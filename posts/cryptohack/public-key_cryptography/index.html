<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self'; form-action 'self'; frame-src 'self'; img-src 'self' data: https://*.google-analytics.com https://*.googletagmanager.com; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' https://*.googletagmanager.com; prefetch-src 'self'; connect-src 'self' https://*.google-analytics.com https://*.analytics.google.com https://*.googletagmanager.com"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CryptoHack Writeup: Public-Key Cryptography | woadey</title>
<meta name=keywords content="cryptohack,crypto,public-key,dh,rsa,writeup"><meta name=description content="Writeups for CryptoHack's Public-Key Cryptography Course"><meta name=author content><link rel=canonical href=https://woadey.xyz/posts/cryptohack/public-key_cryptography/><link crossorigin=anonymous href=/assets/css/stylesheet.801c837919c19cf5e5fa2a539102b0d85b20f9320cf20c026268a4419d9c0537.css integrity="sha256-gByDeRnBnPXl+ipTkQKw2Fsg+TIM8gwCYmikQZ2cBTc=" rel="preload stylesheet" as=style><link rel=icon href=https://woadey.xyz/favicon/pink_trans_bg/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://woadey.xyz/favicon/pink_trans_bg/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://woadey.xyz/favicon/pink_trans_bg/favicon-32x32.png><link rel=apple-touch-icon href=https://woadey.xyz/favicon/white_pink_bg/apple-touch-icon.png><link rel=mask-icon href=https://woadey.xyz/favicon/pink_trans_bg/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://woadey.xyz/posts/cryptohack/public-key_cryptography/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9703667233476494" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-EF924K1NXR"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EF924K1NXR",{anonymize_ip:!1})}</script><meta property="og:title" content="CryptoHack Writeup: Public-Key Cryptography"><meta property="og:description" content="Writeups for CryptoHack's Public-Key Cryptography Course"><meta property="og:type" content="article"><meta property="og:url" content="https://woadey.xyz/posts/cryptohack/public-key_cryptography/"><meta property="og:image" content="https://cryptohack.org/static/img/courses/public-key.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-17T13:36:29-05:00"><meta property="article:modified_time" content="2022-11-17T13:36:29-05:00"><meta property="og:site_name" content="woadey's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cryptohack.org/static/img/courses/public-key.png"><meta name=twitter:title content="CryptoHack Writeup: Public-Key Cryptography"><meta name=twitter:description content="Writeups for CryptoHack's Public-Key Cryptography Course"><meta name=twitter:site content="@woadey_"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"posts","item":"https://woadey.xyz/posts/"},{"@type":"ListItem","position":2,"name":"CryptoHack Writeup: Public-Key Cryptography","item":"https://woadey.xyz/posts/cryptohack/public-key_cryptography/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CryptoHack Writeup: Public-Key Cryptography","name":"CryptoHack Writeup: Public-Key Cryptography","description":"Writeups for CryptoHack's Public-Key Cryptography Course","keywords":["cryptohack","crypto","public-key","dh","rsa","writeup"],"articleBody":"RSA Starter 1 All operations in RSA involve modular exponentiation.\nModular exponentiation is an operation that is used extensively in cryptography and is normally written like: 2^10 mod 17\nYou can think of this as raising some number to a certain power (2^10 = 1024), and then taking the remainder of the division by some other number (1024 mod 17 = 4). In Python there’s a built-in operator for performing this operation: pow(base, exponent, modulus)\nIn RSA, modular exponentiation, together with the problem of prime factorization, helps us to build a “trapdoor function”. This is a function that is easy to compute in one direction, but hard to do in reverse unless you have the right information. It allows us to encrypt a message, and only the person with the key can perform the inverse operation to decrypt it.\nFind the solution to 101^17 mod 22663\nSolution \u003e pow(101, 17, 22663) 19906 flag: 19906\nRSA Starter 2 RSA encryption is modular exponentiation of a message with an exponent e and a modulus N which is normally a product of two primes: N = p * q.\nTogether the exponent and modulus form an RSA “public key” (N, e). The most common value for e is 0x10001 or 65537.\n“Encrypt” the number 12 using the exponent e = 65537 and the primes p = 17 and q = 23. What number do you get as the ciphertext?\nSolution \u003e pow(12,65537,17*23) 301 flag: 301\nRSA Starter 3 RSA relies on the difficulty of the factorization of the modulus N. If the primes can be found then we can calculate the Euler totient of N and thus decrypt the ciphertext.\nGiven N = p*q and two primes:\np = 857504083339712752489993810777\nq = 1029224947942998075080348647219\nWhat is the totient of N?\nSolution \u003e p = 857504083339712752489993810777 \u003e q = 1029224947942998075080348647219 \u003e phi = (p-1)*(q-1) \u003e print(phi) 882564595536224140639625987657529300394956519977044270821168 flag: 882564595536224140639625987657529300394956519977044270821168\nRSA Starter 4 The private key d is used to decrypt ciphertexts created with the corresponding public key (it’s also used to “sign” a message but we’ll get to that later).\nThe private key is the secret piece of information or “trapdoor” which allows us to quickly invert the encryption function. If RSA is implemented well, if you do not have the private key the fastest way to decrypt the ciphertext is to first factorize the modulus.\nIn RSA the private key is the modular multiplicative inverse of the exponent e modulo the totient of N.\nGiven the two primes:\np = 857504083339712752489993810777\nq = 1029224947942998075080348647219\nand the exponent:\ne = 65537\nWhat is the private key d?\nSolution \u003e from Crypto.Util.number import inverse p = 857504083339712752489993810777 q = 1029224947942998075080348647219 e = 65537 phi = (p-1)*(q-1) d = inverse(e, phi) \u003e print(d) 121832886702415731577073962957377780195510499965398469843281 Alternate solution(s):\n# source: CryptoHack user @Scalpel p = 857504083339712752489993810777 q = 1029224947942998075080348647219 e = 65537 phi = (p-1)*(q-1) d = pow(e, -1, phi) print(d) flag: 121832886702415731577073962957377780195510499965398469843281\nRSA Starter 5 I’ve encrypted a secret number for your eyes only using your public key parameters:\nN = 882564595536224140639625987659416029426239230804614613279163\ne = 65537\nUse the private key that you found for these parameters in the previous challenge to decrypt this ciphertext:\nc = 77578995801157823671636298847186723593814843845525223303932\nSolution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 from Crypto.Util.number import inverse, long_to_bytes N = 882564595536224140639625987659416029426239230804614613279163 # http://factordb.com/index.php?query=882564595536224140639625987659416029426239230804614613279163 p = 857504083339712752489993810777 q = 1029224947942998075080348647219 assert p*q == N e = 65537 c = 77578995801157823671636298847186723593814843845525223303932 phi = (p-1)*(q-1) d = inverse(e, phi) m = pow(c, d, N) print(m) 13371337 flag: 13371337\nRSA Starter 6 How can you ensure that the person receiving your message knows that you wrote it?\nYou’ve been asked out on a date, and you want to send a message telling them that you’d love to go, however a jealous lover isn’t so happy about this.\nWhen you send your message saying yes, your jealous lover intercepts the message and corrupts it so it now says no!\nWe can protect against these attacks by signing the message.\nImagine you write a message M. You encrypt this message with your friend’s public key: C = M^e0 mod N0.\nTo sign this message, you calculate the hash of the message: H(M) and “encrypt” this with your private key: S = H(M)^d1 mod N1. Your friend can decrypt the message using their private key: m = C^d0 mod N0. Using your public key they calculate s = S^e1 mod N1.\nNow by computing H(m) and comparing it to s: assert H(m) == s, they can ensure that the message you sent them, is the message that they received!\nSign the flag crypto{Immut4ble_m3ssag1ng} using your private key and the SHA256 hash function.\nChallenge files:\nprivate.key file: private.key\n1 2 N = 15216583654836731327639981224133918855895948374072384050848479908982286890731769486609085918857664046075375253168955058743185664390273058074450390236774324903305663479046566232967297765731625328029814055635316002591227570271271445226094919864475407884459980489638001092788574811554149774028950310695112688723853763743238753349782508121985338746755237819373178699343135091783992299561827389745132880022259873387524273298850340648779897909381979714026837172003953221052431217940632552930880000919436507245150726543040714721553361063311954285289857582079880295199632757829525723874753306371990452491305564061051059885803 d = 11175901210643014262548222473449533091378848269490518850474399681690547281665059317155831692300453197335735728459259392366823302405685389586883670043744683993709123180805154631088513521456979317628012721881537154107239389466063136007337120599915456659758559300673444689263854921332185562706707573660658164991098457874495054854491474065039621922972671588299315846306069845169959451250821044417886630346229021305410340100401530146135418806544340908355106582089082980533651095594192031411679866134256418292249592135441145384466261279428795408721990564658703903787956958168449841491667690491585550160457893350536334242689 Solution 1 2 3 4 5 6 7 8 9 10 from hashlib import sha256 from Crypto.Util.number import bytes_to_long N = 15216583654836731327639981224133918855895948374072384050848479908982286890731769486609085918857664046075375253168955058743185664390273058074450390236774324903305663479046566232967297765731625328029814055635316002591227570271271445226094919864475407884459980489638001092788574811554149774028950310695112688723853763743238753349782508121985338746755237819373178699343135091783992299561827389745132880022259873387524273298850340648779897909381979714026837172003953221052431217940632552930880000919436507245150726543040714721553361063311954285289857582079880295199632757829525723874753306371990452491305564061051059885803 d = 11175901210643014262548222473449533091378848269490518850474399681690547281665059317155831692300453197335735728459259392366823302405685389586883670043744683993709123180805154631088513521456979317628012721881537154107239389466063136007337120599915456659758559300673444689263854921332185562706707573660658164991098457874495054854491474065039621922972671588299315846306069845169959451250821044417886630346229021305410340100401530146135418806544340908355106582089082980533651095594192031411679866134256418292249592135441145384466261279428795408721990564658703903787956958168449841491667690491585550160457893350536334242689 m = b'crypto{Immut4ble_m3ssag1ng}' h_m = bytes_to_long(sha256(m).digest()) s = pow(h_m, d, N) print(hex(s)[2:]) 6ac9bb8f110b318a40ad8d7e57defdcce2652f5928b5f9b97c1504d7096d7af1d34e477b30f1a08014e8d525b14458b709a77a5fa67d4711bd19da1446f9fb0ffd9fdedc4101bdc9a4b26dd036f11d02f6b56f4926170c643f302d59c4fe8ea678b3ca91b4bb9b2024f2a839bec1514c0242b57e1f5e77999ee67c450982730252bc2c3c35acb4ac06a6ce8b9dbf84e29df0baa7369e0fd26f6dfcfb22a464e05c5b72baba8f78dc742e96542169710918ee2947749477869cb3567180ccbdfe6fdbe85bcaca4bf6da77c8f382bb4c8cd56dee43d1290ca856318c97f1756b789e3cac0c9738f5e9f797314d39a2ededb92583d97124ec6b313c4ea3464037d3 flag: 6ac9bb8f110b318a40ad8d7e57defdcce2652f5928b5f9b97c1504d7096d7af1d34e477b30f1a08014e8d525b14458b709a77a5fa67d4711bd19da1446f9fb0ffd9fdedc4101bdc9a4b26dd036f11d02f6b56f4926170c643f302d59c4fe8ea678b3ca91b4bb9b2024f2a839bec1514c0242b57e1f5e77999ee67c450982730252bc2c3c35acb4ac06a6ce8b9dbf84e29df0baa7369e0fd26f6dfcfb22a464e05c5b72baba8f78dc742e96542169710918ee2947749477869cb3567180ccbdfe6fdbe85bcaca4bf6da77c8f382bb4c8cd56dee43d1290ca856318c97f1756b789e3cac0c9738f5e9f797314d39a2ededb92583d97124ec6b313c4ea3464037d3\nFactoring So far we’ve been using the product of small primes for the modulus, but small primes aren’t much good for RSA as they can be factorized using modern methods.\nWhat is a “small prime”? There was an RSA Factoring Challenge with cash prizes given to teams who could factorize RSA moduli. This gave insight to the public into how long various key sizes would remain safe. Computers get faster, algorithms get better, so in cryptography it’s always prudent to err on the side of caution.\nThese days, using primes that are at least 1024 bits long is recommended–multiplying two such 1024 primes gives you a modulus that is 2048 bits large. RSA with a 2048-bit modulus is called RSA-2048.\nSome say that to really remain future-proof you should use RSA-4096 or even RSA-8192. However, there is a tradeoff here; it takes longer to generate large prime numbers, plus modular exponentiations are predictably slower with a large modulus.\nFactorize the 150-bit number 510143758735509025530880200653196460532653147 into its two constituent primes. Give the smaller one as your answer.\nResources:\nHow big an RSA key is considered secure today? primefac-fork Solution factorDB gives us the factors:\np = 19704762736204164635843 q = 25889363174021185185929 Monoprime Why is everyone so obsessed with multiplying two primes for RSA. Why not just use one?\nChallenge files:\noutput.txt Resources:\nWhy do we need in RSA the modulus to be product of 2 primes? file: output.txt\n1 2 3 n = 171731371218065444125482536302245915415603318380280392385291836472299752747934607246477508507827284075763910264995326010251268493630501989810855418416643352631102434317900028697993224868629935657273062472544675693365930943308086634291936846505861203914449338007760990051788980485462592823446469606824421932591 e = 65537 ct = 161367550346730604451454756189028938964941280347662098798775466019463375610700074840105776873791605070092554650190486030367121011578171525759600774739890458414593857709994072516290998135846956596662071379067305011746842247628316996977338024343628757374524136260758515864509435302781735938531030576289086798942 Solution 1 2 3 4 5 6 7 8 9 from Crypto.Util.number import inverse, long_to_bytes n = 171731371218065444125482536302245915415603318380280392385291836472299752747934607246477508507827284075763910264995326010251268493630501989810855418416643352631102434317900028697993224868629935657273062472544675693365930943308086634291936846505861203914449338007760990051788980485462592823446469606824421932591 e = 65537 ct = 161367550346730604451454756189028938964941280347662098798775466019463375610700074840105776873791605070092554650190486030367121011578171525759600774739890458414593857709994072516290998135846956596662071379067305011746842247628316996977338024343628757374524136260758515864509435302781735938531030576289086798942 phi = n-1 d = inverse(e, phi) m = pow(ct, d, n) print(long_to_bytes(m)) b'crypto{0n3_pr1m3_41n7_pr1m3_l0l}' flag: crypto{0n3_pr1m3_41n7_pr1m3_l0l}\nManyprime Using one prime factor was definitely a bad idea so I’ll try using over 30 instead.\nChallenge files:\noutput.txt Resources:\nThe Elliptic Curve Factorization Method file: output.txt\n1 2 3 n = 580642391898843192929563856870897799650883152718761762932292482252152591279871421569162037190419036435041797739880389529593674485555792234900969402019055601781662044515999210032698275981631376651117318677368742867687180140048715627160641771118040372573575479330830092989800730105573700557717146251860588802509310534792310748898504394966263819959963273509119791037525504422606634640173277598774814099540555569257179715908642917355365791447508751401889724095964924513196281345665480688029639999472649549163147599540142367575413885729653166517595719991872223011969856259344396899748662101941230745601719730556631637 e = 65537 ct = 320721490534624434149993723527322977960556510750628354856260732098109692581338409999983376131354918370047625150454728718467998870322344980985635149656977787964380651868131740312053755501594999166365821315043312308622388016666802478485476059625888033017198083472976011719998333985531756978678758897472845358167730221506573817798467100023754709109274265835201757369829744113233607359526441007577850111228850004361838028842815813724076511058179239339760639518034583306154826603816927757236549096339501503316601078891287408682099750164720032975016814187899399273719181407940397071512493967454225665490162619270814464 Solution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 from sage.all import ecm from Crypto.Util.number import inverse, long_to_bytes n = 580642391898843192929563856870897799650883152718761762932292482252152591279871421569162037190419036435041797739880389529593674485555792234900969402019055601781662044515999210032698275981631376651117318677368742867687180140048715627160641771118040372573575479330830092989800730105573700557717146251860588802509310534792310748898504394966263819959963273509119791037525504422606634640173277598774814099540555569257179715908642917355365791447508751401889724095964924513196281345665480688029639999472649549163147599540142367575413885729653166517595719991872223011969856259344396899748662101941230745601719730556631637 e = 65537 ct = 320721490534624434149993723527322977960556510750628354856260732098109692581338409999983376131354918370047625150454728718467998870322344980985635149656977787964380651868131740312053755501594999166365821315043312308622388016666802478485476059625888033017198083472976011719998333985531756978678758897472845358167730221506573817798467100023754709109274265835201757369829744113233607359526441007577850111228850004361838028842815813724076511058179239339760639518034583306154826603816927757236549096339501503316601078891287408682099750164720032975016814187899399273719181407940397071512493967454225665490162619270814464 factors = ecm.factor(n) phi = 1 for f in factors: phi *= f-1 d = inverse(e, phi) m = pow(ct, d, n) print(long_to_bytes(int(m))) b'crypto{700_m4ny_5m4ll_f4c70r5}' flag: crypto{700_m4ny_5m4ll_f4c70r5}\nSalty Smallest exponent should be fastest, right?\nChallenge files:\nsalty.py output.txt file: salty.py\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #!/usr/bin/env python3 from Crypto.Util.number import getPrime, inverse, bytes_to_long, long_to_bytes e = 1 d = -1 while d == -1: p = getPrime(512) q = getPrime(512) phi = (p - 1) * (q - 1) d = inverse(e, phi) n = p * q flag = b\"XXXXXXXXXXXXXXXXXXXXXXX\" pt = bytes_to_long(flag) ct = pow(pt, e, n) print(f\"n = {n}\") print(f\"e = {e}\") print(f\"ct = {ct}\") pt = pow(ct, d, n) decrypted = long_to_bytes(pt) assert decrypted == flag file: output.txt\n1 2 3 n = 110581795715958566206600392161360212579669637391437097703685154237017351570464767725324182051199901920318211290404777259728923614917211291562555864753005179326101890427669819834642007924406862482343614488768256951616086287044725034412802176312273081322195866046098595306261781788276570920467840172004530873767 e = 1 ct = 44981230718212183604274785925793145442655465025264554046028251311164494127485 Solution 1 2 3 4 5 6 7 8 from Crypto.Util.number import long_to_bytes n = 110581795715958566206600392161360212579669637391437097703685154237017351570464767725324182051199901920318211290404777259728923614917211291562555864753005179326101890427669819834642007924406862482343614488768256951616086287044725034412802176312273081322195866046098595306261781788276570920467840172004530873767 e = 1 ct = 44981230718212183604274785925793145442655465025264554046028251311164494127485 m = pow(ct, 1, n) print(long_to_bytes(m)) b'crypto{saltstack_fell_for_this!}' flag: crypto{saltstack_fell_for_this!}\nModulus Inutilis My primes should be more than large enough now!\nChallenge files:\nmodulus_inutilis.py output.txt file: modulus_inutilis.py\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #!/usr/bin/env python3 from Crypto.Util.number import getPrime, inverse, bytes_to_long, long_to_bytes e = 3 d = -1 while d == -1: p = getPrime(1024) q = getPrime(1024) phi = (p - 1) * (q - 1) d = inverse(e, phi) n = p * q flag = b\"XXXXXXXXXXXXXXXXXXXXXXX\" pt = bytes_to_long(flag) ct = pow(pt, e, n) print(f\"n = {n}\") print(f\"e = {e}\") print(f\"ct = {ct}\") pt = pow(ct, d, n) decrypted = long_to_bytes(pt) assert decrypted == flag file: output.txt\n1 2 3 n = 17258212916191948536348548470938004244269544560039009244721959293554822498047075403658429865201816363311805874117705688359853941515579440852166618074161313773416434156467811969628473425365608002907061241714688204565170146117869742910273064909154666642642308154422770994836108669814632309362483307560217924183202838588431342622551598499747369771295105890359290073146330677383341121242366368309126850094371525078749496850520075015636716490087482193603562501577348571256210991732071282478547626856068209192987351212490642903450263288650415552403935705444809043563866466823492258216747445926536608548665086042098252335883 e = 3 ct = 243251053617903760309941844835411292373350655973075480264001352919865180151222189820473358411037759381328642957324889519192337152355302808400638052620580409813222660643570085177957 Solution 1 2 3 4 5 6 7 from Crypto.Util.number import long_to_bytes from gmpy2 import iroot n = 17258212916191948536348548470938004244269544560039009244721959293554822498047075403658429865201816363311805874117705688359853941515579440852166618074161313773416434156467811969628473425365608002907061241714688204565170146117869742910273064909154666642642308154422770994836108669814632309362483307560217924183202838588431342622551598499747369771295105890359290073146330677383341121242366368309126850094371525078749496850520075015636716490087482193603562501577348571256210991732071282478547626856068209192987351212490642903450263288650415552403935705444809043563866466823492258216747445926536608548665086042098252335883 e = 3 ct = 243251053617903760309941844835411292373350655973075480264001352919865180151222189820473358411037759381328642957324889519192337152355302808400638052620580409813222660643570085177957 print(long_to_bytes(iroot(ct,3)[0])) b'crypto{N33d_m04R_p4dd1ng}' flag: crypto{N33d_m04R_p4dd1ng}\nDiffie-Hellman Starter 1 The set of integers modulo n, together with the operations of both addition and multiplication is a ring. This means that adding or multiplying any two elements in the set returns another element in the set.\nWhen the modulus is prime: n = p, we are guaranteed an inverse of every element in the set, and so the ring is promoted to a field. We refer to this field as a finite field Fp.\nThe Diffie-Hellman protocol works with elements of some finite field Fp, where the prime modulus is typically a large prime.\nGiven the prime p = 991, and the element g = 209, find the inverse element d such that g * d mod 991 = 1.\nSolution \u003e from Crypto.Util.number import inverse \u003e inverse(209, 991) 549 flag: 549\nDiffie-Hellman Starter 2 Every element of a finite field Fp can be used to make a subgroup H under repeated action of multiplication. In other words, for an element g: H = {g, g^2, g^3, ...}\nA primitive element of Fp is an element whose subgroup H = Fp, i.e., every element of Fp, can be written as g^n mod p for some integer n. Because of this, primitive elements are sometimes called generators of the finite field.\nFor the finite field with p = 28151 find the smallest element g which is a primitive element of Fp.\nSolution \u003e from sage.all import GF \u003e GF(28151).primitive_element() 7 flag: 7\nDiffie-Hellman Starter 3 The Diffie-Hellman protocol is used because the discrete logarithm is assumed to be a “hard” computation for carefully chosen groups.\nThe first step of the protocol is to establish a prime p and some generator of the finite field g. These must be carefully chosen to avoid special cases where the discrete log can be solved with efficient algorithms. For example, a safe prime p = 2*q +1 is usually picked such that the only factors of p - 1 are {2,q} where q is some other large prime. This protects DH from the Pohlig–Hellman algorithm.\nThe user then picks a secret integer a \u003c p and calculates g^a mod p. This can be transmitted over an insecure network and due to the assumed difficulty of the discrete logarithm, if the protocol has been implemented correctly the secret integer should be infeasible to compute.\nGiven the NIST parameters:\ng: 2 p: 2410312426921032588552076022197566074856950548502459942654116941958108831682612228890093858261341614673227141477904012196503648957050582631942730706805009223062734745341073406696246014589361659774041027169249453200378729434170325843778659198143763193776859869524088940195577346119843545301547043747207749969763750084308926339295559968882457872412993810129130294592999947926365264059284647209730384947211681434464714438488520940127459844288859336526896320919633919 Calculate the value of g^a mod p for\na: 972107443837033796245864316200458246846904598488981605856765890478853088246897345487328491037710219222038930943365848626194109830309179393018216763327572120124760140018038673999837643377590434413866611132403979547150659053897355593394492586978400044375465657296027592948349589216415363722668361328689588996541370097559090335137676411595949335857341797148926151694299575970292809805314431447043469447485957669949989090202320234337890323293401862304986599884732815` Solution \u003e p = 2410312426921032588552076022197566074856950548502459942654116941958108831682612228890093858261341614673227141477904012196503648957050582631942730706805009223062734745341073406696246014589361659774041027169249453200378729434170325843778659198143763193776859869524088940195577346119843545301547043747207749969763750084308926339295559968882457872412993810129130294592999947926365264059284647209730384947211681434464714438488520940127459844288859336526896320919633919 \u003e a = 972107443837033796245864316200458246846904598488981605856765890478853088246897345487328491037710219222038930943365848626194109830309179393018216763327572120124760140018038673999837643377590434413866611132403979547150659053897355593394492586978400044375465657296027592948349589216415363722668361328689588996541370097559090335137676411595949335857341797148926151694299575970292809805314431447043469447485957669949989090202320234337890323293401862304986599884732815 \u003e g = 2 \u003e pow(g, a, p) 1806857697840726523322586721820911358489420128129248078673933653533930681676181753849411715714173604352323556558783759252661061186320274214883104886050164368129191719707402291577330485499513522368289395359523901406138025022522412429238971591272160519144672389532393673832265070057319485399793101182682177465364396277424717543434017666343807276970864475830391776403957550678362368319776566025118492062196941451265638054400177248572271342548616103967411990437357924 flag:\n1806857697840726523322586721820911358489420128129248078673933653533930681676181753849411715714173604352323556558783759252661061186320274214883104886050164368129191719707402291577330485499513522368289395359523901406138025022522412429238971591272160519144672389532393673832265070057319485399793101182682177465364396277424717543434017666343807276970864475830391776403957550678362368319776566025118492062196941451265638054400177248572271342548616103967411990437357924 Diffie-Hellman Starter 4 Now it’s time to calculate a shared secret using data received from your friend Alice. Like before, we will be using the NIST parameters:\ng: 2 p: 2410312426921032588552076022197566074856950548502459942654116941958108831682612228890093858261341614673227141477904012196503648957050582631942730706805009223062734745341073406696246014589361659774041027169249453200378729434170325843778659198143763193776859869524088940195577346119843545301547043747207749969763750084308926339295559968882457872412993810129130294592999947926365264059284647209730384947211681434464714438488520940127459844288859336526896320919633919 You have received the following integer from Alice:\nA: 70249943217595468278554541264975482909289174351516133994495821400710625291840101960595720462672604202133493023241393916394629829526272643847352371534839862030410331485087487331809285533195024369287293217083414424096866925845838641840923193480821332056735592483730921055532222505605661664236182285229504265881752580410194731633895345823963910901731715743835775619780738974844840425579683385344491015955892106904647602049559477279345982530488299847663103078045601 You generate your secret integer b and calculate your public one B, which you send to Alice.\nb: 12019233252903990344598522535774963020395770409445296724034378433497976840167805970589960962221948290951873387728102115996831454482299243226839490999713763440412177965861508773420532266484619126710566414914227560103715336696193210379850575047730388378348266180934946139100479831339835896583443691529372703954589071507717917136906770122077739814262298488662138085608736103418601750861698417340264213867753834679359191427098195887112064503104510489610448294420720` B: 518386956790041579928056815914221837599234551655144585133414727838977145777213383018096662516814302583841858901021822273505120728451788412967971809038854090670743265187138208169355155411883063541881209288967735684152473260687799664130956969450297407027926009182761627800181901721840557870828019840218548188487260441829333603432714023447029942863076979487889569452186257333512355724725941390498966546682790608125613166744820307691068563387354936732643569654017172 You and Alice are now able to calculate a shared secret, which would be infeasible to calculate knowing only {g,p,A,B}.\nWhat is your shared secret?\nSolution \u003e A = 70249943217595468278554541264975482909289174351516133994495821400710625291840101960595720462672604202133493023241393916394629829526272643847352371534839862030410331485087487331809285533195024369287293217083414424096866925845838641840923193480821332056735592483730921055532222505605661664236182285229504265881752580410194731633895345823963910901731715743835775619780738974844840425579683385344491015955892106904647602049559477279345982530488299847663103078045601 \u003e b = 12019233252903990344598522535774963020395770409445296724034378433497976840167805970589960962221948290951873387728102115996831454482299243226839490999713763440412177965861508773420532266484619126710566414914227560103715336696193210379850575047730388378348266180934946139100479831339835896583443691529372703954589071507717917136906770122077739814262298488662138085608736103418601750861698417340264213867753834679359191427098195887112064503104510489610448294420720 \u003e p = 2410312426921032588552076022197566074856950548502459942654116941958108831682612228890093858261341614673227141477904012196503648957050582631942730706805009223062734745341073406696246014589361659774041027169249453200378729434170325843778659198143763193776859869524088940195577346119843545301547043747207749969763750084308926339295559968882457872412993810129130294592999947926365264059284647209730384947211681434464714438488520940127459844288859336526896320919633919 \u003e pow(A,b,p) 1174130740413820656533832746034841985877302086316388380165984436672307692443711310285014138545204369495478725102882673427892104539120952393788961051992901649694063179853598311473820341215879965343136351436410522850717408445802043003164658348006577408558693502220285700893404674592567626297571222027902631157072143330043118418467094237965591198440803970726604537807146703763571606861448354607502654664700390453794493176794678917352634029713320615865940720837909466 flag:\n1174130740413820656533832746034841985877302086316388380165984436672307692443711310285014138545204369495478725102882673427892104539120952393788961051992901649694063179853598311473820341215879965343136351436410522850717408445802043003164658348006577408558693502220285700893404674592567626297571222027902631157072143330043118418467094237965591198440803970726604537807146703763571606861448354607502654664700390453794493176794678917352634029713320615865940720837909466 Diffie-Hellman Starter 5 Alice wants to send you her secret flag and asks you to generate a shared secret with her. She also tells you she will be using the NIST standard:\ng: 2 p: 2410312426921032588552076022197566074856950548502459942654116941958108831682612228890093858261341614673227141477904012196503648957050582631942730706805009223062734745341073406696246014589361659774041027169249453200378729434170325843778659198143763193776859869524088940195577346119843545301547043747207749969763750084308926339295559968882457872412993810129130294592999947926365264059284647209730384947211681434464714438488520940127459844288859336526896320919633919 You receive the following integer from Alice:\nA: 112218739139542908880564359534373424013016249772931962692237907571990334483528877513809272625610512061159061737608547288558662879685086684299624481742865016924065000555267977830144740364467977206555914781236397216033805882207640219686011643468275165718132888489024688846101943642459655423609111976363316080620471928236879737944217503462265615774774318986375878440978819238346077908864116156831874695817477772477121232820827728424890845769152726027520772901423784 You then generate your secret integer and calculate your public one, which you send to Alice.\nb: 197395083814907028991785772714920885908249341925650951555219049411298436217190605190824934787336279228785809783531814507661385111220639329358048196339626065676869119737979175531770768861808581110311903548567424039264485661330995221907803300824165469977099494284722831845653985392791480264712091293580274947132480402319812110462641143884577706335859190668240694680261160210609506891842793868297672619625924001403035676872189455767944077542198064499486164431451944 B: 1241972460522075344783337556660700537760331108332735677863862813666578639518899293226399921252049655031563612905395145236854443334774555982204857895716383215705498970395379526698761468932147200650513626028263449605755661189525521343142979265044068409405667549241125597387173006460145379759986272191990675988873894208956851773331039747840312455221354589910726982819203421992729738296452820365553759182547255998984882158393688119629609067647494762616719047466973581` Individually you each use the shared secret to derive an AES private key. This allows you to encrypt large amounts of data over your channel without needing to exchange keys again.\nAlice sends you the following IV and ciphertext:\n{'iv': '737561146ff8194f45290f5766ed6aba', 'encrypted_flag': '39c99bf2f0c14678d6a5416faef954b5893c316fc3c48622ba1fd6a9fe85f3dc72a29c394cf4bc8aff6a7b21cae8e12c'} Decrypt this to obtain your flag!\nChallenge files:\nsource.py decrypt.py file: source.py\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 from Crypto.Cipher import AES from Crypto.Util.Padding import pad, unpad import hashlib import os from secret import shared_secret FLAG = b'crypto{????????????????????????????}' def encrypt_flag(shared_secret: int): # Derive AES key from shared secret sha1 = hashlib.sha1() sha1.update(str(shared_secret).encode('ascii')) key = sha1.digest()[:16] # Encrypt flag iv = os.urandom(16) cipher = AES.new(key, AES.MODE_CBC, iv) ciphertext = cipher.encrypt(pad(FLAG, 16)) # Prepare data to send data = {} data['iv'] = iv.hex() data['encrypted_flag'] = ciphertext.hex() return data print(encrypt_flag(shared_secret)) file: decrypt.py\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 from Crypto.Cipher import AES from Crypto.Util.Padding import pad, unpad import hashlib def is_pkcs7_padded(message): padding = message[-message[-1]:] return all(padding[i] == len(padding) for i in range(0, len(padding))) def decrypt_flag(shared_secret: int, iv: str, ciphertext: str): # Derive AES key from shared secret sha1 = hashlib.sha1() sha1.update(str(shared_secret).encode('ascii')) key = sha1.digest()[:16] # Decrypt flag ciphertext = bytes.fromhex(ciphertext) iv = bytes.fromhex(iv) cipher = AES.new(key, AES.MODE_CBC, iv) plaintext = cipher.decrypt(ciphertext) if is_pkcs7_padded(plaintext): return unpad(plaintext, 16).decode('ascii') else: return plaintext.decode('ascii') shared_secret = ? iv = ? ciphertext = ? print(decrypt_flag(shared_secret, iv, ciphertext)) Solution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 from Crypto.Cipher import AES from Crypto.Util.Padding import pad, unpad import hashlib def is_pkcs7_padded(message): padding = message[-message[-1]:] return all(padding[i] == len(padding) for i in range(0, len(padding))) def decrypt_flag(shared_secret: int, iv: str, ciphertext: str): # Derive AES key from shared secret sha1 = hashlib.sha1() sha1.update(str(shared_secret).encode('ascii')) key = sha1.digest()[:16] # Decrypt flag ciphertext = bytes.fromhex(ciphertext) iv = bytes.fromhex(iv) cipher = AES.new(key, AES.MODE_CBC, iv) plaintext = cipher.decrypt(ciphertext) if is_pkcs7_padded(plaintext): return unpad(plaintext, 16).decode('ascii') else: return plaintext.decode('ascii') A = 112218739139542908880564359534373424013016249772931962692237907571990334483528877513809272625610512061159061737608547288558662879685086684299624481742865016924065000555267977830144740364467977206555914781236397216033805882207640219686011643468275165718132888489024688846101943642459655423609111976363316080620471928236879737944217503462265615774774318986375878440978819238346077908864116156831874695817477772477121232820827728424890845769152726027520772901423784 b = 197395083814907028991785772714920885908249341925650951555219049411298436217190605190824934787336279228785809783531814507661385111220639329358048196339626065676869119737979175531770768861808581110311903548567424039264485661330995221907803300824165469977099494284722831845653985392791480264712091293580274947132480402319812110462641143884577706335859190668240694680261160210609506891842793868297672619625924001403035676872189455767944077542198064499486164431451944 p = 2410312426921032588552076022197566074856950548502459942654116941958108831682612228890093858261341614673227141477904012196503648957050582631942730706805009223062734745341073406696246014589361659774041027169249453200378729434170325843778659198143763193776859869524088940195577346119843545301547043747207749969763750084308926339295559968882457872412993810129130294592999947926365264059284647209730384947211681434464714438488520940127459844288859336526896320919633919 shared_secret = pow(A, b, p) iv = '737561146ff8194f45290f5766ed6aba' ciphertext = '39c99bf2f0c14678d6a5416faef954b5893c316fc3c48622ba1fd6a9fe85f3dc72a29c394cf4bc8aff6a7b21cae8e12c' print(decrypt_flag(shared_secret, iv, ciphertext)) flag: crypto{sh4r1ng_s3cret5_w1th_fr13nd5}\nParameter Injection You’re in a position to not only intercept Alice and Bob’s DH key exchange, but also rewrite their messages. Think about how you can play with the DH equation that they calculate, and therefore sidestep the need to crack any discrete logarithm problem.\nUse the script from “Diffie-Hellman Starter 5” to decrypt the flag once you’ve recovered the shared secret.\nConnect at nc socket.cryptohack.org 13371\nSolution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 from Crypto.Cipher import AES from Crypto.Util.Padding import pad, unpad import hashlib from pwn import * from json import loads, dumps def is_pkcs7_padded(message): padding = message[-message[-1]:] return all(padding[i] == len(padding) for i in range(0, len(padding))) def decrypt_flag(shared_secret: int, iv: str, ciphertext: str): # Derive AES key from shared secret sha1 = hashlib.sha1() sha1.update(str(shared_secret).encode('ascii')) key = sha1.digest()[:16] # Decrypt flag ciphertext = bytes.fromhex(ciphertext) iv = bytes.fromhex(iv) cipher = AES.new(key, AES.MODE_CBC, iv) plaintext = cipher.decrypt(ciphertext) if is_pkcs7_padded(plaintext): return unpad(plaintext, 16).decode('ascii') else: return plaintext.decode('ascii') r = remote('socket.cryptohack.org', 13371) # Alice -\u003e Us r.readuntilS(b': ') json = loads(r.readlineS()) p = int(json['p'], 16) A = int(json['A'], 16) g = int(json['g'], 16) # Us -\u003e Bob payload = dumps({\"p\":hex(p),\"g\":hex(g),\"A\":hex(p)}).encode('latin') r.sendlineafter(b\"Bob: \", payload) # Us -\u003e Alice (fake Bob's response) payload = dumps({\"B\":\"0x1\"}).encode('latin') r.sendlineafter(b\"Alice: \", payload) # Alice -\u003e Us r.readuntilS(b': ') json = loads(r.readlineS()) iv = json['iv'] ct = json['encrypted_flag'] # Decrypt (shared key = 1 since we sent B=0x1) flag = decrypt_flag(1, iv, ct) print(flag) flag: crypto{n1c3_0n3_m4ll0ry!!!!!!!!}\nExport-grade Alice and Bob are using legacy codebases and need to negotiate parameters they both support. You’ve man-in-the-middled this negotiation step, and can passively observe thereafter. How are you going to ruin their day this time?\nConnect at nc socket.cryptohack.org 13379\nSolution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 from Crypto.Cipher import AES from Crypto.Util.Padding import pad, unpad import hashlib from pwn import * from sage.all import * from json import loads, dumps def is_pkcs7_padded(message): padding = message[-message[-1]:] return all(padding[i] == len(padding) for i in range(0, len(padding))) def decrypt_flag(shared_secret: int, iv: str, ciphertext: str): # Derive AES key from shared secret sha1 = hashlib.sha1() sha1.update(str(shared_secret).encode('ascii')) key = sha1.digest()[:16] # Decrypt flag ciphertext = bytes.fromhex(ciphertext) iv = bytes.fromhex(iv) cipher = AES.new(key, AES.MODE_CBC, iv) plaintext = cipher.decrypt(ciphertext) if is_pkcs7_padded(plaintext): return unpad(plaintext, 16).decode('ascii') else: return plaintext.decode('ascii') r = remote('socket.cryptohack.org', 13379) # Alice -\u003e Us r.readuntilS(b'Alice: ') # Us -\u003e Bob payload = dumps({\"supported\": [\"DH64\"]}).encode('latin') r.sendlineafter(b\"Bob: \", payload) # Bob -\u003e Us r.readuntilS(b'Bob: ') # Us -\u003e Alice payload = r.readline() r.sendlineafter(b\"Alice: \", payload) # Alice -\u003e Us r.readuntilS(b'Alice: ') json = loads(r.readlineS()) p = GF(json['p']) g = p(json['g']) A = p(json['A']) # Bob -\u003e Us r.readuntilS(b'Bob: ') json = loads(r.readlineS()) B = p(json['B']) # Alice -\u003e Us r.readuntilS(b'Alice: ') json = loads(r.readlineS()) iv = json['iv'] ct = json['encrypted_flag'] # Decrypt n = discrete_log(A, g) shared_key = B**n flag = decrypt_flag(shared_key, iv, ct) print(flag) Alternate solution(s): [ image source: CryptoHack user @FELD ] flag: crypto{d0wn6r4d35_4r3_d4n63r0u5}\n","wordCount":"3105","inLanguage":"en","image":"https://cryptohack.org/static/img/courses/public-key.png","datePublished":"2022-11-17T13:36:29-05:00","dateModified":"2022-11-17T13:36:29-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://woadey.xyz/posts/cryptohack/public-key_cryptography/"},"publisher":{"@type":"Organization","name":"woadey","logo":{"@type":"ImageObject","url":"https://woadey.xyz/favicon/pink_trans_bg/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://woadey.xyz/ accesskey=h title="oadey (Alt + H)"><img src=/images/pink.jpeg srcset="/images/pink_hu5661c188f24668226bb80c6208008ab1_117796_0x32_resize_q75_h2_box.webp 32w, /images/pink_hu5661c188f24668226bb80c6208008ab1_117796_64x0_resize_q75_h2_box.webp 120w" sizes=32px height=32 width=32 alt=logo aria-label=logo>
oadey</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://woadey.xyz/posts/ title=posts><span>posts</span></a></li><li><a href=https://woadey.xyz/categories/ title=categories><span>categories</span></a></li><li><a href=https://woadey.xyz/tags/ title=tags><span>tags</span></a></li><li><a href=https://woadey.xyz/archives/ title=archives><span>archives</span></a></li><li><a href=https://woadey.xyz/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://woadey.xyz/>home</a>&nbsp;»&nbsp;<a href=https://woadey.xyz/posts/>posts</a></div><h1 class="post-title entry-hint-parent">CryptoHack Writeup: Public-Key Cryptography</h1><div class=post-description>Writeups for CryptoHack's Public-Key Cryptography Course</div><div class=post-meta><span title='2022-11-17 13:36:29 -0500 -0500'>November 17, 2022</span>&nbsp;·&nbsp;15 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#rsa-starter-1>RSA Starter 1</a><ul><li><a href=#solution>Solution</a></li></ul></li><li><a href=#rsa-starter-2>RSA Starter 2</a><ul><li><a href=#solution-1>Solution</a></li></ul></li><li><a href=#rsa-starter-3>RSA Starter 3</a><ul><li><a href=#solution-2>Solution</a></li></ul></li><li><a href=#rsa-starter-4>RSA Starter 4</a><ul><li><a href=#solution-3>Solution</a></li></ul></li><li><a href=#rsa-starter-5>RSA Starter 5</a><ul><li><a href=#solution-4>Solution</a></li></ul></li><li><a href=#rsa-starter-6>RSA Starter 6</a><ul><li><a href=#solution-5>Solution</a></li></ul></li><li><a href=#factoring>Factoring</a><ul><li><a href=#solution-6>Solution</a></li></ul></li><li><a href=#monoprime>Monoprime</a><ul><li><a href=#solution-7>Solution</a></li></ul></li><li><a href=#manyprime>Manyprime</a><ul><li><a href=#solution-8>Solution</a></li></ul></li><li><a href=#salty>Salty</a><ul><li><a href=#solution-9>Solution</a></li></ul></li><li><a href=#modulus-inutilis>Modulus Inutilis</a><ul><li><a href=#solution-10>Solution</a></li></ul></li><li><a href=#diffie-hellman-starter-1>Diffie-Hellman Starter 1</a><ul><li><a href=#solution-11>Solution</a></li></ul></li><li><a href=#diffie-hellman-starter-2>Diffie-Hellman Starter 2</a><ul><li><a href=#solution-12>Solution</a></li></ul></li><li><a href=#diffie-hellman-starter-3>Diffie-Hellman Starter 3</a><ul><li><a href=#solution-13>Solution</a></li></ul></li><li><a href=#diffie-hellman-starter-4>Diffie-Hellman Starter 4</a><ul><li><a href=#solution-14>Solution</a></li></ul></li><li><a href=#diffie-hellman-starter-5>Diffie-Hellman Starter 5</a><ul><li><a href=#solution-15>Solution</a></li></ul></li><li><a href=#parameter-injection>Parameter Injection</a><ul><li><a href=#solution-16>Solution</a></li></ul></li><li><a href=#export-grade>Export-grade</a><ul><li><a href=#solution-17>Solution</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=rsa-starter-1>RSA Starter 1<a hidden class=anchor aria-hidden=true href=#rsa-starter-1>#</a></h2><blockquote><p>All operations in RSA involve <a href=https://en.wikipedia.org/wiki/Modular_exponentiation title="modular exponentiation" target=_blank rel="nofollow noopener">modular exponentiation</a>.</p><p>Modular exponentiation is an operation that is used extensively in cryptography and is normally written like: <code>2^10 mod 17</code></p><p>You can think of this as raising some number to a certain power (<code>2^10 = 1024</code>), and then taking the remainder of the division by some other number (<code>1024 mod 17 = 4</code>). In Python there&rsquo;s a built-in operator for performing this operation: <code>pow(base, exponent, modulus)</code></p><p>In RSA, modular exponentiation, together with the problem of prime factorization, helps us to build a &ldquo;<a href=https://en.wikipedia.org/wiki/Trapdoor_function title="trapdoor function" target=_blank rel="nofollow noopener">trapdoor function</a>&rdquo;. This is a function that is easy to compute in one direction, but hard to do in reverse unless you have the right information. It allows us to encrypt a message, and only the person with the key can perform the inverse operation to decrypt it.</p><p>Find the solution to <code>101^17 mod 22663</code></p></blockquote><h3 id=solution>Solution<a hidden class=anchor aria-hidden=true href=#solution>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;</span> <span class=nb>pow</span><span class=p>(</span><span class=mi>101</span><span class=p>,</span> <span class=mi>17</span><span class=p>,</span> <span class=mi>22663</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>19906</span>
</span></span></code></pre></div><p><strong>flag:</strong> <code>19906</code></p><h2 id=rsa-starter-2>RSA Starter 2<a hidden class=anchor aria-hidden=true href=#rsa-starter-2>#</a></h2><blockquote><p>RSA encryption is modular exponentiation of a message with an exponent <code>e</code> and a modulus <code>N</code> which is normally a product of two primes: <code>N = p * q</code>.</p><p>Together the exponent and modulus form an RSA &ldquo;public key&rdquo; <code>(N, e)</code>. The most common value for <code>e</code> is <code>0x10001</code> or <code>65537</code>.</p><p>&ldquo;Encrypt&rdquo; the number <code>12</code> using the exponent <code>e = 65537</code> and the primes <code>p = 17</code> and <code>q = 23</code>. What number do you get as the ciphertext?</p></blockquote><h3 id=solution-1>Solution<a hidden class=anchor aria-hidden=true href=#solution-1>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;</span> <span class=nb>pow</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span><span class=mi>65537</span><span class=p>,</span><span class=mi>17</span><span class=o>*</span><span class=mi>23</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>301</span>
</span></span></code></pre></div><p><strong>flag:</strong> <code>301</code></p><h2 id=rsa-starter-3>RSA Starter 3<a hidden class=anchor aria-hidden=true href=#rsa-starter-3>#</a></h2><blockquote><p>RSA relies on the difficulty of the factorization of the modulus <code>N</code>. If the primes can be found then we can calculate the <a href=https://leimao.github.io/article/RSA-Algorithm/ title="Euler totient" target=_blank rel="nofollow noopener">Euler totient</a> of <code>N</code> and thus decrypt the ciphertext.</p><p>Given <code>N = p*q</code> and two primes:</p><p><code>p = 857504083339712752489993810777</code></p><p><code>q = 1029224947942998075080348647219</code></p><p>What is the totient of <code>N</code>?</p></blockquote><h3 id=solution-2>Solution<a hidden class=anchor aria-hidden=true href=#solution-2>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>p</span> <span class=o>=</span> <span class=mi>857504083339712752489993810777</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>q</span> <span class=o>=</span> <span class=mi>1029224947942998075080348647219</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>phi</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>882564595536224140639625987657529300394956519977044270821168</span>
</span></span></code></pre></div><p><strong>flag:</strong> <code>882564595536224140639625987657529300394956519977044270821168</code></p><h2 id=rsa-starter-4>RSA Starter 4<a hidden class=anchor aria-hidden=true href=#rsa-starter-4>#</a></h2><blockquote><p>The private key <code>d</code> is used to decrypt ciphertexts created with the corresponding public key (it&rsquo;s also used to &ldquo;sign&rdquo; a message but we&rsquo;ll get to that later).</p><p>The private key is the secret piece of information or &ldquo;trapdoor&rdquo; which allows us to quickly invert the encryption function. If RSA is implemented well, if you do not have the private key the fastest way to decrypt the ciphertext is to first factorize the modulus.</p><p>In RSA the private key is the <a href=https://en.wikipedia.org/wiki/Modular_multiplicative_inverse title="modular multiplicative inverse" target=_blank rel="nofollow noopener">modular multiplicative inverse</a> of the exponent <code>e</code> modulo the totient of <code>N</code>.</p><p>Given the two primes:</p><p><code>p = 857504083339712752489993810777</code></p><p><code>q = 1029224947942998075080348647219</code></p><p>and the exponent:</p><p><code>e = 65537</code></p><p>What is the private key <code>d</code>?</p></blockquote><h3 id=solution-3>Solution<a hidden class=anchor aria-hidden=true href=#solution-3>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;</span> <span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>inverse</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>p</span> <span class=o>=</span> <span class=mi>857504083339712752489993810777</span>
</span></span><span class=line><span class=cl>  <span class=n>q</span> <span class=o>=</span> <span class=mi>1029224947942998075080348647219</span>
</span></span><span class=line><span class=cl>  <span class=n>e</span> <span class=o>=</span> <span class=mi>65537</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>phi</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>d</span> <span class=o>=</span> <span class=n>inverse</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>121832886702415731577073962957377780195510499965398469843281</span>
</span></span></code></pre></div><p>Alternate solution(s):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># source: CryptoHack user @Scalpel</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>857504083339712752489993810777</span>
</span></span><span class=line><span class=cl><span class=n>q</span> <span class=o>=</span> <span class=mi>1029224947942998075080348647219</span>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>65537</span>
</span></span><span class=line><span class=cl><span class=n>phi</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
</span></span></code></pre></div><p><strong>flag:</strong> <code>121832886702415731577073962957377780195510499965398469843281</code></p><h2 id=rsa-starter-5>RSA Starter 5<a hidden class=anchor aria-hidden=true href=#rsa-starter-5>#</a></h2><blockquote><p>I&rsquo;ve encrypted a secret number for your eyes only using your public key parameters:</p><p><code>N = 882564595536224140639625987659416029426239230804614613279163</code></p><p><code>e = 65537</code></p><p>Use the private key that you found for these parameters in the previous challenge to decrypt this ciphertext:</p><p><code>c = 77578995801157823671636298847186723593814843845525223303932</code></p></blockquote><h3 id=solution-4>Solution<a hidden class=anchor aria-hidden=true href=#solution-4>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>inverse</span><span class=p>,</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl><span class=n>N</span> <span class=o>=</span> <span class=mi>882564595536224140639625987659416029426239230804614613279163</span>
</span></span><span class=line><span class=cl><span class=c1># http://factordb.com/index.php?query=882564595536224140639625987659416029426239230804614613279163</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>857504083339712752489993810777</span>
</span></span><span class=line><span class=cl><span class=n>q</span> <span class=o>=</span> <span class=mi>1029224947942998075080348647219</span>
</span></span><span class=line><span class=cl><span class=k>assert</span> <span class=n>p</span><span class=o>*</span><span class=n>q</span> <span class=o>==</span> <span class=n>N</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>65537</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=mi>77578995801157823671636298847186723593814843845525223303932</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>phi</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>q</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=n>inverse</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=mi>13371337</span>
</span></span></code></pre></div><p><strong>flag:</strong> <code>13371337</code></p><h2 id=rsa-starter-6>RSA Starter 6<a hidden class=anchor aria-hidden=true href=#rsa-starter-6>#</a></h2><blockquote><p>How can you ensure that the person receiving your message knows that you wrote it?</p><p>You&rsquo;ve been asked out on a date, and you want to send a message telling them that you&rsquo;d love to go, however a jealous lover isn&rsquo;t so happy about this.</p><p>When you send your message saying yes, your jealous lover intercepts the message and corrupts it so it now says no!</p><p>We can protect against these attacks by signing the message.</p><p>Imagine you write a message <code>M</code>. You encrypt this message with your friend&rsquo;s public key: <code>C = M^e0 mod N0</code>.</p><p>To sign this message, you calculate the hash of the message: <code>H(M)</code> and &ldquo;encrypt&rdquo; this with your private key: <code>S = H(M)^d1 mod N1</code>.
Your friend can decrypt the message using their private key: <code>m = C^d0 mod N0</code>. Using your public key they calculate <code>s = S^e1 mod N1</code>.</p><p>Now by computing <code>H(m)</code> and comparing it to <code>s</code>: <code>assert H(m) == s</code>, they can ensure that the message you sent them, is the message that they received!</p><p>Sign the flag <code>crypto{Immut4ble_m3ssag1ng}</code> using your private key and the SHA256 hash function.</p><p>Challenge files:</p><ul><li>private.key</li></ul></blockquote><p><em>file: private.key</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>N = 15216583654836731327639981224133918855895948374072384050848479908982286890731769486609085918857664046075375253168955058743185664390273058074450390236774324903305663479046566232967297765731625328029814055635316002591227570271271445226094919864475407884459980489638001092788574811554149774028950310695112688723853763743238753349782508121985338746755237819373178699343135091783992299561827389745132880022259873387524273298850340648779897909381979714026837172003953221052431217940632552930880000919436507245150726543040714721553361063311954285289857582079880295199632757829525723874753306371990452491305564061051059885803
</span></span><span class=line><span class=cl>d = 11175901210643014262548222473449533091378848269490518850474399681690547281665059317155831692300453197335735728459259392366823302405685389586883670043744683993709123180805154631088513521456979317628012721881537154107239389466063136007337120599915456659758559300673444689263854921332185562706707573660658164991098457874495054854491474065039621922972671588299315846306069845169959451250821044417886630346229021305410340100401530146135418806544340908355106582089082980533651095594192031411679866134256418292249592135441145384466261279428795408721990564658703903787956958168449841491667690491585550160457893350536334242689
</span></span></code></pre></td></tr></table></div></div><h3 id=solution-5>Solution<a hidden class=anchor aria-hidden=true href=#solution-5>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>sha256</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>bytes_to_long</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>N</span> <span class=o>=</span> <span class=mi>15216583654836731327639981224133918855895948374072384050848479908982286890731769486609085918857664046075375253168955058743185664390273058074450390236774324903305663479046566232967297765731625328029814055635316002591227570271271445226094919864475407884459980489638001092788574811554149774028950310695112688723853763743238753349782508121985338746755237819373178699343135091783992299561827389745132880022259873387524273298850340648779897909381979714026837172003953221052431217940632552930880000919436507245150726543040714721553361063311954285289857582079880295199632757829525723874753306371990452491305564061051059885803</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=mi>11175901210643014262548222473449533091378848269490518850474399681690547281665059317155831692300453197335735728459259392366823302405685389586883670043744683993709123180805154631088513521456979317628012721881537154107239389466063136007337120599915456659758559300673444689263854921332185562706707573660658164991098457874495054854491474065039621922972671588299315846306069845169959451250821044417886630346229021305410340100401530146135418806544340908355106582089082980533651095594192031411679866134256418292249592135441145384466261279428795408721990564658703903787956958168449841491667690491585550160457893350536334242689</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;crypto</span><span class=si>{Immut4ble_m3ssag1ng}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>h_m</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>sha256</span><span class=p>(</span><span class=n>m</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>h_m</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>hex</span><span class=p>(</span><span class=n>s</span><span class=p>)[</span><span class=mi>2</span><span class=p>:])</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>6ac9bb8f110b318a40ad8d7e57defdcce2652f5928b5f9b97c1504d7096d7af1d34e477b30f1a08014e8d525b14458b709a77a5fa67d4711bd19da1446f9fb0ffd9fdedc4101bdc9a4b26dd036f11d02f6b56f4926170c643f302d59c4fe8ea678b3ca91b4bb9b2024f2a839bec1514c0242b57e1f5e77999ee67c450982730252bc2c3c35acb4ac06a6ce8b9dbf84e29df0baa7369e0fd26f6dfcfb22a464e05c5b72baba8f78dc742e96542169710918ee2947749477869cb3567180ccbdfe6fdbe85bcaca4bf6da77c8f382bb4c8cd56dee43d1290ca856318c97f1756b789e3cac0c9738f5e9f797314d39a2ededb92583d97124ec6b313c4ea3464037d3
</span></span></code></pre></div><p><strong>flag:</strong> <code>6ac9bb8f110b318a40ad8d7e57defdcce2652f5928b5f9b97c1504d7096d7af1d34e477b30f1a08014e8d525b14458b709a77a5fa67d4711bd19da1446f9fb0ffd9fdedc4101bdc9a4b26dd036f11d02f6b56f4926170c643f302d59c4fe8ea678b3ca91b4bb9b2024f2a839bec1514c0242b57e1f5e77999ee67c450982730252bc2c3c35acb4ac06a6ce8b9dbf84e29df0baa7369e0fd26f6dfcfb22a464e05c5b72baba8f78dc742e96542169710918ee2947749477869cb3567180ccbdfe6fdbe85bcaca4bf6da77c8f382bb4c8cd56dee43d1290ca856318c97f1756b789e3cac0c9738f5e9f797314d39a2ededb92583d97124ec6b313c4ea3464037d3</code></p><h2 id=factoring>Factoring<a hidden class=anchor aria-hidden=true href=#factoring>#</a></h2><blockquote><p>So far we&rsquo;ve been using the product of small primes for the modulus, but small primes aren&rsquo;t much good for RSA as they can be factorized using <a href=https://en.wikipedia.org/wiki/General_number_field_sieve title="modern methods" target=_blank rel="nofollow noopener">modern methods</a>.</p><p>What is a &ldquo;small prime&rdquo;? There was an <a href=https://en.wikipedia.org/wiki/RSA_Factoring_Challenge title="RSA Factoring Challenge" target=_blank rel="nofollow noopener">RSA Factoring Challenge</a> with cash prizes given to teams who could factorize RSA moduli. This gave insight to the public into how long various key sizes would remain safe. Computers get faster, algorithms get better, so in cryptography it&rsquo;s always prudent to err on the side of caution.</p><p>These days, using primes that are at least 1024 bits long is recommended–multiplying two such 1024 primes gives you a modulus that is 2048 bits large. RSA with a 2048-bit modulus is called RSA-2048.</p><p>Some say that to really remain future-proof you should use RSA-4096 or even RSA-8192. However, there is a tradeoff here; it takes longer to generate large prime numbers, plus modular exponentiations are predictably slower with a large modulus.</p><p>Factorize the 150-bit number <code>510143758735509025530880200653196460532653147</code> into its two constituent primes. Give the smaller one as your answer.</p><p>Resources:</p><ul><li><a href=https://crypto.stackexchange.com/questions/1978/how-big-an-rsa-key-is-considered-secure-today/1982#1982 title="How big an RSA key is considered secure today?" target=_blank rel="nofollow noopener">How big an RSA key is considered secure today?</a></li><li><a href=https://github.com/elliptic-shiho/primefac-fork title=primefac-fork target=_blank rel="nofollow noopener">primefac-fork</a></li></ul></blockquote><h3 id=solution-6>Solution<a hidden class=anchor aria-hidden=true href=#solution-6>#</a></h3><p><a href="http://factordb.com/index.php?query=510143758735509025530880200653196460532653147" title=factorDB target=_blank rel="nofollow noopener">factorDB</a> gives us the factors:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>p = 19704762736204164635843
</span></span><span class=line><span class=cl>q = 25889363174021185185929
</span></span></code></pre></div><h2 id=monoprime>Monoprime<a hidden class=anchor aria-hidden=true href=#monoprime>#</a></h2><blockquote><p>Why is everyone so obsessed with multiplying two primes for RSA. Why not just use one?</p><p>Challenge files:</p><ul><li>output.txt</li></ul><p>Resources:</p><ul><li><a href=https://crypto.stackexchange.com/questions/5170/why-do-we-need-in-rsa-the-modulus-to-be-product-of-2-primes title="Why do we need in RSA the modulus to be product of 2 primes?" target=_blank rel="nofollow noopener">Why do we need in RSA the modulus to be product of 2 primes?</a></li></ul></blockquote><p><em>file: output.txt</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>n = 171731371218065444125482536302245915415603318380280392385291836472299752747934607246477508507827284075763910264995326010251268493630501989810855418416643352631102434317900028697993224868629935657273062472544675693365930943308086634291936846505861203914449338007760990051788980485462592823446469606824421932591                                                                  
</span></span><span class=line><span class=cl>e = 65537
</span></span><span class=line><span class=cl>ct = 161367550346730604451454756189028938964941280347662098798775466019463375610700074840105776873791605070092554650190486030367121011578171525759600774739890458414593857709994072516290998135846956596662071379067305011746842247628316996977338024343628757374524136260758515864509435302781735938531030576289086798942  
</span></span></code></pre></td></tr></table></div></div><h3 id=solution-7>Solution<a hidden class=anchor aria-hidden=true href=#solution-7>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>inverse</span><span class=p>,</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>171731371218065444125482536302245915415603318380280392385291836472299752747934607246477508507827284075763910264995326010251268493630501989810855418416643352631102434317900028697993224868629935657273062472544675693365930943308086634291936846505861203914449338007760990051788980485462592823446469606824421932591</span>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>65537</span>
</span></span><span class=line><span class=cl><span class=n>ct</span> <span class=o>=</span> <span class=mi>161367550346730604451454756189028938964941280347662098798775466019463375610700074840105776873791605070092554650190486030367121011578171525759600774739890458414593857709994072516290998135846956596662071379067305011746842247628316996977338024343628757374524136260758515864509435302781735938531030576289086798942</span>
</span></span><span class=line><span class=cl><span class=n>phi</span> <span class=o>=</span> <span class=n>n</span><span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=n>inverse</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>ct</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>m</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=sa>b</span><span class=s1>&#39;crypto</span><span class=si>{0n3_pr1m3_41n7_pr1m3_l0l}</span><span class=s1>&#39;</span>
</span></span></code></pre></div><p><strong>flag:</strong> <code>crypto{0n3_pr1m3_41n7_pr1m3_l0l}</code></p><h2 id=manyprime>Manyprime<a hidden class=anchor aria-hidden=true href=#manyprime>#</a></h2><blockquote><p>Using one prime factor was definitely a bad idea so I&rsquo;ll try using over 30 instead.</p><p>Challenge files:</p><ul><li>output.txt</li></ul><p>Resources:</p><ul><li><a href=https://doc.sagemath.org/html/en/reference/interfaces/sage/interfaces/ecm.html title="The Elliptic Curve Factorization Method" target=_blank rel="nofollow noopener">The Elliptic Curve Factorization Method</a></li></ul></blockquote><p><em>file: output.txt</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>n = 580642391898843192929563856870897799650883152718761762932292482252152591279871421569162037190419036435041797739880389529593674485555792234900969402019055601781662044515999210032698275981631376651117318677368742867687180140048715627160641771118040372573575479330830092989800730105573700557717146251860588802509310534792310748898504394966263819959963273509119791037525504422606634640173277598774814099540555569257179715908642917355365791447508751401889724095964924513196281345665480688029639999472649549163147599540142367575413885729653166517595719991872223011969856259344396899748662101941230745601719730556631637
</span></span><span class=line><span class=cl>e = 65537
</span></span><span class=line><span class=cl>ct = 320721490534624434149993723527322977960556510750628354856260732098109692581338409999983376131354918370047625150454728718467998870322344980985635149656977787964380651868131740312053755501594999166365821315043312308622388016666802478485476059625888033017198083472976011719998333985531756978678758897472845358167730221506573817798467100023754709109274265835201757369829744113233607359526441007577850111228850004361838028842815813724076511058179239339760639518034583306154826603816927757236549096339501503316601078891287408682099750164720032975016814187899399273719181407940397071512493967454225665490162619270814464
</span></span></code></pre></td></tr></table></div></div><h3 id=solution-8>Solution<a hidden class=anchor aria-hidden=true href=#solution-8>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sage.all</span> <span class=kn>import</span> <span class=n>ecm</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>inverse</span><span class=p>,</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>580642391898843192929563856870897799650883152718761762932292482252152591279871421569162037190419036435041797739880389529593674485555792234900969402019055601781662044515999210032698275981631376651117318677368742867687180140048715627160641771118040372573575479330830092989800730105573700557717146251860588802509310534792310748898504394966263819959963273509119791037525504422606634640173277598774814099540555569257179715908642917355365791447508751401889724095964924513196281345665480688029639999472649549163147599540142367575413885729653166517595719991872223011969856259344396899748662101941230745601719730556631637</span>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>65537</span>
</span></span><span class=line><span class=cl><span class=n>ct</span> <span class=o>=</span> <span class=mi>320721490534624434149993723527322977960556510750628354856260732098109692581338409999983376131354918370047625150454728718467998870322344980985635149656977787964380651868131740312053755501594999166365821315043312308622388016666802478485476059625888033017198083472976011719998333985531756978678758897472845358167730221506573817798467100023754709109274265835201757369829744113233607359526441007577850111228850004361838028842815813724076511058179239339760639518034583306154826603816927757236549096339501503316601078891287408682099750164720032975016814187899399273719181407940397071512493967454225665490162619270814464</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>factors</span> <span class=o>=</span> <span class=n>ecm</span><span class=o>.</span><span class=n>factor</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>phi</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>factors</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>phi</span> <span class=o>*=</span> <span class=n>f</span><span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=n>inverse</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>ct</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>m</span><span class=p>)))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=sa>b</span><span class=s1>&#39;crypto</span><span class=si>{700_m4ny_5m4ll_f4c70r5}</span><span class=s1>&#39;</span>
</span></span></code></pre></div><p><strong>flag:</strong> <code>crypto{700_m4ny_5m4ll_f4c70r5}</code></p><h2 id=salty>Salty<a hidden class=anchor aria-hidden=true href=#salty>#</a></h2><blockquote><p>Smallest exponent should be fastest, right?</p><p>Challenge files:</p><ul><li>salty.py</li><li>output.txt</li></ul></blockquote><p><em>file: salty.py</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>getPrime</span><span class=p>,</span> <span class=n>inverse</span><span class=p>,</span> <span class=n>bytes_to_long</span><span class=p>,</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>d</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>512</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>512</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>phi</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>inverse</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;XXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
</span></span><span class=line><span class=cl><span class=n>pt</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ct</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>pt</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;n = </span><span class=si>{</span><span class=n>n</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;e = </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;ct = </span><span class=si>{</span><span class=n>ct</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pt</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>ct</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>decrypted</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>pt</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>assert</span> <span class=n>decrypted</span> <span class=o>==</span> <span class=n>flag</span>
</span></span></code></pre></td></tr></table></div></div><p><em>file: output.txt</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>n = 110581795715958566206600392161360212579669637391437097703685154237017351570464767725324182051199901920318211290404777259728923614917211291562555864753005179326101890427669819834642007924406862482343614488768256951616086287044725034412802176312273081322195866046098595306261781788276570920467840172004530873767                                                                  
</span></span><span class=line><span class=cl>e = 1
</span></span><span class=line><span class=cl>ct = 44981230718212183604274785925793145442655465025264554046028251311164494127485
</span></span></code></pre></td></tr></table></div></div><h3 id=solution-9>Solution<a hidden class=anchor aria-hidden=true href=#solution-9>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>110581795715958566206600392161360212579669637391437097703685154237017351570464767725324182051199901920318211290404777259728923614917211291562555864753005179326101890427669819834642007924406862482343614488768256951616086287044725034412802176312273081322195866046098595306261781788276570920467840172004530873767</span>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>ct</span> <span class=o>=</span> <span class=mi>44981230718212183604274785925793145442655465025264554046028251311164494127485</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>ct</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>m</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=sa>b</span><span class=s1>&#39;crypto{saltstack_fell_for_this!}&#39;</span>
</span></span></code></pre></div><p><strong>flag:</strong> <code>crypto{saltstack_fell_for_this!}</code></p><h2 id=modulus-inutilis>Modulus Inutilis<a hidden class=anchor aria-hidden=true href=#modulus-inutilis>#</a></h2><blockquote><p>My primes should be more than large enough now!</p><p>Challenge files:</p><ul><li>modulus_inutilis.py</li><li>output.txt</li></ul></blockquote><p><em>file: modulus_inutilis.py</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>getPrime</span><span class=p>,</span> <span class=n>inverse</span><span class=p>,</span> <span class=n>bytes_to_long</span><span class=p>,</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>d</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>phi</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>inverse</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;XXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
</span></span><span class=line><span class=cl><span class=n>pt</span> <span class=o>=</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ct</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>pt</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;n = </span><span class=si>{</span><span class=n>n</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;e = </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;ct = </span><span class=si>{</span><span class=n>ct</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pt</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>ct</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>decrypted</span> <span class=o>=</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>pt</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>assert</span> <span class=n>decrypted</span> <span class=o>==</span> <span class=n>flag</span>
</span></span></code></pre></td></tr></table></div></div><p><em>file: output.txt</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>n = 17258212916191948536348548470938004244269544560039009244721959293554822498047075403658429865201816363311805874117705688359853941515579440852166618074161313773416434156467811969628473425365608002907061241714688204565170146117869742910273064909154666642642308154422770994836108669814632309362483307560217924183202838588431342622551598499747369771295105890359290073146330677383341121242366368309126850094371525078749496850520075015636716490087482193603562501577348571256210991732071282478547626856068209192987351212490642903450263288650415552403935705444809043563866466823492258216747445926536608548665086042098252335883
</span></span><span class=line><span class=cl>e = 3
</span></span><span class=line><span class=cl>ct = 243251053617903760309941844835411292373350655973075480264001352919865180151222189820473358411037759381328642957324889519192337152355302808400638052620580409813222660643570085177957
</span></span></code></pre></td></tr></table></div></div><h3 id=solution-10>Solution<a hidden class=anchor aria-hidden=true href=#solution-10>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>gmpy2</span> <span class=kn>import</span> <span class=n>iroot</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>17258212916191948536348548470938004244269544560039009244721959293554822498047075403658429865201816363311805874117705688359853941515579440852166618074161313773416434156467811969628473425365608002907061241714688204565170146117869742910273064909154666642642308154422770994836108669814632309362483307560217924183202838588431342622551598499747369771295105890359290073146330677383341121242366368309126850094371525078749496850520075015636716490087482193603562501577348571256210991732071282478547626856068209192987351212490642903450263288650415552403935705444809043563866466823492258216747445926536608548665086042098252335883</span>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>ct</span> <span class=o>=</span> <span class=mi>243251053617903760309941844835411292373350655973075480264001352919865180151222189820473358411037759381328642957324889519192337152355302808400638052620580409813222660643570085177957</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>iroot</span><span class=p>(</span><span class=n>ct</span><span class=p>,</span><span class=mi>3</span><span class=p>)[</span><span class=mi>0</span><span class=p>]))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=sa>b</span><span class=s1>&#39;crypto</span><span class=si>{N33d_m04R_p4dd1ng}</span><span class=s1>&#39;</span>
</span></span></code></pre></div><p><strong>flag:</strong> <code>crypto{N33d_m04R_p4dd1ng}</code></p><h2 id=diffie-hellman-starter-1>Diffie-Hellman Starter 1<a hidden class=anchor aria-hidden=true href=#diffie-hellman-starter-1>#</a></h2><blockquote><p>The set of integers modulo <code>n</code>, together with the operations of both addition and multiplication is a ring. This means that adding or multiplying any two elements in the set returns another element in the set.</p><p>When the modulus is prime: <code>n = p</code>, we are guaranteed an inverse of every element in the set, and so the ring is promoted to a field. We refer to this field as a finite field <code>Fp</code>.</p><p>The Diffie-Hellman protocol works with elements of some finite field <code>Fp</code>, where the prime modulus is typically a large prime.</p><p>Given the prime <code>p = 991</code>, and the element <code>g = 209</code>, find the inverse element <code>d</code> such that <code>g * d mod 991 = 1</code>.</p></blockquote><h3 id=solution-11>Solution<a hidden class=anchor aria-hidden=true href=#solution-11>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;</span> <span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>inverse</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>inverse</span><span class=p>(</span><span class=mi>209</span><span class=p>,</span> <span class=mi>991</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>549</span>
</span></span></code></pre></div><p><strong>flag:</strong> <code>549</code></p><h2 id=diffie-hellman-starter-2>Diffie-Hellman Starter 2<a hidden class=anchor aria-hidden=true href=#diffie-hellman-starter-2>#</a></h2><blockquote><p>Every element of a finite field <code>Fp</code> can be used to make a subgroup <code>H</code> under repeated action of multiplication. In other words, for an element <code>g</code>: <code>H = {g, g^2, g^3, ...}</code></p><p>A primitive element of <code>Fp</code> is an element whose subgroup <code>H = Fp</code>, i.e., every element of <code>Fp</code>, can be written as <code>g^n mod p</code> for some integer <code>n</code>. Because of this, primitive elements are sometimes called generators of the finite field.</p><p>For the finite field with <code>p = 28151</code> find the smallest element <code>g</code> which is a primitive element of <code>Fp</code>.</p></blockquote><h3 id=solution-12>Solution<a hidden class=anchor aria-hidden=true href=#solution-12>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;</span> <span class=kn>from</span> <span class=nn>sage.all</span> <span class=kn>import</span> <span class=n>GF</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>GF</span><span class=p>(</span><span class=mi>28151</span><span class=p>)</span><span class=o>.</span><span class=n>primitive_element</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>
</span></span></code></pre></div><p><strong>flag:</strong> <code>7</code></p><h2 id=diffie-hellman-starter-3>Diffie-Hellman Starter 3<a hidden class=anchor aria-hidden=true href=#diffie-hellman-starter-3>#</a></h2><blockquote><p>The Diffie-Hellman protocol is used because the discrete logarithm is assumed to be a &ldquo;hard&rdquo; computation for carefully chosen groups.</p><p>The first step of the protocol is to establish a prime <code>p</code> and some generator of the finite field <code>g</code>. These must be carefully chosen to avoid special cases where the discrete log can be solved with efficient algorithms. For example, a safe prime <code>p = 2*q +1</code> is usually picked such that the only factors of <code>p - 1</code> are <code>{2,q}</code> where <code>q</code> is some other large prime. This protects DH from the <a href=https://en.wikipedia.org/wiki/Pohlig%E2%80%93Hellman_algorithm title="Pohlig–Hellman algorithm" target=_blank rel="nofollow noopener">Pohlig–Hellman algorithm</a>.</p><p>The user then picks a secret integer <code>a &lt; p</code> and calculates <code>g^a mod p</code>. This can be transmitted over an insecure network and due to the assumed difficulty of the discrete logarithm, if the protocol has been implemented correctly the secret integer should be infeasible to compute.</p><p>Given the NIST parameters:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>g: 2
</span></span><span class=line><span class=cl>p: 2410312426921032588552076022197566074856950548502459942654116941958108831682612228890093858261341614673227141477904012196503648957050582631942730706805009223062734745341073406696246014589361659774041027169249453200378729434170325843778659198143763193776859869524088940195577346119843545301547043747207749969763750084308926339295559968882457872412993810129130294592999947926365264059284647209730384947211681434464714438488520940127459844288859336526896320919633919
</span></span></code></pre></div><p>Calculate the value of <code>g^a mod p</code> for</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>a: 972107443837033796245864316200458246846904598488981605856765890478853088246897345487328491037710219222038930943365848626194109830309179393018216763327572120124760140018038673999837643377590434413866611132403979547150659053897355593394492586978400044375465657296027592948349589216415363722668361328689588996541370097559090335137676411595949335857341797148926151694299575970292809805314431447043469447485957669949989090202320234337890323293401862304986599884732815`
</span></span></code></pre></div></blockquote><h3 id=solution-13>Solution<a hidden class=anchor aria-hidden=true href=#solution-13>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>p</span> <span class=o>=</span> <span class=mi>2410312426921032588552076022197566074856950548502459942654116941958108831682612228890093858261341614673227141477904012196503648957050582631942730706805009223062734745341073406696246014589361659774041027169249453200378729434170325843778659198143763193776859869524088940195577346119843545301547043747207749969763750084308926339295559968882457872412993810129130294592999947926365264059284647209730384947211681434464714438488520940127459844288859336526896320919633919</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>972107443837033796245864316200458246846904598488981605856765890478853088246897345487328491037710219222038930943365848626194109830309179393018216763327572120124760140018038673999837643377590434413866611132403979547150659053897355593394492586978400044375465657296027592948349589216415363722668361328689588996541370097559090335137676411595949335857341797148926151694299575970292809805314431447043469447485957669949989090202320234337890323293401862304986599884732815</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>g</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=nb>pow</span><span class=p>(</span><span class=n>g</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>1806857697840726523322586721820911358489420128129248078673933653533930681676181753849411715714173604352323556558783759252661061186320274214883104886050164368129191719707402291577330485499513522368289395359523901406138025022522412429238971591272160519144672389532393673832265070057319485399793101182682177465364396277424717543434017666343807276970864475830391776403957550678362368319776566025118492062196941451265638054400177248572271342548616103967411990437357924</span>
</span></span></code></pre></div><p><strong>flag:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>1806857697840726523322586721820911358489420128129248078673933653533930681676181753849411715714173604352323556558783759252661061186320274214883104886050164368129191719707402291577330485499513522368289395359523901406138025022522412429238971591272160519144672389532393673832265070057319485399793101182682177465364396277424717543434017666343807276970864475830391776403957550678362368319776566025118492062196941451265638054400177248572271342548616103967411990437357924
</span></span></code></pre></div><h2 id=diffie-hellman-starter-4>Diffie-Hellman Starter 4<a hidden class=anchor aria-hidden=true href=#diffie-hellman-starter-4>#</a></h2><blockquote><p>Now it&rsquo;s time to calculate a shared secret using data received from your friend Alice. Like before, we will be using the NIST parameters:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>g: 2
</span></span><span class=line><span class=cl>p: 2410312426921032588552076022197566074856950548502459942654116941958108831682612228890093858261341614673227141477904012196503648957050582631942730706805009223062734745341073406696246014589361659774041027169249453200378729434170325843778659198143763193776859869524088940195577346119843545301547043747207749969763750084308926339295559968882457872412993810129130294592999947926365264059284647209730384947211681434464714438488520940127459844288859336526896320919633919
</span></span></code></pre></div><p>You have received the following integer from Alice:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>A: 70249943217595468278554541264975482909289174351516133994495821400710625291840101960595720462672604202133493023241393916394629829526272643847352371534839862030410331485087487331809285533195024369287293217083414424096866925845838641840923193480821332056735592483730921055532222505605661664236182285229504265881752580410194731633895345823963910901731715743835775619780738974844840425579683385344491015955892106904647602049559477279345982530488299847663103078045601
</span></span></code></pre></div><p>You generate your secret integer b and calculate your public one B, which you send to Alice.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>b: 12019233252903990344598522535774963020395770409445296724034378433497976840167805970589960962221948290951873387728102115996831454482299243226839490999713763440412177965861508773420532266484619126710566414914227560103715336696193210379850575047730388378348266180934946139100479831339835896583443691529372703954589071507717917136906770122077739814262298488662138085608736103418601750861698417340264213867753834679359191427098195887112064503104510489610448294420720`
</span></span><span class=line><span class=cl>B: 518386956790041579928056815914221837599234551655144585133414727838977145777213383018096662516814302583841858901021822273505120728451788412967971809038854090670743265187138208169355155411883063541881209288967735684152473260687799664130956969450297407027926009182761627800181901721840557870828019840218548188487260441829333603432714023447029942863076979487889569452186257333512355724725941390498966546682790608125613166744820307691068563387354936732643569654017172
</span></span></code></pre></div><p>You and Alice are now able to calculate a shared secret, which would be infeasible to calculate knowing only <code>{g,p,A,B}</code>.</p><p>What is your shared secret?</p></blockquote><h3 id=solution-14>Solution<a hidden class=anchor aria-hidden=true href=#solution-14>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>A</span> <span class=o>=</span> <span class=mi>70249943217595468278554541264975482909289174351516133994495821400710625291840101960595720462672604202133493023241393916394629829526272643847352371534839862030410331485087487331809285533195024369287293217083414424096866925845838641840923193480821332056735592483730921055532222505605661664236182285229504265881752580410194731633895345823963910901731715743835775619780738974844840425579683385344491015955892106904647602049559477279345982530488299847663103078045601</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>12019233252903990344598522535774963020395770409445296724034378433497976840167805970589960962221948290951873387728102115996831454482299243226839490999713763440412177965861508773420532266484619126710566414914227560103715336696193210379850575047730388378348266180934946139100479831339835896583443691529372703954589071507717917136906770122077739814262298488662138085608736103418601750861698417340264213867753834679359191427098195887112064503104510489610448294420720</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>p</span> <span class=o>=</span> <span class=mi>2410312426921032588552076022197566074856950548502459942654116941958108831682612228890093858261341614673227141477904012196503648957050582631942730706805009223062734745341073406696246014589361659774041027169249453200378729434170325843778659198143763193776859869524088940195577346119843545301547043747207749969763750084308926339295559968882457872412993810129130294592999947926365264059284647209730384947211681434464714438488520940127459844288859336526896320919633919</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=nb>pow</span><span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=n>b</span><span class=p>,</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>1174130740413820656533832746034841985877302086316388380165984436672307692443711310285014138545204369495478725102882673427892104539120952393788961051992901649694063179853598311473820341215879965343136351436410522850717408445802043003164658348006577408558693502220285700893404674592567626297571222027902631157072143330043118418467094237965591198440803970726604537807146703763571606861448354607502654664700390453794493176794678917352634029713320615865940720837909466</span>
</span></span></code></pre></div><p><strong>flag:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>1174130740413820656533832746034841985877302086316388380165984436672307692443711310285014138545204369495478725102882673427892104539120952393788961051992901649694063179853598311473820341215879965343136351436410522850717408445802043003164658348006577408558693502220285700893404674592567626297571222027902631157072143330043118418467094237965591198440803970726604537807146703763571606861448354607502654664700390453794493176794678917352634029713320615865940720837909466
</span></span></code></pre></div><h2 id=diffie-hellman-starter-5>Diffie-Hellman Starter 5<a hidden class=anchor aria-hidden=true href=#diffie-hellman-starter-5>#</a></h2><blockquote><p>Alice wants to send you her secret flag and asks you to generate a shared secret with her. She also tells you she will be using the NIST standard:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>g: 2
</span></span><span class=line><span class=cl>p: 2410312426921032588552076022197566074856950548502459942654116941958108831682612228890093858261341614673227141477904012196503648957050582631942730706805009223062734745341073406696246014589361659774041027169249453200378729434170325843778659198143763193776859869524088940195577346119843545301547043747207749969763750084308926339295559968882457872412993810129130294592999947926365264059284647209730384947211681434464714438488520940127459844288859336526896320919633919
</span></span></code></pre></div><p>You receive the following integer from Alice:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>A: 112218739139542908880564359534373424013016249772931962692237907571990334483528877513809272625610512061159061737608547288558662879685086684299624481742865016924065000555267977830144740364467977206555914781236397216033805882207640219686011643468275165718132888489024688846101943642459655423609111976363316080620471928236879737944217503462265615774774318986375878440978819238346077908864116156831874695817477772477121232820827728424890845769152726027520772901423784
</span></span></code></pre></div><p>You then generate your secret integer and calculate your public one, which you send to Alice.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>b: 197395083814907028991785772714920885908249341925650951555219049411298436217190605190824934787336279228785809783531814507661385111220639329358048196339626065676869119737979175531770768861808581110311903548567424039264485661330995221907803300824165469977099494284722831845653985392791480264712091293580274947132480402319812110462641143884577706335859190668240694680261160210609506891842793868297672619625924001403035676872189455767944077542198064499486164431451944
</span></span><span class=line><span class=cl>B: 1241972460522075344783337556660700537760331108332735677863862813666578639518899293226399921252049655031563612905395145236854443334774555982204857895716383215705498970395379526698761468932147200650513626028263449605755661189525521343142979265044068409405667549241125597387173006460145379759986272191990675988873894208956851773331039747840312455221354589910726982819203421992729738296452820365553759182547255998984882158393688119629609067647494762616719047466973581`
</span></span></code></pre></div><p>Individually you each use the shared secret to derive an AES private key. This allows you to encrypt large amounts of data over your channel without needing to exchange keys again.</p><p>Alice sends you the following IV and ciphertext:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>{&#39;iv&#39;: &#39;737561146ff8194f45290f5766ed6aba&#39;, &#39;encrypted_flag&#39;: &#39;39c99bf2f0c14678d6a5416faef954b5893c316fc3c48622ba1fd6a9fe85f3dc72a29c394cf4bc8aff6a7b21cae8e12c&#39;}
</span></span></code></pre></div><p>Decrypt this to obtain your flag!</p><p>Challenge files:</p><ul><li>source.py</li><li>decrypt.py</li></ul></blockquote><p><em>file: source.py</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secret</span> <span class=kn>import</span> <span class=n>shared_secret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>FLAG</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;crypto{????????????????????????????}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt_flag</span><span class=p>(</span><span class=n>shared_secret</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Derive AES key from shared secret</span>
</span></span><span class=line><span class=cl>    <span class=n>sha1</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>sha1</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>shared_secret</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>sha1</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=c1># Encrypt flag</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>pad</span><span class=p>(</span><span class=n>FLAG</span><span class=p>,</span> <span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1># Prepare data to send</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>[</span><span class=s1>&#39;iv&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>iv</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>[</span><span class=s1>&#39;encrypted_flag&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>encrypt_flag</span><span class=p>(</span><span class=n>shared_secret</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p><em>file: decrypt.py</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>is_pkcs7_padded</span><span class=p>(</span><span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>padding</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=o>-</span><span class=n>message</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]:]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>all</span><span class=p>(</span><span class=n>padding</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>padding</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>padding</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_flag</span><span class=p>(</span><span class=n>shared_secret</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Derive AES key from shared secret</span>
</span></span><span class=line><span class=cl>    <span class=n>sha1</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>sha1</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>shared_secret</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>sha1</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=c1># Decrypt flag</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>is_pkcs7_padded</span><span class=p>(</span><span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>plaintext</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>shared_secret</span> <span class=o>=</span> <span class=err>?</span>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=err>?</span>
</span></span><span class=line><span class=cl><span class=n>ciphertext</span> <span class=o>=</span> <span class=err>?</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>decrypt_flag</span><span class=p>(</span><span class=n>shared_secret</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=solution-15>Solution<a hidden class=anchor aria-hidden=true href=#solution-15>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>is_pkcs7_padded</span><span class=p>(</span><span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>padding</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=o>-</span><span class=n>message</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]:]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>all</span><span class=p>(</span><span class=n>padding</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>padding</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>padding</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_flag</span><span class=p>(</span><span class=n>shared_secret</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Derive AES key from shared secret</span>
</span></span><span class=line><span class=cl>    <span class=n>sha1</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>sha1</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>shared_secret</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>sha1</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=c1># Decrypt flag</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>is_pkcs7_padded</span><span class=p>(</span><span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>plaintext</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>A</span> <span class=o>=</span> <span class=mi>112218739139542908880564359534373424013016249772931962692237907571990334483528877513809272625610512061159061737608547288558662879685086684299624481742865016924065000555267977830144740364467977206555914781236397216033805882207640219686011643468275165718132888489024688846101943642459655423609111976363316080620471928236879737944217503462265615774774318986375878440978819238346077908864116156831874695817477772477121232820827728424890845769152726027520772901423784</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=mi>197395083814907028991785772714920885908249341925650951555219049411298436217190605190824934787336279228785809783531814507661385111220639329358048196339626065676869119737979175531770768861808581110311903548567424039264485661330995221907803300824165469977099494284722831845653985392791480264712091293580274947132480402319812110462641143884577706335859190668240694680261160210609506891842793868297672619625924001403035676872189455767944077542198064499486164431451944</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>2410312426921032588552076022197566074856950548502459942654116941958108831682612228890093858261341614673227141477904012196503648957050582631942730706805009223062734745341073406696246014589361659774041027169249453200378729434170325843778659198143763193776859869524088940195577346119843545301547043747207749969763750084308926339295559968882457872412993810129130294592999947926365264059284647209730384947211681434464714438488520940127459844288859336526896320919633919</span>
</span></span><span class=line><span class=cl><span class=n>shared_secret</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=s1>&#39;737561146ff8194f45290f5766ed6aba&#39;</span>
</span></span><span class=line><span class=cl><span class=n>ciphertext</span> <span class=o>=</span> <span class=s1>&#39;39c99bf2f0c14678d6a5416faef954b5893c316fc3c48622ba1fd6a9fe85f3dc72a29c394cf4bc8aff6a7b21cae8e12c&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>decrypt_flag</span><span class=p>(</span><span class=n>shared_secret</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>flag:</strong> <code>crypto{sh4r1ng_s3cret5_w1th_fr13nd5}</code></p><h2 id=parameter-injection>Parameter Injection<a hidden class=anchor aria-hidden=true href=#parameter-injection>#</a></h2><blockquote><p>You&rsquo;re in a position to not only intercept Alice and Bob&rsquo;s DH key exchange, but also rewrite their messages. Think about how you can play with the DH equation that they calculate, and therefore sidestep the need to crack any discrete logarithm problem.</p><p>Use the script from &ldquo;Diffie-Hellman Starter 5&rdquo; to decrypt the flag once you&rsquo;ve recovered the shared secret.</p><p>Connect at <code>nc socket.cryptohack.org 13371</code></p></blockquote><h3 id=solution-16>Solution<a hidden class=anchor aria-hidden=true href=#solution-16>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>json</span> <span class=kn>import</span> <span class=n>loads</span><span class=p>,</span> <span class=n>dumps</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>is_pkcs7_padded</span><span class=p>(</span><span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>padding</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=o>-</span><span class=n>message</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]:]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>all</span><span class=p>(</span><span class=n>padding</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>padding</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>padding</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_flag</span><span class=p>(</span><span class=n>shared_secret</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Derive AES key from shared secret</span>
</span></span><span class=line><span class=cl>    <span class=n>sha1</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>sha1</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>shared_secret</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>sha1</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=c1># Decrypt flag</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>is_pkcs7_padded</span><span class=p>(</span><span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>plaintext</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s1>&#39;socket.cryptohack.org&#39;</span><span class=p>,</span> <span class=mi>13371</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Alice -&gt; Us</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>readuntilS</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>json</span> <span class=o>=</span> <span class=n>loads</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>readlineS</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>json</span><span class=p>[</span><span class=s1>&#39;p&#39;</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>A</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>json</span><span class=p>[</span><span class=s1>&#39;A&#39;</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>json</span><span class=p>[</span><span class=s1>&#39;g&#39;</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Us -&gt; Bob</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;p&#34;</span><span class=p>:</span><span class=nb>hex</span><span class=p>(</span><span class=n>p</span><span class=p>),</span><span class=s2>&#34;g&#34;</span><span class=p>:</span><span class=nb>hex</span><span class=p>(</span><span class=n>g</span><span class=p>),</span><span class=s2>&#34;A&#34;</span><span class=p>:</span><span class=nb>hex</span><span class=p>(</span><span class=n>p</span><span class=p>)})</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;latin&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Bob: &#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Us -&gt; Alice (fake Bob&#39;s response)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;B&#34;</span><span class=p>:</span><span class=s2>&#34;0x1&#34;</span><span class=p>})</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;latin&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Alice: &#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Alice -&gt; Us</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>readuntilS</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>json</span> <span class=o>=</span> <span class=n>loads</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>readlineS</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=n>json</span><span class=p>[</span><span class=s1>&#39;iv&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>ct</span> <span class=o>=</span> <span class=n>json</span><span class=p>[</span><span class=s1>&#39;encrypted_flag&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Decrypt (shared key = 1 since we sent B=0x1)</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>decrypt_flag</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ct</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>flag:</strong> <code>crypto{n1c3_0n3_m4ll0ry!!!!!!!!}</code></p><h2 id=export-grade>Export-grade<a hidden class=anchor aria-hidden=true href=#export-grade>#</a></h2><blockquote><p>Alice and Bob are using legacy codebases and need to negotiate parameters they both support. You&rsquo;ve man-in-the-middled this negotiation step, and can passively observe thereafter. How are you going to ruin their day this time?</p><p>Connect at <code>nc socket.cryptohack.org 13379</code></p></blockquote><h3 id=solution-17>Solution<a hidden class=anchor aria-hidden=true href=#solution-17>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sage.all</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>json</span> <span class=kn>import</span> <span class=n>loads</span><span class=p>,</span> <span class=n>dumps</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>is_pkcs7_padded</span><span class=p>(</span><span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>padding</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=o>-</span><span class=n>message</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]:]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>all</span><span class=p>(</span><span class=n>padding</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>padding</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>padding</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_flag</span><span class=p>(</span><span class=n>shared_secret</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Derive AES key from shared secret</span>
</span></span><span class=line><span class=cl>    <span class=n>sha1</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>sha1</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>shared_secret</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>sha1</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=c1># Decrypt flag</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>is_pkcs7_padded</span><span class=p>(</span><span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>plaintext</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s1>&#39;socket.cryptohack.org&#39;</span><span class=p>,</span> <span class=mi>13379</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Alice -&gt; Us</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>readuntilS</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;Alice: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Us -&gt; Bob</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;supported&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;DH64&#34;</span><span class=p>]})</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;latin&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Bob: &#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Bob -&gt; Us</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>readuntilS</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;Bob: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Us -&gt; Alice</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>readline</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Alice: &#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Alice -&gt; Us</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>readuntilS</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;Alice: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>json</span> <span class=o>=</span> <span class=n>loads</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>readlineS</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>GF</span><span class=p>(</span><span class=n>json</span><span class=p>[</span><span class=s1>&#39;p&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=n>p</span><span class=p>(</span><span class=n>json</span><span class=p>[</span><span class=s1>&#39;g&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>A</span> <span class=o>=</span> <span class=n>p</span><span class=p>(</span><span class=n>json</span><span class=p>[</span><span class=s1>&#39;A&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Bob -&gt; Us</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>readuntilS</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;Bob: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>json</span> <span class=o>=</span> <span class=n>loads</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>readlineS</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>B</span> <span class=o>=</span> <span class=n>p</span><span class=p>(</span><span class=n>json</span><span class=p>[</span><span class=s1>&#39;B&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Alice -&gt; Us</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>readuntilS</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;Alice: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>json</span> <span class=o>=</span> <span class=n>loads</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>readlineS</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=n>json</span><span class=p>[</span><span class=s1>&#39;iv&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>ct</span> <span class=o>=</span> <span class=n>json</span><span class=p>[</span><span class=s1>&#39;encrypted_flag&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Decrypt</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=n>discrete_log</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>g</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>shared_key</span> <span class=o>=</span> <span class=n>B</span><span class=o>**</span><span class=n>n</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=n>decrypt_flag</span><span class=p>(</span><span class=n>shared_key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ct</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Alternate solution(s):<figure class=image-caption><img alt=ans srcset="/posts/cryptohack/public-key_cryptography/images/ans_hu8f6eb0a3b2506aacee90ff8d6ad5b0b1_234959_480x0_resize_q75_h2_box_3.webp 480w,
/posts/cryptohack/public-key_cryptography/images/ans_hu8f6eb0a3b2506aacee90ff8d6ad5b0b1_234959_768x0_resize_q75_h2_box_3.webp 768w,
/posts/cryptohack/public-key_cryptography/images/ans_hu8f6eb0a3b2506aacee90ff8d6ad5b0b1_234959_1024x0_resize_q75_h2_box_3.webp 1024w" sizes=100vw src=images/ans.png width=768 height=432 loading=lazy><figcaption>[ <em>image source: CryptoHack user @FELD</em> ]</figcaption></figure></p><p><strong>flag:</strong> <code>crypto{d0wn6r4d35_4r3_d4n63r0u5}</code></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://woadey.xyz/tags/crypto/>Crypto</a></li><li><a href=https://woadey.xyz/tags/rsa/>Rsa</a></li><li><a href=https://woadey.xyz/tags/dh/>Dh</a></li></ul><nav class=paginav><a class=prev href=https://woadey.xyz/posts/htb/easy/inject/><span class=title>« Prev</span><br><span>HTB Writeup: Inject</span>
</a><a class=next href=https://woadey.xyz/posts/cryptohack/symmetric_cryptography/><span class=title>Next »</span><br><span>CryptoHack Writeup: Symmetric Cryptography</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://woadey.xyz/>woadey</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>